 <!DOCTYPE html>
		<html
			class="layout layout-holy-grail   show-table-of-contents conceptual show-breadcrumb default-focus"
			lang="en-us"
			dir="ltr"
			data-authenticated="false"
			data-auth-status-determined="false"
			data-target="docs"
			x-ms-format-detection="none"
		>
			
		
<!-- Mirrored from learn.microsoft.com/en-us/aspnet/core/security/enforcing-ssl?view=aspnetcore-9.0 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 06 Aug 2025 14:53:03 GMT -->
<head>
			<title>Enforce HTTPS in ASP.NET Core | Microsoft Learn</title>
			<meta charset="utf-8" />
			<meta name="viewport" content="width=device-width, initial-scale=1.0" />
			<meta name="color-scheme" content="light dark" />

			<meta name="description" content="Learn how to require HTTPS/TLS in an ASP.NET Core web app." />
			<link rel="canonical" href="enforcing-ssl553c.html?view=aspnetcore-9.0" /> 

			<!-- Non-customizable open graph and sharing-related metadata -->
			<meta name="twitter:card" content="summary" />
			<meta name="twitter:site" content="@MicrosoftLearn" />
			<meta property="og:type" content="website" />
			<meta property="og:image:alt" content="Enforce HTTPS in ASP.NET Core | Microsoft Learn" />
			<meta property="og:image" content="https://learn.microsoft.com/dotnet/media/dotnet-logo.png" />
			<!-- Page specific open graph and sharing-related metadata -->
			<meta property="og:title" content="Enforce HTTPS in ASP.NET Core" />
			<meta property="og:url" content="enforcing-ssl553c.html?view=aspnetcore-9.0" />
			<meta property="og:description" content="Learn how to require HTTPS/TLS in an ASP.NET Core web app." />
			<meta name="platform_id" content="e161f75c-cfd4-c97f-1775-dd3922db0100" /> <meta name="scope" content="ASP.NET Core" />
			<meta name="locale" content="en-us" />
			 <meta name="adobe-target" content="true" />
			<meta name="uhfHeaderId" content="MSDocsHeader-AspNet" />

			<meta name="page_type" content="conceptual" />

			<!--page specific meta tags-->
			

			<!-- custom meta tags -->
			
		<meta name="breadcrumb_path" content="/aspnet/core/breadcrumb/toc.json" />
	
		<meta name="feedback_system" content="OpenSource" />
	
		<meta name="feedback_product_url" content="https://github.com/dotnet/aspnetcore/blob/main/CONTRIBUTING.md" />
	
		<meta name="ms.service" content="aspnet-core" />
	
		<meta name="ms.topic" content="conceptual" />
	
		<meta name="ms.subservice" content="security" />
	
		<meta name="author" content="tdykstra" />
	
		<meta name="ms.author" content="tdykstra" />
	
		<meta name="monikerRange" content="&gt;= aspnetcore-3.0" />
	
		<meta name="ms.custom" content="mvc, linux-related-content" />
	
		<meta name="ms.date" content="2024-10-24T00:00:00Z" />
	
		<meta name="uid" content="security/enforcing-ssl" />
	
		<meta name="document_id" content="c7ddfb2f-5dea-5e31-2a27-02a4dc16104c" />
	
		<meta name="document_version_independent_id" content="12ca0b9a-2638-a4ce-c45f-d4579c83dafb" />
	
		<meta name="updated_at" content="2025-07-30T11:33:00Z" />
	
		<meta name="original_content_git_url" content="https://github.com/dotnet/AspNetCore.Docs/blob/live/aspnetcore/security/enforcing-ssl.md" />
	
		<meta name="gitcommit" content="https://github.com/dotnet/AspNetCore.Docs/blob/879a03201958c8aea52cdfa611a1272865b09707/aspnetcore/security/enforcing-ssl.md" />
	
		<meta name="git_commit_id" content="879a03201958c8aea52cdfa611a1272865b09707" />
	
		<meta name="monikers" content="aspnetcore-3.0" />
	
		<meta name="monikers" content="aspnetcore-3.1" />
	
		<meta name="monikers" content="aspnetcore-5.0" />
	
		<meta name="monikers" content="aspnetcore-6.0" />
	
		<meta name="monikers" content="aspnetcore-7.0" />
	
		<meta name="monikers" content="aspnetcore-8.0" />
	
		<meta name="monikers" content="aspnetcore-9.0" />
	
		<meta name="monikers" content="aspnetcore-10.0" />
	
		<meta name="default_moniker" content="aspnetcore-9.0" />
	
		<meta name="site_name" content="Docs" />
	
		<meta name="depot_name" content="MSDN.aspnet-core-conceptual" />
	
		<meta name="schema" content="Conceptual" />
	
		<meta name="toc_rel" content="../toc.json" />
	
		<meta name="pdf_url_template" content="https://learn.microsoft.com/pdfstore/en-us/MSDN.aspnet-core-conceptual/{branchName}{pdfName}" />
	
		<meta name="feedback_help_link_type" content="" />
	
		<meta name="feedback_help_link_url" content="" />
	
		<meta name="word_count" content="16702" />
	
		<meta name="config_moniker_range" content="&gt;= aspnetcore-1.0" />
	
		<meta name="asset_id" content="security/enforcing-ssl" />
	
		<meta name="moniker_range_name" content="baeba9fa90d1bd6d351857ae16d477a8" />
	
		<meta name="item_type" content="Content" />
	
		<meta name="source_path" content="aspnetcore/security/enforcing-ssl.md" />
	
		<meta name="previous_tlsh_hash" content="0E85B0A3854ED614EF924D1E285FB70192F4C18AEEE079C021167DD2D16E6FA767662D9BC113B2C837326AC20291824F41E5FBBB522C335B197614AF839C3285FB9C27F5DA" />
	
		<meta name="github_feedback_content_git_url" content="https://github.com/dotnet/AspNetCore.Docs/blob/main/aspnetcore/security/enforcing-ssl.md" />
	 
		<meta name="cmProducts" content="https://authoring-docs-microsoft.poolparty.biz/devrel/d452572f-6212-498f-9050-ca4a9e50a425" data-source="generated" />
	
		<meta name="cmProducts" content="https://authoring-docs-microsoft.poolparty.biz/devrel/7696cda6-0510-47f6-8302-71bb5d2e28cf" data-source="generated" />
	
		<meta name="cmProducts" content="https://authoring-docs-microsoft.poolparty.biz/devrel/bcbcbad5-4208-4783-8035-8481272c98b8" data-source="generated" />
	
		<meta name="spProducts" content="https://authoring-docs-microsoft.poolparty.biz/devrel/a12e40b7-59a2-4437-96e2-166ce622b864" data-source="generated" />
	
		<meta name="spProducts" content="https://authoring-docs-microsoft.poolparty.biz/devrel/69c76c32-967e-4c65-b89a-74cc527db725" data-source="generated" />
	
		<meta name="spProducts" content="https://authoring-docs-microsoft.poolparty.biz/devrel/43b2e5aa-8a6d-4de2-a252-692232e5edc8" data-source="generated" />
	

			<!-- assets and js globals -->
			
			<link rel="stylesheet" href="https://learn.microsoft.com/static/assets/0.4.03137.7032-e8b681c0/styles/site-ltr.css" />
			<link rel="preconnect" href="http://mscom.demdex.net/" crossorigin />
						<link rel="dns-prefetch" href="http://target.microsoft.com/" />
						<link rel="dns-prefetch" href="http://microsoftmscompoc.tt.omtrdc.net/" />
						<link
							rel="preload"
							as="script"
							href="https://learn.microsoft.com/static/third-party/adobe-target/at-js/2.9.0/at.js"
							integrity="sha384-1/viVM50hgc33O2gOgkWz3EjiD/Fy/ld1dKYXJRUyjNYVEjSUGcSN+iPiQF7e4cu"
							crossorigin="anonymous"
							id="adobe-target-script"
							type="application/javascript"
						/>
			<script src="https://wcpstatic.microsoft.com/mscc/lib/v2/wcp-consent.js"></script>
			<script src="https://js.monitor.azure.com/scripts/c/ms.jsll-4.min.js"></script>
			<script src="https://learn.microsoft.com/_themes/docs.theme/master/en-us/_themes/global/deprecation.js"></script>

			<!-- msdocs global object -->
			<script id="msdocs-script">
		var msDocs = {
  "environment": {
    "accessLevel": "online",
    "azurePortalHostname": "portal.azure.com",
    "reviewFeatures": false,
    "supportLevel": "production",
    "systemContent": true,
    "siteName": "learn",
    "legacyHosting": false
  },
  "data": {
    "contentLocale": "en-us",
    "contentDir": "ltr",
    "userLocale": "en-us",
    "userDir": "ltr",
    "pageTemplate": "Conceptual",
    "brand": "",
    "context": {},
    "standardFeedback": false,
    "showFeedbackReport": false,
    "feedbackHelpLinkType": "",
    "feedbackHelpLinkUrl": "",
    "feedbackSystem": "OpenSource",
    "feedbackGitHubRepo": "dotnet/AspNetCore.Docs",
    "feedbackProductUrl": "https://github.com/dotnet/aspnetcore/blob/main/CONTRIBUTING.md",
    "extendBreadcrumb": false,
    "isEditDisplayable": true,
    "isPrivateUnauthorized": false,
    "hideViewSource": false,
    "isPermissioned": false,
    "hasRecommendations": true,
    "contributors": [
      {
        "name": "tdykstra",
        "url": "https://github.com/tdykstra"
      },
      {
        "name": "Copilot",
        "url": "https://github.com/Copilot"
      },
      {
        "name": "guardrex",
        "url": "https://github.com/guardrex"
      },
      {
        "name": "Rick-Anderson",
        "url": "https://github.com/Rick-Anderson"
      },
      {
        "name": "amcasey",
        "url": "https://github.com/amcasey"
      },
      {
        "name": "dbradish-microsoft",
        "url": "https://github.com/dbradish-microsoft"
      },
      {
        "name": "jposert",
        "url": "https://github.com/jposert"
      },
      {
        "name": "bftelman",
        "url": "https://github.com/bftelman"
      },
      {
        "name": "v-thepet",
        "url": "https://github.com/v-thepet"
      },
      {
        "name": "postmeback",
        "url": "https://github.com/postmeback"
      },
      {
        "name": "fredrik0x",
        "url": "https://github.com/fredrik0x"
      },
      {
        "name": "jooooel",
        "url": "https://github.com/jooooel"
      },
      {
        "name": "serpent5",
        "url": "https://github.com/serpent5"
      },
      {
        "name": "sgryphon",
        "url": "https://github.com/sgryphon"
      },
      {
        "name": "GitHubPang",
        "url": "https://github.com/GitHubPang"
      },
      {
        "name": "mthalman",
        "url": "https://github.com/mthalman"
      },
      {
        "name": "khalidabuhakmeh",
        "url": "https://github.com/khalidabuhakmeh"
      },
      {
        "name": "mrnustik",
        "url": "https://github.com/mrnustik"
      },
      {
        "name": "DCtheGeek",
        "url": "https://github.com/DCtheGeek"
      },
      {
        "name": "scottaddie",
        "url": "https://github.com/scottaddie"
      },
      {
        "name": "donhuvy",
        "url": "https://github.com/donhuvy"
      },
      {
        "name": "Rusty-1",
        "url": "https://github.com/Rusty-1"
      },
      {
        "name": "rbsec",
        "url": "https://github.com/rbsec"
      },
      {
        "name": "nschonni",
        "url": "https://github.com/nschonni"
      },
      {
        "name": "hajekj",
        "url": "https://github.com/hajekj"
      },
      {
        "name": "blowdart",
        "url": "https://github.com/blowdart"
      },
      {
        "name": "Ffloriel",
        "url": "https://github.com/Ffloriel"
      },
      {
        "name": "v-anpasi",
        "url": "https://github.com/v-anpasi"
      },
      {
        "name": "danroth27",
        "url": "https://github.com/danroth27"
      }
    ],
    "openSourceFeedbackIssueUrl": "https://github.com/dotnet/aspnetcore.docs/issues/new?template=customer-feedback.yml",
    "openSourceFeedbackIssueTitle": "",
    "openSourceFeedbackIssueLabels": "Source - Docs.ms,:watch: Not Triaged"
  },
  "functions": {}
};;
	</script>

			<!-- base scripts, msdocs global should be before this -->
			<script src="https://learn.microsoft.com/static/assets/0.4.03137.7032-e8b681c0/scripts/en-us/index-docs.js"></script>
			

			<!-- json-ld -->
			
		</head>
	
			<body
				id="body"
				data-bi-name="body"
				class="layout-body "
				lang="en-us"
				dir="ltr"
			>
				<header class="layout-body-header">
		<div class="header-holder has-default-focus">
			
		<a
			href="#main"
			
			style="z-index: 1070"
			class="outline-color-text visually-hidden-until-focused position-fixed inner-focus focus-visible top-0 left-0 right-0 padding-xs text-align-center background-color-body"
			
		>
			Skip to main content
		</a>
	
		<a
			href="#"
			data-skip-to-ask-learn
			style="z-index: 1070"
			class="outline-color-text visually-hidden-until-focused position-fixed inner-focus focus-visible top-0 left-0 right-0 padding-xs text-align-center background-color-body"
			hidden
		>
			Skip to Ask Learn chat experience
		</a>
	

			<div hidden id="cookie-consent-holder" data-test-id="cookie-consent-container"></div>
			<!-- Unsupported browser warning -->
			<div
				id="unsupported-browser"
				style="background-color: white; color: black; padding: 16px; border-bottom: 1px solid grey;"
				hidden
			>
				<div style="max-width: 800px; margin: 0 auto;">
					<p style="font-size: 24px">This browser is no longer supported.</p>
					<p style="font-size: 16px; margin-top: 16px;">
						Upgrade to Microsoft Edge to take advantage of the latest features, security updates, and technical support.
					</p>
					<div style="margin-top: 12px;">
						<a
							href="https://go.microsoft.com/fwlink/p/?LinkID=2092881"
							style="background-color: #0078d4; border: 1px solid #0078d4; color: white; padding: 6px 12px; border-radius: 2px; display: inline-block;"
						>
							Download Microsoft Edge
						</a>
						<a
							href="https://learn.microsoft.com/en-us/lifecycle/faq/internet-explorer-microsoft-edge"
							style="background-color: white; padding: 6px 12px; border: 1px solid #505050; color: #171717; border-radius: 2px; display: inline-block;"
						>
							More info about Internet Explorer and Microsoft Edge
						</a>
					</div>
				</div>
			</div>
			<!-- site header -->
			<header
				id="ms--site-header"
				data-test-id="site-header-wrapper"
				role="banner"
				itemscope="itemscope"
				itemtype="http://schema.org/Organization"
			>
				<div
					id="ms--mobile-nav"
					class="site-header display-none-tablet padding-inline-none gap-none"
					data-bi-name="mobile-header"
					data-test-id="mobile-header"
				></div>
				<div
					id="ms--primary-nav"
					class="site-header display-none display-flex-tablet"
					data-bi-name="L1-header"
					data-test-id="primary-header"
				></div>
				<div
					id="ms--secondary-nav"
					class="site-header display-none display-flex-tablet"
					data-bi-name="L2-header"
					data-test-id="secondary-header"
				></div>
			</header>
			
		<!-- banner -->
		<div data-banner>
			<div id="disclaimer-holder"></div>
			
		</div>
		<!-- banner end -->
	
		</div>
	</header>
				 <section
					id="layout-body-menu"
					class="layout-body-menu display-flex"
					data-bi-name="menu"
			  >
					<div
		id="left-container"
		class="left-container display-none display-block-tablet padding-inline-sm padding-bottom-sm width-full"
	>
		<nav
			id="affixed-left-container"
			class="margin-top-sm-tablet position-sticky display-flex flex-direction-column"
			aria-label="Primary"
		></nav>
	</div>
			  </section>

				<main
					id="main"
					role="main"
					class="layout-body-main "
					data-bi-name="content"
					lang="en-us"
					dir="ltr"
				>
					
			<div
		id="ms--content-header"
		class="content-header default-focus border-bottom-none"
		data-bi-name="content-header"
	>
		<div class="content-header-controls margin-xxs margin-inline-sm-tablet">
			<button
				type="button"
				class="contents-button button button-sm margin-right-xxs"
				data-bi-name="contents-expand"
				aria-haspopup="true"
				data-contents-button
			>
				<span class="icon" aria-hidden="true"><span class="docon docon-menu"></span></span>
				<span class="contents-expand-title"> Table of contents </span>
			</button>
			<button
				type="button"
				class="ap-collapse-behavior ap-expanded button button-sm"
				data-bi-name="ap-collapse"
				aria-controls="action-panel"
			>
				<span class="icon" aria-hidden="true"><span class="docon docon-exit-mode"></span></span>
				<span>Exit editor mode</span>
			</button>
		</div>
	</div>
			<div data-main-column class="padding-sm padding-top-none padding-top-sm-tablet">
				<div>
					
		<div id="article-header" class="background-color-body margin-bottom-xs display-none-print">
			<div class="display-flex align-items-center justify-content-space-between">
				
		<details
			id="article-header-breadcrumbs-overflow-popover"
			class="popover"
			data-for="article-header-breadcrumbs"
		>
			<summary
				class="button button-clear button-primary button-sm inner-focus"
				aria-label="All breadcrumbs"
			>
				<span class="icon">
					<span class="docon docon-more"></span>
				</span>
			</summary>
			<div id="article-header-breadcrumbs-overflow" class="popover-content padding-none"></div>
		</details>

		<bread-crumbs
			id="article-header-breadcrumbs"
			data-test-id="article-header-breadcrumbs"
			class="overflow-hidden flex-grow-1 margin-right-sm margin-right-md-tablet margin-right-lg-desktop margin-left-negative-xxs padding-left-xxs"
		></bread-crumbs>
	 
		<div
			id="article-header-page-actions"
			class="opacity-none margin-left-auto display-flex flex-wrap-no-wrap align-items-stretch"
		>
			
		<button
			class="button button-sm border-none inner-focus display-none-tablet flex-shrink-0 "
			data-bi-name="ask-learn-assistant-entry"
			data-test-id="ask-learn-assistant-modal-entry-mobile"
			data-ask-learn-modal-entry
			type="button"
			style="min-width: max-content;"
			aria-expanded="false"
			aria-label="Ask Learn"
			hidden
		>
			<span class="icon font-size-lg" aria-hidden="true">
				<span class="docon docon-chat-sparkle-fill gradient-ask-learn-logo"></span>
			</span>
		</button>
		<button
			class="button button-sm display-none display-inline-flex-tablet display-none-desktop flex-shrink-0 margin-right-xxs border-color-ask-learn "
			data-bi-name="ask-learn-assistant-entry"
			data-test-id="ask-learn-assistant-modal-entry-tablet"
			data-ask-learn-modal-entry
			type="button"
			style="min-width: max-content;"
			aria-expanded="false"
			hidden
		>
			<span class="icon font-size-lg" aria-hidden="true">
				<span class="docon docon-chat-sparkle-fill gradient-ask-learn-logo"></span>
			</span>
			<span>Ask Learn</span>
		</button>
		<button
			class="button button-sm display-none flex-shrink-0 display-inline-flex-desktop margin-right-xxs	border-color-ask-learn "
			data-bi-name="ask-learn-assistant-entry"
			data-test-id="ask-learn-assistant-flyout-entry"
			data-ask-learn-flyout-entry
			data-flyout-button="toggle"
			type="button"
			style="min-width: max-content;"
			aria-expanded="false"
			aria-controls="ask-learn-flyout"
			hidden
		>
			<span class="icon font-size-lg" aria-hidden="true">
				<span class="docon docon-chat-sparkle-fill gradient-ask-learn-logo"></span>
			</span>
			<span>Ask Learn</span>
		</button>
	 
		<button
			type="button"
			id="ms--focus-mode-button"
			data-focus-mode
			data-bi-name="focus-mode-entry"
			class="button button-sm flex-shrink-0 margin-right-xxs display-none display-inline-flex-desktop"
		>
			<span class="icon font-size-lg" aria-hidden="true">
				<span class="docon docon-glasses"></span>
			</span>
			<span>Focus mode</span>
		</button>
	 

			<details class="popover popover-right" id="article-header-page-actions-overflow">
				<summary
					class="justify-content-flex-start button button-clear button-sm button-primary inner-focus"
					aria-label="More actions"
					title="More actions"
				>
					<span class="icon" aria-hidden="true">
						<span class="docon docon-more-vertical"></span>
					</span>
				</summary>
				<div class="popover-content">
					
		<button
			data-page-action-item="overflow-mobile"
			type="button"
			class="button-block button-sm has-inner-focus button button-clear display-none-tablet justify-content-flex-start text-align-left"
			data-bi-name="contents-expand"
			data-contents-button
			data-popover-close
		>
			<span class="icon">
				<span class="docon docon-editor-list-bullet" aria-hidden="true"></span>
			</span>
			<span class="contents-expand-title">Table of contents</span>
		</button>
	 
		<a
			id="lang-link-overflow"
			class="button-sm has-inner-focus button button-clear button-block justify-content-flex-start text-align-left"
			data-bi-name="language-toggle"
			data-page-action-item="overflow-all"
			data-check-hidden="true"
			data-read-in-link
			href="#"
			hidden
		>
			<span class="icon" aria-hidden="true" data-read-in-link-icon>
				<span class="docon docon-locale-globe"></span>
			</span>
			<span data-read-in-link-text>Read in English</span>
		</a>
	 
		<button
			type="button"
			class="collection button button-clear button-sm button-block justify-content-flex-start text-align-left inner-focus"
			data-list-type="collection"
			data-bi-name="collection"
			data-page-action-item="overflow-all"
			data-check-hidden="true"
			data-popover-close
		>
			<span class="icon" aria-hidden="true">
				<span class="docon docon-circle-addition"></span>
			</span>
			<span class="collection-status">Add</span>
		</button>
	
					
		<button
			type="button"
			class="collection button button-block button-clear button-sm justify-content-flex-start text-align-left inner-focus"
			data-list-type="plan"
			data-bi-name="plan"
			data-page-action-item="overflow-all"
			data-check-hidden="true"
			data-popover-close
			hidden
		>
			<span class="icon" aria-hidden="true">
				<span class="docon docon-circle-addition"></span>
			</span>
			<span class="plan-status">Add to plan</span>
		</button>
	  
		<a
			data-contenteditbtn
			class="button button-clear button-block button-sm inner-focus justify-content-flex-start text-align-left text-decoration-none"
			data-bi-name="edit"
			
			href="https://github.com/dotnet/AspNetCore.Docs/blob/main/aspnetcore/security/enforcing-ssl.md"
			data-original_content_git_url="https://github.com/dotnet/AspNetCore.Docs/blob/live/aspnetcore/security/enforcing-ssl.md"
			data-original_content_git_url_template="{repo}/blob/{branch}/aspnetcore/security/enforcing-ssl.md"
			data-pr_repo=""
			data-pr_branch=""
		>
			<span class="icon" aria-hidden="true">
				<span class="docon docon-edit-outline"></span>
			</span>
			<span>Edit</span>
		</a>
	
					
		<hr class="margin-block-xxs" />
		<h4 class="font-size-sm padding-left-xxs">Share via</h4>
		
					<a
						class="button button-clear button-sm inner-focus button-block justify-content-flex-start text-align-left text-decoration-none share-facebook"
						data-bi-name="facebook"
						data-page-action-item="overflow-all"
						href="#"
					>
						<span class="icon color-primary" aria-hidden="true">
							<span class="docon docon-facebook-share"></span>
						</span>
						<span>Facebook</span>
					</a>

					<a
						href="#"
						class="button button-clear button-sm inner-focus button-block justify-content-flex-start text-align-left text-decoration-none share-twitter"
						data-bi-name="twitter"
						data-page-action-item="overflow-all"
					>
						<span class="icon color-text" aria-hidden="true">
							<span class="docon docon-xlogo-share"></span>
						</span>
						<span>x.com</span>
					</a>

					<a
						href="#"
						class="button button-clear button-sm inner-focus button-block justify-content-flex-start text-align-left text-decoration-none share-linkedin"
						data-bi-name="linkedin"
						data-page-action-item="overflow-all"
					>
						<span class="icon color-primary" aria-hidden="true">
							<span class="docon docon-linked-in-logo"></span>
						</span>
						<span>LinkedIn</span>
					</a>
					<a
						href="#"
						class="button button-clear button-sm inner-focus button-block justify-content-flex-start text-align-left text-decoration-none share-email"
						data-bi-name="email"
						data-page-action-item="overflow-all"
					>
						<span class="icon color-primary" aria-hidden="true">
							<span class="docon docon-mail-message"></span>
						</span>
						<span>Email</span>
					</a>
			  
	 
		<hr class="margin-block-xxs" />
		<button
			class="button button-block button-clear button-sm justify-content-flex-start text-align-left inner-focus"
			type="button"
			data-bi-name="print"
			data-page-action-item="overflow-all"
			data-popover-close
			data-print-page
			data-check-hidden="true"
		>
			<span class="icon color-primary" aria-hidden="true">
				<span class="docon docon-print"></span>
			</span>
			<span>Print</span>
		</button>
	
				</div>
			</details>
		</div>
	
			</div>
		</div>
	
					<!-- azure disclaimer -->
					
					<!-- privateUnauthorizedTemplate is hidden by default -->
					
		<div unauthorized-private-section data-bi-name="permission-content-unauthorized-private" hidden>
			<hr class="hr margin-top-xs margin-bottom-sm" />
			<div class="notification notification-info">
				<div class="notification-content">
					<p class="margin-top-none notification-title">
						<span class="icon">
							<span class="docon docon-exclamation-circle-solid" aria-hidden="true"></span>
						</span>
						<span>Note</span>
					</p>
					<p class="margin-top-none authentication-determined not-authenticated">
						Access to this page requires authorization. You can try <a class="docs-sign-in" href="#" data-bi-name="permission-content-sign-in">signing in</a> or <a  class="docs-change-directory" data-bi-name="permisson-content-change-directory">changing directories</a>.
					</p>
					<p class="margin-top-none authentication-determined authenticated">
						Access to this page requires authorization. You can try <a class="docs-change-directory" data-bi-name="permisson-content-change-directory">changing directories</a>.
					</p>
				</div>
			</div>
		</div>
	
					<div class="content"><h1 id="enforce-https-in-aspnet-core">Enforce HTTPS in ASP.NET Core</h1></div>
					
		<div
			id="article-metadata"
			class="page-metadata-container display-flex gap-xxs justify-content-space-between align-items-center flex-wrap-wrap"
		>
			
		<div class="margin-block-xxs">
			<ul class="metadata page-metadata" data-bi-name="page info" lang="en-us" dir="ltr">
				  <li class="visibility-hidden-visual-diff">
			<local-time
				format="twoDigitNumeric"
				datetime="2024-10-25T00:43:00.000Z"
				data-article-date-source="calculated"
				class="is-invisible"
			>
				2024-10-25
			</local-time>
		</li>  
			</ul>
		</div>
	 
				<div
					id="user-feedback"
					class="margin-block-xxs display-none display-none-print"
					hidden
					data-hide-on-archived
				>
					
		<button
			id="user-feedback-button"
			data-test-id="conceptual-feedback-button"
			class="button button-sm button-clear button-primary display-none"
			type="button"
			data-bi-name="user-feedback-button"
			data-user-feedback-button
			hidden
		>
			<span class="icon" aria-hidden="true">
				<span class="docon docon-like"></span>
			</span>
			<span>Feedback</span>
		</button>
	
				</div>
		  
		</div>
	 
		<nav
			id="center-doc-outline"
			class="doc-outline is-hidden-desktop display-none-print margin-bottom-sm"
			data-bi-name="intopic toc"
			aria-label="In this article"
		>
			<h2 id="ms--in-this-article" class="title is-6 margin-block-xs">
				In this article
			</h2>
		</nav>
	
					<div class="content"><p>By <a href="https://www.linkedin.com/in/dave-galvan/" data-linktype="external">David Galvan</a> and <a href="https://twitter.com/RickAndMSFT" data-linktype="external">Rick Anderson</a></p>
<p>this article shows how to:</p>
<ul>
<li>Require HTTPS for all requests.</li>
<li>Redirect all HTTP requests to HTTPS.</li>
</ul>
<p>No API can prevent a client from sending sensitive data on the first request.</p>
<div data-moniker="aspnetcore-10.0 aspnetcore-9.0">
<div class="WARNING">
<p>Warning</p>
<h2 id="api-projects">API projects</h2>
<p>Do <strong>not</strong> use <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.mvc.requirehttpsattribute" class="no-loc" data-linktype="absolute-path">RequireHttpsAttribute</a> on Web APIs that receive sensitive information. <code>RequireHttpsAttribute</code> uses HTTP status codes to redirect browsers from HTTP to HTTPS. API clients may not understand or obey redirects from HTTP to HTTPS. Such clients may send information over HTTP. Web APIs should either:</p>
<ul>
<li>Not listen on HTTP.</li>
<li>Close the connection with status code 400 (Bad Request) and not serve the request.</li>
</ul>
<p>To disable HTTP redirection in an API, set the <code>ASPNETCORE_URLS</code> environment variable or use the <code>--urls</code> command line flag. For more information, see <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-9.0" data-linktype="relative-path">Use multiple environments in ASP.NET Core</a> and <a href="https://andrewlock.net/8-ways-to-set-the-urls-for-an-aspnetcore-app/" data-linktype="external">8 ways to set the URLs for an ASP.NET Core app</a> by Andrew Lock.</p>
<h2 id="hsts-and-api-projects">HSTS and API projects</h2>
<p>The default API projects don't include <a href="#hsts" data-linktype="self-bookmark">HSTS</a> because <a href="https://developer.mozilla.org/docs/Web/HTTP/Headers/Strict-Transport-Security" data-linktype="external">HSTS</a> is generally a browser only instruction. Other callers, such as phone or desktop apps, do <strong>not</strong> obey the instruction. Even within browsers, a single authenticated call to an API over HTTP has risks on insecure networks. The secure approach is to configure API projects to only listen to and respond over HTTPS.</p>
</div>
<p><a name="no-http"></a></p>
<h3 id="http-redirection-to-https-causes-err_invalid_redirect-on-the-cors-preflight-request">HTTP redirection to HTTPS causes ERR_INVALID_REDIRECT on the CORS preflight request</h3>
<p>Requests to an endpoint using HTTP that are redirected to HTTPS by <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.httpspolicybuilderextensions.usehttpsredirection" class="no-loc" data-linktype="absolute-path">UseHttpsRedirection</a> fail with <code>ERR_INVALID_REDIRECT</code> on the CORS preflight request.</p>
<p>API projects can reject HTTP requests rather than use <code>UseHttpsRedirection</code> to redirect requests to HTTPS.</p>
<h2 id="require-https">Require HTTPS</h2>
<p>We recommend that production ASP.NET Core web apps use:</p>
<ul>
<li>HTTPS Redirection Middleware (<a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.httpspolicybuilderextensions.usehttpsredirection" class="no-loc" data-linktype="absolute-path">UseHttpsRedirection</a>) to redirect HTTP requests to HTTPS.</li>
<li>HSTS Middleware (<a href="#http-strict-transport-security-protocol-hsts" data-linktype="self-bookmark">UseHsts</a>) to send HTTP Strict Transport Security Protocol (HSTS) headers to clients.</li>
</ul>
<div class="NOTE">
<p>Note</p>
<p>Apps deployed in a reverse proxy configuration allow the proxy to handle connection security (HTTPS). If the proxy also handles HTTPS redirection, there's no need to use HTTPS Redirection Middleware. If the proxy server also handles writing HSTS headers (for example, <a href="https://learn.microsoft.com/en-us/iis/get-started/whats-new-in-iis-10-version-1709/iis-10-version-1709-hsts#iis-100-version-1709-native-hsts-support" data-linktype="absolute-path">native HSTS support in IIS 10.0 (1709) or later</a>), HSTS Middleware isn't required by the app. For more information, see <a href="#opt-out-of-httpshsts-on-project-creation" data-linktype="self-bookmark">Opt-out of HTTPS/HSTS on project creation</a>.</p>
</div>
<h3 id="usehttpsredirection">UseHttpsRedirection</h3>
<p>The following code calls <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.httpspolicybuilderextensions.usehttpsredirection" class="no-loc" data-linktype="absolute-path">UseHttpsRedirection</a> in the <code>Program.cs</code> file:</p>
<pre><code class="lang-csharp" highlight-lines="13">var builder = WebApplication.CreateBuilder(args);

builder.Services.AddRazorPages();

var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();

app.MapRazorPages();

app.Run();
</code></pre>
<p>The preceding highlighted code:</p>
<ul>
<li>Uses the default <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.httpspolicy.httpsredirectionoptions.redirectstatuscode#microsoft-aspnetcore-httpspolicy-httpsredirectionoptions-redirectstatuscode" class="no-loc" data-linktype="absolute-path">HttpsRedirectionOptions.RedirectStatusCode</a> (<a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.statuscodes.status307temporaryredirect#microsoft-aspnetcore-http-statuscodes-status307temporaryredirect" class="no-loc" data-linktype="absolute-path">Status307TemporaryRedirect</a>).</li>
<li>Uses the default <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.httpspolicy.httpsredirectionoptions.httpsport#microsoft-aspnetcore-httpspolicy-httpsredirectionoptions-httpsport" class="no-loc" data-linktype="absolute-path">HttpsRedirectionOptions.HttpsPort</a> (null) unless overridden by the <code>ASPNETCORE_HTTPS_PORT</code> environment variable or <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.hosting.server.features.iserveraddressesfeature" class="no-loc" data-linktype="absolute-path">IServerAddressesFeature</a>.</li>
</ul>
<p>We recommend using temporary redirects rather than permanent redirects. Link caching can cause unstable behavior in development environments. If you prefer to send a permanent redirect status code when the app is in a non-Development environment, see the <a href="#configure-permanent-redirects-in-production" data-linktype="self-bookmark">Configure permanent redirects in production</a> section. We recommend using <a href="#http-strict-transport-security-protocol-hsts" data-linktype="self-bookmark">HSTS</a> to signal to clients that only secure resource requests should be sent to the app (only in production).</p>
<h3 id="port-configuration">Port configuration</h3>
<p>A port must be available for the middleware to redirect an insecure request to HTTPS. If no port is available:</p>
<ul>
<li>Redirection to HTTPS doesn't occur.</li>
<li>The middleware logs the warning "Failed to determine the https port for redirect."</li>
</ul>
<p>Specify the HTTPS port using any of the following approaches:</p>
<ul>
<li><p>Set <a href="#options" data-linktype="self-bookmark">HttpsRedirectionOptions.HttpsPort</a>.</p>
</li>
<li><p>Set the <code>https_port</code> <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/host/generic-host?view=aspnetcore-9.0#https_port" data-linktype="relative-path">host setting</a>:</p>
<ul>
<li><p>In host configuration.</p>
</li>
<li><p>By setting the <code>ASPNETCORE_HTTPS_PORT</code> environment variable.</p>
</li>
<li><p>By adding a top-level entry in <code>appsettings.json</code>:</p>
<pre><code class="lang-json" highlight-lines="2">{
  "https_port": 443,
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*"
}
</code></pre></li>
</ul>
</li>
<li><p>Indicate a port with the secure scheme using the <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/host/generic-host?view=aspnetcore-9.0#urls" data-linktype="relative-path">ASPNETCORE_URLS environment variable</a>. The environment variable configures the server. The middleware indirectly discovers the HTTPS port via <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.hosting.server.features.iserveraddressesfeature" class="no-loc" data-linktype="absolute-path">IServerAddressesFeature</a>. This approach doesn't work in reverse proxy deployments.</p>
</li>
<li><p>The ASP.NET Core web templates set an HTTPS URL in <code>Properties/launchsettings.json</code> for both Kestrel and IIS Express. <code>launchsettings.json</code> is only used on the local machine.</p>
</li>
<li><p>Configure an HTTPS URL endpoint for a public-facing edge deployment of <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Kestrel</a> server or <a href="../fundamentals/servers/httpsys553c.html?view=aspnetcore-9.0" data-linktype="relative-path">HTTP.sys</a> server. Only <strong>one HTTPS port</strong> is used by the app. The middleware discovers the port via <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.hosting.server.features.iserveraddressesfeature" class="no-loc" data-linktype="absolute-path">IServerAddressesFeature</a>.</p>
</li>
</ul>
<div class="NOTE">
<p>Note</p>
<p>When an app is run in a reverse proxy configuration, <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.hosting.server.features.iserveraddressesfeature" class="no-loc" data-linktype="absolute-path">IServerAddressesFeature</a> isn't available. Set the port using one of the other approaches described in this section.</p>
</div>
<h3 id="edge-deployments">Edge deployments</h3>
<p>When <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Kestrel</a> or <a href="../fundamentals/servers/httpsys553c.html?view=aspnetcore-9.0" data-linktype="relative-path">HTTP.sys</a> is used as a public-facing edge server, Kestrel or HTTP.sys must be configured to listen on both:</p>
<ul>
<li>The secure port where the client is redirected (typically, 443 in production and 5001 in development).</li>
<li>The insecure port (typically, 80 in production and 5000 in development).</li>
</ul>
<p>The insecure port must be accessible by the client in order for the app to receive an insecure request and redirect the client to the secure port.</p>
<p>For more information, see <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0#endpoint-configuration" data-linktype="relative-path">Kestrel endpoint configuration</a> or <a href="../fundamentals/servers/httpsys553c.html?view=aspnetcore-9.0" data-linktype="relative-path">HTTP.sys web server implementation in ASP.NET Core</a>.</p>
<h3 id="deployment-scenarios">Deployment scenarios</h3>
<p>Any firewall between the client and server must also have communication ports open for traffic.</p>
<p>If requests are forwarded in a reverse proxy configuration, use <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/proxy-load-balancer?view=aspnetcore-9.0" data-linktype="relative-path">Forwarded Headers Middleware</a> before calling HTTPS Redirection Middleware. Forwarded Headers Middleware updates the <code>Request.Scheme</code>, using the <code>X-Forwarded-Proto</code> header. The middleware permits redirect URIs and other security policies to work correctly. When Forwarded Headers Middleware isn't used, the backend app might not receive the correct scheme and end up in a redirect loop. A common end user error message is that too many redirects have occurred.</p>
<p>When deploying to Azure App Service, follow the guidance in <a href="https://learn.microsoft.com/en-us/azure/app-service/app-service-web-tutorial-custom-ssl" data-linktype="absolute-path">Tutorial: Bind an existing custom SSL certificate to Azure Web Apps</a>.</p>
<h3 id="options">Options</h3>
<p>The following highlighted code calls <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.httpsredirectionservicesextensions.addhttpsredirection" class="no-loc" data-linktype="absolute-path">AddHttpsRedirection</a> to configure middleware options:</p>
<pre><code class="lang-csharp" highlight-lines="16-20">using static Microsoft.AspNetCore.Http.StatusCodes;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddRazorPages();

builder.Services.AddHsts(options =&gt;
{
    options.Preload = true;
    options.IncludeSubDomains = true;
    options.MaxAge = TimeSpan.FromDays(60);
    options.ExcludedHosts.Add("example.com");
    options.ExcludedHosts.Add("www.example.com");
});

builder.Services.AddHttpsRedirection(options =&gt;
{
    options.RedirectStatusCode = Status307TemporaryRedirect;
    options.HttpsPort = 5001;
});

var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();

app.MapRazorPages();

app.Run();
</code></pre>
<p>Calling <code>AddHttpsRedirection</code> is only necessary to change the values of <code>HttpsPort</code> or <code>RedirectStatusCode</code>.</p>
<p>The preceding highlighted code:</p>
<ul>
<li>Sets <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.httpspolicy.httpsredirectionoptions.redirectstatuscode" class="no-loc" data-linktype="absolute-path">HttpsRedirectionOptions.RedirectStatusCode</a> to <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.statuscodes.status307temporaryredirect#microsoft-aspnetcore-http-statuscodes-status307temporaryredirect" class="no-loc" data-linktype="absolute-path">Status307TemporaryRedirect</a>, which is the default value. Use the fields of the <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.statuscodes" class="no-loc" data-linktype="absolute-path">StatusCodes</a> class for assignments to <code>RedirectStatusCode</code>.</li>
<li>Sets the HTTPS port to 5001.</li>
</ul>
<h4 id="configure-permanent-redirects-in-production">Configure permanent redirects in production</h4>
<p>The middleware defaults to sending a <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.statuscodes.status307temporaryredirect#microsoft-aspnetcore-http-statuscodes-status307temporaryredirect" class="no-loc" data-linktype="absolute-path">Status307TemporaryRedirect</a> with all redirects. If you prefer to send a permanent redirect status code when the app is in a non-Development environment, wrap the middleware options configuration in a conditional check for a non-Development environment.</p>
<p>When configuring services in <code>Program.cs</code>:</p>
<pre><code class="lang-csharp" highlight-lines="7-14">using static Microsoft.AspNetCore.Http.StatusCodes;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddRazorPages();

if (!builder.Environment.IsDevelopment())
{
    builder.Services.AddHttpsRedirection(options =&gt;
    {
        options.RedirectStatusCode = Status308PermanentRedirect;
        options.HttpsPort = 443;
    });
}

var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");

    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();

app.MapRazorPages();

app.Run();
</code></pre><h2 id="https-redirection-middleware-alternative-approach">HTTPS Redirection Middleware alternative approach</h2>
<p>An alternative to using HTTPS Redirection Middleware (<code>UseHttpsRedirection</code>) is to use URL Rewriting Middleware (<code>AddRedirectToHttps</code>). <code>AddRedirectToHttps</code> can also set the status code and port when the redirect is executed. For more information, see <a href="../fundamentals/url-rewriting553c.html?view=aspnetcore-9.0" data-linktype="relative-path">URL Rewriting Middleware</a>.</p>
<p>When redirecting to HTTPS without the requirement for additional redirect rules, we recommend using HTTPS Redirection Middleware (<code>UseHttpsRedirection</code>) described in this article.</p>
<p><a name="hsts"></a></p>
<h2 id="http-strict-transport-security-protocol-hsts">HTTP Strict Transport Security Protocol (HSTS)</h2>
<p>Per <a href="https://www.owasp.org/index.php/About_The_Open_Web_Application_Security_Project" data-linktype="external">OWASP</a>, <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Strict_Transport_Security_Cheat_Sheet.html" data-linktype="external">HTTP Strict Transport Security (HSTS)</a> is an opt-in security enhancement that's specified by a web app through the use of a response header. When a <a href="https://cheatsheetseries.owasp.org/cheatsheets/Transport_Layer_Protection_Cheat_Sheet.html#browser-support" data-linktype="external">browser that supports HSTS</a> receives this header:</p>
<ul>
<li>The browser stores configuration for the domain that prevents sending any communication over HTTP. The browser forces all communication over HTTPS.</li>
<li>The browser prevents the user from using untrusted or invalid certificates. The browser disables prompts that allow a user to temporarily trust such a certificate.</li>
</ul>
<p>Because <a href="https://developer.mozilla.org/docs/Web/HTTP/Headers/Strict-Transport-Security" data-linktype="external">HSTS</a> is enforced by the client, it has some limitations:</p>
<ul>
<li>The client must support HSTS.</li>
<li>HSTS requires at least one successful HTTPS request to establish the HSTS policy.</li>
<li>The application must check every HTTP request and redirect or reject the HTTP request.</li>
</ul>
<p>ASP.NET Core implements HSTS with the <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.hstsbuilderextensions.usehsts" class="no-loc" data-linktype="absolute-path">UseHsts</a> extension method. The following code calls <code>UseHsts</code> when the app isn't in <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-9.0" data-linktype="relative-path">development mode</a>:</p>
<pre><code class="lang-csharp" highlight-lines="10">var builder = WebApplication.CreateBuilder(args);

builder.Services.AddRazorPages();

var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();

app.MapRazorPages();

app.Run();
</code></pre>
<p><code>UseHsts</code> isn't recommended in development because the HSTS settings are highly cacheable by browsers. By default, <code>UseHsts</code> excludes the local loopback address.</p>
<p>For production environments that are implementing HTTPS for the first time, set the initial <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.httpspolicy.hstsoptions.maxage" class="no-loc" data-linktype="absolute-path">HstsOptions.MaxAge</a> to a small value using one of the <a href="https://learn.microsoft.com/en-us/dotnet/api/system.timespan" class="no-loc" data-linktype="absolute-path">TimeSpan</a> methods. Set the value from hours to no more than a single day in case you need to revert the HTTPS infrastructure to HTTP. After you're confident in the sustainability of the HTTPS configuration, increase the HSTS <code>max-age</code> value; a commonly used value is one year.</p>
<p>The following highlighted code:</p>
<pre><code class="lang-csharp" highlight-lines="7-14">using static Microsoft.AspNetCore.Http.StatusCodes;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddRazorPages();

builder.Services.AddHsts(options =&gt;
{
    options.Preload = true;
    options.IncludeSubDomains = true;
    options.MaxAge = TimeSpan.FromDays(60);
    options.ExcludedHosts.Add("example.com");
    options.ExcludedHosts.Add("www.example.com");
});

builder.Services.AddHttpsRedirection(options =&gt;
{
    options.RedirectStatusCode = Status307TemporaryRedirect;
    options.HttpsPort = 5001;
});

var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();

app.MapRazorPages();

app.Run();
</code></pre>
<ul>
<li>Sets the preload parameter of the <code>Strict-Transport-Security</code> header. Preload isn't part of the <a href="https://tools.ietf.org/html/rfc6797" data-linktype="external">RFC HSTS specification</a>, but is supported by web browsers to preload HSTS sites on fresh install. For more information, see <a href="https://hstspreload.org/" data-linktype="external">https://hstspreload.org/</a>.</li>
<li>Enables <a href="https://tools.ietf.org/html/rfc6797#section-6.1.2" data-linktype="external">includeSubDomain</a>, which applies the HSTS policy to Host subdomains.</li>
<li>Explicitly sets the <code>max-age</code> parameter of the <code>Strict-Transport-Security</code> header to 60 days. If not set, defaults to 30 days. For more information, see the <a href="https://tools.ietf.org/html/rfc6797#section-6.1.1" data-linktype="external">max-age directive</a>.</li>
<li>Adds <code>example.com</code> to the list of hosts to exclude.</li>
</ul>
<p><code>UseHsts</code> excludes the following loopback hosts:</p>
<ul>
<li><code>localhost</code> : The IPv4 loopback address.</li>
<li><code>127.0.0.1</code> : The IPv4 loopback address.</li>
<li><code>[::1]</code> : The IPv6 loopback address.</li>
</ul>
<h2 id="opt-out-of-httpshsts-on-project-creation">Opt-out of HTTPS/HSTS on project creation</h2>
<p>In some backend service scenarios where connection security is handled at the public-facing edge of the network, configuring connection security at each node isn't required. Web apps that are generated from the templates in Visual Studio or from the <a href="https://learn.microsoft.com/en-us/dotnet/core/tools/dotnet-new" data-linktype="absolute-path">dotnet new</a> command enable <a href="#require-https" data-linktype="self-bookmark">HTTPS redirection</a> and <a href="#http-strict-transport-security-protocol-hsts" data-linktype="self-bookmark">HSTS</a>. For deployments that don't require these scenarios, you can opt-out of HTTPS/HSTS when the app is created from the template.</p>
<p>To opt-out of HTTPS/HSTS:</p>
<div class="tabGroup" id="tabgroup_1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_1_visual-studio" role="tab" aria-controls="tabpanel_1_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true" data-linktype="self-bookmark">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_1_net-cli" role="tab" aria-controls="tabpanel_1_net-cli" data-tab="net-cli" tabindex="-1" data-linktype="self-bookmark">.NET CLI</a>
</li>
</ul>
<section id="tabpanel_1_visual-studio" role="tabpanel" data-tab="visual-studio">

<p>Uncheck the <strong>Configure for HTTPS</strong> checkbox.</p>
<p><img src="https://learn.microsoft.com/en-us/aspnet/core/security/enforcing-ssl/_static/out-vs2019.png?view=aspnetcore-9.0" alt="New ASP.NET Core Web Application dialog showing the Configure for HTTPS checkbox unselected." data-linktype="relative-path"></p>
</section>
<section id="tabpanel_1_net-cli" role="tabpanel" data-tab="net-cli" aria-hidden="true" hidden="hidden">

<p>Use the <code>--no-https</code> option. For example</p>
<pre><code class="lang-dotnetcli">dotnet new webapp --no-https
</code></pre>
</section>
</div>

<p><a name="trust"></a></p>
<h2 id="trust-the-aspnet-core-https-development-certificate">Trust the ASP.NET Core HTTPS development certificate</h2>
<p>The .NET SDK includes an HTTPS development certificate. The certificate is installed as part of the first-run experience. For example, <code>dotnet --info</code> produces a variation of the following output:</p>
<pre><code class="lang-cli">ASP.NET Core
------------
Successfully installed the ASP.NET Core HTTPS Development Certificate.
To trust the certificate run 'dotnet dev-certs https --trust' (Windows and macOS only).
For establishing trust on other platforms refer to the platform specific documentation.
For more information on configuring HTTPS see https://go.microsoft.com/fwlink/?linkid=848054.
</code></pre>
<p>Installing the .NET SDK installs the ASP.NET Core HTTPS development certificate to the local user certificate store. The certificate has been installed, but it's not trusted. To trust the certificate, perform the one-time step to run the <code>dotnet dev-certs</code> tool:</p>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --trust
</code></pre>
<p>The following command provides help on the <code>dotnet dev-certs</code> tool:</p>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --help
</code></pre>
<div class="WARNING">
<p>Warning</p>
<p>Do not create a development certificate in an environment that will be redistributed, such as a container image or virtual machine. Doing so can lead to spoofing and elevation of privilege. To help prevent this, set the <code>DOTNET_GENERATE_ASPNET_CERTIFICATE</code> environment variable to <code>false</code> prior to calling the .NET CLI for the first time. This will skip the automatic generation of the ASP.NET Core development certificate during the CLI's first-run experience.</p>
</div>
<h2 id="how-to-set-up-a-developer-certificate-for-docker">How to set up a developer certificate for Docker</h2>
<p>See <a href="https://github.com/dotnet/AspNetCore.Docs/issues/6199" data-linktype="external">this GitHub issue</a>.</p>
<h2 id="linux-specific-considerations">Linux-specific considerations</h2>
<p>Linux distros differ substantially in how they mark certificates as trusted. While <code>dotnet dev-certs</code> is expected to be broadly applicable it is only officially supported on Ubuntu and Fedora and specifically aims to ensure trust in Firefox and Chromium-based browsers (Edge, Chrome, and Chromium).</p>
<h3 id="dependencies">Dependencies</h3>
<p>To establish OpenSSL trust, the <code>openssl</code> tool must be on the path.</p>
<p>To establish browser trust (for example in Edge or Firefox), the <code>certutil</code> tool must be on the path.</p>
<h3 id="openssl-trust">OpenSSL trust</h3>
<p>When the ASP.NET Core development certificate is trusted, it is exported to a folder in the current user's home directory. To have <a href="https://www.openssl.org/" data-linktype="external">OpenSSL</a> (and clients that consume it) pick up this folder, you need to set the <code>SSL_CERT_DIR</code> environment variable. You can either do this in a single session by running a command like <code>export SSL_CERT_DIR=$HOME/.aspnet/dev-certs/trust:/usr/lib/ssl/certs</code> (the exact value will be in the output when <code>--verbose</code> is passed) or by adding it your (distro- and shell-specific) configuration file (for example <code>.profile</code>).</p>
<p>This is required to make tools like <code>curl</code> trust the development certificate. Or, alternatively, you can pass <code>-CAfile</code> or <code>-CApath</code> to each individual <code>curl</code> invocation.</p>
<p>Note that this requires 1.1.1h or later or 3.0.0 or later, depending on which major version you're using.</p>
<p>If OpenSSL trust gets into a bad state (for example if <code>dotnet dev-certs https --clean</code> fails to remove it), it is frequently possible to set things right using the <a href="https://docs.openssl.org/master/man1/openssl-rehash/" data-linktype="external"><code>c_rehash</code></a> tool.</p>
<h3 id="overrides">Overrides</h3>
<p>If you're using another browser with its own Network Security Services (NSS) store, you can use the <code>DOTNET_DEV_CERTS_NSSDB_PATHS</code> environment variable to specify a colon-delimited list of NSS directories (for example, the directory containing <code>cert9.db</code>) to which to add the development certificate.</p>
<p>If you store the certificates you want OpenSSL to trust in a specific directory, you can use the <code>DOTNET_DEV_CERTS_OPENSSL_CERTIFICATE_DIRECTORY</code> environment variable to indicate where that is.</p>
<div class="WARNING">
<p>Warning</p>
<p>If you set either of these variables, it is important that they are set to the same values each time trust is updated. If they change, the tool won't know about certificates in the former locations (for example to clean them up).</p>
</div>
<h3 id="using-sudo">Using sudo</h3>
<p>As on other platforms, development certificates are stored and trusted separately for each user. As a result, if you run <code>dotnet dev-certs</code> as a different user (for example by using <code>sudo</code>), it is <em>that</em> user (for example <code>root</code>) that will trust the development certificate.</p>
<h3 id="trust-https-certificate-on-linux-with-linux-dev-certs">Trust HTTPS certificate on Linux with linux-dev-certs</h3>
<p><a href="https://github.com/tmds/linux-dev-certs" data-linktype="external">linux-dev-certs</a> is an open-source, community-supported, .NET global tool that provides a convenient way to create and trust a developer certificate on Linux. The tool is not maintained or supported by Microsoft.</p>
<p>The following commands install the tool and create a trusted developer certificate:</p>
<pre><code class="lang-cli">dotnet tool update -g linux-dev-certs
dotnet linux-dev-certs install
</code></pre>
<p>For more information or to report issues, see the <a href="https://github.com/tmds/linux-dev-certs" data-linktype="external">linux-dev-certs GitHub repository</a>.</p>
<div class="tabGroup" id="tabgroup_2">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_2_linux-sles" role="tab" aria-controls="tabpanel_2_linux-sles" data-tab="linux-sles" tabindex="0" aria-selected="true" data-linktype="self-bookmark">SUSE Linux Enterprise Server</a>
</li>
</ul>
<section id="tabpanel_2_linux-sles" role="tabpanel" data-tab="linux-sles">

<p>See <a href="https://github.com/dotnet/AspNetCore.Docs/issues/28292" data-linktype="external">this GitHub issue</a></p>
<!--
> [!WARNING]
> The following instructions are intended for development purposes only. Do not use the certificates generated in these instructions for a production environment.

These instructions use Mozilla's *legacy* tool [certutil](https://firefox-source-docs.mozilla.org/security/nss/legacy/tools/nss_tools_certutil/index.html). Instructions may be updated as modern utilities and practices are discovered.

> [!CAUTION]
> Improper use of TLS certificates could lead to spoofing.

> [!TIP]
> Instructions for valid production certificates can be found in the RHEL Documentation.
> [RHEL8 TLS Certificates](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/securing_networks/index#creating-and-managing-tls-keys-and-certificates_securing-networks)
> [RHEL9 TLS Certificates](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/securing_networks/index#creating-and-managing-tls-keys-and-certificates_securing-networks)
> [RHEL9 Certificate System](https://access.redhat.com/documentation/en-us/red_hat_certificate_system/9)

### Install Dependencies

```sh
dnf install nss-tools
```

### Export The ASP.NET Core Development Certificate

> [!IMPORTANT]
> Replace `${ProjectDirectory}` with your projects directory.
> Replace `${CertificateName}` with a name you'll be able to identify in the future.

```sh
cd ${ProjectDirectory}
dotnet dev-certs https -ep ${ProjectDirectory}/${CertificateName}.crt --format PEM
```

> [!CAUTION]
> If using git, add your certificate to your `${ProjectDirectory}/.gitignore` or `${ProjectDirectory}/.git/info/exclude`.
> View the [git documentation](https://git-scm.com/docs/gitignore) for information about these files.

> [!TIP]
> You can move your exported certificate outside of your Git repository and replace the occurrences of `${ProjectDirectory}`, in the following instructions, with the new location.

### Import The ASP.NET Core Development Certificate

> [!IMPORTANT]
> Replace `${UserProfile}` with the profile you intend to use.
> Do not replace `$HOME`, it is the environment variable to your user directory.

#### Chromium-based Browsers

```sh
certutil -d sql:$HOME/.pki/nssdb -A -t "P,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
```

#### Mozilla Firefox

```sh
certutil -d sql:$HOME/.mozilla/firefox/${UserProfile}/ -A -t "C,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
```

#### Create An Alias To Test With Curl

> [!IMPORTANT]
>
> Don't delete the exported certificate if you plan to test with curl.
> You'll need to create an alias referencing it in your `$SHELL`'s profile

```sh
alias curl="curl --cacert ${ProjectDirectory}/${CertificateName}.crt"
```

### Cleaning up the Development Certificates

```sh
certutil -d sql:$HOME/.pki/nssdb -D -n ${CertificateName}
certutil -d sql:$HOME/.mozilla/firefox/${UserProfile}/ -D -n ${CertificateName}
rm ${ProjectDirectory}/${CertificateName}.crt
dotnet dev-certs https --clean
```

>[!NOTE]
> Remove the curl alias you created earlier
-->
</section>
</div>

<p><a name="tcp"></a></p>
<h2 id="troubleshoot-certificate-problems-such-as-certificate-not-trusted">Troubleshoot certificate problems such as certificate not trusted</h2>
<p>This section provides help when the ASP.NET Core HTTPS development certificate has been <a href="#trust" data-linktype="self-bookmark">installed and trusted</a>, but you still have browser warnings that the certificate is not trusted. The ASP.NET Core HTTPS development certificate is used by <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Kestrel</a>.</p>
<p>To repair the IIS Express certificate, see <a href="https://stackoverflow.com/a/20048613/502537" data-linktype="external">this Stackoverflow</a> issue.</p>
<h3 id="all-platforms---certificate-not-trusted">All platforms - certificate not trusted</h3>
<p>Run the following commands:</p>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --clean
dotnet dev-certs https --trust
</code></pre>
<p>Close any browser instances open. Open a new browser window to app. Certificate trust is cached by browsers.</p>
<h3 id="dotnet-dev-certs-https---clean-fails">dotnet dev-certs https --clean Fails</h3>
<p>The preceding commands solve most browser trust issues. If the browser is still not trusting the certificate, follow the platform-specific suggestions that follow.</p>
<h3 id="docker---certificate-not-trusted">Docker - certificate not trusted</h3>
<ul>
<li>Delete the <em>C:\Users{USER}\AppData\Roaming\ASP.NET\Https</em> folder.</li>
<li>Clean the solution. Delete the <em>bin</em> and <em>obj</em> folders.</li>
<li>Restart the development tool. For example, Visual Studio or Visual Studio Code.</li>
</ul>
<h3 id="windows---certificate-not-trusted">Windows - certificate not trusted</h3>
<ul>
<li>Check the certificates in the certificate store. There should be a <code>localhost</code> certificate with the <code>ASP.NET Core HTTPS development certificate</code> friendly name both under <code>Current User &gt; Personal &gt; Certificates</code> and <code>Current User &gt; Trusted root certification authorities &gt; Certificates</code></li>
<li>Remove all the found certificates from both Personal and Trusted root certification authorities. Do <strong>not</strong> remove the IIS Express localhost certificate.</li>
<li>Run the following commands:</li>
</ul>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --clean
dotnet dev-certs https --trust
</code></pre>
<p>Close any browser instances open. Open a new browser window to app.</p>
<h3 id="os-x---certificate-not-trusted">OS X - certificate not trusted</h3>
<ul>
<li>Open KeyChain Access.</li>
<li>Select the System keychain.</li>
<li>Check for the presence of a localhost certificate.</li>
<li>Check that it contains a <code>+</code> symbol on the icon to indicate it's trusted for all users.</li>
<li>Remove the certificate from the system keychain.</li>
<li>Run the following commands:</li>
</ul>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --clean
dotnet dev-certs https --trust
</code></pre>
<p>Close any browser instances open. Open a new browser window to app.</p>
<p>See <a href="https://github.com/dotnet/AspNetCore/issues/16892" data-linktype="external">HTTPS Error using IIS Express (dotnet/AspNetCore #16892)</a> for troubleshooting certificate issues with Visual Studio.</p>
<h3 id="linux-certificate-not-trusted">Linux certificate not trusted</h3>
<p>Check that the certificate being configured for trust is the user HTTPS developer certificate that will be used by the Kestrel server.</p>
<p>Check the current user default HTTPS developer Kestrel certificate at the following location:</p>
<pre><code>ls -la ~/.dotnet/corefx/cryptography/x509stores/my
</code></pre>
<p>The HTTPS developer Kestrel certificate file is the SHA1 thumbprint. When the file is deleted via <code>dotnet dev-certs https --clean</code>, it's regenerated when needed with a different thumbprint.
Check the thumbprint of the exported certificate matches with the following command:</p>
<pre><code>openssl x509 -noout -fingerprint -sha1 -inform pem -in /usr/local/share/ca-certificates/aspnet/https.crt
</code></pre>
<p>If the certificate doesn't match, it could be one of the following:</p>
<ul>
<li>An old certificate.</li>
<li>An exported a developer certificate for the root user. For this case, export the certificate.</li>
</ul>
<p>The root user certificate can be checked at:</p>
<pre><code>ls -la /root/.dotnet/corefx/cryptography/x509stores/my
</code></pre>
<h3 id="iis-express-ssl-certificate-used-with-visual-studio">IIS Express SSL certificate used with Visual Studio</h3>
<p>To fix problems with the IIS Express certificate, select <strong>Repair</strong> from the Visual Studio installer. For more information, see <a href="https://github.com/dotnet/aspnetcore/issues/16892" data-linktype="external">this GitHub issue</a>.</p>
<h3 id="group-policy-prevents-self-signed-certificates-from-being-trusted">Group policy prevents self-signed certificates from being trusted</h3>
<p>In some cases, group policy may prevent self-signed certificates from being trusted. For more information, see <a href="https://github.com/dotnet/aspnetcore/issues/21173" data-linktype="external">this GitHub issue</a>.</p>
<h2 id="additional-information">Additional information</h2>
<ul>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/proxy-load-balancer?view=aspnetcore-9.0" data-linktype="relative-path">Configure ASP.NET Core to work with proxy servers and load balancers</a></li>
<li><a href="../host-and-deploy/linux-nginx553c.html?view=aspnetcore-9.0#https-configuration" data-linktype="relative-path">Host ASP.NET Core on Linux with Nginx: HTTPS configuration</a></li>
<li><a href="https://learn.microsoft.com/en-us/iis/manage/configuring-security/how-to-set-up-ssl-on-iis" data-linktype="absolute-path">How to Set Up SSL on IIS</a></li>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/servers/kestrel/endpoints?view=aspnetcore-9.0" data-linktype="relative-path">Configure endpoints for the ASP.NET Core Kestrel web server</a></li>
<li><a href="https://www.owasp.org/index.php/HTTP_Strict_Transport_Security_Cheat_Sheet#Browser_Support" data-linktype="external">OWASP HSTS browser support</a></li>
</ul>
</div>
<div data-moniker="aspnetcore-6.0">
<div class="NOTE">
<p>Note</p>
<p>If you're using .NET 9 or later SDK, see the updated Linux procedures in the <a href="https://learn.microsoft.com/en-us/aspnet/core/security/enforcing-ssl?view=aspnetcore-9.0&amp;preserve-view=true" data-linktype="relative-path">.NET 9 version of this article</a>.</p>
</div>
<div class="WARNING">
<p>Warning</p>
<h2 id="api-projects">API projects</h2>
<p>Do <strong>not</strong> use <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.mvc.requirehttpsattribute" class="no-loc" data-linktype="absolute-path">RequireHttpsAttribute</a> on Web APIs that receive sensitive information. <code>RequireHttpsAttribute</code> uses HTTP status codes to redirect browsers from HTTP to HTTPS. API clients may not understand or obey redirects from HTTP to HTTPS. Such clients may send information over HTTP. Web APIs should either:</p>
<ul>
<li>Not listen on HTTP.</li>
<li>Close the connection with status code 400 (Bad Request) and not serve the request.</li>
</ul>
<p>To disable HTTP redirection in an API, set the <code>ASPNETCORE_URLS</code> environment variable or use the <code>--urls</code> command line flag. For more information, see <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-9.0" data-linktype="relative-path">Use multiple environments in ASP.NET Core</a> and <a href="https://andrewlock.net/8-ways-to-set-the-urls-for-an-aspnetcore-app/" data-linktype="external">8 ways to set the URLs for an ASP.NET Core app</a> by Andrew Lock.</p>
<h2 id="hsts-and-api-projects">HSTS and API projects</h2>
<p>The default API projects don't include <a href="#hsts" data-linktype="self-bookmark">HSTS</a> because <a href="https://developer.mozilla.org/docs/Web/HTTP/Headers/Strict-Transport-Security" data-linktype="external">HSTS</a> is generally a browser only instruction. Other callers, such as phone or desktop apps, do <strong>not</strong> obey the instruction. Even within browsers, a single authenticated call to an API over HTTP has risks on insecure networks. The secure approach is to configure API projects to only listen to and respond over HTTPS.</p>
</div>
<p><a name="no-http"></a></p>
<h3 id="http-redirection-to-https-causes-err_invalid_redirect-on-the-cors-preflight-request">HTTP redirection to HTTPS causes ERR_INVALID_REDIRECT on the CORS preflight request</h3>
<p>Requests to an endpoint using HTTP that are redirected to HTTPS by <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.httpspolicybuilderextensions.usehttpsredirection" class="no-loc" data-linktype="absolute-path">UseHttpsRedirection</a> fail with <code>ERR_INVALID_REDIRECT</code> on the CORS preflight request.</p>
<p>API projects can reject HTTP requests rather than use <code>UseHttpsRedirection</code> to redirect requests to HTTPS.</p>
<h2 id="require-https">Require HTTPS</h2>
<p>We recommend that production ASP.NET Core web apps use:</p>
<ul>
<li>HTTPS Redirection Middleware (<a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.httpspolicybuilderextensions.usehttpsredirection" class="no-loc" data-linktype="absolute-path">UseHttpsRedirection</a>) to redirect HTTP requests to HTTPS.</li>
<li>HSTS Middleware (<a href="#http-strict-transport-security-protocol-hsts" data-linktype="self-bookmark">UseHsts</a>) to send HTTP Strict Transport Security Protocol (HSTS) headers to clients.</li>
</ul>
<div class="NOTE">
<p>Note</p>
<p>Apps deployed in a reverse proxy configuration allow the proxy to handle connection security (HTTPS). If the proxy also handles HTTPS redirection, there's no need to use HTTPS Redirection Middleware. If the proxy server also handles writing HSTS headers (for example, <a href="https://learn.microsoft.com/en-us/iis/get-started/whats-new-in-iis-10-version-1709/iis-10-version-1709-hsts#iis-100-version-1709-native-hsts-support" data-linktype="absolute-path">native HSTS support in IIS 10.0 (1709) or later</a>), HSTS Middleware isn't required by the app. For more information, see <a href="#opt-out-of-httpshsts-on-project-creation" data-linktype="self-bookmark">Opt-out of HTTPS/HSTS on project creation</a>.</p>
</div>
<h3 id="usehttpsredirection">UseHttpsRedirection</h3>
<p>The following code calls <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.httpspolicybuilderextensions.usehttpsredirection" class="no-loc" data-linktype="absolute-path">UseHttpsRedirection</a> in the <code>Program.cs</code> file:</p>
<pre><code class="lang-csharp" highlight-lines="13">var builder = WebApplication.CreateBuilder(args);

builder.Services.AddRazorPages();

var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();

app.MapRazorPages();

app.Run();
</code></pre>
<p>The preceding highlighted code:</p>
<ul>
<li>Uses the default <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.httpspolicy.httpsredirectionoptions.redirectstatuscode#microsoft-aspnetcore-httpspolicy-httpsredirectionoptions-redirectstatuscode" class="no-loc" data-linktype="absolute-path">HttpsRedirectionOptions.RedirectStatusCode</a> (<a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.statuscodes.status307temporaryredirect#microsoft-aspnetcore-http-statuscodes-status307temporaryredirect" class="no-loc" data-linktype="absolute-path">Status307TemporaryRedirect</a>).</li>
<li>Uses the default <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.httpspolicy.httpsredirectionoptions.httpsport#microsoft-aspnetcore-httpspolicy-httpsredirectionoptions-httpsport" class="no-loc" data-linktype="absolute-path">HttpsRedirectionOptions.HttpsPort</a> (null) unless overridden by the <code>ASPNETCORE_HTTPS_PORT</code> environment variable or <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.hosting.server.features.iserveraddressesfeature" class="no-loc" data-linktype="absolute-path">IServerAddressesFeature</a>.</li>
</ul>
<p>We recommend using temporary redirects rather than permanent redirects. Link caching can cause unstable behavior in development environments. If you prefer to send a permanent redirect status code when the app is in a non-Development environment, see the <a href="#configure-permanent-redirects-in-production" data-linktype="self-bookmark">Configure permanent redirects in production</a> section. We recommend using <a href="#http-strict-transport-security-protocol-hsts" data-linktype="self-bookmark">HSTS</a> to signal to clients that only secure resource requests should be sent to the app (only in production).</p>
<h3 id="port-configuration">Port configuration</h3>
<p>A port must be available for the middleware to redirect an insecure request to HTTPS. If no port is available:</p>
<ul>
<li>Redirection to HTTPS doesn't occur.</li>
<li>The middleware logs the warning "Failed to determine the https port for redirect."</li>
</ul>
<p>Specify the HTTPS port using any of the following approaches:</p>
<ul>
<li><p>Set <a href="#options" data-linktype="self-bookmark">HttpsRedirectionOptions.HttpsPort</a>.</p>
</li>
<li><p>Set the <code>https_port</code> <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/host/generic-host?view=aspnetcore-9.0#https_port" data-linktype="relative-path">host setting</a>:</p>
<ul>
<li><p>In host configuration.</p>
</li>
<li><p>By setting the <code>ASPNETCORE_HTTPS_PORT</code> environment variable.</p>
</li>
<li><p>By adding a top-level entry in <code>appsettings.json</code>:</p>
<pre><code class="lang-json" highlight-lines="2">{
  "https_port": 443,
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*"
}
</code></pre></li>
</ul>
</li>
<li><p>Indicate a port with the secure scheme using the <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/host/generic-host?view=aspnetcore-9.0#urls" data-linktype="relative-path">ASPNETCORE_URLS environment variable</a>. The environment variable configures the server. The middleware indirectly discovers the HTTPS port via <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.hosting.server.features.iserveraddressesfeature" class="no-loc" data-linktype="absolute-path">IServerAddressesFeature</a>. This approach doesn't work in reverse proxy deployments.</p>
</li>
<li><p>The ASP.NET Core web templates set an HTTPS URL in <code>Properties/launchsettings.json</code> for both Kestrel and IIS Express. <code>launchsettings.json</code> is only used on the local machine.</p>
</li>
<li><p>Configure an HTTPS URL endpoint for a public-facing edge deployment of <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Kestrel</a> server or <a href="../fundamentals/servers/httpsys553c.html?view=aspnetcore-9.0" data-linktype="relative-path">HTTP.sys</a> server. Only <strong>one HTTPS port</strong> is used by the app. The middleware discovers the port via <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.hosting.server.features.iserveraddressesfeature" class="no-loc" data-linktype="absolute-path">IServerAddressesFeature</a>.</p>
</li>
</ul>
<div class="NOTE">
<p>Note</p>
<p>When an app is run in a reverse proxy configuration, <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.hosting.server.features.iserveraddressesfeature" class="no-loc" data-linktype="absolute-path">IServerAddressesFeature</a> isn't available. Set the port using one of the other approaches described in this section.</p>
</div>
<h3 id="edge-deployments">Edge deployments</h3>
<p>When <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Kestrel</a> or <a href="../fundamentals/servers/httpsys553c.html?view=aspnetcore-9.0" data-linktype="relative-path">HTTP.sys</a> is used as a public-facing edge server, Kestrel or HTTP.sys must be configured to listen on both:</p>
<ul>
<li>The secure port where the client is redirected (typically, 443 in production and 5001 in development).</li>
<li>The insecure port (typically, 80 in production and 5000 in development).</li>
</ul>
<p>The insecure port must be accessible by the client in order for the app to receive an insecure request and redirect the client to the secure port.</p>
<p>For more information, see <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0#endpoint-configuration" data-linktype="relative-path">Kestrel endpoint configuration</a> or <a href="../fundamentals/servers/httpsys553c.html?view=aspnetcore-9.0" data-linktype="relative-path">HTTP.sys web server implementation in ASP.NET Core</a>.</p>
<h3 id="deployment-scenarios">Deployment scenarios</h3>
<p>Any firewall between the client and server must also have communication ports open for traffic.</p>
<p>If requests are forwarded in a reverse proxy configuration, use <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/proxy-load-balancer?view=aspnetcore-9.0" data-linktype="relative-path">Forwarded Headers Middleware</a> before calling HTTPS Redirection Middleware. Forwarded Headers Middleware updates the <code>Request.Scheme</code>, using the <code>X-Forwarded-Proto</code> header. The middleware permits redirect URIs and other security policies to work correctly. When Forwarded Headers Middleware isn't used, the backend app might not receive the correct scheme and end up in a redirect loop. A common end user error message is that too many redirects have occurred.</p>
<p>When deploying to Azure App Service, follow the guidance in <a href="https://learn.microsoft.com/en-us/azure/app-service/app-service-web-tutorial-custom-ssl" data-linktype="absolute-path">Tutorial: Bind an existing custom SSL certificate to Azure Web Apps</a>.</p>
<h3 id="options">Options</h3>
<p>The following highlighted code calls <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.httpsredirectionservicesextensions.addhttpsredirection" class="no-loc" data-linktype="absolute-path">AddHttpsRedirection</a> to configure middleware options:</p>
<pre><code class="lang-csharp" highlight-lines="16-20">using static Microsoft.AspNetCore.Http.StatusCodes;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddRazorPages();

builder.Services.AddHsts(options =&gt;
{
    options.Preload = true;
    options.IncludeSubDomains = true;
    options.MaxAge = TimeSpan.FromDays(60);
    options.ExcludedHosts.Add("example.com");
    options.ExcludedHosts.Add("www.example.com");
});

builder.Services.AddHttpsRedirection(options =&gt;
{
    options.RedirectStatusCode = Status307TemporaryRedirect;
    options.HttpsPort = 5001;
});

var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();

app.MapRazorPages();

app.Run();
</code></pre>
<p>Calling <code>AddHttpsRedirection</code> is only necessary to change the values of <code>HttpsPort</code> or <code>RedirectStatusCode</code>.</p>
<p>The preceding highlighted code:</p>
<ul>
<li>Sets <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.httpspolicy.httpsredirectionoptions.redirectstatuscode" class="no-loc" data-linktype="absolute-path">HttpsRedirectionOptions.RedirectStatusCode</a> to <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.statuscodes.status307temporaryredirect#microsoft-aspnetcore-http-statuscodes-status307temporaryredirect" class="no-loc" data-linktype="absolute-path">Status307TemporaryRedirect</a>, which is the default value. Use the fields of the <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.statuscodes" class="no-loc" data-linktype="absolute-path">StatusCodes</a> class for assignments to <code>RedirectStatusCode</code>.</li>
<li>Sets the HTTPS port to 5001.</li>
</ul>
<h4 id="configure-permanent-redirects-in-production">Configure permanent redirects in production</h4>
<p>The middleware defaults to sending a <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.statuscodes.status307temporaryredirect#microsoft-aspnetcore-http-statuscodes-status307temporaryredirect" class="no-loc" data-linktype="absolute-path">Status307TemporaryRedirect</a> with all redirects. If you prefer to send a permanent redirect status code when the app is in a non-Development environment, wrap the middleware options configuration in a conditional check for a non-Development environment.</p>
<p>When configuring services in <code>Program.cs</code>:</p>
<pre><code class="lang-csharp" highlight-lines="7-14">using static Microsoft.AspNetCore.Http.StatusCodes;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddRazorPages();

if (!builder.Environment.IsDevelopment())
{
    builder.Services.AddHttpsRedirection(options =&gt;
    {
        options.RedirectStatusCode = Status308PermanentRedirect;
        options.HttpsPort = 443;
    });
}

var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");

    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();

app.MapRazorPages();

app.Run();
</code></pre><h2 id="https-redirection-middleware-alternative-approach">HTTPS Redirection Middleware alternative approach</h2>
<p>An alternative to using HTTPS Redirection Middleware (<code>UseHttpsRedirection</code>) is to use URL Rewriting Middleware (<code>AddRedirectToHttps</code>). <code>AddRedirectToHttps</code> can also set the status code and port when the redirect is executed. For more information, see <a href="../fundamentals/url-rewriting553c.html?view=aspnetcore-9.0" data-linktype="relative-path">URL Rewriting Middleware</a>.</p>
<p>When redirecting to HTTPS without the requirement for additional redirect rules, we recommend using HTTPS Redirection Middleware (<code>UseHttpsRedirection</code>) described in this article.</p>
<p><a name="hsts"></a></p>
<h2 id="http-strict-transport-security-protocol-hsts">HTTP Strict Transport Security Protocol (HSTS)</h2>
<p>Per <a href="https://www.owasp.org/index.php/About_The_Open_Web_Application_Security_Project" data-linktype="external">OWASP</a>, <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Strict_Transport_Security_Cheat_Sheet.html" data-linktype="external">HTTP Strict Transport Security (HSTS)</a> is an opt-in security enhancement that's specified by a web app through the use of a response header. When a <a href="https://cheatsheetseries.owasp.org/cheatsheets/Transport_Layer_Protection_Cheat_Sheet.html#browser-support" data-linktype="external">browser that supports HSTS</a> receives this header:</p>
<ul>
<li>The browser stores configuration for the domain that prevents sending any communication over HTTP. The browser forces all communication over HTTPS.</li>
<li>The browser prevents the user from using untrusted or invalid certificates. The browser disables prompts that allow a user to temporarily trust such a certificate.</li>
</ul>
<p>Because <a href="https://developer.mozilla.org/docs/Web/HTTP/Headers/Strict-Transport-Security" data-linktype="external">HSTS</a> is enforced by the client, it has some limitations:</p>
<ul>
<li>The client must support HSTS.</li>
<li>HSTS requires at least one successful HTTPS request to establish the HSTS policy.</li>
<li>The application must check every HTTP request and redirect or reject the HTTP request.</li>
</ul>
<p>ASP.NET Core implements HSTS with the <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.hstsbuilderextensions.usehsts" class="no-loc" data-linktype="absolute-path">UseHsts</a> extension method. The following code calls <code>UseHsts</code> when the app isn't in <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-9.0" data-linktype="relative-path">development mode</a>:</p>
<pre><code class="lang-csharp" highlight-lines="10">var builder = WebApplication.CreateBuilder(args);

builder.Services.AddRazorPages();

var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();

app.MapRazorPages();

app.Run();
</code></pre>
<p><code>UseHsts</code> isn't recommended in development because the HSTS settings are highly cacheable by browsers. By default, <code>UseHsts</code> excludes the local loopback address.</p>
<p>For production environments that are implementing HTTPS for the first time, set the initial <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.httpspolicy.hstsoptions.maxage" class="no-loc" data-linktype="absolute-path">HstsOptions.MaxAge</a> to a small value using one of the <a href="https://learn.microsoft.com/en-us/dotnet/api/system.timespan" class="no-loc" data-linktype="absolute-path">TimeSpan</a> methods. Set the value from hours to no more than a single day in case you need to revert the HTTPS infrastructure to HTTP. After you're confident in the sustainability of the HTTPS configuration, increase the HSTS <code>max-age</code> value; a commonly used value is one year.</p>
<p>The following highlighted code:</p>
<pre><code class="lang-csharp" highlight-lines="7-14">using static Microsoft.AspNetCore.Http.StatusCodes;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddRazorPages();

builder.Services.AddHsts(options =&gt;
{
    options.Preload = true;
    options.IncludeSubDomains = true;
    options.MaxAge = TimeSpan.FromDays(60);
    options.ExcludedHosts.Add("example.com");
    options.ExcludedHosts.Add("www.example.com");
});

builder.Services.AddHttpsRedirection(options =&gt;
{
    options.RedirectStatusCode = Status307TemporaryRedirect;
    options.HttpsPort = 5001;
});

var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();

app.MapRazorPages();

app.Run();
</code></pre>
<ul>
<li>Sets the preload parameter of the <code>Strict-Transport-Security</code> header. Preload isn't part of the <a href="https://tools.ietf.org/html/rfc6797" data-linktype="external">RFC HSTS specification</a>, but is supported by web browsers to preload HSTS sites on fresh install. For more information, see <a href="https://hstspreload.org/" data-linktype="external">https://hstspreload.org/</a>.</li>
<li>Enables <a href="https://tools.ietf.org/html/rfc6797#section-6.1.2" data-linktype="external">includeSubDomain</a>, which applies the HSTS policy to Host subdomains.</li>
<li>Explicitly sets the <code>max-age</code> parameter of the <code>Strict-Transport-Security</code> header to 60 days. If not set, defaults to 30 days. For more information, see the <a href="https://tools.ietf.org/html/rfc6797#section-6.1.1" data-linktype="external">max-age directive</a>.</li>
<li>Adds <code>example.com</code> to the list of hosts to exclude.</li>
</ul>
<p><code>UseHsts</code> excludes the following loopback hosts:</p>
<ul>
<li><code>localhost</code> : The IPv4 loopback address.</li>
<li><code>127.0.0.1</code> : The IPv4 loopback address.</li>
<li><code>[::1]</code> : The IPv6 loopback address.</li>
</ul>
<h2 id="opt-out-of-httpshsts-on-project-creation">Opt-out of HTTPS/HSTS on project creation</h2>
<p>In some backend service scenarios where connection security is handled at the public-facing edge of the network, configuring connection security at each node isn't required. Web apps that are generated from the templates in Visual Studio or from the <a href="https://learn.microsoft.com/en-us/dotnet/core/tools/dotnet-new" data-linktype="absolute-path">dotnet new</a> command enable <a href="#require-https" data-linktype="self-bookmark">HTTPS redirection</a> and <a href="#http-strict-transport-security-protocol-hsts" data-linktype="self-bookmark">HSTS</a>. For deployments that don't require these scenarios, you can opt-out of HTTPS/HSTS when the app is created from the template.</p>
<p>To opt-out of HTTPS/HSTS:</p>
<div class="tabGroup" id="tabgroup_1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_1_visual-studio" role="tab" aria-controls="tabpanel_1_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true" data-linktype="self-bookmark">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_1_net-cli" role="tab" aria-controls="tabpanel_1_net-cli" data-tab="net-cli" tabindex="-1" data-linktype="self-bookmark">.NET CLI</a>
</li>
</ul>
<section id="tabpanel_1_visual-studio" role="tabpanel" data-tab="visual-studio">

<p>Uncheck the <strong>Configure for HTTPS</strong> checkbox.</p>
<p><img src="https://learn.microsoft.com/en-us/aspnet/core/security/enforcing-ssl/_static/out-vs2019.png?view=aspnetcore-9.0" alt="New ASP.NET Core Web Application dialog showing the Configure for HTTPS checkbox unselected." data-linktype="relative-path"></p>
</section>
<section id="tabpanel_1_net-cli" role="tabpanel" data-tab="net-cli" aria-hidden="true" hidden="hidden">

<p>Use the <code>--no-https</code> option. For example</p>
<pre><code class="lang-dotnetcli">dotnet new webapp --no-https
</code></pre>
</section>
</div>

<p><a name="trust"></a></p>
<h2 id="trust-the-aspnet-core-https-development-certificate-on-windows-and-macos">Trust the ASP.NET Core HTTPS development certificate on Windows and macOS</h2>
<p>For the Firefox browser, see the next section.</p>
<p>The .NET Core SDK includes an HTTPS development certificate. The certificate is installed as part of the first-run experience. For example, <code>dotnet --info</code> produces a variation of the following output:</p>
<pre><code class="lang-cli">ASP.NET Core
------------
Successfully installed the ASP.NET Core HTTPS Development Certificate.
To trust the certificate run 'dotnet dev-certs https --trust' (Windows and macOS only).
For establishing trust on other platforms refer to the platform specific documentation.
For more information on configuring HTTPS see https://go.microsoft.com/fwlink/?linkid=848054.
</code></pre>
<p>Installing the .NET Core SDK installs the ASP.NET Core HTTPS development certificate to the local user certificate store. The certificate has been installed, but it's not trusted. To trust the certificate, perform the one-time step to run the <code>dotnet dev-certs</code> tool:</p>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --trust
</code></pre>
<p>The following command provides help on the <code>dotnet dev-certs</code> tool:</p>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --help
</code></pre>
<div class="WARNING">
<p>Warning</p>
<p>Do not create a development certificate in an environment that will be redistributed, such as a container image or virtual machine. Doing so can lead to spoofing and elevation of privilege. To help prevent this, set the <code>DOTNET_GENERATE_ASPNET_CERTIFICATE</code> environment variable to <code>false</code> prior to calling the .NET CLI for the first time. This will skip the automatic generation of the ASP.NET Core development certificate during the CLI's first-run experience.</p>
</div>
<p><a name="trust-ff"></a></p>
<h3 id="trust-the-https-certificate-with-firefox-to-prevent-sec_error_inadequate_key_usage-error">Trust the HTTPS certificate with Firefox to prevent SEC_ERROR_INADEQUATE_KEY_USAGE error</h3>
<p>The Firefox browser uses its own certificate store, and therefore doesn't trust the <a href="https://learn.microsoft.com/en-us/iis/extensions/introduction-to-iis-express/iis-express-overview" data-linktype="absolute-path">IIS Express</a> or <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Kestrel</a> developer certificates.</p>
<p>There are two approaches to trusting the HTTPS certificate with Firefox, create a policy file or configure with the FireFox browser. Configuring with the browser creates the policy file, so the two approaches are equivalent.</p>
<h4 id="create-a-policy-file-to-trust-https-certificate-with-firefox">Create a policy file to trust HTTPS certificate with Firefox</h4>
<p>Create a policy file (<code>policies.json</code>) at:</p>
<ul>
<li>Windows: <code>%PROGRAMFILES%\Mozilla Firefox\distribution\</code></li>
<li>MacOS: <code>Firefox.app/Contents/Resources/distribution</code></li>
<li>Linux: See <a href="#trust-ff-linux" data-linktype="self-bookmark">Trust the certificate with Firefox on Linux</a> in this article.</li>
</ul>
<p>Add the following JSON to the Firefox policy file:</p>
<pre><code class="lang-json">{
  "policies": {
    "Certificates": {
      "ImportEnterpriseRoots": true
    }
  }
}
</code></pre>
<p>The preceding policy file makes Firefox trust certificates from the trusted certificates in the Windows certificate store. The next section provides an alternative approach to create the preceding policy file by using the Firefox browser.</p>
<p><a name="trust-ff-ba"></a></p>
<h3 id="configure-trust-of-https-certificate-using-firefox-browser">Configure trust of HTTPS certificate using Firefox browser</h3>
<p>Set  <code>security.enterprise_roots.enabled</code> = <code>true</code> using the following instructions:</p>
<ol>
<li>Enter <code>about:config</code> in the FireFox browser.</li>
<li>Select <strong>Accept the Risk and Continue</strong> if you accept the risk.</li>
<li>Select <strong>Show All</strong></li>
<li>Set <code>security.enterprise_roots.enabled</code> = <code>true</code></li>
<li>Exit and restart Firefox</li>
</ol>
<p>For more information, see <a href="https://support.mozilla.org/kb/setting-certificate-authorities-firefox" data-linktype="external">Setting Up Certificate Authorities (CAs) in Firefox</a> and the <a href="https://github.com/mozilla/policy-templates/blob/master/README.md" data-linktype="external">mozilla/policy-templates/README file</a>.</p>
<h2 id="how-to-set-up-a-developer-certificate-for-docker">How to set up a developer certificate for Docker</h2>
<p>See <a href="https://github.com/dotnet/AspNetCore.Docs/issues/6199" data-linktype="external">this GitHub issue</a>.</p>
<h2 id="trust-https-certificate-on-linux">Trust HTTPS certificate on Linux</h2>
<p>Establishing trust is distribution and browser specific. The following sections provide instructions for some popular distributions and the Chromium browsers (Edge and Chrome) and for Firefox.</p>
<!-- Uncomment when linus-dev-certs supports .NET 6>
### Trust HTTPS certificate on Linux with linux-dev-certs

[linux-dev-certs](https://github.com/tmds/linux-dev-certs) is an open-source, community-supported, .NET global tool that provides a convenient way to create and trust a developer certificate on Linux. The tool is not maintained or supported by Microsoft.

The following commands install the tool and create a trusted developer certificate:

```cli
dotnet tool update -g linux-dev-certs
dotnet linux-dev-certs install
```

For more information or to report issues, see the [linux-dev-certs GitHub repository](https://github.com/tmds/linux-dev-certs).
-->
<h3 id="ubuntu-trust-the-certificate-for-service-to-service-communication">Ubuntu trust the certificate for service-to-service communication</h3>
<p>The following instructions don't work for some Ubuntu versions, such as 20.04. For more information, see GitHub issue <a href="https://github.com/dotnet/AspNetCore.Docs/issues/23686" data-linktype="external">dotnet/AspNetCore.Docs #23686</a>.</p>
<ol>
<li><p>Install <a href="https://www.openssl.org/" data-linktype="external">OpenSSL</a> 1.1.1h or later. See your distribution for instructions on how to update OpenSSL.</p>
</li>
<li><p>Run the following commands:</p>
<pre><code class="lang-cli">dotnet dev-certs https
sudo -E dotnet dev-certs https -ep /usr/local/share/ca-certificates/aspnet/https.crt --format PEM
sudo update-ca-certificates
</code></pre>
</li>
</ol>
<p>The preceding commands:</p>
<ul>
<li>Ensure the current user's developer certificate is created.</li>
<li>Exports the certificate with elevated permissions needed for the <code>ca-certificates</code> folder, using the current user's environment.</li>
<li>Removing the <code>-E</code>  flag exports the root user certificate, generating it if necessary. Each newly generated certificate has a different thumbprint. When running as root, <code>sudo</code>  and  <code>-E</code> are not needed.</li>
</ul>
<p>The path in the preceding command is specific for Ubuntu. For other distributions, select an appropriate path or use the path for the Certificate Authorities (CAs).</p>
<p><a name="ssl-linux"></a></p>
<h3 id="trust-https-certificate-on-linux-using-edge-or-chrome">Trust HTTPS certificate on Linux using Edge or Chrome</h3>
<div class="tabGroup" id="tabgroup_2">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_2_linux-ubuntu" role="tab" aria-controls="tabpanel_2_linux-ubuntu" data-tab="linux-ubuntu" tabindex="0" aria-selected="true" data-linktype="self-bookmark">Ubuntu</a>
</li>
<li role="presentation">
<a href="#tabpanel_2_linux-rhel" role="tab" aria-controls="tabpanel_2_linux-rhel" data-tab="linux-rhel" tabindex="-1" data-linktype="self-bookmark">Red Hat Enterprise Linux</a>
</li>
<li role="presentation">
<a href="#tabpanel_2_linux-sles" role="tab" aria-controls="tabpanel_2_linux-sles" data-tab="linux-sles" tabindex="-1" data-linktype="self-bookmark">SUSE Linux Enterprise Server</a>
</li>
</ul>
<section id="tabpanel_2_linux-ubuntu" role="tabpanel" data-tab="linux-ubuntu">

<p>For chromium browsers on Linux:</p>
<ul>
<li><p>Install the <code>libnss3-tools</code> for your distribution.</p>
</li>
<li><p>Create or verify the <code>$HOME/.pki/nssdb</code> folder exists on the machine.</p>
</li>
<li><p>Export the certificate with the following command:</p>
<pre><code class="lang-cli">dotnet dev-certs https
sudo -E dotnet dev-certs https -ep /usr/local/share/ca-certificates/aspnet/https.crt --format PEM
</code></pre>
<p>The path in the preceding command is specific for Ubuntu. For other distributions, select an appropriate path or use the path for the Certificate Authorities (CAs).</p>
</li>
<li><p>Run the following commands:</p>
<pre><code class="lang-cli">certutil -d sql:$HOME/.pki/nssdb -A -t "P,," -n localhost -i /usr/local/share/ca-certificates/aspnet/https.crt
</code></pre>
</li>
<li><p>Exit and restart the browser.</p>
</li>
</ul>
<p><a name="trust-ff-linux"></a></p>
<h4 id="trust-the-certificate-with-firefox-on-linux">Trust the certificate with Firefox on Linux</h4>
<ul>
<li><p>Export the certificate with the following command:</p>
<pre><code class="lang-vstscli">dotnet dev-certs https
sudo -E dotnet dev-certs https -ep /usr/local/share/ca-certificates/aspnet/https.crt --format PEM
</code></pre>
<p>The path in the preceding command is specific for Ubuntu. For other distributions, select an appropriate path or use the path for the Certificate Authorities (CAs).</p>
</li>
<li><p>Create a JSON file at <code>/usr/lib/firefox/distribution/policies.json</code> with the following command:</p>
</li>
</ul>
<pre><code class="lang-sh">cat &lt;&lt;EOF | sudo tee /usr/lib/firefox/distribution/policies.json
{
    "policies": {
        "Certificates": {
            "Install": [
                "/usr/local/share/ca-certificates/aspnet/https.crt"
            ]
        }
    }
}
EOF
</code></pre>
<p>Note: Ubuntu 21.10 Firefox comes as a snap package and the installation folder is <code>/snap/firefox/current/usr/lib/firefox</code>.</p>
<p>See <a href="#trust-ff-ba" data-linktype="self-bookmark">Configure trust of HTTPS certificate using Firefox browser</a> in this article for an alternative way to configure the policy file using the browser.</p>
</section>
<section id="tabpanel_2_linux-rhel" role="tabpanel" data-tab="linux-rhel" aria-hidden="true" hidden="hidden">

<div class="WARNING">
<p>Warning</p>
<p>The following instructions are intended for development purposes only. Do not use the certificates generated in these instructions for a production environment.</p>
</div>
<p>These instructions use Mozilla's <em>legacy</em> tool <code>certutil</code> at  <code>https://firefox-source-docs.mozilla.org/security/nss/legacy/tools/nss_tools_certutil/index.html</code>. Instructions may be updated as modern utilities and practices are discovered.</p>
<div class="CAUTION">
<p>Caution</p>
<p>Improper use of TLS certificates could lead to spoofing.</p>
</div>
<div class="TIP">
<p>Tip</p>
<p>Instructions for valid production certificates can be found in the RHEL Documentation.
<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/securing_networks/index#creating-and-managing-tls-keys-and-certificates_securing-networks" data-linktype="external">RHEL8 TLS Certificates</a>
<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/securing_networks/index#creating-and-managing-tls-keys-and-certificates_securing-networks" data-linktype="external">RHEL9 TLS Certificates</a>
<a href="https://access.redhat.com/documentation/en-us/red_hat_certificate_system/9" data-linktype="external">RHEL9 Certificate System</a></p>
</div>
<h3 id="install-dependencies">Install Dependencies</h3>
<pre><code class="lang-sh">dnf install nss-tools
</code></pre>
<h3 id="export-the-aspnet-core-development-certificate">Export The ASP.NET Core Development Certificate</h3>
<div class="IMPORTANT">
<p>Important</p>
<p>Replace <code>${ProjectDirectory}</code> with your projects directory.
Replace <code>${CertificateName}</code> with a name you'll be able to identify in the future.</p>
</div>
<pre><code class="lang-sh">cd ${ProjectDirectory}
dotnet dev-certs https -ep ${ProjectDirectory}/${CertificateName}.crt --format PEM
</code></pre>
<div class="CAUTION">
<p>Caution</p>
<p>If using git, add your certificate to your <code>${ProjectDirectory}/.gitignore</code> or <code>${ProjectDirectory}/.git/info/exclude</code>.
View the <a href="https://git-scm.com/docs/gitignore" data-linktype="external">git documentation</a> for information about these files.</p>
</div>
<div class="TIP">
<p>Tip</p>
<p>You can move your exported certificate outside of your Git repository and replace the occurrences of <code>${ProjectDirectory}</code>, in the following instructions, with the new location.</p>
</div>
<h3 id="import-the-aspnet-core-development-certificate">Import The ASP.NET Core Development Certificate</h3>
<div class="IMPORTANT">
<p>Important</p>
<p>Replace <code>${UserProfile}</code> with the profile you intend to use.
Do not replace <code>$HOME</code>, it is the environment variable to your user directory.</p>
</div>
<h4 id="chromium-based-browsers">Chromium-based Browsers</h4>
<pre><code class="lang-sh">certutil -d sql:$HOME/.pki/nssdb -A -t "P,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
certutil -d sql:$HOME/.pki/nssdb -A -t "C,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
</code></pre>
<h4 id="mozilla-firefox">Mozilla Firefox</h4>
<pre><code class="lang-sh">certutil -d sql:$HOME/.mozilla/firefox/${UserProfile}/ -A -t "P,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
certutil -d sql:$HOME/.mozilla/firefox/${UserProfile}/ -A -t "C,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
</code></pre>
<h4 id="create-an-alias-to-test-with-curl">Create An Alias To Test With Curl</h4>
<div class="IMPORTANT">
<p>Important</p>
<p>Don't delete the exported certificate if you plan to test with curl.
You'll need to create an alias referencing it in your <code>$SHELL</code>'s profile</p>
</div>
<pre><code class="lang-sh">alias curl="curl --cacert ${ProjectDirectory}/${CertificateName}.crt"
</code></pre>
<h3 id="cleaning-up-the-development-certificates">Cleaning up the Development Certificates</h3>
<pre><code class="lang-sh">certutil -d sql:$HOME/.pki/nssdb -D -n ${CertificateName}
certutil -d sql:$HOME/.mozilla/firefox/${UserProfile}/ -D -n ${CertificateName}
rm ${ProjectDirectory}/${CertificateName}.crt
dotnet dev-certs https --clean
</code></pre>
<div class="NOTE">
<p>Note</p>
<p>Remove the curl alias you created earlier</p>
</div>
</section>
<section id="tabpanel_2_linux-sles" role="tabpanel" data-tab="linux-sles" aria-hidden="true" hidden="hidden">

<p>See <a href="https://github.com/dotnet/AspNetCore.Docs/issues/28292" data-linktype="external">this GitHub issue</a></p>
<!--
> [!WARNING]
> The following instructions are intended for development purposes only. Do not use the certificates generated in these instructions for a production environment.

These instructions use Mozilla's *legacy* tool [certutil](https://firefox-source-docs.mozilla.org/security/nss/legacy/tools/nss_tools_certutil/index.html). Instructions may be updated as modern utilities and practices are discovered.

> [!CAUTION]
> Improper use of TLS certificates could lead to spoofing.

> [!TIP]
> Instructions for valid production certificates can be found in the RHEL Documentation.
> [RHEL8 TLS Certificates](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/securing_networks/index#creating-and-managing-tls-keys-and-certificates_securing-networks)
> [RHEL9 TLS Certificates](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/securing_networks/index#creating-and-managing-tls-keys-and-certificates_securing-networks)
> [RHEL9 Certificate System](https://access.redhat.com/documentation/en-us/red_hat_certificate_system/9)

### Install Dependencies

```sh
dnf install nss-tools
```

### Export The ASP.NET Core Development Certificate

> [!IMPORTANT]
> Replace `${ProjectDirectory}` with your projects directory.
> Replace `${CertificateName}` with a name you'll be able to identify in the future.

```sh
cd ${ProjectDirectory}
dotnet dev-certs https -ep ${ProjectDirectory}/${CertificateName}.crt --format PEM
```

> [!CAUTION]
> If using git, add your certificate to your `${ProjectDirectory}/.gitignore` or `${ProjectDirectory}/.git/info/exclude`.
> View the [git documentation](https://git-scm.com/docs/gitignore) for information about these files.

> [!TIP]
> You can move your exported certificate outside of your Git repository and replace the occurrences of `${ProjectDirectory}`, in the following instructions, with the new location.

### Import The ASP.NET Core Development Certificate

> [!IMPORTANT]
> Replace `${UserProfile}` with the profile you intend to use.
> Do not replace `$HOME`, it is the environment variable to your user directory.

#### Chromium-based Browsers

```sh
certutil -d sql:$HOME/.pki/nssdb -A -t "P,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
certutil -d sql:$HOME/.pki/nssdb -A -t "C,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
```

#### Mozilla Firefox

```sh
certutil -d sql:$HOME/.mozilla/firefox/${UserProfile}/ -A -t "P,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
certutil -d sql:$HOME/.mozilla/firefox/${UserProfile}/ -A -t "C,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
```

#### Create An Alias To Test With Curl

> [!IMPORTANT]
>
> Don't delete the exported certificate if you plan to test with curl.
> You'll need to create an alias referencing it in your `$SHELL`'s profile

```sh
alias curl="curl --cacert ${ProjectDirectory}/${CertificateName}.crt"
```

### Cleaning up the Development Certificates

```sh
certutil -d sql:$HOME/.pki/nssdb -D -n ${CertificateName}
certutil -d sql:$HOME/.mozilla/firefox/${UserProfile}/ -D -n ${CertificateName}
rm ${ProjectDirectory}/${CertificateName}.crt
dotnet dev-certs https --clean
```

>[!NOTE]
> Remove the curl alias you created earlier
-->
</section>
</div>

<p><a name="wsl"></a></p>
<h3 id="trust-the-certificate-with-fedora-34">Trust the certificate with Fedora 34</h3>
<p>See:</p>
<ul>
<li><a href="https://github.com/dotnet/aspnetcore/issues/32361#issuecomment-837111639" data-linktype="external">This GitHub comment</a></li>
<li><a href="https://docs.fedoraproject.org/en-US/quick-docs/using-shared-system-certificates/" data-linktype="external">Fedora: Using Shared System Certificates</a></li>
<li><a href="https://fedoramagazine.org/set-up-a-net-development-environment/" data-linktype="external">Set up a .NET development environment</a> on Fedora.</li>
</ul>
<h3 id="trust-the-certificate-with-other-distros">Trust the certificate with other distros</h3>
<p>See <a href="https://github.com/dotnet/aspnetcore/issues/32842" data-linktype="external">this GitHub issue</a>.</p>
<h2 id="trust-https-certificate-from-windows-subsystem-for-linux">Trust HTTPS certificate from Windows Subsystem for Linux</h2>
<p>The following instructions don't work for some Linux distributions, such as Ubuntu 20.04. For more information, see GitHub issue <a href="https://github.com/dotnet/AspNetCore.Docs/issues/23686" data-linktype="external">dotnet/AspNetCore.Docs #23686</a>.</p>
<p>The <a href="https://learn.microsoft.com/en-us/windows/wsl/about" data-linktype="absolute-path">Windows Subsystem for Linux (WSL)</a> generates an HTTPS self-signed development certificate, which by default isn't trusted in Windows. The easiest way to have Windows trust the WSL certificate, is to configure WSL to use the same certificate as Windows:</p>
<ul>
<li><p>On <em><strong>Windows</strong></em>, export the developer certificate to a file:</p>
<pre><code>dotnet dev-certs https -ep https.pfx -p $CREDENTIAL_PLACEHOLDER$ --trust
</code></pre>
<p>Where <code>$CREDENTIAL_PLACEHOLDER$</code> is a password.</p>
</li>
<li><p>In a WSL window, import the exported certificate on the WSL instance:</p>
<pre><code>dotnet dev-certs https --clean --import &lt;&lt;path-to-pfx&gt;&gt; --password $CREDENTIAL_PLACEHOLDER$
</code></pre>
</li>
</ul>
<p>The preceding approach is a one time operation per certificate and per WSL distribution. It's easier than exporting the certificate over and over. If you update or regenerate the certificate on windows, you might need to run the preceding commands again.</p>
<p><a name="tcp"></a></p>
<h2 id="troubleshoot-certificate-problems-such-as-certificate-not-trusted">Troubleshoot certificate problems such as certificate not trusted</h2>
<p>This section provides help when the ASP.NET Core HTTPS development certificate has been <a href="#trust" data-linktype="self-bookmark">installed and trusted</a>, but you still have browser warnings that the certificate is not trusted. The ASP.NET Core HTTPS development certificate is used by <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Kestrel</a>.</p>
<p>To repair the IIS Express certificate, see <a href="https://stackoverflow.com/a/20048613/502537" data-linktype="external">this Stackoverflow</a> issue.</p>
<h3 id="all-platforms---certificate-not-trusted">All platforms - certificate not trusted</h3>
<p>Run the following commands:</p>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --clean
dotnet dev-certs https --trust
</code></pre>
<p>Close any browser instances open. Open a new browser window to app. Certificate trust is cached by browsers.</p>
<h3 id="dotnet-dev-certs-https---clean-fails">dotnet dev-certs https --clean Fails</h3>
<p>The preceding commands solve most browser trust issues. If the browser is still not trusting the certificate, follow the platform-specific suggestions that follow.</p>
<h3 id="docker---certificate-not-trusted">Docker - certificate not trusted</h3>
<ul>
<li>Delete the <em>C:\Users{USER}\AppData\Roaming\ASP.NET\Https</em> folder.</li>
<li>Clean the solution. Delete the <em>bin</em> and <em>obj</em> folders.</li>
<li>Restart the development tool. For example, Visual Studio or Visual Studio Code.</li>
</ul>
<h3 id="windows---certificate-not-trusted">Windows - certificate not trusted</h3>
<ul>
<li>Check the certificates in the certificate store. There should be a <code>localhost</code> certificate with the <code>ASP.NET Core HTTPS development certificate</code> friendly name both under <code>Current User &gt; Personal &gt; Certificates</code> and <code>Current User &gt; Trusted root certification authorities &gt; Certificates</code></li>
<li>Remove all the found certificates from both Personal and Trusted root certification authorities. Do <strong>not</strong> remove the IIS Express localhost certificate.</li>
<li>Run the following commands:</li>
</ul>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --clean
dotnet dev-certs https --trust
</code></pre>
<p>Close any browser instances open. Open a new browser window to app.</p>
<h3 id="os-x---certificate-not-trusted">OS X - certificate not trusted</h3>
<ul>
<li>Open KeyChain Access.</li>
<li>Select the System keychain.</li>
<li>Check for the presence of a localhost certificate.</li>
<li>Check that it contains a <code>+</code> symbol on the icon to indicate it's trusted for all users.</li>
<li>Remove the certificate from the system keychain.</li>
<li>Run the following commands:</li>
</ul>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --clean
dotnet dev-certs https --trust
</code></pre>
<p>Close any browser instances open. Open a new browser window to app.</p>
<p>See <a href="https://github.com/dotnet/AspNetCore/issues/16892" data-linktype="external">HTTPS Error using IIS Express (dotnet/AspNetCore #16892)</a> for troubleshooting certificate issues with Visual Studio.</p>
<h3 id="linux-certificate-not-trusted">Linux certificate not trusted</h3>
<p>Check that the certificate being configured for trust is the user HTTPS developer certificate that will be used by the Kestrel server.</p>
<p>Check the current user default HTTPS developer Kestrel certificate at the following location:</p>
<pre><code>ls -la ~/.dotnet/corefx/cryptography/x509stores/my
</code></pre>
<p>The HTTPS developer Kestrel certificate file is the SHA1 thumbprint. When the file is deleted via <code>dotnet dev-certs https --clean</code>, it's regenerated when needed with a different thumbprint.
Check the thumbprint of the exported certificate matches with the following command:</p>
<pre><code>openssl x509 -noout -fingerprint -sha1 -inform pem -in /usr/local/share/ca-certificates/aspnet/https.crt
</code></pre>
<p>If the certificate doesn't match, it could be one of the following:</p>
<ul>
<li>An old certificate.</li>
<li>An exported a developer certificate for the root user. For this case, export the  certificate.</li>
</ul>
<p>The root user certificate can be checked at:</p>
<pre><code>ls -la /root/.dotnet/corefx/cryptography/x509stores/my
</code></pre>
<h3 id="iis-express-ssl-certificate-used-with-visual-studio">IIS Express SSL certificate used with Visual Studio</h3>
<p>To fix problems with the IIS Express certificate, select <strong>Repair</strong> from the Visual Studio installer. For more information, see <a href="https://github.com/dotnet/aspnetcore/issues/16892" data-linktype="external">this GitHub issue</a>.</p>
<h3 id="group-policy-prevents-self-signed-certificates-from-being-trusted">Group policy prevents self-signed certificates from being trusted</h3>
<p>In some cases, group policy may prevent self-signed certificates from being trusted. For more information, see <a href="https://github.com/dotnet/aspnetcore/issues/21173" data-linktype="external">this GitHub issue</a>.</p>
<h2 id="additional-information">Additional information</h2>
<ul>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/proxy-load-balancer?view=aspnetcore-9.0" data-linktype="relative-path">Configure ASP.NET Core to work with proxy servers and load balancers</a></li>
<li><a href="../host-and-deploy/linux-nginx553c.html?view=aspnetcore-9.0#https-configuration" data-linktype="relative-path">Host ASP.NET Core on Linux with Nginx: HTTPS configuration</a></li>
<li><a href="https://learn.microsoft.com/en-us/iis/manage/configuring-security/how-to-set-up-ssl-on-iis" data-linktype="absolute-path">How to Set Up SSL on IIS</a></li>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/servers/kestrel/endpoints?view=aspnetcore-9.0" data-linktype="relative-path">Configure endpoints for the ASP.NET Core Kestrel web server</a></li>
<li><a href="https://www.owasp.org/index.php/HTTP_Strict_Transport_Security_Cheat_Sheet#Browser_Support" data-linktype="external">OWASP HSTS browser support</a></li>
</ul>
</div>
<div data-moniker="aspnetcore-3.0 aspnetcore-3.1 aspnetcore-5.0">
<div class="WARNING">
<p>Warning</p>
<h2 id="api-projects-1">API projects</h2>
<p>Do <strong>not</strong> use <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.mvc.requirehttpsattribute" class="no-loc" data-linktype="absolute-path">RequireHttpsAttribute</a> on Web APIs that receive sensitive information. <code>RequireHttpsAttribute</code> uses HTTP status codes to redirect browsers from HTTP to HTTPS. API clients may not understand or obey redirects from HTTP to HTTPS. Such clients may send information over HTTP. Web APIs should either:</p>
<ul>
<li>Not listen on HTTP.</li>
<li>Close the connection with status code 400 (Bad Request) and not serve the request.</li>
</ul>
<p>To disable HTTP redirection in an API, set the <code>ASPNETCORE_URLS</code> environment variable or use the <code>--urls</code> command line flag. For more information, see <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-9.0" data-linktype="relative-path">Use multiple environments in ASP.NET Core</a> and <a href="https://andrewlock.net/5-ways-to-set-the-urls-for-an-aspnetcore-app/" data-linktype="external">5 ways to set the URLs for an ASP.NET Core app</a> by Andrew Lock.</p>
<h2 id="hsts-and-api-projects-1">HSTS and API projects</h2>
<p>The default API projects don't include <a href="#hsts" data-linktype="self-bookmark">HSTS</a> because HSTS is generally a browser only instruction. Other callers, such as phone or desktop apps, do <strong>not</strong> obey the instruction. Even within browsers, a single authenticated call to an API over HTTP has risks on insecure networks. The secure approach is to configure API projects to only listen to and respond over HTTPS.</p>
</div>
<h2 id="require-https-1">Require HTTPS</h2>
<p>We recommend that production ASP.NET Core web apps use:</p>
<ul>
<li>HTTPS Redirection Middleware (<a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.httpspolicybuilderextensions.usehttpsredirection" class="no-loc" data-linktype="absolute-path">UseHttpsRedirection</a>) to redirect HTTP requests to HTTPS.</li>
<li>HSTS Middleware (<a href="#http-strict-transport-security-protocol-hsts" data-linktype="self-bookmark">UseHsts</a>) to send HTTP Strict Transport Security Protocol (HSTS) headers to clients.</li>
</ul>
<div class="NOTE">
<p>Note</p>
<p>Apps deployed in a reverse proxy configuration allow the proxy to handle connection security (HTTPS). If the proxy also handles HTTPS redirection, there's no need to use HTTPS Redirection Middleware. If the proxy server also handles writing HSTS headers (for example, <a href="https://learn.microsoft.com/en-us/iis/get-started/whats-new-in-iis-10-version-1709/iis-10-version-1709-hsts#iis-100-version-1709-native-hsts-support" data-linktype="absolute-path">native HSTS support in IIS 10.0 (1709) or later</a>), HSTS Middleware isn't required by the app. For more information, see <a href="#opt-out-of-httpshsts-on-project-creation" data-linktype="self-bookmark">Opt-out of HTTPS/HSTS on project creation</a>.</p>
</div>
<h3 id="usehttpsredirection-1">UseHttpsRedirection</h3>
<p>The following code calls <code>UseHttpsRedirection</code> in the <code>Startup</code> class:</p>
<pre><code class="lang-csharp" highlight-lines="14">public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
    if (env.IsDevelopment())
    {
        app.UseDeveloperExceptionPage();
    }
    else
    {
        app.UseExceptionHandler("/Error");
        // The default HSTS value is 30 days. You may want to change this for production scenarios, see https://aka.ms/aspnetcore-hsts.
        app.UseHsts();
    }

    app.UseHttpsRedirection();
    app.UseStaticFiles();

    app.UseRouting();

    app.UseAuthorization();

    app.UseEndpoints(endpoints =&gt;
    {
        endpoints.MapRazorPages();
    });
}
</code></pre>
<p>The preceding highlighted code:</p>
<ul>
<li>Uses the default <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.httpspolicy.httpsredirectionoptions.redirectstatuscode#microsoft-aspnetcore-httpspolicy-httpsredirectionoptions-redirectstatuscode" class="no-loc" data-linktype="absolute-path">HttpsRedirectionOptions.RedirectStatusCode</a> (<a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.statuscodes.status307temporaryredirect#microsoft-aspnetcore-http-statuscodes-status307temporaryredirect" class="no-loc" data-linktype="absolute-path">Status307TemporaryRedirect</a>).</li>
<li>Uses the default <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.httpspolicy.httpsredirectionoptions.httpsport#microsoft-aspnetcore-httpspolicy-httpsredirectionoptions-httpsport" class="no-loc" data-linktype="absolute-path">HttpsRedirectionOptions.HttpsPort</a> (null) unless overridden by the <code>ASPNETCORE_HTTPS_PORT</code> environment variable or <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.hosting.server.features.iserveraddressesfeature" class="no-loc" data-linktype="absolute-path">IServerAddressesFeature</a>.</li>
</ul>
<p>We recommend using temporary redirects rather than permanent redirects. Link caching can cause unstable behavior in development environments. If you prefer to send a permanent redirect status code when the app is in a non-Development environment, see the <a href="#configure-permanent-redirects-in-production" data-linktype="self-bookmark">Configure permanent redirects in production</a> section. We recommend using <a href="#http-strict-transport-security-protocol-hsts" data-linktype="self-bookmark">HSTS</a> to signal to clients that only secure resource requests should be sent to the app (only in production).</p>
<h3 id="port-configuration-1">Port configuration</h3>
<p>A port must be available for the middleware to redirect an insecure request to HTTPS. If no port is available:</p>
<ul>
<li>Redirection to HTTPS doesn't occur.</li>
<li>The middleware logs the warning "Failed to determine the https port for redirect."</li>
</ul>
<p>Specify the HTTPS port using any of the following approaches:</p>
<ul>
<li><p>Set <a href="#options" data-linktype="self-bookmark">HttpsRedirectionOptions.HttpsPort</a>.</p>
</li>
<li><p>Set the <code>https_port</code> <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/host/generic-host?view=aspnetcore-9.0#https_port" data-linktype="relative-path">host setting</a>:</p>
<ul>
<li><p>In host configuration.</p>
</li>
<li><p>By setting the <code>ASPNETCORE_HTTPS_PORT</code> environment variable.</p>
</li>
<li><p>By adding a top-level entry in <code>appsettings.json</code>:</p>
<pre><code class="lang-json" highlight-lines="2">{
    "https_port": 443,
    "Logging": {
        "LogLevel": {
            "Default": "Information",
            "Microsoft": "Warning",
            "Microsoft.Hosting.Lifetime": "Information"
        }
    },
    "AllowedHosts": "*"
}
</code></pre></li>
</ul>
</li>
<li><p>Indicate a port with the secure scheme using the <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/host/generic-host?view=aspnetcore-9.0#urls" data-linktype="relative-path">ASPNETCORE_URLS environment variable</a>. The environment variable configures the server. The middleware indirectly discovers the HTTPS port via <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.hosting.server.features.iserveraddressesfeature" class="no-loc" data-linktype="absolute-path">IServerAddressesFeature</a>. This approach doesn't work in reverse proxy deployments.</p>
</li>
<li><p>In development, set an HTTPS URL in <code>launchsettings.json</code>. Enable HTTPS when IIS Express is used.</p>
</li>
<li><p>Configure an HTTPS URL endpoint for a public-facing edge deployment of <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Kestrel</a> server or <a href="../fundamentals/servers/httpsys553c.html?view=aspnetcore-9.0" data-linktype="relative-path">HTTP.sys</a> server. Only <strong>one HTTPS port</strong> is used by the app. The middleware discovers the port via <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.hosting.server.features.iserveraddressesfeature" class="no-loc" data-linktype="absolute-path">IServerAddressesFeature</a>.</p>
</li>
</ul>
<div class="NOTE">
<p>Note</p>
<p>When an app is run in a reverse proxy configuration, <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.hosting.server.features.iserveraddressesfeature" class="no-loc" data-linktype="absolute-path">IServerAddressesFeature</a> isn't available. Set the port using one of the other approaches described in this section.</p>
</div>
<h3 id="edge-deployments-1">Edge deployments</h3>
<p>When Kestrel or HTTP.sys is used as a public-facing edge server, Kestrel or HTTP.sys must be configured to listen on both:</p>
<ul>
<li>The secure port where the client is redirected (typically, 443 in production and 5001 in development).</li>
<li>The insecure port (typically, 80 in production and 5000 in development).</li>
</ul>
<p>The insecure port must be accessible by the client in order for the app to receive an insecure request and redirect the client to the secure port.</p>
<p>For more information, see <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0#endpoint-configuration" data-linktype="relative-path">Kestrel endpoint configuration</a> or <a href="../fundamentals/servers/httpsys553c.html?view=aspnetcore-9.0" data-linktype="relative-path">HTTP.sys web server implementation in ASP.NET Core</a>.</p>
<h3 id="deployment-scenarios-1">Deployment scenarios</h3>
<p>Any firewall between the client and server must also have communication ports open for traffic.</p>
<p>If requests are forwarded in a reverse proxy configuration, use <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/proxy-load-balancer?view=aspnetcore-9.0" data-linktype="relative-path">Forwarded Headers Middleware</a> before calling HTTPS Redirection Middleware. Forwarded Headers Middleware updates the <code>Request.Scheme</code>, using the <code>X-Forwarded-Proto</code> header. The middleware permits redirect URIs and other security policies to work correctly. When Forwarded Headers Middleware isn't used, the backend app might not receive the correct scheme and end up in a redirect loop. A common end user error message is that too many redirects have occurred.</p>
<p>When deploying to Azure App Service, follow the guidance in <a href="https://learn.microsoft.com/en-us/azure/app-service/app-service-web-tutorial-custom-ssl" data-linktype="absolute-path">Tutorial: Bind an existing custom SSL certificate to Azure Web Apps</a>.</p>
<h3 id="options-1">Options</h3>
<p>The following highlighted code calls <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.httpsredirectionservicesextensions.addhttpsredirection" class="no-loc" data-linktype="absolute-path">AddHttpsRedirection</a> to configure middleware options:</p>
<pre><code class="lang-csharp" highlight-lines="14-18">public void ConfigureServices(IServiceCollection services)
{
    services.AddRazorPages();

    services.AddHsts(options =&gt;
    {
        options.Preload = true;
        options.IncludeSubDomains = true;
        options.MaxAge = TimeSpan.FromDays(60);
        options.ExcludedHosts.Add("example.com");
        options.ExcludedHosts.Add("www.example.com");
    });

    services.AddHttpsRedirection(options =&gt;
    {
        options.RedirectStatusCode = (int) HttpStatusCode.TemporaryRedirect;
        options.HttpsPort = 5001;
    });
}
</code></pre>
<p>Calling <code>AddHttpsRedirection</code> is only necessary to change the values of <code>HttpsPort</code> or <code>RedirectStatusCode</code>.</p>
<p>The preceding highlighted code:</p>
<ul>
<li>Sets <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.httpspolicy.httpsredirectionoptions.redirectstatuscode" class="no-loc" data-linktype="absolute-path">HttpsRedirectionOptions.RedirectStatusCode</a> to <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.statuscodes.status307temporaryredirect#microsoft-aspnetcore-http-statuscodes-status307temporaryredirect" class="no-loc" data-linktype="absolute-path">Status307TemporaryRedirect</a>, which is the default value. Use the fields of the <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.statuscodes" class="no-loc" data-linktype="absolute-path">StatusCodes</a> class for assignments to <code>RedirectStatusCode</code>.</li>
<li>Sets the HTTPS port to 5001.</li>
</ul>
<h4 id="configure-permanent-redirects-in-production-1">Configure permanent redirects in production</h4>
<p>The middleware defaults to sending a <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.statuscodes.status307temporaryredirect#microsoft-aspnetcore-http-statuscodes-status307temporaryredirect" class="no-loc" data-linktype="absolute-path">Status307TemporaryRedirect</a> with all redirects. If you prefer to send a permanent redirect status code when the app is in a non-Development environment, wrap the middleware options configuration in a conditional check for a non-Development environment.</p>
<p>When configuring services in <code>Startup.cs</code>:</p>
<pre><code class="lang-csharp">public void ConfigureServices(IServiceCollection services)
{
    // IWebHostEnvironment (stored in _env) is injected into the Startup class.
    if (!_env.IsDevelopment())
    {
        services.AddHttpsRedirection(options =&gt;
        {
            options.RedirectStatusCode = (int) HttpStatusCode.PermanentRedirect;
            options.HttpsPort = 443;
        });
    }
}
</code></pre>
<h2 id="https-redirection-middleware-alternative-approach-1">HTTPS Redirection Middleware alternative approach</h2>
<p>An alternative to using HTTPS Redirection Middleware (<code>UseHttpsRedirection</code>) is to use URL Rewriting Middleware (<code>AddRedirectToHttps</code>). <code>AddRedirectToHttps</code> can also set the status code and port when the redirect is executed. For more information, see <a href="../fundamentals/url-rewriting553c.html?view=aspnetcore-9.0" data-linktype="relative-path">URL Rewriting Middleware</a>.</p>
<p>When redirecting to HTTPS without the requirement for additional redirect rules, we recommend using HTTPS Redirection Middleware (<code>UseHttpsRedirection</code>) described in this article.</p>
<p><a name="hsts"></a></p>
<h2 id="http-strict-transport-security-protocol-hsts-1">HTTP Strict Transport Security Protocol (HSTS)</h2>
<p>Per <a href="https://www.owasp.org/index.php/About_The_Open_Web_Application_Security_Project" data-linktype="external">OWASP</a>, <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Strict_Transport_Security_Cheat_Sheet.html" data-linktype="external">HTTP Strict Transport Security (HSTS)</a> is an opt-in security enhancement that's specified by a web app through the use of a response header. When a <a href="https://cheatsheetseries.owasp.org/cheatsheets/Transport_Layer_Protection_Cheat_Sheet.html#browser-support" data-linktype="external">browser that supports HSTS</a> receives this header:</p>
<ul>
<li>The browser stores configuration for the domain that prevents sending any communication over HTTP. The browser forces all communication over HTTPS.</li>
<li>The browser prevents the user from using untrusted or invalid certificates. The browser disables prompts that allow a user to temporarily trust such a certificate.</li>
</ul>
<p>Because HSTS is enforced by the client, it has some limitations:</p>
<ul>
<li>The client must support HSTS.</li>
<li>HSTS requires at least one successful HTTPS request to establish the HSTS policy.</li>
<li>The application must check every HTTP request and redirect or reject the HTTP request.</li>
</ul>
<p>ASP.NET Core implements HSTS with the <code>UseHsts</code> extension method. The following code calls <code>UseHsts</code> when the app isn't in <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-9.0" data-linktype="relative-path">development mode</a>:</p>
<pre><code class="lang-csharp" highlight-lines="11">public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
    if (env.IsDevelopment())
    {
        app.UseDeveloperExceptionPage();
    }
    else
    {
        app.UseExceptionHandler("/Error");
        // The default HSTS value is 30 days. You may want to change this for production scenarios, see https://aka.ms/aspnetcore-hsts.
        app.UseHsts();
    }

    app.UseHttpsRedirection();
    app.UseStaticFiles();

    app.UseRouting();

    app.UseAuthorization();

    app.UseEndpoints(endpoints =&gt;
    {
        endpoints.MapRazorPages();
    });
}
</code></pre>
<p><code>UseHsts</code> isn't recommended in development because the HSTS settings are highly cacheable by browsers. By default, <code>UseHsts</code> excludes the local loopback address.</p>
<p>For production environments that are implementing HTTPS for the first time, set the initial <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.httpspolicy.hstsoptions.maxage" class="no-loc" data-linktype="absolute-path">HstsOptions.MaxAge</a> to a small value using one of the <a href="https://learn.microsoft.com/en-us/dotnet/api/system.timespan" class="no-loc" data-linktype="absolute-path">TimeSpan</a> methods. Set the value from hours to no more than a single day in case you need to revert the HTTPS infrastructure to HTTP. After you're confident in the sustainability of the HTTPS configuration, increase the HSTS <code>max-age</code> value; a commonly used value is one year.</p>
<p>The following code:</p>
<pre><code class="lang-csharp" highlight-lines="5-12">public void ConfigureServices(IServiceCollection services)
{
    services.AddRazorPages();

    services.AddHsts(options =&gt;
    {
        options.Preload = true;
        options.IncludeSubDomains = true;
        options.MaxAge = TimeSpan.FromDays(60);
        options.ExcludedHosts.Add("example.com");
        options.ExcludedHosts.Add("www.example.com");
    });

    services.AddHttpsRedirection(options =&gt;
    {
        options.RedirectStatusCode = (int) HttpStatusCode.TemporaryRedirect;
        options.HttpsPort = 5001;
    });
}
</code></pre>
<ul>
<li>Sets the preload parameter of the <code>Strict-Transport-Security</code> header. Preload isn't part of the <a href="https://tools.ietf.org/html/rfc6797" data-linktype="external">RFC HSTS specification</a>, but is supported by web browsers to preload HSTS sites on fresh install. For more information, see <a href="https://hstspreload.org/" data-linktype="external">https://hstspreload.org/</a>.</li>
<li>Enables <a href="https://tools.ietf.org/html/rfc6797#section-6.1.2" data-linktype="external">includeSubDomain</a>, which applies the HSTS policy to Host subdomains.</li>
<li>Explicitly sets the <code>max-age</code> parameter of the <code>Strict-Transport-Security</code> header to 60 days. If not set, defaults to 30 days. For more information, see the <a href="https://tools.ietf.org/html/rfc6797#section-6.1.1" data-linktype="external">max-age directive</a>.</li>
<li>Adds <code>example.com</code> to the list of hosts to exclude.</li>
</ul>
<p><code>UseHsts</code> excludes the following loopback hosts:</p>
<ul>
<li><code>localhost</code> : The IPv4 loopback address.</li>
<li><code>127.0.0.1</code> : The IPv4 loopback address.</li>
<li><code>[::1]</code> : The IPv6 loopback address.</li>
</ul>
<h2 id="opt-out-of-httpshsts-on-project-creation-1">Opt-out of HTTPS/HSTS on project creation</h2>
<p>In some backend service scenarios where connection security is handled at the public-facing edge of the network, configuring connection security at each node isn't required. Web apps that are generated from the templates in Visual Studio or from the <a href="https://learn.microsoft.com/en-us/dotnet/core/tools/dotnet-new" data-linktype="absolute-path">dotnet new</a> command enable <a href="#require-https" data-linktype="self-bookmark">HTTPS redirection</a> and <a href="#http-strict-transport-security-protocol-hsts" data-linktype="self-bookmark">HSTS</a>. For deployments that don't require these scenarios, you can opt-out of HTTPS/HSTS when the app is created from the template.</p>
<p>To opt-out of HTTPS/HSTS:</p>
<div class="tabGroup" id="tabgroup_3">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_3_visual-studio" role="tab" aria-controls="tabpanel_3_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true" data-linktype="self-bookmark">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_3_net-cli" role="tab" aria-controls="tabpanel_3_net-cli" data-tab="net-cli" tabindex="-1" data-linktype="self-bookmark">.NET CLI</a>
</li>
</ul>
<section id="tabpanel_3_visual-studio" role="tabpanel" data-tab="visual-studio">

<p>Uncheck the <strong>Configure for HTTPS</strong> checkbox.</p>
<p><img src="https://learn.microsoft.com/en-us/aspnet/core/security/enforcing-ssl/_static/out-vs2022.png?view=aspnetcore-9.0" alt="Additional information dialog for New ASP.NET Core Web App template, showing the Configure for HTTPS checkbox" data-linktype="relative-path"></p>
</section>
<section id="tabpanel_3_net-cli" role="tabpanel" data-tab="net-cli" aria-hidden="true" hidden="hidden">

<p>Use the <code>--no-https</code> option. For example</p>
<pre><code class="lang-dotnetcli">dotnet new webapp --no-https
</code></pre>
</section>
</div>

<p><a name="trust"></a></p>
<h2 id="trust-the-aspnet-core-https-development-certificate-on-windows-and-macos-1">Trust the ASP.NET Core HTTPS development certificate on Windows and macOS</h2>
<p>For the Firefox browser, see the next section.</p>
<p>The .NET Core SDK includes an HTTPS development certificate. The certificate is installed as part of the first-run experience. For example, running <code>dotnet new webapp</code> for the first time produces a variation of the following output:</p>
<pre><code class="lang-output">Installed an ASP.NET Core HTTPS development certificate.
To trust the certificate, run 'dotnet dev-certs https --trust'
Learn about HTTPS: https://aka.ms/dotnet-https
</code></pre>
<p>Installing the .NET Core SDK installs the ASP.NET Core HTTPS development certificate to the local user certificate store. The certificate has been installed, but it's not trusted. To trust the certificate, perform the one-time step to run the <code>dotnet dev-certs</code> tool:</p>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --trust
</code></pre>
<p>The following command provides help on the <code>dotnet dev-certs</code> tool:</p>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --help
</code></pre>
<div class="WARNING">
<p>Warning</p>
<p>Do not create a development certificate in an environment that will be redistributed, such as a container image or virtual machine. Doing so can lead to spoofing and elevation of privilege. To help prevent this, set the <code>DOTNET_GENERATE_ASPNET_CERTIFICATE</code> environment variable to <code>false</code> prior to calling the .NET CLI for the first time. This will skip the automatic generation of the ASP.NET Core development certificate during the CLI's first-run experience.</p>
</div>
<p><a name="trust-ff"></a></p>
<h3 id="trust-the-https-certificate-with-firefox-to-prevent-sec_error_inadequate_key_usage-error-1">Trust the HTTPS certificate with Firefox to prevent SEC_ERROR_INADEQUATE_KEY_USAGE error</h3>
<p>The Firefox browser uses its own certificate store, and therefore doesn't trust the <a href="https://learn.microsoft.com/en-us/iis/extensions/introduction-to-iis-express/iis-express-overview" data-linktype="absolute-path">IIS Express</a> or <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Kestrel</a> developer certificates.</p>
<p>There are two approaches to trusting the HTTPS certificate with Firefox, create a policy file or configure with the FireFox browser. Configuring with the browser creates the policy file, so the two approaches are equivalent.</p>
<h4 id="create-a-policy-file-to-trust-https-certificate-with-firefox-1">Create a policy file to trust HTTPS certificate with Firefox</h4>
<p>Create a policy file (<code>policies.json</code>) at:</p>
<ul>
<li>Windows: <code>%PROGRAMFILES%\Mozilla Firefox\distribution\</code></li>
<li>MacOS: <code>Firefox.app/Contents/Resources/distribution</code></li>
<li>Linux: See <a href="#trust-ff-linux" data-linktype="self-bookmark">Trust the certificate with Firefox on Linux</a> later in this article.</li>
</ul>
<p>Add the following JSON to the Firefox policy file:</p>
<pre><code class="lang-json">{
  "policies": {
    "Certificates": {
      "ImportEnterpriseRoots": true
    }
  }
}
</code></pre>
<p>The preceding policy file makes Firefox trust certificates from the trusted certificates in the Windows certificate store. The next section provides an alternative approach to create the preceding policy file by using the Firefox browser.</p>
<p><a name="trust-ff-ba"></a></p>
<h3 id="configure-trust-of-https-certificate-using-firefox-browser-1">Configure trust of HTTPS certificate using Firefox browser</h3>
<p>Set  <code>security.enterprise_roots.enabled</code> = <code>true</code> using the following instructions:</p>
<ol>
<li>Enter <code>about:config</code> in the FireFox browser.</li>
<li>Select <strong>Accept the Risk and Continue</strong> if you accept the risk.</li>
<li>Select <strong>Show All</strong>.</li>
<li>Set <code>security.enterprise_roots.enabled</code> = <code>true</code>.</li>
<li>Exit and restart Firefox.</li>
</ol>
<p>For more information, see <a href="https://support.mozilla.org/kb/setting-certificate-authorities-firefox" data-linktype="external">Setting Up Certificate Authorities (CAs) in Firefox</a> and the <a href="https://github.com/mozilla/policy-templates/blob/master/README.md" data-linktype="external">mozilla/policy-templates/README file</a>.</p>
<h2 id="how-to-set-up-a-developer-certificate-for-docker-1">How to set up a developer certificate for Docker</h2>
<p>See <a href="https://github.com/dotnet/AspNetCore.Docs/issues/6199" data-linktype="external">this GitHub issue</a>.</p>
<h2 id="trust-https-certificate-on-linux-1">Trust HTTPS certificate on Linux</h2>
<p>Establishing trust is distribution and browser specific. The following sections provide instructions for some popular distributions and the Chromium browsers (Edge and Chrome) and for Firefox.</p>
<h3 id="ubuntu-trust-the-certificate-for-service-to-service-communication-1">Ubuntu trust the certificate for service-to-service communication</h3>
<ol>
<li><p>Install <a href="https://www.openssl.org/" data-linktype="external">OpenSSL</a> 1.1.1h or later. See your distribution for instructions on how to update OpenSSL.</p>
</li>
<li><p>Run the following commands:</p>
<pre><code class="lang-cli">dotnet dev-certs https
sudo -E dotnet dev-certs https -ep /usr/local/share/ca-certificates/aspnet/https.crt --format PEM
sudo update-ca-certificates
</code></pre>
</li>
</ol>
<p>The preceding commands:</p>
<ul>
<li>Ensure the current user's developer certificate is created.</li>
<li>Export the certificate with elevated permissions needed for the <code>ca-certificates</code> folder, using the current user's environment.</li>
<li>Remove the <code>-E</code>  flag to export the root user certificate, generating it if necessary. Each newly generated certificate has a different thumbprint. When running as root, <code>sudo</code>  and  <code>-E</code> are not needed.</li>
</ul>
<p>The path in the preceding command is specific for Ubuntu. For other distributions, select an appropriate path or use the path for the Certificate Authorities (CAs).</p>
<p><a name="ssl-linux"></a></p>
<h3 id="trust-https-certificate-on-linux-using-edge-or-chrome-1">Trust HTTPS certificate on Linux using Edge or Chrome</h3>
<p>For chromium browsers on Linux:</p>
<ul>
<li><p>Install the <code>libnss3-tools</code> for your distribution.</p>
</li>
<li><p>Create or verify the <code>$HOME/.pki/nssdb</code> folder exists on the machine.</p>
</li>
<li><p>Export the certificate with the following command:</p>
<pre><code class="lang-cli">dotnet dev-certs https
sudo -E dotnet dev-certs https -ep /usr/local/share/ca-certificates/aspnet/https.crt --format PEM
</code></pre>
<p>The path in the preceding command is specific for Ubuntu. For other distributions, select an appropriate path or use the path for the Certificate Authorities (CAs).</p>
</li>
<li><p>Run the following commands:</p>
<pre><code class="lang-cli">certutil -d sql:$HOME/.pki/nssdb -A -t "P,," -n localhost -i /usr/local/share/ca-certificates/aspnet/https.crt
</code></pre>
</li>
<li><p>Exit and restart the browser.</p>
</li>
</ul>
<p><a name="trust-ff-linux"></a></p>
<h3 id="trust-the-certificate-with-firefox-on-linux-1">Trust the certificate with Firefox on Linux</h3>
<ul>
<li><p>Export the certificate with the following command:</p>
<pre><code class="lang-vstscli">dotnet dev-certs https
sudo -E dotnet dev-certs https -ep /usr/local/share/ca-certificates/aspnet/https.crt --format PEM
</code></pre>
<p>The path in the preceding command is specific for Ubuntu. For other distributions, select an appropriate path or use the path for the Certificate Authorities (CAs).</p>
</li>
<li><p>Create a JSON file at <code>/usr/lib/firefox/distribution/policies.json</code> with the following contents:</p>
</li>
</ul>
<pre><code class="lang-sh">cat &lt;&lt;EOF | sudo tee /usr/lib/firefox/distribution/policies.json
{
    "policies": {
        "Certificates": {
            "Install": [
                "/usr/local/share/ca-certificates/aspnet/https.crt"
            ]
        }
    }
}
EOF
</code></pre>
<p>See <a href="#trust-ff-ba" data-linktype="self-bookmark">Configure trust of HTTPS certificate using Firefox browser</a> in this article for an alternative way to configure the policy file using the browser.</p>
<p><a name="wsl"></a></p>
<h3 id="trust-the-certificate-with-fedora-34-1">Trust the certificate with Fedora 34</h3>
<h4 id="firefox-on-fedora">Firefox on Fedora</h4>
<pre><code class="lang-bash">echo 'pref("general.config.filename", "firefox.cfg");
pref("general.config.obscure_value", 0);' &gt; ./autoconfig.js

echo '//Enable policies.json
lockPref("browser.policies.perUserDir", false);' &gt; firefox.cfg

echo "{
    \"policies\": {
        \"Certificates\": {
            \"Install\": [
                \"aspnetcore-localhost-https.crt\"
            ]
        }
    }
}" &gt; policies.json

dotnet dev-certs https -ep localhost.crt --format PEM

sudo mv autoconfig.js /usr/lib64/firefox/
sudo mv firefox.cfg /usr/lib64/firefox/
sudo mv policies.json /usr/lib64/firefox/distribution/
mkdir -p ~/.mozilla/certificates
cp localhost.crt ~/.mozilla/certificates/aspnetcore-localhost-https.crt
rm localhost.crt
</code></pre>
<h4 id="trust-dotnet-to-dotnet-on-fedora">Trust dotnet-to-dotnet on Fedora</h4>
<pre><code class="lang-bash">sudo cp localhost.crt /etc/pki/tls/certs/localhost.pem
sudo update-ca-trust
rm localhost.crt
</code></pre>
<p>See <a href="https://github.com/dotnet/aspnetcore/issues/32361#issuecomment-837111639" data-linktype="external">this GitHub comment</a> for more information.</p>
<h3 id="trust-the-certificate-with-other-distros-1">Trust the certificate with other distros</h3>
<p>See <a href="https://github.com/dotnet/aspnetcore/issues/32842" data-linktype="external">this GitHub issue</a>.</p>
<h2 id="trust-https-certificate-from-windows-subsystem-for-linux-1">Trust HTTPS certificate from Windows Subsystem for Linux</h2>
<p>The <a href="https://learn.microsoft.com/en-us/windows/wsl/about" data-linktype="absolute-path">Windows Subsystem for Linux (WSL)</a> generates an HTTPS self-signed development certificate. To configure the Windows certificate store to trust the WSL certificate:</p>
<ul>
<li><p>Export the developer certificate to a file on <em><strong>Windows</strong></em>:</p>
<pre><code>dotnet dev-certs https -ep C:\&lt;&lt;path-to-folder&gt;&gt;\aspnetcore.pfx -p $CREDENTIAL_PLACEHOLDER$
</code></pre>
<p>Where <code>$CREDENTIAL_PLACEHOLDER$</code> is a password.</p>
</li>
<li><p>In a WSL window, import the exported certificate on the WSL instance:</p>
<pre><code>dotnet dev-certs https --clean --import /mnt/c/&lt;&lt;path-to-folder&gt;&gt;/aspnetcore.pfx -p $CREDENTIAL_PLACEHOLDER$
</code></pre>
</li>
</ul>
<p>The preceding approach is a one time operation per certificate and per WSL distribution. It's easier than exporting the certificate over and over. If you update or regenerate the certificate on windows, you might need to run the preceding commands again.</p>
<p><a name="tcp"></a></p>
<h2 id="troubleshoot-certificate-problems-such-as-certificate-not-trusted-1">Troubleshoot certificate problems such as certificate not trusted</h2>
<p>This section provides help when the ASP.NET Core HTTPS development certificate has been <a href="#trust" data-linktype="self-bookmark">installed and trusted</a>, but you still have browser warnings that the certificate is not trusted. The ASP.NET Core HTTPS development certificate is used by <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Kestrel</a>.</p>
<p>To repair the IIS Express certificate, see <a href="https://stackoverflow.com/a/20048613/502537" data-linktype="external">this Stackoverflow</a> issue.</p>
<h3 id="all-platforms---certificate-not-trusted-1">All platforms - certificate not trusted</h3>
<p>Run the following commands:</p>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --clean
dotnet dev-certs https --trust
</code></pre>
<p>Close any browser instances that are open. Open a new browser window to the app. Certificate trust is cached by browsers.</p>
<h3 id="dotnet-dev-certs-https---clean-fails-1">dotnet dev-certs https --clean fails</h3>
<p>The preceding commands solve most browser trust issues. If the browser is still not trusting the certificate, follow the platform-specific suggestions that follow.</p>
<h3 id="docker---certificate-not-trusted-1">Docker - certificate not trusted</h3>
<ul>
<li>Delete the <em>C:\Users{USER}\AppData\Roaming\ASP.NET\Https</em> folder.</li>
<li>Clean the solution. Delete the <em>bin</em> and <em>obj</em> folders.</li>
<li>Restart the development tool. For example, Visual Studio, Visual Studio Code, or Visual Studio for Mac.</li>
</ul>
<h3 id="windows---certificate-not-trusted-1">Windows - certificate not trusted</h3>
<ul>
<li>Check the certificates in the certificate store. There should be a <code>localhost</code> certificate with the <code>ASP.NET Core HTTPS development certificate</code> friendly name both under <code>Current User &gt; Personal &gt; Certificates</code> and <code>Current User &gt; Trusted root certification authorities &gt; Certificates</code></li>
<li>Remove all the found certificates from both Personal and Trusted root certification authorities. Do <strong>not</strong> remove the IIS Express localhost certificate.</li>
<li>Run the following commands:</li>
</ul>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --clean
dotnet dev-certs https --trust
</code></pre>
<p>Close any browser instances that are open. Open a new browser window to the app. Certificate trust is cached by browsers.</p>
<h3 id="os-x---certificate-not-trusted-1">OS X - certificate not trusted</h3>
<ul>
<li>Open KeyChain Access.</li>
<li>Select the System keychain.</li>
<li>Check for the presence of a localhost certificate.</li>
<li>Check that it contains a <code>+</code> symbol on the icon to indicate it's trusted for all users.</li>
<li>Remove the certificate from the system keychain.</li>
<li>Run the following commands:</li>
</ul>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --clean
dotnet dev-certs https --trust
</code></pre>
<p>Close any browser instances that are open. Open a new browser window to the app. Certificate trust is cached by browsers.</p>
<p>See <a href="https://github.com/dotnet/AspNetCore/issues/16892" data-linktype="external">HTTPS Error using IIS Express (dotnet/AspNetCore #16892)</a> for troubleshooting certificate issues with Visual Studio.</p>
<h3 id="linux-certificate-not-trusted-1">Linux certificate not trusted</h3>
<p>Check that the certificate being configured for trust is the user HTTPS developer certificate that will be used by the Kestrel server.</p>
<p>Check the current user default HTTPS developer Kestrel certificate at the following location:</p>
<pre><code>ls -la ~/.dotnet/corefx/cryptography/x509stores/my
</code></pre>
<p>The HTTPS developer Kestrel certificate file is the SHA1 thumbprint. When the file is deleted via <code>dotnet dev-certs https --clean</code>, it's regenerated when needed with a different thumbprint.
Check the thumbprint of the exported certificate matches with the following command:</p>
<pre><code>openssl x509 -noout -fingerprint -sha1 -inform pem -in /usr/local/share/ca-certificates/aspnet/https.crt
</code></pre>
<p>If the certificate doesn't match, it could be one of the following:</p>
<ul>
<li>An old certificate.</li>
<li>An exported a developer certificate for the root user. For this case, export the  certificate.</li>
</ul>
<p>The root user certificate can be checked at:</p>
<pre><code>ls -la /root/.dotnet/corefx/cryptography/x509stores/my
</code></pre>
<h3 id="iis-express-ssl-certificate-used-with-visual-studio-1">IIS Express SSL certificate used with Visual Studio</h3>
<p>To fix problems with the IIS Express certificate, select <strong>Repair</strong> from the Visual Studio installer. For more information, see <a href="https://github.com/dotnet/aspnetcore/issues/16892" data-linktype="external">this GitHub issue</a>.</p>
<h2 id="additional-information-1">Additional information</h2>
<ul>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/proxy-load-balancer?view=aspnetcore-9.0" data-linktype="relative-path">Configure ASP.NET Core to work with proxy servers and load balancers</a></li>
<li><a href="../host-and-deploy/linux-nginx553c.html?view=aspnetcore-9.0#https-configuration" data-linktype="relative-path">Host ASP.NET Core on Linux with Nginx: HTTPS configuration</a></li>
<li><a href="https://learn.microsoft.com/en-us/iis/manage/configuring-security/how-to-set-up-ssl-on-iis" data-linktype="absolute-path">How to Set Up SSL on IIS</a></li>
<li><a href="https://www.owasp.org/index.php/HTTP_Strict_Transport_Security_Cheat_Sheet#Browser_Support" data-linktype="external">OWASP HSTS browser support</a></li>
<li><a href="https://learn.microsoft.com/en-us/dotnet/core/tools/dotnet-dev-certs" data-linktype="absolute-path"><code>dotnet dev-certs</code></a></li>
</ul>
</div>
<div data-moniker="aspnetcore-7.0">
<div class="NOTE">
<p>Note</p>
<p>If you're using .NET 9 or later SDK, see the updated Linux procedures in the <a href="https://learn.microsoft.com/en-us/aspnet/core/security/enforcing-ssl?view=aspnetcore-9.0&amp;preserve-view=true" data-linktype="relative-path">.NET 9 version of this article</a>.</p>
</div>
<div class="WARNING">
<p>Warning</p>
<h2 id="api-projects">API projects</h2>
<p>Do <strong>not</strong> use <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.mvc.requirehttpsattribute" class="no-loc" data-linktype="absolute-path">RequireHttpsAttribute</a> on Web APIs that receive sensitive information. <code>RequireHttpsAttribute</code> uses HTTP status codes to redirect browsers from HTTP to HTTPS. API clients may not understand or obey redirects from HTTP to HTTPS. Such clients may send information over HTTP. Web APIs should either:</p>
<ul>
<li>Not listen on HTTP.</li>
<li>Close the connection with status code 400 (Bad Request) and not serve the request.</li>
</ul>
<p>To disable HTTP redirection in an API, set the <code>ASPNETCORE_URLS</code> environment variable or use the <code>--urls</code> command line flag. For more information, see <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-9.0" data-linktype="relative-path">Use multiple environments in ASP.NET Core</a> and <a href="https://andrewlock.net/8-ways-to-set-the-urls-for-an-aspnetcore-app/" data-linktype="external">8 ways to set the URLs for an ASP.NET Core app</a> by Andrew Lock.</p>
<h2 id="hsts-and-api-projects">HSTS and API projects</h2>
<p>The default API projects don't include <a href="#hsts" data-linktype="self-bookmark">HSTS</a> because <a href="https://developer.mozilla.org/docs/Web/HTTP/Headers/Strict-Transport-Security" data-linktype="external">HSTS</a> is generally a browser only instruction. Other callers, such as phone or desktop apps, do <strong>not</strong> obey the instruction. Even within browsers, a single authenticated call to an API over HTTP has risks on insecure networks. The secure approach is to configure API projects to only listen to and respond over HTTPS.</p>
</div>
<p><a name="no-http"></a></p>
<h3 id="http-redirection-to-https-causes-err_invalid_redirect-on-the-cors-preflight-request">HTTP redirection to HTTPS causes ERR_INVALID_REDIRECT on the CORS preflight request</h3>
<p>Requests to an endpoint using HTTP that are redirected to HTTPS by <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.httpspolicybuilderextensions.usehttpsredirection" class="no-loc" data-linktype="absolute-path">UseHttpsRedirection</a> fail with <code>ERR_INVALID_REDIRECT</code> on the CORS preflight request.</p>
<p>API projects can reject HTTP requests rather than use <code>UseHttpsRedirection</code> to redirect requests to HTTPS.</p>
<h2 id="require-https">Require HTTPS</h2>
<p>We recommend that production ASP.NET Core web apps use:</p>
<ul>
<li>HTTPS Redirection Middleware (<a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.httpspolicybuilderextensions.usehttpsredirection" class="no-loc" data-linktype="absolute-path">UseHttpsRedirection</a>) to redirect HTTP requests to HTTPS.</li>
<li>HSTS Middleware (<a href="#http-strict-transport-security-protocol-hsts" data-linktype="self-bookmark">UseHsts</a>) to send HTTP Strict Transport Security Protocol (HSTS) headers to clients.</li>
</ul>
<div class="NOTE">
<p>Note</p>
<p>Apps deployed in a reverse proxy configuration allow the proxy to handle connection security (HTTPS). If the proxy also handles HTTPS redirection, there's no need to use HTTPS Redirection Middleware. If the proxy server also handles writing HSTS headers (for example, <a href="https://learn.microsoft.com/en-us/iis/get-started/whats-new-in-iis-10-version-1709/iis-10-version-1709-hsts#iis-100-version-1709-native-hsts-support" data-linktype="absolute-path">native HSTS support in IIS 10.0 (1709) or later</a>), HSTS Middleware isn't required by the app. For more information, see <a href="#opt-out-of-httpshsts-on-project-creation" data-linktype="self-bookmark">Opt-out of HTTPS/HSTS on project creation</a>.</p>
</div>
<h3 id="usehttpsredirection">UseHttpsRedirection</h3>
<p>The following code calls <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.httpspolicybuilderextensions.usehttpsredirection" class="no-loc" data-linktype="absolute-path">UseHttpsRedirection</a> in the <code>Program.cs</code> file:</p>
<pre><code class="lang-csharp" highlight-lines="13">var builder = WebApplication.CreateBuilder(args);

builder.Services.AddRazorPages();

var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();

app.MapRazorPages();

app.Run();
</code></pre>
<p>The preceding highlighted code:</p>
<ul>
<li>Uses the default <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.httpspolicy.httpsredirectionoptions.redirectstatuscode#microsoft-aspnetcore-httpspolicy-httpsredirectionoptions-redirectstatuscode" class="no-loc" data-linktype="absolute-path">HttpsRedirectionOptions.RedirectStatusCode</a> (<a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.statuscodes.status307temporaryredirect#microsoft-aspnetcore-http-statuscodes-status307temporaryredirect" class="no-loc" data-linktype="absolute-path">Status307TemporaryRedirect</a>).</li>
<li>Uses the default <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.httpspolicy.httpsredirectionoptions.httpsport#microsoft-aspnetcore-httpspolicy-httpsredirectionoptions-httpsport" class="no-loc" data-linktype="absolute-path">HttpsRedirectionOptions.HttpsPort</a> (null) unless overridden by the <code>ASPNETCORE_HTTPS_PORT</code> environment variable or <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.hosting.server.features.iserveraddressesfeature" class="no-loc" data-linktype="absolute-path">IServerAddressesFeature</a>.</li>
</ul>
<p>We recommend using temporary redirects rather than permanent redirects. Link caching can cause unstable behavior in development environments. If you prefer to send a permanent redirect status code when the app is in a non-Development environment, see the <a href="#configure-permanent-redirects-in-production" data-linktype="self-bookmark">Configure permanent redirects in production</a> section. We recommend using <a href="#http-strict-transport-security-protocol-hsts" data-linktype="self-bookmark">HSTS</a> to signal to clients that only secure resource requests should be sent to the app (only in production).</p>
<h3 id="port-configuration">Port configuration</h3>
<p>A port must be available for the middleware to redirect an insecure request to HTTPS. If no port is available:</p>
<ul>
<li>Redirection to HTTPS doesn't occur.</li>
<li>The middleware logs the warning "Failed to determine the https port for redirect."</li>
</ul>
<p>Specify the HTTPS port using any of the following approaches:</p>
<ul>
<li><p>Set <a href="#options" data-linktype="self-bookmark">HttpsRedirectionOptions.HttpsPort</a>.</p>
</li>
<li><p>Set the <code>https_port</code> <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/host/generic-host?view=aspnetcore-9.0#https_port" data-linktype="relative-path">host setting</a>:</p>
<ul>
<li><p>In host configuration.</p>
</li>
<li><p>By setting the <code>ASPNETCORE_HTTPS_PORT</code> environment variable.</p>
</li>
<li><p>By adding a top-level entry in <code>appsettings.json</code>:</p>
<pre><code class="lang-json" highlight-lines="2">{
  "https_port": 443,
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*"
}
</code></pre></li>
</ul>
</li>
<li><p>Indicate a port with the secure scheme using the <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/host/generic-host?view=aspnetcore-9.0#urls" data-linktype="relative-path">ASPNETCORE_URLS environment variable</a>. The environment variable configures the server. The middleware indirectly discovers the HTTPS port via <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.hosting.server.features.iserveraddressesfeature" class="no-loc" data-linktype="absolute-path">IServerAddressesFeature</a>. This approach doesn't work in reverse proxy deployments.</p>
</li>
<li><p>The ASP.NET Core web templates set an HTTPS URL in <code>Properties/launchsettings.json</code> for both Kestrel and IIS Express. <code>launchsettings.json</code> is only used on the local machine.</p>
</li>
<li><p>Configure an HTTPS URL endpoint for a public-facing edge deployment of <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Kestrel</a> server or <a href="../fundamentals/servers/httpsys553c.html?view=aspnetcore-9.0" data-linktype="relative-path">HTTP.sys</a> server. Only <strong>one HTTPS port</strong> is used by the app. The middleware discovers the port via <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.hosting.server.features.iserveraddressesfeature" class="no-loc" data-linktype="absolute-path">IServerAddressesFeature</a>.</p>
</li>
</ul>
<div class="NOTE">
<p>Note</p>
<p>When an app is run in a reverse proxy configuration, <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.hosting.server.features.iserveraddressesfeature" class="no-loc" data-linktype="absolute-path">IServerAddressesFeature</a> isn't available. Set the port using one of the other approaches described in this section.</p>
</div>
<h3 id="edge-deployments">Edge deployments</h3>
<p>When <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Kestrel</a> or <a href="../fundamentals/servers/httpsys553c.html?view=aspnetcore-9.0" data-linktype="relative-path">HTTP.sys</a> is used as a public-facing edge server, Kestrel or HTTP.sys must be configured to listen on both:</p>
<ul>
<li>The secure port where the client is redirected (typically, 443 in production and 5001 in development).</li>
<li>The insecure port (typically, 80 in production and 5000 in development).</li>
</ul>
<p>The insecure port must be accessible by the client in order for the app to receive an insecure request and redirect the client to the secure port.</p>
<p>For more information, see <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0#endpoint-configuration" data-linktype="relative-path">Kestrel endpoint configuration</a> or <a href="../fundamentals/servers/httpsys553c.html?view=aspnetcore-9.0" data-linktype="relative-path">HTTP.sys web server implementation in ASP.NET Core</a>.</p>
<h3 id="deployment-scenarios">Deployment scenarios</h3>
<p>Any firewall between the client and server must also have communication ports open for traffic.</p>
<p>If requests are forwarded in a reverse proxy configuration, use <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/proxy-load-balancer?view=aspnetcore-9.0" data-linktype="relative-path">Forwarded Headers Middleware</a> before calling HTTPS Redirection Middleware. Forwarded Headers Middleware updates the <code>Request.Scheme</code>, using the <code>X-Forwarded-Proto</code> header. The middleware permits redirect URIs and other security policies to work correctly. When Forwarded Headers Middleware isn't used, the backend app might not receive the correct scheme and end up in a redirect loop. A common end user error message is that too many redirects have occurred.</p>
<p>When deploying to Azure App Service, follow the guidance in <a href="https://learn.microsoft.com/en-us/azure/app-service/app-service-web-tutorial-custom-ssl" data-linktype="absolute-path">Tutorial: Bind an existing custom SSL certificate to Azure Web Apps</a>.</p>
<h3 id="options">Options</h3>
<p>The following highlighted code calls <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.httpsredirectionservicesextensions.addhttpsredirection" class="no-loc" data-linktype="absolute-path">AddHttpsRedirection</a> to configure middleware options:</p>
<pre><code class="lang-csharp" highlight-lines="16-20">using static Microsoft.AspNetCore.Http.StatusCodes;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddRazorPages();

builder.Services.AddHsts(options =&gt;
{
    options.Preload = true;
    options.IncludeSubDomains = true;
    options.MaxAge = TimeSpan.FromDays(60);
    options.ExcludedHosts.Add("example.com");
    options.ExcludedHosts.Add("www.example.com");
});

builder.Services.AddHttpsRedirection(options =&gt;
{
    options.RedirectStatusCode = Status307TemporaryRedirect;
    options.HttpsPort = 5001;
});

var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();

app.MapRazorPages();

app.Run();
</code></pre>
<p>Calling <code>AddHttpsRedirection</code> is only necessary to change the values of <code>HttpsPort</code> or <code>RedirectStatusCode</code>.</p>
<p>The preceding highlighted code:</p>
<ul>
<li>Sets <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.httpspolicy.httpsredirectionoptions.redirectstatuscode" class="no-loc" data-linktype="absolute-path">HttpsRedirectionOptions.RedirectStatusCode</a> to <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.statuscodes.status307temporaryredirect#microsoft-aspnetcore-http-statuscodes-status307temporaryredirect" class="no-loc" data-linktype="absolute-path">Status307TemporaryRedirect</a>, which is the default value. Use the fields of the <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.statuscodes" class="no-loc" data-linktype="absolute-path">StatusCodes</a> class for assignments to <code>RedirectStatusCode</code>.</li>
<li>Sets the HTTPS port to 5001.</li>
</ul>
<h4 id="configure-permanent-redirects-in-production">Configure permanent redirects in production</h4>
<p>The middleware defaults to sending a <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.statuscodes.status307temporaryredirect#microsoft-aspnetcore-http-statuscodes-status307temporaryredirect" class="no-loc" data-linktype="absolute-path">Status307TemporaryRedirect</a> with all redirects. If you prefer to send a permanent redirect status code when the app is in a non-Development environment, wrap the middleware options configuration in a conditional check for a non-Development environment.</p>
<p>When configuring services in <code>Program.cs</code>:</p>
<pre><code class="lang-csharp" highlight-lines="7-14">using static Microsoft.AspNetCore.Http.StatusCodes;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddRazorPages();

if (!builder.Environment.IsDevelopment())
{
    builder.Services.AddHttpsRedirection(options =&gt;
    {
        options.RedirectStatusCode = Status308PermanentRedirect;
        options.HttpsPort = 443;
    });
}

var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");

    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();

app.MapRazorPages();

app.Run();
</code></pre><h2 id="https-redirection-middleware-alternative-approach">HTTPS Redirection Middleware alternative approach</h2>
<p>An alternative to using HTTPS Redirection Middleware (<code>UseHttpsRedirection</code>) is to use URL Rewriting Middleware (<code>AddRedirectToHttps</code>). <code>AddRedirectToHttps</code> can also set the status code and port when the redirect is executed. For more information, see <a href="../fundamentals/url-rewriting553c.html?view=aspnetcore-9.0" data-linktype="relative-path">URL Rewriting Middleware</a>.</p>
<p>When redirecting to HTTPS without the requirement for additional redirect rules, we recommend using HTTPS Redirection Middleware (<code>UseHttpsRedirection</code>) described in this article.</p>
<p><a name="hsts"></a></p>
<h2 id="http-strict-transport-security-protocol-hsts">HTTP Strict Transport Security Protocol (HSTS)</h2>
<p>Per <a href="https://www.owasp.org/index.php/About_The_Open_Web_Application_Security_Project" data-linktype="external">OWASP</a>, <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Strict_Transport_Security_Cheat_Sheet.html" data-linktype="external">HTTP Strict Transport Security (HSTS)</a> is an opt-in security enhancement that's specified by a web app through the use of a response header. When a <a href="https://cheatsheetseries.owasp.org/cheatsheets/Transport_Layer_Protection_Cheat_Sheet.html#browser-support" data-linktype="external">browser that supports HSTS</a> receives this header:</p>
<ul>
<li>The browser stores configuration for the domain that prevents sending any communication over HTTP. The browser forces all communication over HTTPS.</li>
<li>The browser prevents the user from using untrusted or invalid certificates. The browser disables prompts that allow a user to temporarily trust such a certificate.</li>
</ul>
<p>Because <a href="https://developer.mozilla.org/docs/Web/HTTP/Headers/Strict-Transport-Security" data-linktype="external">HSTS</a> is enforced by the client, it has some limitations:</p>
<ul>
<li>The client must support HSTS.</li>
<li>HSTS requires at least one successful HTTPS request to establish the HSTS policy.</li>
<li>The application must check every HTTP request and redirect or reject the HTTP request.</li>
</ul>
<p>ASP.NET Core implements HSTS with the <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.hstsbuilderextensions.usehsts" class="no-loc" data-linktype="absolute-path">UseHsts</a> extension method. The following code calls <code>UseHsts</code> when the app isn't in <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-9.0" data-linktype="relative-path">development mode</a>:</p>
<pre><code class="lang-csharp" highlight-lines="10">var builder = WebApplication.CreateBuilder(args);

builder.Services.AddRazorPages();

var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();

app.MapRazorPages();

app.Run();
</code></pre>
<p><code>UseHsts</code> isn't recommended in development because the HSTS settings are highly cacheable by browsers. By default, <code>UseHsts</code> excludes the local loopback address.</p>
<p>For production environments that are implementing HTTPS for the first time, set the initial <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.httpspolicy.hstsoptions.maxage" class="no-loc" data-linktype="absolute-path">HstsOptions.MaxAge</a> to a small value using one of the <a href="https://learn.microsoft.com/en-us/dotnet/api/system.timespan" class="no-loc" data-linktype="absolute-path">TimeSpan</a> methods. Set the value from hours to no more than a single day in case you need to revert the HTTPS infrastructure to HTTP. After you're confident in the sustainability of the HTTPS configuration, increase the HSTS <code>max-age</code> value; a commonly used value is one year.</p>
<p>The following highlighted code:</p>
<pre><code class="lang-csharp" highlight-lines="7-14">using static Microsoft.AspNetCore.Http.StatusCodes;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddRazorPages();

builder.Services.AddHsts(options =&gt;
{
    options.Preload = true;
    options.IncludeSubDomains = true;
    options.MaxAge = TimeSpan.FromDays(60);
    options.ExcludedHosts.Add("example.com");
    options.ExcludedHosts.Add("www.example.com");
});

builder.Services.AddHttpsRedirection(options =&gt;
{
    options.RedirectStatusCode = Status307TemporaryRedirect;
    options.HttpsPort = 5001;
});

var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();

app.MapRazorPages();

app.Run();
</code></pre>
<ul>
<li>Sets the preload parameter of the <code>Strict-Transport-Security</code> header. Preload isn't part of the <a href="https://tools.ietf.org/html/rfc6797" data-linktype="external">RFC HSTS specification</a>, but is supported by web browsers to preload HSTS sites on fresh install. For more information, see <a href="https://hstspreload.org/" data-linktype="external">https://hstspreload.org/</a>.</li>
<li>Enables <a href="https://tools.ietf.org/html/rfc6797#section-6.1.2" data-linktype="external">includeSubDomain</a>, which applies the HSTS policy to Host subdomains.</li>
<li>Explicitly sets the <code>max-age</code> parameter of the <code>Strict-Transport-Security</code> header to 60 days. If not set, defaults to 30 days. For more information, see the <a href="https://tools.ietf.org/html/rfc6797#section-6.1.1" data-linktype="external">max-age directive</a>.</li>
<li>Adds <code>example.com</code> to the list of hosts to exclude.</li>
</ul>
<p><code>UseHsts</code> excludes the following loopback hosts:</p>
<ul>
<li><code>localhost</code> : The IPv4 loopback address.</li>
<li><code>127.0.0.1</code> : The IPv4 loopback address.</li>
<li><code>[::1]</code> : The IPv6 loopback address.</li>
</ul>
<h2 id="opt-out-of-httpshsts-on-project-creation">Opt-out of HTTPS/HSTS on project creation</h2>
<p>In some backend service scenarios where connection security is handled at the public-facing edge of the network, configuring connection security at each node isn't required. Web apps that are generated from the templates in Visual Studio or from the <a href="https://learn.microsoft.com/en-us/dotnet/core/tools/dotnet-new" data-linktype="absolute-path">dotnet new</a> command enable <a href="#require-https" data-linktype="self-bookmark">HTTPS redirection</a> and <a href="#http-strict-transport-security-protocol-hsts" data-linktype="self-bookmark">HSTS</a>. For deployments that don't require these scenarios, you can opt-out of HTTPS/HSTS when the app is created from the template.</p>
<p>To opt-out of HTTPS/HSTS:</p>
<div class="tabGroup" id="tabgroup_1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_1_visual-studio" role="tab" aria-controls="tabpanel_1_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true" data-linktype="self-bookmark">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_1_net-cli" role="tab" aria-controls="tabpanel_1_net-cli" data-tab="net-cli" tabindex="-1" data-linktype="self-bookmark">.NET CLI</a>
</li>
</ul>
<section id="tabpanel_1_visual-studio" role="tabpanel" data-tab="visual-studio">

<p>Uncheck the <strong>Configure for HTTPS</strong> checkbox.</p>
<p><img src="https://learn.microsoft.com/en-us/aspnet/core/security/enforcing-ssl/_static/out-vs2019.png?view=aspnetcore-9.0" alt="New ASP.NET Core Web Application dialog showing the Configure for HTTPS checkbox unselected." data-linktype="relative-path"></p>
</section>
<section id="tabpanel_1_net-cli" role="tabpanel" data-tab="net-cli" aria-hidden="true" hidden="hidden">

<p>Use the <code>--no-https</code> option. For example</p>
<pre><code class="lang-dotnetcli">dotnet new webapp --no-https
</code></pre>
</section>
</div>

<p><a name="trust"></a></p>
<h2 id="trust-the-aspnet-core-https-development-certificate-on-windows-and-macos">Trust the ASP.NET Core HTTPS development certificate on Windows and macOS</h2>
<p>For the Firefox browser, see the next section.</p>
<p>The .NET Core SDK includes an HTTPS development certificate. The certificate is installed as part of the first-run experience. For example, <code>dotnet --info</code> produces a variation of the following output:</p>
<pre><code class="lang-cli">ASP.NET Core
------------
Successfully installed the ASP.NET Core HTTPS Development Certificate.
To trust the certificate run 'dotnet dev-certs https --trust' (Windows and macOS only).
For establishing trust on other platforms refer to the platform specific documentation.
For more information on configuring HTTPS see https://go.microsoft.com/fwlink/?linkid=848054.
</code></pre>
<p>Installing the .NET Core SDK installs the ASP.NET Core HTTPS development certificate to the local user certificate store. The certificate has been installed, but it's not trusted. To trust the certificate, perform the one-time step to run the <code>dotnet dev-certs</code> tool:</p>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --trust
</code></pre>
<p>The following command provides help on the <code>dotnet dev-certs</code> tool:</p>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --help
</code></pre>
<div class="WARNING">
<p>Warning</p>
<p>Do not create a development certificate in an environment that will be redistributed, such as a container image or virtual machine. Doing so can lead to spoofing and elevation of privilege. To help prevent this, set the <code>DOTNET_GENERATE_ASPNET_CERTIFICATE</code> environment variable to <code>false</code> prior to calling the .NET CLI for the first time. This will skip the automatic generation of the ASP.NET Core development certificate during the CLI's first-run experience.</p>
</div>
<p><a name="trust-ff"></a></p>
<h3 id="trust-the-https-certificate-with-firefox-to-prevent-sec_error_inadequate_key_usage-error">Trust the HTTPS certificate with Firefox to prevent SEC_ERROR_INADEQUATE_KEY_USAGE error</h3>
<p>The Firefox browser uses its own certificate store, and therefore doesn't trust the <a href="https://learn.microsoft.com/en-us/iis/extensions/introduction-to-iis-express/iis-express-overview" data-linktype="absolute-path">IIS Express</a> or <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Kestrel</a> developer certificates.</p>
<p>There are two approaches to trusting the HTTPS certificate with Firefox, create a policy file or configure with the FireFox browser. Configuring with the browser creates the policy file, so the two approaches are equivalent.</p>
<h4 id="create-a-policy-file-to-trust-https-certificate-with-firefox">Create a policy file to trust HTTPS certificate with Firefox</h4>
<p>Create a policy file (<code>policies.json</code>) at:</p>
<ul>
<li>Windows: <code>%PROGRAMFILES%\Mozilla Firefox\distribution\</code></li>
<li>MacOS: <code>Firefox.app/Contents/Resources/distribution</code></li>
<li>Linux: See <a href="#trust-ff-linux" data-linktype="self-bookmark">Trust the certificate with Firefox on Linux</a> in this article.</li>
</ul>
<p>Add the following JSON to the Firefox policy file:</p>
<pre><code class="lang-json">{
  "policies": {
    "Certificates": {
      "ImportEnterpriseRoots": true
    }
  }
}
</code></pre>
<p>The preceding policy file makes Firefox trust certificates from the trusted certificates in the Windows certificate store. The next section provides an alternative approach to create the preceding policy file by using the Firefox browser.</p>
<p><a name="trust-ff-ba"></a></p>
<h3 id="configure-trust-of-https-certificate-using-firefox-browser">Configure trust of HTTPS certificate using Firefox browser</h3>
<p>Set  <code>security.enterprise_roots.enabled</code> = <code>true</code> using the following instructions:</p>
<ol>
<li>Enter <code>about:config</code> in the FireFox browser.</li>
<li>Select <strong>Accept the Risk and Continue</strong> if you accept the risk.</li>
<li>Select <strong>Show All</strong></li>
<li>Set <code>security.enterprise_roots.enabled</code> = <code>true</code></li>
<li>Exit and restart Firefox</li>
</ol>
<p>For more information, see <a href="https://support.mozilla.org/kb/setting-certificate-authorities-firefox" data-linktype="external">Setting Up Certificate Authorities (CAs) in Firefox</a> and the <a href="https://github.com/mozilla/policy-templates/blob/master/README.md" data-linktype="external">mozilla/policy-templates/README file</a>.</p>
<h2 id="how-to-set-up-a-developer-certificate-for-docker">How to set up a developer certificate for Docker</h2>
<p>See <a href="https://github.com/dotnet/AspNetCore.Docs/issues/6199" data-linktype="external">this GitHub issue</a>.</p>
<h2 id="trust-https-certificate-on-linux">Trust HTTPS certificate on Linux</h2>
<p>Establishing trust is distribution and browser specific. The following sections provide instructions for some popular distributions and the Chromium browsers (Edge and Chrome) and for Firefox.</p>
<!-- Uncomment when linus-dev-certs supports .NET 7>
### Trust HTTPS certificate on Linux with linux-dev-certs

[linux-dev-certs](https://github.com/tmds/linux-dev-certs) is an open-source, community-supported, .NET global tool that provides a convenient way to create and trust a developer certificate on Linux. The tool is not maintained or supported by Microsoft.

The following commands install the tool and create a trusted developer certificate:

```cli
dotnet tool update -g linux-dev-certs
dotnet linux-dev-certs install
```

For more information or to report issues, see the [linux-dev-certs GitHub repository](https://github.com/tmds/linux-dev-certs).
-->
<h3 id="ubuntu-trust-the-certificate-for-service-to-service-communication">Ubuntu trust the certificate for service-to-service communication</h3>
<p>The following instructions don't work for some Ubuntu versions, such as 20.04. For more information, see GitHub issue <a href="https://github.com/dotnet/AspNetCore.Docs/issues/23686" data-linktype="external">dotnet/AspNetCore.Docs #23686</a>.</p>
<ol>
<li><p>Install <a href="https://www.openssl.org/" data-linktype="external">OpenSSL</a> 1.1.1h or later. See your distribution for instructions on how to update OpenSSL.</p>
</li>
<li><p>Run the following commands:</p>
<pre><code class="lang-cli">dotnet dev-certs https
sudo -E dotnet dev-certs https -ep /usr/local/share/ca-certificates/aspnet/https.crt --format PEM
sudo update-ca-certificates
</code></pre>
</li>
</ol>
<p>The preceding commands:</p>
<ul>
<li>Ensure the current user's developer certificate is created.</li>
<li>Exports the certificate with elevated permissions needed for the <code>ca-certificates</code> folder, using the current user's environment.</li>
<li>Removing the <code>-E</code>  flag exports the root user certificate, generating it if necessary. Each newly generated certificate has a different thumbprint. When running as root, <code>sudo</code>  and  <code>-E</code> are not needed.</li>
</ul>
<p>The path in the preceding command is specific for Ubuntu. For other distributions, select an appropriate path or use the path for the Certificate Authorities (CAs).</p>
<p><a name="ssl-linux"></a></p>
<h3 id="trust-https-certificate-on-linux-using-edge-or-chrome">Trust HTTPS certificate on Linux using Edge or Chrome</h3>
<div class="tabGroup" id="tabgroup_2">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_2_linux-ubuntu" role="tab" aria-controls="tabpanel_2_linux-ubuntu" data-tab="linux-ubuntu" tabindex="0" aria-selected="true" data-linktype="self-bookmark">Ubuntu</a>
</li>
<li role="presentation">
<a href="#tabpanel_2_linux-rhel" role="tab" aria-controls="tabpanel_2_linux-rhel" data-tab="linux-rhel" tabindex="-1" data-linktype="self-bookmark">Red Hat Enterprise Linux</a>
</li>
<li role="presentation">
<a href="#tabpanel_2_linux-sles" role="tab" aria-controls="tabpanel_2_linux-sles" data-tab="linux-sles" tabindex="-1" data-linktype="self-bookmark">SUSE Linux Enterprise Server</a>
</li>
</ul>
<section id="tabpanel_2_linux-ubuntu" role="tabpanel" data-tab="linux-ubuntu">

<p>For chromium browsers on Linux:</p>
<ul>
<li><p>Install the <code>libnss3-tools</code> for your distribution.</p>
</li>
<li><p>Create or verify the <code>$HOME/.pki/nssdb</code> folder exists on the machine.</p>
</li>
<li><p>Export the certificate with the following command:</p>
<pre><code class="lang-cli">dotnet dev-certs https
sudo -E dotnet dev-certs https -ep /usr/local/share/ca-certificates/aspnet/https.crt --format PEM
</code></pre>
<p>The path in the preceding command is specific for Ubuntu. For other distributions, select an appropriate path or use the path for the Certificate Authorities (CAs).</p>
</li>
<li><p>Run the following commands:</p>
<pre><code class="lang-cli">certutil -d sql:$HOME/.pki/nssdb -A -t "P,," -n localhost -i /usr/local/share/ca-certificates/aspnet/https.crt
</code></pre>
</li>
<li><p>Exit and restart the browser.</p>
</li>
</ul>
<p><a name="trust-ff-linux"></a></p>
<h4 id="trust-the-certificate-with-firefox-on-linux">Trust the certificate with Firefox on Linux</h4>
<ul>
<li><p>Export the certificate with the following command:</p>
<pre><code class="lang-vstscli">dotnet dev-certs https
sudo -E dotnet dev-certs https -ep /usr/local/share/ca-certificates/aspnet/https.crt --format PEM
</code></pre>
<p>The path in the preceding command is specific for Ubuntu. For other distributions, select an appropriate path or use the path for the Certificate Authorities (CAs).</p>
</li>
<li><p>Create a JSON file at <code>/usr/lib/firefox/distribution/policies.json</code> with the following command:</p>
</li>
</ul>
<pre><code class="lang-sh">cat &lt;&lt;EOF | sudo tee /usr/lib/firefox/distribution/policies.json
{
    "policies": {
        "Certificates": {
            "Install": [
                "/usr/local/share/ca-certificates/aspnet/https.crt"
            ]
        }
    }
}
EOF
</code></pre>
<p>Note: Ubuntu 21.10 Firefox comes as a snap package and the installation folder is <code>/snap/firefox/current/usr/lib/firefox</code>.</p>
<p>See <a href="#trust-ff-ba" data-linktype="self-bookmark">Configure trust of HTTPS certificate using Firefox browser</a> in this article for an alternative way to configure the policy file using the browser.</p>
</section>
<section id="tabpanel_2_linux-rhel" role="tabpanel" data-tab="linux-rhel" aria-hidden="true" hidden="hidden">

<div class="WARNING">
<p>Warning</p>
<p>The following instructions are intended for development purposes only. Do not use the certificates generated in these instructions for a production environment.</p>
</div>
<p>These instructions use Mozilla's <em>legacy</em> tool <code>certutil</code> at  <code>https://firefox-source-docs.mozilla.org/security/nss/legacy/tools/nss_tools_certutil/index.html</code>. Instructions may be updated as modern utilities and practices are discovered.</p>
<div class="CAUTION">
<p>Caution</p>
<p>Improper use of TLS certificates could lead to spoofing.</p>
</div>
<div class="TIP">
<p>Tip</p>
<p>Instructions for valid production certificates can be found in the RHEL Documentation.
<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/securing_networks/index#creating-and-managing-tls-keys-and-certificates_securing-networks" data-linktype="external">RHEL8 TLS Certificates</a>
<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/securing_networks/index#creating-and-managing-tls-keys-and-certificates_securing-networks" data-linktype="external">RHEL9 TLS Certificates</a>
<a href="https://access.redhat.com/documentation/en-us/red_hat_certificate_system/9" data-linktype="external">RHEL9 Certificate System</a></p>
</div>
<h3 id="install-dependencies">Install Dependencies</h3>
<pre><code class="lang-sh">dnf install nss-tools
</code></pre>
<h3 id="export-the-aspnet-core-development-certificate">Export The ASP.NET Core Development Certificate</h3>
<div class="IMPORTANT">
<p>Important</p>
<p>Replace <code>${ProjectDirectory}</code> with your projects directory.
Replace <code>${CertificateName}</code> with a name you'll be able to identify in the future.</p>
</div>
<pre><code class="lang-sh">cd ${ProjectDirectory}
dotnet dev-certs https -ep ${ProjectDirectory}/${CertificateName}.crt --format PEM
</code></pre>
<div class="CAUTION">
<p>Caution</p>
<p>If using git, add your certificate to your <code>${ProjectDirectory}/.gitignore</code> or <code>${ProjectDirectory}/.git/info/exclude</code>.
View the <a href="https://git-scm.com/docs/gitignore" data-linktype="external">git documentation</a> for information about these files.</p>
</div>
<div class="TIP">
<p>Tip</p>
<p>You can move your exported certificate outside of your Git repository and replace the occurrences of <code>${ProjectDirectory}</code>, in the following instructions, with the new location.</p>
</div>
<h3 id="import-the-aspnet-core-development-certificate">Import The ASP.NET Core Development Certificate</h3>
<div class="IMPORTANT">
<p>Important</p>
<p>Replace <code>${UserProfile}</code> with the profile you intend to use.
Do not replace <code>$HOME</code>, it is the environment variable to your user directory.</p>
</div>
<h4 id="chromium-based-browsers">Chromium-based Browsers</h4>
<pre><code class="lang-sh">certutil -d sql:$HOME/.pki/nssdb -A -t "P,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
certutil -d sql:$HOME/.pki/nssdb -A -t "C,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
</code></pre>
<h4 id="mozilla-firefox">Mozilla Firefox</h4>
<pre><code class="lang-sh">certutil -d sql:$HOME/.mozilla/firefox/${UserProfile}/ -A -t "P,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
certutil -d sql:$HOME/.mozilla/firefox/${UserProfile}/ -A -t "C,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
</code></pre>
<h4 id="create-an-alias-to-test-with-curl">Create An Alias To Test With Curl</h4>
<div class="IMPORTANT">
<p>Important</p>
<p>Don't delete the exported certificate if you plan to test with curl.
You'll need to create an alias referencing it in your <code>$SHELL</code>'s profile</p>
</div>
<pre><code class="lang-sh">alias curl="curl --cacert ${ProjectDirectory}/${CertificateName}.crt"
</code></pre>
<h3 id="cleaning-up-the-development-certificates">Cleaning up the Development Certificates</h3>
<pre><code class="lang-sh">certutil -d sql:$HOME/.pki/nssdb -D -n ${CertificateName}
certutil -d sql:$HOME/.mozilla/firefox/${UserProfile}/ -D -n ${CertificateName}
rm ${ProjectDirectory}/${CertificateName}.crt
dotnet dev-certs https --clean
</code></pre>
<div class="NOTE">
<p>Note</p>
<p>Remove the curl alias you created earlier</p>
</div>
</section>
<section id="tabpanel_2_linux-sles" role="tabpanel" data-tab="linux-sles" aria-hidden="true" hidden="hidden">

<p>See <a href="https://github.com/dotnet/AspNetCore.Docs/issues/28292" data-linktype="external">this GitHub issue</a></p>
<!--
> [!WARNING]
> The following instructions are intended for development purposes only. Do not use the certificates generated in these instructions for a production environment.

These instructions use Mozilla's *legacy* tool [certutil](https://firefox-source-docs.mozilla.org/security/nss/legacy/tools/nss_tools_certutil/index.html). Instructions may be updated as modern utilities and practices are discovered.

> [!CAUTION]
> Improper use of TLS certificates could lead to spoofing.

> [!TIP]
> Instructions for valid production certificates can be found in the RHEL Documentation.
> [RHEL8 TLS Certificates](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/securing_networks/index#creating-and-managing-tls-keys-and-certificates_securing-networks)
> [RHEL9 TLS Certificates](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/securing_networks/index#creating-and-managing-tls-keys-and-certificates_securing-networks)
> [RHEL9 Certificate System](https://access.redhat.com/documentation/en-us/red_hat_certificate_system/9)

### Install Dependencies

```sh
dnf install nss-tools
```

### Export The ASP.NET Core Development Certificate

> [!IMPORTANT]
> Replace `${ProjectDirectory}` with your projects directory.
> Replace `${CertificateName}` with a name you'll be able to identify in the future.

```sh
cd ${ProjectDirectory}
dotnet dev-certs https -ep ${ProjectDirectory}/${CertificateName}.crt --format PEM
```

> [!CAUTION]
> If using git, add your certificate to your `${ProjectDirectory}/.gitignore` or `${ProjectDirectory}/.git/info/exclude`.
> View the [git documentation](https://git-scm.com/docs/gitignore) for information about these files.

> [!TIP]
> You can move your exported certificate outside of your Git repository and replace the occurrences of `${ProjectDirectory}`, in the following instructions, with the new location.

### Import The ASP.NET Core Development Certificate

> [!IMPORTANT]
> Replace `${UserProfile}` with the profile you intend to use.
> Do not replace `$HOME`, it is the environment variable to your user directory.

#### Chromium-based Browsers

```sh
certutil -d sql:$HOME/.pki/nssdb -A -t "P,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
certutil -d sql:$HOME/.pki/nssdb -A -t "C,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
```

#### Mozilla Firefox

```sh
certutil -d sql:$HOME/.mozilla/firefox/${UserProfile}/ -A -t "P,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
certutil -d sql:$HOME/.mozilla/firefox/${UserProfile}/ -A -t "C,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
```

#### Create An Alias To Test With Curl

> [!IMPORTANT]
>
> Don't delete the exported certificate if you plan to test with curl.
> You'll need to create an alias referencing it in your `$SHELL`'s profile

```sh
alias curl="curl --cacert ${ProjectDirectory}/${CertificateName}.crt"
```

### Cleaning up the Development Certificates

```sh
certutil -d sql:$HOME/.pki/nssdb -D -n ${CertificateName}
certutil -d sql:$HOME/.mozilla/firefox/${UserProfile}/ -D -n ${CertificateName}
rm ${ProjectDirectory}/${CertificateName}.crt
dotnet dev-certs https --clean
```

>[!NOTE]
> Remove the curl alias you created earlier
-->
</section>
</div>

<p><a name="wsl"></a></p>
<h3 id="trust-the-certificate-with-fedora-34">Trust the certificate with Fedora 34</h3>
<p>See:</p>
<ul>
<li><a href="https://github.com/dotnet/aspnetcore/issues/32361#issuecomment-837111639" data-linktype="external">This GitHub comment</a></li>
<li><a href="https://docs.fedoraproject.org/en-US/quick-docs/using-shared-system-certificates/" data-linktype="external">Fedora: Using Shared System Certificates</a></li>
<li><a href="https://fedoramagazine.org/set-up-a-net-development-environment/" data-linktype="external">Set up a .NET development environment</a> on Fedora.</li>
</ul>
<h3 id="trust-the-certificate-with-other-distros">Trust the certificate with other distros</h3>
<p>See <a href="https://github.com/dotnet/aspnetcore/issues/32842" data-linktype="external">this GitHub issue</a>.</p>
<h2 id="trust-https-certificate-from-windows-subsystem-for-linux">Trust HTTPS certificate from Windows Subsystem for Linux</h2>
<p>The following instructions don't work for some Linux distributions, such as Ubuntu 20.04. For more information, see GitHub issue <a href="https://github.com/dotnet/AspNetCore.Docs/issues/23686" data-linktype="external">dotnet/AspNetCore.Docs #23686</a>.</p>
<p>The <a href="https://learn.microsoft.com/en-us/windows/wsl/about" data-linktype="absolute-path">Windows Subsystem for Linux (WSL)</a> generates an HTTPS self-signed development certificate, which by default isn't trusted in Windows. The easiest way to have Windows trust the WSL certificate, is to configure WSL to use the same certificate as Windows:</p>
<ul>
<li><p>On <em><strong>Windows</strong></em>, export the developer certificate to a file:</p>
<pre><code>dotnet dev-certs https -ep https.pfx -p $CREDENTIAL_PLACEHOLDER$ --trust
</code></pre>
<p>Where <code>$CREDENTIAL_PLACEHOLDER$</code> is a password.</p>
</li>
<li><p>In a WSL window, import the exported certificate on the WSL instance:</p>
<pre><code>dotnet dev-certs https --clean --import &lt;&lt;path-to-pfx&gt;&gt; --password $CREDENTIAL_PLACEHOLDER$
</code></pre>
</li>
</ul>
<p>The preceding approach is a one time operation per certificate and per WSL distribution. It's easier than exporting the certificate over and over. If you update or regenerate the certificate on windows, you might need to run the preceding commands again.</p>
<p><a name="tcp"></a></p>
<h2 id="troubleshoot-certificate-problems-such-as-certificate-not-trusted">Troubleshoot certificate problems such as certificate not trusted</h2>
<p>This section provides help when the ASP.NET Core HTTPS development certificate has been <a href="#trust" data-linktype="self-bookmark">installed and trusted</a>, but you still have browser warnings that the certificate is not trusted. The ASP.NET Core HTTPS development certificate is used by <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Kestrel</a>.</p>
<p>To repair the IIS Express certificate, see <a href="https://stackoverflow.com/a/20048613/502537" data-linktype="external">this Stackoverflow</a> issue.</p>
<h3 id="all-platforms---certificate-not-trusted">All platforms - certificate not trusted</h3>
<p>Run the following commands:</p>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --clean
dotnet dev-certs https --trust
</code></pre>
<p>Close any browser instances open. Open a new browser window to app. Certificate trust is cached by browsers.</p>
<h3 id="dotnet-dev-certs-https---clean-fails">dotnet dev-certs https --clean Fails</h3>
<p>The preceding commands solve most browser trust issues. If the browser is still not trusting the certificate, follow the platform-specific suggestions that follow.</p>
<h3 id="docker---certificate-not-trusted">Docker - certificate not trusted</h3>
<ul>
<li>Delete the <em>C:\Users{USER}\AppData\Roaming\ASP.NET\Https</em> folder.</li>
<li>Clean the solution. Delete the <em>bin</em> and <em>obj</em> folders.</li>
<li>Restart the development tool. For example, Visual Studio or Visual Studio Code.</li>
</ul>
<h3 id="windows---certificate-not-trusted">Windows - certificate not trusted</h3>
<ul>
<li>Check the certificates in the certificate store. There should be a <code>localhost</code> certificate with the <code>ASP.NET Core HTTPS development certificate</code> friendly name both under <code>Current User &gt; Personal &gt; Certificates</code> and <code>Current User &gt; Trusted root certification authorities &gt; Certificates</code></li>
<li>Remove all the found certificates from both Personal and Trusted root certification authorities. Do <strong>not</strong> remove the IIS Express localhost certificate.</li>
<li>Run the following commands:</li>
</ul>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --clean
dotnet dev-certs https --trust
</code></pre>
<p>Close any browser instances open. Open a new browser window to app.</p>
<h3 id="os-x---certificate-not-trusted">OS X - certificate not trusted</h3>
<ul>
<li>Open KeyChain Access.</li>
<li>Select the System keychain.</li>
<li>Check for the presence of a localhost certificate.</li>
<li>Check that it contains a <code>+</code> symbol on the icon to indicate it's trusted for all users.</li>
<li>Remove the certificate from the system keychain.</li>
<li>Run the following commands:</li>
</ul>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --clean
dotnet dev-certs https --trust
</code></pre>
<p>Close any browser instances open. Open a new browser window to app.</p>
<p>See <a href="https://github.com/dotnet/AspNetCore/issues/16892" data-linktype="external">HTTPS Error using IIS Express (dotnet/AspNetCore #16892)</a> for troubleshooting certificate issues with Visual Studio.</p>
<h3 id="linux-certificate-not-trusted">Linux certificate not trusted</h3>
<p>Check that the certificate being configured for trust is the user HTTPS developer certificate that will be used by the Kestrel server.</p>
<p>Check the current user default HTTPS developer Kestrel certificate at the following location:</p>
<pre><code>ls -la ~/.dotnet/corefx/cryptography/x509stores/my
</code></pre>
<p>The HTTPS developer Kestrel certificate file is the SHA1 thumbprint. When the file is deleted via <code>dotnet dev-certs https --clean</code>, it's regenerated when needed with a different thumbprint.
Check the thumbprint of the exported certificate matches with the following command:</p>
<pre><code>openssl x509 -noout -fingerprint -sha1 -inform pem -in /usr/local/share/ca-certificates/aspnet/https.crt
</code></pre>
<p>If the certificate doesn't match, it could be one of the following:</p>
<ul>
<li>An old certificate.</li>
<li>An exported a developer certificate for the root user. For this case, export the  certificate.</li>
</ul>
<p>The root user certificate can be checked at:</p>
<pre><code>ls -la /root/.dotnet/corefx/cryptography/x509stores/my
</code></pre>
<h3 id="iis-express-ssl-certificate-used-with-visual-studio">IIS Express SSL certificate used with Visual Studio</h3>
<p>To fix problems with the IIS Express certificate, select <strong>Repair</strong> from the Visual Studio installer. For more information, see <a href="https://github.com/dotnet/aspnetcore/issues/16892" data-linktype="external">this GitHub issue</a>.</p>
<h3 id="group-policy-prevents-self-signed-certificates-from-being-trusted">Group policy prevents self-signed certificates from being trusted</h3>
<p>In some cases, group policy may prevent self-signed certificates from being trusted. For more information, see <a href="https://github.com/dotnet/aspnetcore/issues/21173" data-linktype="external">this GitHub issue</a>.</p>
<h2 id="additional-information">Additional information</h2>
<ul>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/proxy-load-balancer?view=aspnetcore-9.0" data-linktype="relative-path">Configure ASP.NET Core to work with proxy servers and load balancers</a></li>
<li><a href="../host-and-deploy/linux-nginx553c.html?view=aspnetcore-9.0#https-configuration" data-linktype="relative-path">Host ASP.NET Core on Linux with Nginx: HTTPS configuration</a></li>
<li><a href="https://learn.microsoft.com/en-us/iis/manage/configuring-security/how-to-set-up-ssl-on-iis" data-linktype="absolute-path">How to Set Up SSL on IIS</a></li>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/servers/kestrel/endpoints?view=aspnetcore-9.0" data-linktype="relative-path">Configure endpoints for the ASP.NET Core Kestrel web server</a></li>
<li><a href="https://www.owasp.org/index.php/HTTP_Strict_Transport_Security_Cheat_Sheet#Browser_Support" data-linktype="external">OWASP HSTS browser support</a></li>
</ul>
</div>
<div data-moniker="aspnetcore-8.0">
<div class="NOTE">
<p>Note</p>
<p>If you're using .NET 9 or later SDK, see the updated Linux procedures in the <a href="https://learn.microsoft.com/en-us/aspnet/core/security/enforcing-ssl?view=aspnetcore-9.0&amp;preserve-view=true" data-linktype="relative-path">.NET 9 version of this article</a>.</p>
</div>
<div class="WARNING">
<p>Warning</p>
<h2 id="api-projects">API projects</h2>
<p>Do <strong>not</strong> use <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.mvc.requirehttpsattribute" class="no-loc" data-linktype="absolute-path">RequireHttpsAttribute</a> on Web APIs that receive sensitive information. <code>RequireHttpsAttribute</code> uses HTTP status codes to redirect browsers from HTTP to HTTPS. API clients may not understand or obey redirects from HTTP to HTTPS. Such clients may send information over HTTP. Web APIs should either:</p>
<ul>
<li>Not listen on HTTP.</li>
<li>Close the connection with status code 400 (Bad Request) and not serve the request.</li>
</ul>
<p>To disable HTTP redirection in an API, set the <code>ASPNETCORE_URLS</code> environment variable or use the <code>--urls</code> command line flag. For more information, see <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-9.0" data-linktype="relative-path">Use multiple environments in ASP.NET Core</a> and <a href="https://andrewlock.net/8-ways-to-set-the-urls-for-an-aspnetcore-app/" data-linktype="external">8 ways to set the URLs for an ASP.NET Core app</a> by Andrew Lock.</p>
<h2 id="hsts-and-api-projects">HSTS and API projects</h2>
<p>The default API projects don't include <a href="#hsts" data-linktype="self-bookmark">HSTS</a> because <a href="https://developer.mozilla.org/docs/Web/HTTP/Headers/Strict-Transport-Security" data-linktype="external">HSTS</a> is generally a browser only instruction. Other callers, such as phone or desktop apps, do <strong>not</strong> obey the instruction. Even within browsers, a single authenticated call to an API over HTTP has risks on insecure networks. The secure approach is to configure API projects to only listen to and respond over HTTPS.</p>
</div>
<p><a name="no-http"></a></p>
<h3 id="http-redirection-to-https-causes-err_invalid_redirect-on-the-cors-preflight-request">HTTP redirection to HTTPS causes ERR_INVALID_REDIRECT on the CORS preflight request</h3>
<p>Requests to an endpoint using HTTP that are redirected to HTTPS by <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.httpspolicybuilderextensions.usehttpsredirection" class="no-loc" data-linktype="absolute-path">UseHttpsRedirection</a> fail with <code>ERR_INVALID_REDIRECT</code> on the CORS preflight request.</p>
<p>API projects can reject HTTP requests rather than use <code>UseHttpsRedirection</code> to redirect requests to HTTPS.</p>
<h2 id="require-https">Require HTTPS</h2>
<p>We recommend that production ASP.NET Core web apps use:</p>
<ul>
<li>HTTPS Redirection Middleware (<a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.httpspolicybuilderextensions.usehttpsredirection" class="no-loc" data-linktype="absolute-path">UseHttpsRedirection</a>) to redirect HTTP requests to HTTPS.</li>
<li>HSTS Middleware (<a href="#http-strict-transport-security-protocol-hsts" data-linktype="self-bookmark">UseHsts</a>) to send HTTP Strict Transport Security Protocol (HSTS) headers to clients.</li>
</ul>
<div class="NOTE">
<p>Note</p>
<p>Apps deployed in a reverse proxy configuration allow the proxy to handle connection security (HTTPS). If the proxy also handles HTTPS redirection, there's no need to use HTTPS Redirection Middleware. If the proxy server also handles writing HSTS headers (for example, <a href="https://learn.microsoft.com/en-us/iis/get-started/whats-new-in-iis-10-version-1709/iis-10-version-1709-hsts#iis-100-version-1709-native-hsts-support" data-linktype="absolute-path">native HSTS support in IIS 10.0 (1709) or later</a>), HSTS Middleware isn't required by the app. For more information, see <a href="#opt-out-of-httpshsts-on-project-creation" data-linktype="self-bookmark">Opt-out of HTTPS/HSTS on project creation</a>.</p>
</div>
<h3 id="usehttpsredirection">UseHttpsRedirection</h3>
<p>The following code calls <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.httpspolicybuilderextensions.usehttpsredirection" class="no-loc" data-linktype="absolute-path">UseHttpsRedirection</a> in the <code>Program.cs</code> file:</p>
<pre><code class="lang-csharp" highlight-lines="13">var builder = WebApplication.CreateBuilder(args);

builder.Services.AddRazorPages();

var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();

app.MapRazorPages();

app.Run();
</code></pre>
<p>The preceding highlighted code:</p>
<ul>
<li>Uses the default <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.httpspolicy.httpsredirectionoptions.redirectstatuscode#microsoft-aspnetcore-httpspolicy-httpsredirectionoptions-redirectstatuscode" class="no-loc" data-linktype="absolute-path">HttpsRedirectionOptions.RedirectStatusCode</a> (<a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.statuscodes.status307temporaryredirect#microsoft-aspnetcore-http-statuscodes-status307temporaryredirect" class="no-loc" data-linktype="absolute-path">Status307TemporaryRedirect</a>).</li>
<li>Uses the default <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.httpspolicy.httpsredirectionoptions.httpsport#microsoft-aspnetcore-httpspolicy-httpsredirectionoptions-httpsport" class="no-loc" data-linktype="absolute-path">HttpsRedirectionOptions.HttpsPort</a> (null) unless overridden by the <code>ASPNETCORE_HTTPS_PORT</code> environment variable or <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.hosting.server.features.iserveraddressesfeature" class="no-loc" data-linktype="absolute-path">IServerAddressesFeature</a>.</li>
</ul>
<p>We recommend using temporary redirects rather than permanent redirects. Link caching can cause unstable behavior in development environments. If you prefer to send a permanent redirect status code when the app is in a non-Development environment, see the <a href="#configure-permanent-redirects-in-production" data-linktype="self-bookmark">Configure permanent redirects in production</a> section. We recommend using <a href="#http-strict-transport-security-protocol-hsts" data-linktype="self-bookmark">HSTS</a> to signal to clients that only secure resource requests should be sent to the app (only in production).</p>
<h3 id="port-configuration">Port configuration</h3>
<p>A port must be available for the middleware to redirect an insecure request to HTTPS. If no port is available:</p>
<ul>
<li>Redirection to HTTPS doesn't occur.</li>
<li>The middleware logs the warning "Failed to determine the https port for redirect."</li>
</ul>
<p>Specify the HTTPS port using any of the following approaches:</p>
<ul>
<li><p>Set <a href="#options" data-linktype="self-bookmark">HttpsRedirectionOptions.HttpsPort</a>.</p>
</li>
<li><p>Set the <code>https_port</code> <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/host/generic-host?view=aspnetcore-9.0#https_port" data-linktype="relative-path">host setting</a>:</p>
<ul>
<li><p>In host configuration.</p>
</li>
<li><p>By setting the <code>ASPNETCORE_HTTPS_PORT</code> environment variable.</p>
</li>
<li><p>By adding a top-level entry in <code>appsettings.json</code>:</p>
<pre><code class="lang-json" highlight-lines="2">{
  "https_port": 443,
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*"
}
</code></pre></li>
</ul>
</li>
<li><p>Indicate a port with the secure scheme using the <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/host/generic-host?view=aspnetcore-9.0#urls" data-linktype="relative-path">ASPNETCORE_URLS environment variable</a>. The environment variable configures the server. The middleware indirectly discovers the HTTPS port via <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.hosting.server.features.iserveraddressesfeature" class="no-loc" data-linktype="absolute-path">IServerAddressesFeature</a>. This approach doesn't work in reverse proxy deployments.</p>
</li>
<li><p>The ASP.NET Core web templates set an HTTPS URL in <code>Properties/launchsettings.json</code> for both Kestrel and IIS Express. <code>launchsettings.json</code> is only used on the local machine.</p>
</li>
<li><p>Configure an HTTPS URL endpoint for a public-facing edge deployment of <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Kestrel</a> server or <a href="../fundamentals/servers/httpsys553c.html?view=aspnetcore-9.0" data-linktype="relative-path">HTTP.sys</a> server. Only <strong>one HTTPS port</strong> is used by the app. The middleware discovers the port via <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.hosting.server.features.iserveraddressesfeature" class="no-loc" data-linktype="absolute-path">IServerAddressesFeature</a>.</p>
</li>
</ul>
<div class="NOTE">
<p>Note</p>
<p>When an app is run in a reverse proxy configuration, <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.hosting.server.features.iserveraddressesfeature" class="no-loc" data-linktype="absolute-path">IServerAddressesFeature</a> isn't available. Set the port using one of the other approaches described in this section.</p>
</div>
<h3 id="edge-deployments">Edge deployments</h3>
<p>When <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Kestrel</a> or <a href="../fundamentals/servers/httpsys553c.html?view=aspnetcore-9.0" data-linktype="relative-path">HTTP.sys</a> is used as a public-facing edge server, Kestrel or HTTP.sys must be configured to listen on both:</p>
<ul>
<li>The secure port where the client is redirected (typically, 443 in production and 5001 in development).</li>
<li>The insecure port (typically, 80 in production and 5000 in development).</li>
</ul>
<p>The insecure port must be accessible by the client in order for the app to receive an insecure request and redirect the client to the secure port.</p>
<p>For more information, see <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0#endpoint-configuration" data-linktype="relative-path">Kestrel endpoint configuration</a> or <a href="../fundamentals/servers/httpsys553c.html?view=aspnetcore-9.0" data-linktype="relative-path">HTTP.sys web server implementation in ASP.NET Core</a>.</p>
<h3 id="deployment-scenarios">Deployment scenarios</h3>
<p>Any firewall between the client and server must also have communication ports open for traffic.</p>
<p>If requests are forwarded in a reverse proxy configuration, use <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/proxy-load-balancer?view=aspnetcore-9.0" data-linktype="relative-path">Forwarded Headers Middleware</a> before calling HTTPS Redirection Middleware. Forwarded Headers Middleware updates the <code>Request.Scheme</code>, using the <code>X-Forwarded-Proto</code> header. The middleware permits redirect URIs and other security policies to work correctly. When Forwarded Headers Middleware isn't used, the backend app might not receive the correct scheme and end up in a redirect loop. A common end user error message is that too many redirects have occurred.</p>
<p>When deploying to Azure App Service, follow the guidance in <a href="https://learn.microsoft.com/en-us/azure/app-service/app-service-web-tutorial-custom-ssl" data-linktype="absolute-path">Tutorial: Bind an existing custom SSL certificate to Azure Web Apps</a>.</p>
<h3 id="options">Options</h3>
<p>The following highlighted code calls <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.httpsredirectionservicesextensions.addhttpsredirection" class="no-loc" data-linktype="absolute-path">AddHttpsRedirection</a> to configure middleware options:</p>
<pre><code class="lang-csharp" highlight-lines="16-20">using static Microsoft.AspNetCore.Http.StatusCodes;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddRazorPages();

builder.Services.AddHsts(options =&gt;
{
    options.Preload = true;
    options.IncludeSubDomains = true;
    options.MaxAge = TimeSpan.FromDays(60);
    options.ExcludedHosts.Add("example.com");
    options.ExcludedHosts.Add("www.example.com");
});

builder.Services.AddHttpsRedirection(options =&gt;
{
    options.RedirectStatusCode = Status307TemporaryRedirect;
    options.HttpsPort = 5001;
});

var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();

app.MapRazorPages();

app.Run();
</code></pre>
<p>Calling <code>AddHttpsRedirection</code> is only necessary to change the values of <code>HttpsPort</code> or <code>RedirectStatusCode</code>.</p>
<p>The preceding highlighted code:</p>
<ul>
<li>Sets <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.httpspolicy.httpsredirectionoptions.redirectstatuscode" class="no-loc" data-linktype="absolute-path">HttpsRedirectionOptions.RedirectStatusCode</a> to <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.statuscodes.status307temporaryredirect#microsoft-aspnetcore-http-statuscodes-status307temporaryredirect" class="no-loc" data-linktype="absolute-path">Status307TemporaryRedirect</a>, which is the default value. Use the fields of the <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.statuscodes" class="no-loc" data-linktype="absolute-path">StatusCodes</a> class for assignments to <code>RedirectStatusCode</code>.</li>
<li>Sets the HTTPS port to 5001.</li>
</ul>
<h4 id="configure-permanent-redirects-in-production">Configure permanent redirects in production</h4>
<p>The middleware defaults to sending a <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.statuscodes.status307temporaryredirect#microsoft-aspnetcore-http-statuscodes-status307temporaryredirect" class="no-loc" data-linktype="absolute-path">Status307TemporaryRedirect</a> with all redirects. If you prefer to send a permanent redirect status code when the app is in a non-Development environment, wrap the middleware options configuration in a conditional check for a non-Development environment.</p>
<p>When configuring services in <code>Program.cs</code>:</p>
<pre><code class="lang-csharp" highlight-lines="7-14">using static Microsoft.AspNetCore.Http.StatusCodes;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddRazorPages();

if (!builder.Environment.IsDevelopment())
{
    builder.Services.AddHttpsRedirection(options =&gt;
    {
        options.RedirectStatusCode = Status308PermanentRedirect;
        options.HttpsPort = 443;
    });
}

var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");

    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();

app.MapRazorPages();

app.Run();
</code></pre><h2 id="https-redirection-middleware-alternative-approach">HTTPS Redirection Middleware alternative approach</h2>
<p>An alternative to using HTTPS Redirection Middleware (<code>UseHttpsRedirection</code>) is to use URL Rewriting Middleware (<code>AddRedirectToHttps</code>). <code>AddRedirectToHttps</code> can also set the status code and port when the redirect is executed. For more information, see <a href="../fundamentals/url-rewriting553c.html?view=aspnetcore-9.0" data-linktype="relative-path">URL Rewriting Middleware</a>.</p>
<p>When redirecting to HTTPS without the requirement for additional redirect rules, we recommend using HTTPS Redirection Middleware (<code>UseHttpsRedirection</code>) described in this article.</p>
<p><a name="hsts"></a></p>
<h2 id="http-strict-transport-security-protocol-hsts">HTTP Strict Transport Security Protocol (HSTS)</h2>
<p>Per <a href="https://www.owasp.org/index.php/About_The_Open_Web_Application_Security_Project" data-linktype="external">OWASP</a>, <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Strict_Transport_Security_Cheat_Sheet.html" data-linktype="external">HTTP Strict Transport Security (HSTS)</a> is an opt-in security enhancement that's specified by a web app through the use of a response header. When a <a href="https://cheatsheetseries.owasp.org/cheatsheets/Transport_Layer_Protection_Cheat_Sheet.html#browser-support" data-linktype="external">browser that supports HSTS</a> receives this header:</p>
<ul>
<li>The browser stores configuration for the domain that prevents sending any communication over HTTP. The browser forces all communication over HTTPS.</li>
<li>The browser prevents the user from using untrusted or invalid certificates. The browser disables prompts that allow a user to temporarily trust such a certificate.</li>
</ul>
<p>Because <a href="https://developer.mozilla.org/docs/Web/HTTP/Headers/Strict-Transport-Security" data-linktype="external">HSTS</a> is enforced by the client, it has some limitations:</p>
<ul>
<li>The client must support HSTS.</li>
<li>HSTS requires at least one successful HTTPS request to establish the HSTS policy.</li>
<li>The application must check every HTTP request and redirect or reject the HTTP request.</li>
</ul>
<p>ASP.NET Core implements HSTS with the <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.hstsbuilderextensions.usehsts" class="no-loc" data-linktype="absolute-path">UseHsts</a> extension method. The following code calls <code>UseHsts</code> when the app isn't in <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-9.0" data-linktype="relative-path">development mode</a>:</p>
<pre><code class="lang-csharp" highlight-lines="10">var builder = WebApplication.CreateBuilder(args);

builder.Services.AddRazorPages();

var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();

app.MapRazorPages();

app.Run();
</code></pre>
<p><code>UseHsts</code> isn't recommended in development because the HSTS settings are highly cacheable by browsers. By default, <code>UseHsts</code> excludes the local loopback address.</p>
<p>For production environments that are implementing HTTPS for the first time, set the initial <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.httpspolicy.hstsoptions.maxage" class="no-loc" data-linktype="absolute-path">HstsOptions.MaxAge</a> to a small value using one of the <a href="https://learn.microsoft.com/en-us/dotnet/api/system.timespan" class="no-loc" data-linktype="absolute-path">TimeSpan</a> methods. Set the value from hours to no more than a single day in case you need to revert the HTTPS infrastructure to HTTP. After you're confident in the sustainability of the HTTPS configuration, increase the HSTS <code>max-age</code> value; a commonly used value is one year.</p>
<p>The following highlighted code:</p>
<pre><code class="lang-csharp" highlight-lines="7-14">using static Microsoft.AspNetCore.Http.StatusCodes;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddRazorPages();

builder.Services.AddHsts(options =&gt;
{
    options.Preload = true;
    options.IncludeSubDomains = true;
    options.MaxAge = TimeSpan.FromDays(60);
    options.ExcludedHosts.Add("example.com");
    options.ExcludedHosts.Add("www.example.com");
});

builder.Services.AddHttpsRedirection(options =&gt;
{
    options.RedirectStatusCode = Status307TemporaryRedirect;
    options.HttpsPort = 5001;
});

var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();

app.MapRazorPages();

app.Run();
</code></pre>
<ul>
<li>Sets the preload parameter of the <code>Strict-Transport-Security</code> header. Preload isn't part of the <a href="https://tools.ietf.org/html/rfc6797" data-linktype="external">RFC HSTS specification</a>, but is supported by web browsers to preload HSTS sites on fresh install. For more information, see <a href="https://hstspreload.org/" data-linktype="external">https://hstspreload.org/</a>.</li>
<li>Enables <a href="https://tools.ietf.org/html/rfc6797#section-6.1.2" data-linktype="external">includeSubDomain</a>, which applies the HSTS policy to Host subdomains.</li>
<li>Explicitly sets the <code>max-age</code> parameter of the <code>Strict-Transport-Security</code> header to 60 days. If not set, defaults to 30 days. For more information, see the <a href="https://tools.ietf.org/html/rfc6797#section-6.1.1" data-linktype="external">max-age directive</a>.</li>
<li>Adds <code>example.com</code> to the list of hosts to exclude.</li>
</ul>
<p><code>UseHsts</code> excludes the following loopback hosts:</p>
<ul>
<li><code>localhost</code> : The IPv4 loopback address.</li>
<li><code>127.0.0.1</code> : The IPv4 loopback address.</li>
<li><code>[::1]</code> : The IPv6 loopback address.</li>
</ul>
<h2 id="opt-out-of-httpshsts-on-project-creation">Opt-out of HTTPS/HSTS on project creation</h2>
<p>In some backend service scenarios where connection security is handled at the public-facing edge of the network, configuring connection security at each node isn't required. Web apps that are generated from the templates in Visual Studio or from the <a href="https://learn.microsoft.com/en-us/dotnet/core/tools/dotnet-new" data-linktype="absolute-path">dotnet new</a> command enable <a href="#require-https" data-linktype="self-bookmark">HTTPS redirection</a> and <a href="#http-strict-transport-security-protocol-hsts" data-linktype="self-bookmark">HSTS</a>. For deployments that don't require these scenarios, you can opt-out of HTTPS/HSTS when the app is created from the template.</p>
<p>To opt-out of HTTPS/HSTS:</p>
<div class="tabGroup" id="tabgroup_1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_1_visual-studio" role="tab" aria-controls="tabpanel_1_visual-studio" data-tab="visual-studio" tabindex="0" aria-selected="true" data-linktype="self-bookmark">Visual Studio</a>
</li>
<li role="presentation">
<a href="#tabpanel_1_net-cli" role="tab" aria-controls="tabpanel_1_net-cli" data-tab="net-cli" tabindex="-1" data-linktype="self-bookmark">.NET CLI</a>
</li>
</ul>
<section id="tabpanel_1_visual-studio" role="tabpanel" data-tab="visual-studio">

<p>Uncheck the <strong>Configure for HTTPS</strong> checkbox.</p>
<p><img src="https://learn.microsoft.com/en-us/aspnet/core/security/enforcing-ssl/_static/out-vs2019.png?view=aspnetcore-9.0" alt="New ASP.NET Core Web Application dialog showing the Configure for HTTPS checkbox unselected." data-linktype="relative-path"></p>
</section>
<section id="tabpanel_1_net-cli" role="tabpanel" data-tab="net-cli" aria-hidden="true" hidden="hidden">

<p>Use the <code>--no-https</code> option. For example</p>
<pre><code class="lang-dotnetcli">dotnet new webapp --no-https
</code></pre>
</section>
</div>

<p><a name="trust"></a></p>
<h2 id="trust-the-aspnet-core-https-development-certificate-on-windows-and-macos">Trust the ASP.NET Core HTTPS development certificate on Windows and macOS</h2>
<p>For the Firefox browser, see the next section.</p>
<p>The .NET SDK includes an HTTPS development certificate. The certificate is installed as part of the first-run experience. For example, <code>dotnet --info</code> produces a variation of the following output:</p>
<pre><code class="lang-cli">ASP.NET Core
------------
Successfully installed the ASP.NET Core HTTPS Development Certificate.
To trust the certificate run 'dotnet dev-certs https --trust' (Windows and macOS only).
For establishing trust on other platforms refer to the platform specific documentation.
For more information on configuring HTTPS see https://go.microsoft.com/fwlink/?linkid=848054.
</code></pre>
<p>Installing the .NET SDK installs the ASP.NET Core HTTPS development certificate to the local user certificate store. The certificate has been installed, but it's not trusted. To trust the certificate, perform the one-time step to run the <code>dotnet dev-certs</code> tool:</p>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --trust
</code></pre>
<p>The following command provides help on the <code>dotnet dev-certs</code> tool:</p>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --help
</code></pre>
<div class="WARNING">
<p>Warning</p>
<p>Do not create a development certificate in an environment that will be redistributed, such as a container image or virtual machine. Doing so can lead to spoofing and elevation of privilege. To help prevent this, set the <code>DOTNET_GENERATE_ASPNET_CERTIFICATE</code> environment variable to <code>false</code> prior to calling the .NET CLI for the first time. This will skip the automatic generation of the ASP.NET Core development certificate during the CLI's first-run experience.</p>
</div>
<p><a name="trust-ff"></a></p>
<h3 id="trust-the-https-certificate-with-firefox-to-prevent-sec_error_inadequate_key_usage-error">Trust the HTTPS certificate with Firefox to prevent SEC_ERROR_INADEQUATE_KEY_USAGE error</h3>
<p>The Firefox browser uses its own certificate store, and therefore doesn't trust the <a href="https://learn.microsoft.com/en-us/iis/extensions/introduction-to-iis-express/iis-express-overview" data-linktype="absolute-path">IIS Express</a> or <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Kestrel</a> developer certificates.</p>
<p>There are two approaches to trusting the HTTPS certificate with Firefox, create a policy file or configure with the FireFox browser. Configuring with the browser creates the policy file, so the two approaches are equivalent.</p>
<h4 id="create-a-policy-file-to-trust-https-certificate-with-firefox">Create a policy file to trust HTTPS certificate with Firefox</h4>
<p>Create a policy file (<code>policies.json</code>) at:</p>
<ul>
<li>Windows: <code>%PROGRAMFILES%\Mozilla Firefox\distribution\</code></li>
<li>MacOS: <code>Firefox.app/Contents/Resources/distribution</code></li>
<li>Linux: See <a href="https://learn.microsoft.com/en-us/aspnet/core/security/enforcing-ssl?tabs=visual-studio%2Clinux-ubuntu%2Clinux-sles#trust-the-certificate-with-firefox-on-linux" data-linktype="absolute-path">Trust the certificate with Firefox on Linux</a> in this article.</li>
</ul>
<p>Add the following JSON to the Firefox policy file:</p>
<pre><code class="lang-json">{
  "policies": {
    "Certificates": {
      "ImportEnterpriseRoots": true
    }
  }
}
</code></pre>
<p>The preceding policy file makes Firefox trust certificates from the trusted certificates in the Windows certificate store. The next section provides an alternative approach to create the preceding policy file by using the Firefox browser.</p>
<p><a name="trust-ff-ba"></a></p>
<h3 id="configure-trust-of-https-certificate-using-firefox-browser">Configure trust of HTTPS certificate using Firefox browser</h3>
<p>Set  <code>security.enterprise_roots.enabled</code> = <code>true</code> using the following instructions:</p>
<ol>
<li>Enter <code>about:config</code> in the FireFox browser.</li>
<li>Select <strong>Accept the Risk and Continue</strong> if you accept the risk.</li>
<li>Select <strong>Show All</strong></li>
<li>Set <code>security.enterprise_roots.enabled</code> = <code>true</code></li>
<li>Exit and restart Firefox</li>
</ol>
<p>For more information, see <a href="https://support.mozilla.org/kb/setting-certificate-authorities-firefox" data-linktype="external">Setting Up Certificate Authorities (CAs) in Firefox</a> and the <a href="https://github.com/mozilla/policy-templates/blob/master/README.md" data-linktype="external">mozilla/policy-templates/README file</a>.</p>
<h2 id="how-to-set-up-a-developer-certificate-for-docker">How to set up a developer certificate for Docker</h2>
<p>See <a href="https://github.com/dotnet/AspNetCore.Docs/issues/6199" data-linktype="external">this GitHub issue</a>.</p>
<h2 id="trust-https-certificate-on-linux">Trust HTTPS certificate on Linux</h2>
<p>Establishing trust is distribution and browser specific. The following sections provide instructions for some popular distributions and the Chromium browsers (Edge and Chrome) and for Firefox.</p>
<h3 id="trust-https-certificate-on-linux-with-linux-dev-certs">Trust HTTPS certificate on Linux with linux-dev-certs</h3>
<p><a href="https://github.com/tmds/linux-dev-certs" data-linktype="external">linux-dev-certs</a> is an open-source, community-supported, .NET global tool that provides a convenient way to create and trust a developer certificate on Linux. The tool is not maintained or supported by Microsoft.</p>
<p>The following commands install the tool and create a trusted developer certificate:</p>
<pre><code class="lang-cli">dotnet tool update -g linux-dev-certs
dotnet linux-dev-certs install
</code></pre>
<p>For more information or to report issues, see the <a href="https://github.com/tmds/linux-dev-certs" data-linktype="external">linux-dev-certs GitHub repository</a>.</p>
<h3 id="ubuntu-trust-the-certificate-for-service-to-service-communication">Ubuntu trust the certificate for service-to-service communication</h3>
<p>The following instructions don't work for some Ubuntu versions, such as 20.04. For more information, see GitHub issue <a href="https://github.com/dotnet/AspNetCore.Docs/issues/23686" data-linktype="external">dotnet/AspNetCore.Docs #23686</a>.</p>
<ol>
<li><p>Install <a href="https://www.openssl.org/" data-linktype="external">OpenSSL</a> 1.1.1h or later. See your distribution for instructions on how to update OpenSSL.</p>
</li>
<li><p>Run the following commands:</p>
<pre><code class="lang-cli">dotnet dev-certs https
sudo -E dotnet dev-certs https -ep /usr/local/share/ca-certificates/aspnet/https.crt --format PEM
sudo update-ca-certificates
</code></pre>
</li>
</ol>
<p>The preceding commands:</p>
<ul>
<li>Ensure the current user's developer certificate is created.</li>
<li>Exports the certificate with elevated permissions needed for the <code>ca-certificates</code> folder, using the current user's environment.</li>
<li>Removing the <code>-E</code>  flag exports the root user certificate, generating it if necessary. Each newly generated certificate has a different thumbprint. When running as root, <code>sudo</code>  and  <code>-E</code> are not needed.</li>
</ul>
<p>The path in the preceding command is specific for Ubuntu. For other distributions, select an appropriate path or use the path for the Certificate Authorities (CAs).</p>
<p><a name="ssl-linux"></a></p>
<h3 id="trust-https-certificate-on-linux-using-edge-or-chrome">Trust HTTPS certificate on Linux using Edge or Chrome</h3>
<div class="tabGroup" id="tabgroup_2">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_2_linux-ubuntu" role="tab" aria-controls="tabpanel_2_linux-ubuntu" data-tab="linux-ubuntu" tabindex="0" aria-selected="true" data-linktype="self-bookmark">Ubuntu</a>
</li>
<li role="presentation">
<a href="#tabpanel_2_linux-rhel" role="tab" aria-controls="tabpanel_2_linux-rhel" data-tab="linux-rhel" tabindex="-1" data-linktype="self-bookmark">Red Hat Enterprise Linux</a>
</li>
<li role="presentation">
<a href="#tabpanel_2_linux-sles" role="tab" aria-controls="tabpanel_2_linux-sles" data-tab="linux-sles" tabindex="-1" data-linktype="self-bookmark">SUSE Linux Enterprise Server</a>
</li>
</ul>
<section id="tabpanel_2_linux-ubuntu" role="tabpanel" data-tab="linux-ubuntu">

<p>For chromium browsers on Linux:</p>
<ul>
<li><p>Install the <code>libnss3-tools</code> for your distribution.</p>
</li>
<li><p>Create or verify the <code>$HOME/.pki/nssdb</code> folder exists on the machine.</p>
</li>
<li><p>Export the certificate with the following command:</p>
<pre><code class="lang-cli">dotnet dev-certs https
sudo -E dotnet dev-certs https -ep /usr/local/share/ca-certificates/aspnet/https.crt --format PEM
</code></pre>
<p>The path in the preceding command is specific for Ubuntu. For other distributions, select an appropriate path or use the path for the Certificate Authorities (CAs).</p>
</li>
<li><p>Run the following commands:</p>
<pre><code class="lang-cli">certutil -d sql:$HOME/.pki/nssdb -A -t "P,," -n localhost -i /usr/local/share/ca-certificates/aspnet/https.crt
</code></pre>
</li>
<li><p>Exit and restart the browser.</p>
</li>
</ul>
<p><a name="trust-ff-linux8"></a></p>
<h4 id="trust-the-certificate-with-firefox-on-linux">Trust the certificate with Firefox on Linux</h4>
<ul>
<li><p>Export the certificate with the following command:</p>
<pre><code class="lang-vstscli">dotnet dev-certs https
sudo -E dotnet dev-certs https -ep /usr/local/share/ca-certificates/aspnet/https.crt --format PEM
</code></pre>
<p>The path in the preceding command is specific for Ubuntu. For other distributions, select an appropriate path or use the path for the Certificate Authorities (CAs).</p>
</li>
<li><p>Create a JSON file at <code>/usr/lib/firefox/distribution/policies.json</code> with the following command:</p>
</li>
</ul>
<pre><code class="lang-sh">cat &lt;&lt;EOF | sudo tee /usr/lib/firefox/distribution/policies.json
{
    "policies": {
        "Certificates": {
            "Install": [
                "/usr/local/share/ca-certificates/aspnet/https.crt"
            ]
        }
    }
}
EOF
</code></pre>
<p>Note: Ubuntu 21.10 Firefox comes as a snap package and the installation folder is <code>/snap/firefox/current/usr/lib/firefox</code>.</p>
<p>See <a href="#trust-ff-ba" data-linktype="self-bookmark">Configure trust of HTTPS certificate using Firefox browser</a> in this article for an alternative way to configure the policy file using the browser.</p>
</section>
<section id="tabpanel_2_linux-rhel" role="tabpanel" data-tab="linux-rhel" aria-hidden="true" hidden="hidden">

<div class="WARNING">
<p>Warning</p>
<p>The following instructions are intended for development purposes only. Do not use the certificates generated in these instructions for a production environment.</p>
</div>
<p>These instructions use Mozilla's <em>legacy</em> tool <code>certutil</code> at  <code>https://firefox-source-docs.mozilla.org/security/nss/legacy/tools/nss_tools_certutil/index.html</code>. Instructions may be updated as modern utilities and practices are discovered.</p>
<div class="CAUTION">
<p>Caution</p>
<p>Improper use of TLS certificates could lead to spoofing.</p>
</div>
<div class="TIP">
<p>Tip</p>
<p>Instructions for valid production certificates can be found in the RHEL Documentation.
<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/securing_networks/index#creating-and-managing-tls-keys-and-certificates_securing-networks" data-linktype="external">RHEL8 TLS Certificates</a>
<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/securing_networks/index#creating-and-managing-tls-keys-and-certificates_securing-networks" data-linktype="external">RHEL9 TLS Certificates</a>
<a href="https://access.redhat.com/documentation/en-us/red_hat_certificate_system/9" data-linktype="external">RHEL9 Certificate System</a></p>
</div>
<h3 id="install-dependencies">Install Dependencies</h3>
<pre><code class="lang-sh">dnf install nss-tools
</code></pre>
<h3 id="export-the-aspnet-core-development-certificate">Export The ASP.NET Core Development Certificate</h3>
<div class="IMPORTANT">
<p>Important</p>
<p>Replace <code>${ProjectDirectory}</code> with your projects directory.
Replace <code>${CertificateName}</code> with a name you'll be able to identify in the future.</p>
</div>
<pre><code class="lang-sh">cd ${ProjectDirectory}
dotnet dev-certs https -ep ${ProjectDirectory}/${CertificateName}.crt --format PEM
</code></pre>
<div class="CAUTION">
<p>Caution</p>
<p>If using git, add your certificate to your <code>${ProjectDirectory}/.gitignore</code> or <code>${ProjectDirectory}/.git/info/exclude</code>.
View the <a href="https://git-scm.com/docs/gitignore" data-linktype="external">git documentation</a> for information about these files.</p>
</div>
<div class="TIP">
<p>Tip</p>
<p>You can move your exported certificate outside of your Git repository and replace the occurrences of <code>${ProjectDirectory}</code>, in the following instructions, with the new location.</p>
</div>
<h3 id="import-the-aspnet-core-development-certificate">Import The ASP.NET Core Development Certificate</h3>
<div class="IMPORTANT">
<p>Important</p>
<p>Replace <code>${UserProfile}</code> with the profile you intend to use.
Do not replace <code>$HOME</code>, it is the environment variable to your user directory.</p>
</div>
<h4 id="chromium-based-browsers">Chromium-based Browsers</h4>
<pre><code class="lang-sh">certutil -d sql:$HOME/.pki/nssdb -A -t "P,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
certutil -d sql:$HOME/.pki/nssdb -A -t "C,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
</code></pre>
<h4 id="mozilla-firefox">Mozilla Firefox</h4>
<pre><code class="lang-sh">certutil -d sql:$HOME/.mozilla/firefox/${UserProfile}/ -A -t "P,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
certutil -d sql:$HOME/.mozilla/firefox/${UserProfile}/ -A -t "C,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
</code></pre>
<h4 id="create-an-alias-to-test-with-curl">Create An Alias To Test With Curl</h4>
<div class="IMPORTANT">
<p>Important</p>
<p>Don't delete the exported certificate if you plan to test with curl.
You'll need to create an alias referencing it in your <code>$SHELL</code>'s profile</p>
</div>
<pre><code class="lang-sh">alias curl="curl --cacert ${ProjectDirectory}/${CertificateName}.crt"
</code></pre>
<h3 id="cleaning-up-the-development-certificates">Cleaning up the Development Certificates</h3>
<pre><code class="lang-sh">certutil -d sql:$HOME/.pki/nssdb -D -n ${CertificateName}
certutil -d sql:$HOME/.mozilla/firefox/${UserProfile}/ -D -n ${CertificateName}
rm ${ProjectDirectory}/${CertificateName}.crt
dotnet dev-certs https --clean
</code></pre>
<div class="NOTE">
<p>Note</p>
<p>Remove the curl alias you created earlier</p>
</div>
</section>
<section id="tabpanel_2_linux-sles" role="tabpanel" data-tab="linux-sles" aria-hidden="true" hidden="hidden">

<p>See <a href="https://github.com/dotnet/AspNetCore.Docs/issues/28292" data-linktype="external">this GitHub issue</a></p>
<!--
> [!WARNING]
> The following instructions are intended for development purposes only. Do not use the certificates generated in these instructions for a production environment.

These instructions use Mozilla's *legacy* tool [certutil](https://firefox-source-docs.mozilla.org/security/nss/legacy/tools/nss_tools_certutil/index.html). Instructions may be updated as modern utilities and practices are discovered.

> [!CAUTION]
> Improper use of TLS certificates could lead to spoofing.

> [!TIP]
> Instructions for valid production certificates can be found in the RHEL Documentation.
> [RHEL8 TLS Certificates](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/securing_networks/index#creating-and-managing-tls-keys-and-certificates_securing-networks)
> [RHEL9 TLS Certificates](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/securing_networks/index#creating-and-managing-tls-keys-and-certificates_securing-networks)
> [RHEL9 Certificate System](https://access.redhat.com/documentation/en-us/red_hat_certificate_system/9)

### Install Dependencies

```sh
dnf install nss-tools
```

### Export The ASP.NET Core Development Certificate

> [!IMPORTANT]
> Replace `${ProjectDirectory}` with your projects directory.
> Replace `${CertificateName}` with a name you'll be able to identify in the future.

```sh
cd ${ProjectDirectory}
dotnet dev-certs https -ep ${ProjectDirectory}/${CertificateName}.crt --format PEM
```

> [!CAUTION]
> If using git, add your certificate to your `${ProjectDirectory}/.gitignore` or `${ProjectDirectory}/.git/info/exclude`.
> View the [git documentation](https://git-scm.com/docs/gitignore) for information about these files.

> [!TIP]
> You can move your exported certificate outside of your Git repository and replace the occurrences of `${ProjectDirectory}`, in the following instructions, with the new location.

### Import The ASP.NET Core Development Certificate

> [!IMPORTANT]
> Replace `${UserProfile}` with the profile you intend to use.
> Do not replace `$HOME`, it is the environment variable to your user directory.

#### Chromium-based Browsers

```sh
certutil -d sql:$HOME/.pki/nssdb -A -t "P,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
certutil -d sql:$HOME/.pki/nssdb -A -t "C,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
```

#### Mozilla Firefox

```sh
certutil -d sql:$HOME/.mozilla/firefox/${UserProfile}/ -A -t "P,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
certutil -d sql:$HOME/.mozilla/firefox/${UserProfile}/ -A -t "C,," -n ${CertificateName} -i ${ProjectDirectory}/${CertificateName}.crt
```

#### Create An Alias To Test With Curl

> [!IMPORTANT]
>
> Don't delete the exported certificate if you plan to test with curl.
> You'll need to create an alias referencing it in your `$SHELL`'s profile

```sh
alias curl="curl --cacert ${ProjectDirectory}/${CertificateName}.crt"
```

### Cleaning up the Development Certificates

```sh
certutil -d sql:$HOME/.pki/nssdb -D -n ${CertificateName}
certutil -d sql:$HOME/.mozilla/firefox/${UserProfile}/ -D -n ${CertificateName}
rm ${ProjectDirectory}/${CertificateName}.crt
dotnet dev-certs https --clean
```

>[!NOTE]
> Remove the curl alias you created earlier
-->
</section>
</div>

<p><a name="wsl"></a></p>
<h3 id="trust-the-certificate-with-fedora-34">Trust the certificate with Fedora 34</h3>
<p>See:</p>
<ul>
<li><a href="https://github.com/dotnet/aspnetcore/issues/32361#issuecomment-837111639" data-linktype="external">This GitHub comment</a></li>
<li><a href="https://docs.fedoraproject.org/en-US/quick-docs/using-shared-system-certificates/" data-linktype="external">Fedora: Using Shared System Certificates</a></li>
<li><a href="https://fedoramagazine.org/set-up-a-net-development-environment/" data-linktype="external">Set up a .NET development environment</a> on Fedora.</li>
</ul>
<h3 id="trust-the-certificate-with-other-distros">Trust the certificate with other distros</h3>
<p>See <a href="https://github.com/dotnet/aspnetcore/issues/32842" data-linktype="external">this GitHub issue</a>.</p>
<h2 id="trust-https-certificate-from-windows-subsystem-for-linux">Trust HTTPS certificate from Windows Subsystem for Linux</h2>
<p>The following instructions don't work for some Linux distributions, such as Ubuntu 20.04. For more information, see GitHub issue <a href="https://github.com/dotnet/AspNetCore.Docs/issues/23686" data-linktype="external">dotnet/AspNetCore.Docs #23686</a>.</p>
<p>The <a href="https://learn.microsoft.com/en-us/windows/wsl/about" data-linktype="absolute-path">Windows Subsystem for Linux (WSL)</a> generates an HTTPS self-signed development certificate, which by default isn't trusted in Windows. The easiest way to have Windows trust the WSL certificate, is to configure WSL to use the same certificate as Windows:</p>
<ul>
<li><p>On <em><strong>Windows</strong></em>, export the developer certificate to a file:</p>
<pre><code>dotnet dev-certs https -ep https.pfx -p $CREDENTIAL_PLACEHOLDER$ --trust
</code></pre>
<p>Where <code>$CREDENTIAL_PLACEHOLDER$</code> is a password.</p>
</li>
<li><p>In a WSL window, import the exported certificate on the WSL instance:</p>
<pre><code>dotnet dev-certs https --clean --import &lt;&lt;path-to-pfx&gt;&gt; --password $CREDENTIAL_PLACEHOLDER$
</code></pre>
</li>
</ul>
<p>The preceding approach is a one time operation per certificate and per WSL distribution. It's easier than exporting the certificate over and over. If you update or regenerate the certificate on windows, you might need to run the preceding commands again.</p>
<p><a name="tcp"></a></p>
<h2 id="troubleshoot-certificate-problems-such-as-certificate-not-trusted">Troubleshoot certificate problems such as certificate not trusted</h2>
<p>This section provides help when the ASP.NET Core HTTPS development certificate has been <a href="#trust" data-linktype="self-bookmark">installed and trusted</a>, but you still have browser warnings that the certificate is not trusted. The ASP.NET Core HTTPS development certificate is used by <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Kestrel</a>.</p>
<p>To repair the IIS Express certificate, see <a href="https://stackoverflow.com/a/20048613/502537" data-linktype="external">this Stackoverflow</a> issue.</p>
<h3 id="all-platforms---certificate-not-trusted">All platforms - certificate not trusted</h3>
<p>Run the following commands:</p>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --clean
dotnet dev-certs https --trust
</code></pre>
<p>Close any browser instances open. Open a new browser window to app. Certificate trust is cached by browsers.</p>
<h3 id="dotnet-dev-certs-https---clean-fails">dotnet dev-certs https --clean Fails</h3>
<p>The preceding commands solve most browser trust issues. If the browser is still not trusting the certificate, follow the platform-specific suggestions that follow.</p>
<h3 id="docker---certificate-not-trusted">Docker - certificate not trusted</h3>
<ul>
<li>Delete the <em>C:\Users{USER}\AppData\Roaming\ASP.NET\Https</em> folder.</li>
<li>Clean the solution. Delete the <em>bin</em> and <em>obj</em> folders.</li>
<li>Restart the development tool. For example, Visual Studio or Visual Studio Code.</li>
</ul>
<h3 id="windows---certificate-not-trusted">Windows - certificate not trusted</h3>
<ul>
<li>Check the certificates in the certificate store. There should be a <code>localhost</code> certificate with the <code>ASP.NET Core HTTPS development certificate</code> friendly name both under <code>Current User &gt; Personal &gt; Certificates</code> and <code>Current User &gt; Trusted root certification authorities &gt; Certificates</code></li>
<li>Remove all the found certificates from both Personal and Trusted root certification authorities. Do <strong>not</strong> remove the IIS Express localhost certificate.</li>
<li>Run the following commands:</li>
</ul>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --clean
dotnet dev-certs https --trust
</code></pre>
<p>Close any browser instances open. Open a new browser window to app.</p>
<h3 id="os-x---certificate-not-trusted">OS X - certificate not trusted</h3>
<ul>
<li>Open KeyChain Access.</li>
<li>Select the System keychain.</li>
<li>Check for the presence of a localhost certificate.</li>
<li>Check that it contains a <code>+</code> symbol on the icon to indicate it's trusted for all users.</li>
<li>Remove the certificate from the system keychain.</li>
<li>Run the following commands:</li>
</ul>
<pre><code class="lang-dotnetcli">dotnet dev-certs https --clean
dotnet dev-certs https --trust
</code></pre>
<p>Close any browser instances open. Open a new browser window to app.</p>
<p>See <a href="https://github.com/dotnet/AspNetCore/issues/16892" data-linktype="external">HTTPS Error using IIS Express (dotnet/AspNetCore #16892)</a> for troubleshooting certificate issues with Visual Studio.</p>
<h3 id="linux-certificate-not-trusted">Linux certificate not trusted</h3>
<p>Check that the certificate being configured for trust is the user HTTPS developer certificate that will be used by the Kestrel server.</p>
<p>Check the current user default HTTPS developer Kestrel certificate at the following location:</p>
<pre><code>ls -la ~/.dotnet/corefx/cryptography/x509stores/my
</code></pre>
<p>The HTTPS developer Kestrel certificate file is the SHA1 thumbprint. When the file is deleted via <code>dotnet dev-certs https --clean</code>, it's regenerated when needed with a different thumbprint.
Check the thumbprint of the exported certificate matches with the following command:</p>
<pre><code>openssl x509 -noout -fingerprint -sha1 -inform pem -in /usr/local/share/ca-certificates/aspnet/https.crt
</code></pre>
<p>If the certificate doesn't match, it could be one of the following:</p>
<ul>
<li>An old certificate.</li>
<li>An exported a developer certificate for the root user. For this case, export the  certificate.</li>
</ul>
<p>The root user certificate can be checked at:</p>
<pre><code>ls -la /root/.dotnet/corefx/cryptography/x509stores/my
</code></pre>
<h3 id="iis-express-ssl-certificate-used-with-visual-studio">IIS Express SSL certificate used with Visual Studio</h3>
<p>To fix problems with the IIS Express certificate, select <strong>Repair</strong> from the Visual Studio installer. For more information, see <a href="https://github.com/dotnet/aspnetcore/issues/16892" data-linktype="external">this GitHub issue</a>.</p>
<h3 id="group-policy-prevents-self-signed-certificates-from-being-trusted">Group policy prevents self-signed certificates from being trusted</h3>
<p>In some cases, group policy may prevent self-signed certificates from being trusted. For more information, see <a href="https://github.com/dotnet/aspnetcore/issues/21173" data-linktype="external">this GitHub issue</a>.</p>
<h2 id="additional-information">Additional information</h2>
<ul>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/proxy-load-balancer?view=aspnetcore-9.0" data-linktype="relative-path">Configure ASP.NET Core to work with proxy servers and load balancers</a></li>
<li><a href="../host-and-deploy/linux-nginx553c.html?view=aspnetcore-9.0#https-configuration" data-linktype="relative-path">Host ASP.NET Core on Linux with Nginx: HTTPS configuration</a></li>
<li><a href="https://learn.microsoft.com/en-us/iis/manage/configuring-security/how-to-set-up-ssl-on-iis" data-linktype="absolute-path">How to Set Up SSL on IIS</a></li>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/servers/kestrel/endpoints?view=aspnetcore-9.0" data-linktype="relative-path">Configure endpoints for the ASP.NET Core Kestrel web server</a></li>
<li><a href="https://www.owasp.org/index.php/HTTP_Strict_Transport_Security_Cheat_Sheet#Browser_Support" data-linktype="external">OWASP HSTS browser support</a></li>
</ul>
</div>
</div>
					
		<div
			id="ms--inline-notifications"
			class="margin-block-xs"
			data-bi-name="inline-notification"
		></div>
	 
		<div
			id="assertive-live-region"
			role="alert"
			aria-live="assertive"
			class="visually-hidden"
			aria-relevant="additions"
			aria-atomic="true"
		></div>
		<div
			id="polite-live-region"
			role="status"
			aria-live="polite"
			class="visually-hidden"
			aria-relevant="additions"
			aria-atomic="true"
		></div>
	
					
			
		<!-- feedback section -->
		<section
			class="feedback-section position-relative margin-top-lg border border-radius padding-xxs display-none-print"
			data-bi-name="open-source-feedback-section"
			data-open-source-feedback-section
			hidden
		>
			<div class="display-flex flex-direction-column flex-direction-row-tablet">
				<div
					class="width-450-tablet padding-inline-xs padding-inline-xs-tablet padding-top-xs padding-bottom-sm padding-top-xs-tablet background-color-body-medium"
				>
					<div class="display-flex flex-direction-column">
						<div class="padding-bottom-xxs">
							<span class="icon margin-right-xxs" aria-hidden="true">
								<span class="docon docon-brand-github"></span>
							</span>
							<span class="font-weight-semibold">
								Collaborate with us on GitHub
							</span>
						</div>
						<span class="line-height-normal">
							The source for this content can be found on GitHub, where you can also create and review issues and pull requests. For more information, see <a href="https://learn.microsoft.com/contribute/content/dotnet/dotnet-contribute">our contributor guide</a>.
						</span>
					</div>
				</div>
				<div
					class="display-flex gap-xs width-full-tablet flex-direction-column padding-xs justify-content-space-evenly"
				>
					<div class="media">
						
					<div class="media-left">
						<div class="image image-36x36" hidden data-open-source-image-container>
							<img
								class="theme-display is-light"
								src="https://learn.microsoft.com/media/logos/logo_net.svg"
								aria-hidden="true"
								data-open-source-image-light
							/>
							<img
								class="theme-display is-dark is-high-contrast"
								src="https://learn.microsoft.com/media/logos/logo_net.svg"
								aria-hidden="true"
								data-open-source-image-dark
							/>
						</div>
					</div>
			  

						<div class="media-content">
							<p
								class="font-size-xl font-weight-semibold margin-bottom-xxs"
								data-open-source-product-title
							>
								ASP.NET Core
							</p>
							<div class="display-flex gap-xs flex-direction-column">
								<p class="line-height-normal" data-open-source-product-description></p>
								<div class="display-flex gap-xs flex-direction-column">
									<a href="#" data-github-link>
										<span class="icon margin-right-xxs" aria-hidden="true">
											<span class="docon docon-bug"></span>
										</span>
										<span>Open a documentation issue</span>
									</a>
									<a
										href="https://github.com/dotnet/aspnetcore/blob/main/CONTRIBUTING.md"
										class="display-block margin-top-auto font-size-md"
										data-feedback-product-url
									>
										<span class="icon margin-right-xxs" aria-hidden="true">
											<span class="docon docon-feedback"></span>
										</span>
										<span>Provide product feedback</span>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
		<!-- end feedback section -->
	
			
		<!-- feedback section -->
		<section
			id="site-user-feedback-footer"
			class="font-size-sm margin-top-md display-none-print display-none-desktop"
			data-test-id="site-user-feedback-footer"
			data-bi-name="site-feedback-section"
		>
			<hr class="hr" />
			<h2 id="ms--feedback" class="title is-3">Feedback</h2>
			<div class="display-flex flex-wrap-wrap align-items-center">
				<p class="font-weight-semibold margin-xxs margin-left-none">
					Was this page helpful?
				</p>
				<div class="buttons">
					<button
						class="thumb-rating-button like button button-primary button-sm"
						data-test-id="footer-rating-yes"
						data-binary-rating-response="rating-yes"
						type="button"
						title="This article is helpful"
						data-bi-name="button-rating-yes"
						aria-pressed="false"
					>
						<span class="icon" aria-hidden="true">
							<span class="docon docon-like"></span>
						</span>
						<span>Yes</span>
					</button>
					<button
						class="thumb-rating-button dislike button button-primary button-sm"
						data-test-id="footer-rating-no"
						data-binary-rating-response="rating-no"
						type="button"
						title="This article is not helpful"
						data-bi-name="button-rating-no"
						aria-pressed="false"
					>
						<span class="icon" aria-hidden="true">
							<span class="docon docon-dislike"></span>
						</span>
						<span>No</span>
					</button>
				</div>
			</div>
		</section>
		<!-- end feedback section -->
	
		
				</div>
				
		<div id="ms--additional-resources-mobile" class="display-none-print">
			<hr class="hr" hidden />
			<h2 id="ms--additional-resources-mobile-heading" class="title is-3" hidden>
				Additional resources
			</h2>
			
		<section
			id="right-rail-recommendations-mobile"
			class=""
			data-bi-name="recommendations"
			hidden
		></section>
	 
		<section
			id="right-rail-training-mobile"
			class=""
			data-bi-name="learning-resource-card"
			hidden
		></section>
	 
		<section
			id="right-rail-events-mobile"
			class=""
			data-bi-name="events-card"
			hidden
		></section>
	 
		<section
			id="right-rail-qna-mobile"
			class="margin-top-xxs"
			data-bi-name="qna-link-card"
			hidden
		></section>
	
		</div>
	
			</div>
			
		<div
			id="action-panel"
			role="region"
			aria-label="Action Panel"
			class="action-panel"
			tabindex="-1"
		></div>
	
		
				</main>
				<aside
					id="layout-body-aside"
					class="layout-body-aside "
					data-bi-name="aside"
			  >
					
		<div
			id="ms--additional-resources"
			class="right-container padding-sm display-none display-block-desktop height-full"
			data-bi-name="pageactions"
			role="complementary"
			aria-label="Additional resources"
		>
			<div id="affixed-right-container" data-bi-name="right-column">
				
		<nav
			id="side-doc-outline"
			class="doc-outline border-bottom padding-bottom-xs margin-bottom-xs"
			data-bi-name="intopic toc"
			aria-label="In this article"
		>
			<h3>In this article</h3>
		</nav>
	
				<!-- Feedback -->
				
		<section
			id="ms--site-user-feedback-right-rail"
			class="font-size-sm display-none-print"
			data-test-id="site-user-feedback-right-rail"
			data-bi-name="site-feedback-right-rail"
		>
			<p class="font-weight-semibold margin-bottom-xs">Was this page helpful?</p>
			<div class="buttons">
				<button
					class="thumb-rating-button like button button-primary button-sm"
					data-test-id="right-rail-rating-yes"
					data-binary-rating-response="rating-yes"
					type="button"
					title="This article is helpful"
					data-bi-name="button-rating-yes"
					aria-pressed="false"
				>
					<span class="icon" aria-hidden="true">
						<span class="docon docon-like"></span>
					</span>
					<span>Yes</span>
				</button>
				<button
					class="thumb-rating-button dislike button button-primary button-sm"
					data-test-id="right-rail-rating-no"
					data-binary-rating-response="rating-no"
					type="button"
					title="This article is not helpful"
					data-bi-name="button-rating-no"
					aria-pressed="false"
				>
					<span class="icon" aria-hidden="true">
						<span class="docon docon-dislike"></span>
					</span>
					<span>No</span>
				</button>
			</div>
		</section>
	
			</div>
		</div>
	
			  </aside> <section
					id="layout-body-flyout"
					class="layout-body-flyout "
					data-bi-name="flyout"
			  >
					 <div
	class="height-full border-left background-color-body-medium"
	id="ask-learn-flyout"
></div>
			  </section> <div class="layout-body-footer " data-bi-name="layout-footer">
		<footer
			id="footer"
			data-test-id="footer"
			data-bi-name="footer"
			class="footer-layout has-padding has-default-focus border-top  uhf-container"
			role="contentinfo"
		>
			<div class="display-flex gap-xs flex-wrap-wrap is-full-height padding-right-lg-desktop">
				
		<a
			data-mscc-ic="false"
			href="#"
			data-bi-name="select-locale"
			class="locale-selector-link flex-shrink-0 button button-sm button-clear external-link-indicator"
			id=""
			title=""
			><span class="icon" aria-hidden="true"
				><span class="docon docon-world"></span></span
			><span class="local-selector-link-text">en-us</span></a
		>
	
				<div class="ccpa-privacy-link" data-ccpa-privacy-link hidden>
		
		<a
			data-mscc-ic="false"
			href="https://aka.ms/yourcaliforniaprivacychoices"
			data-bi-name="your-privacy-choices"
			class="button button-sm button-clear flex-shrink-0 external-link-indicator"
			id=""
			title=""
			>
		<svg
			xmlns="http://www.w3.org/2000/svg"
			viewBox="0 0 30 14"
			xml:space="preserve"
			height="16"
			width="43"
			aria-hidden="true"
			focusable="false"
		>
			<path
				d="M7.4 12.8h6.8l3.1-11.6H7.4C4.2 1.2 1.6 3.8 1.6 7s2.6 5.8 5.8 5.8z"
				style="fill-rule:evenodd;clip-rule:evenodd;fill:#fff"
			></path>
			<path
				d="M22.6 0H7.4c-3.9 0-7 3.1-7 7s3.1 7 7 7h15.2c3.9 0 7-3.1 7-7s-3.2-7-7-7zm-21 7c0-3.2 2.6-5.8 5.8-5.8h9.9l-3.1 11.6H7.4c-3.2 0-5.8-2.6-5.8-5.8z"
				style="fill-rule:evenodd;clip-rule:evenodd;fill:#06f"
			></path>
			<path
				d="M24.6 4c.2.2.2.6 0 .8L22.5 7l2.2 2.2c.2.2.2.6 0 .8-.2.2-.6.2-.8 0l-2.2-2.2-2.2 2.2c-.2.2-.6.2-.8 0-.2-.2-.2-.6 0-.8L20.8 7l-2.2-2.2c-.2-.2-.2-.6 0-.8.2-.2.6-.2.8 0l2.2 2.2L23.8 4c.2-.2.6-.2.8 0z"
				style="fill:#fff"
			></path>
			<path
				d="M12.7 4.1c.2.2.3.6.1.8L8.6 9.8c-.1.1-.2.2-.3.2-.2.1-.5.1-.7-.1L5.4 7.7c-.2-.2-.2-.6 0-.8.2-.2.6-.2.8 0L8 8.6l3.8-4.5c.2-.2.6-.2.9 0z"
				style="fill:#06f"
			></path>
		</svg>
	
			<span>Your Privacy Choices</span></a
		>
	
	</div>
				<div class="flex-shrink-0">
		<div class="dropdown has-caret-up">
			<button
				data-test-id="theme-selector-button"
				class="dropdown-trigger button button-clear button-sm has-inner-focus theme-dropdown-trigger"
				aria-controls="{{ themeMenuId }}"
				aria-expanded="false"
				title="Theme"
				data-bi-name="theme"
			>
				<span class="icon">
					<span class="docon docon-sun" aria-hidden="true"></span>
				</span>
				<span>Theme</span>
				<span class="icon expanded-indicator" aria-hidden="true">
					<span class="docon docon-chevron-down-light"></span>
				</span>
			</button>
			<div class="dropdown-menu" id="{{ themeMenuId }}" role="menu">
				<ul class="theme-selector padding-xxs" data-test-id="theme-dropdown-menu">
					<li class="theme display-block">
						<button
							class="button button-clear button-sm theme-control button-block justify-content-flex-start text-align-left"
							data-theme-to="light"
						>
							<span class="theme-light margin-right-xxs">
								<span
									class="theme-selector-icon border display-inline-block has-body-background"
									aria-hidden="true"
								>
									<svg class="svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 14">
										<rect width="22" height="14" class="has-fill-body-background" />
										<rect x="5" y="5" width="12" height="4" class="has-fill-secondary" />
										<rect x="5" y="2" width="2" height="1" class="has-fill-secondary" />
										<rect x="8" y="2" width="2" height="1" class="has-fill-secondary" />
										<rect x="11" y="2" width="3" height="1" class="has-fill-secondary" />
										<rect x="1" y="1" width="2" height="2" class="has-fill-secondary" />
										<rect x="5" y="10" width="7" height="2" rx="0.3" class="has-fill-primary" />
										<rect x="19" y="1" width="2" height="2" rx="1" class="has-fill-secondary" />
									</svg>
								</span>
							</span>
							<span role="menuitem"> Light </span>
						</button>
					</li>
					<li class="theme display-block">
						<button
							class="button button-clear button-sm theme-control button-block justify-content-flex-start text-align-left"
							data-theme-to="dark"
						>
							<span class="theme-dark margin-right-xxs">
								<span
									class="border theme-selector-icon display-inline-block has-body-background"
									aria-hidden="true"
								>
									<svg class="svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 14">
										<rect width="22" height="14" class="has-fill-body-background" />
										<rect x="5" y="5" width="12" height="4" class="has-fill-secondary" />
										<rect x="5" y="2" width="2" height="1" class="has-fill-secondary" />
										<rect x="8" y="2" width="2" height="1" class="has-fill-secondary" />
										<rect x="11" y="2" width="3" height="1" class="has-fill-secondary" />
										<rect x="1" y="1" width="2" height="2" class="has-fill-secondary" />
										<rect x="5" y="10" width="7" height="2" rx="0.3" class="has-fill-primary" />
										<rect x="19" y="1" width="2" height="2" rx="1" class="has-fill-secondary" />
									</svg>
								</span>
							</span>
							<span role="menuitem"> Dark </span>
						</button>
					</li>
					<li class="theme display-block">
						<button
							class="button button-clear button-sm theme-control button-block justify-content-flex-start text-align-left"
							data-theme-to="high-contrast"
						>
							<span class="theme-high-contrast margin-right-xxs">
								<span
									class="border theme-selector-icon display-inline-block has-body-background"
									aria-hidden="true"
								>
									<svg class="svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 14">
										<rect width="22" height="14" class="has-fill-body-background" />
										<rect x="5" y="5" width="12" height="4" class="has-fill-secondary" />
										<rect x="5" y="2" width="2" height="1" class="has-fill-secondary" />
										<rect x="8" y="2" width="2" height="1" class="has-fill-secondary" />
										<rect x="11" y="2" width="3" height="1" class="has-fill-secondary" />
										<rect x="1" y="1" width="2" height="2" class="has-fill-secondary" />
										<rect x="5" y="10" width="7" height="2" rx="0.3" class="has-fill-primary" />
										<rect x="19" y="1" width="2" height="2" rx="1" class="has-fill-secondary" />
									</svg>
								</span>
							</span>
							<span role="menuitem"> High contrast </span>
						</button>
					</li>
				</ul>
			</div>
		</div>
	</div>
			</div>
			<ul class="links" data-bi-name="footerlinks">
				<li class="manage-cookies-holder" hidden=""></li>
				<li>
		
		<a
			data-mscc-ic="false"
			href="https://learn.microsoft.com/en-us/principles-for-ai-generated-content"
			data-bi-name="aiDisclaimer"
			class=" external-link-indicator"
			id=""
			title=""
			>AI Disclaimer</a
		>
	
	</li><li>
		
		<a
			data-mscc-ic="false"
			href="https://learn.microsoft.com/en-us/previous-versions/"
			data-bi-name="archivelink"
			class=" external-link-indicator"
			id=""
			title=""
			>Previous Versions</a
		>
	
	</li> <li>
		
		<a
			data-mscc-ic="false"
			href="https://techcommunity.microsoft.com/t5/microsoft-learn-blog/bg-p/MicrosoftLearnBlog"
			data-bi-name="bloglink"
			class=" external-link-indicator"
			id=""
			title=""
			>Blog</a
		>
	
	</li> <li>
		
		<a
			data-mscc-ic="false"
			href="https://learn.microsoft.com/en-us/contribute"
			data-bi-name="contributorGuide"
			class=" external-link-indicator"
			id=""
			title=""
			>Contribute</a
		>
	
	</li><li>
		
		<a
			data-mscc-ic="false"
			href="https://go.microsoft.com/fwlink/?LinkId=521839"
			data-bi-name="privacy"
			class=" external-link-indicator"
			id=""
			title=""
			>Privacy</a
		>
	
	</li><li>
		
		<a
			data-mscc-ic="false"
			href="https://learn.microsoft.com/en-us/legal/termsofuse"
			data-bi-name="termsofuse"
			class=" external-link-indicator"
			id=""
			title=""
			>Terms of Use</a
		>
	
	</li><li>
		
		<a
			data-mscc-ic="false"
			href="https://www.microsoft.com/legal/intellectualproperty/Trademarks/"
			data-bi-name="trademarks"
			class=" external-link-indicator"
			id=""
			title=""
			>Trademarks</a
		>
	
	</li>
				<li>&copy; Microsoft 2025</li>
			</ul>
		</footer>
	</footer>
			</body>
		
<!-- Mirrored from learn.microsoft.com/en-us/aspnet/core/security/enforcing-ssl?view=aspnetcore-9.0 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 06 Aug 2025 14:53:03 GMT -->
</html>