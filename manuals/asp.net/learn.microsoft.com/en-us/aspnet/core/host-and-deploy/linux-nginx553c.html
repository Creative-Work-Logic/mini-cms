 <!DOCTYPE html>
		<html
			class="layout layout-holy-grail   show-table-of-contents conceptual show-breadcrumb default-focus"
			lang="en-us"
			dir="ltr"
			data-authenticated="false"
			data-auth-status-determined="false"
			data-target="docs"
			x-ms-format-detection="none"
		>
			
		
<!-- Mirrored from learn.microsoft.com/en-us/aspnet/core/host-and-deploy/linux-nginx?view=aspnetcore-9.0 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 06 Aug 2025 14:53:03 GMT -->
<head>
			<title>Host ASP.NET Core on Linux with Nginx | Microsoft Learn</title>
			<meta charset="utf-8" />
			<meta name="viewport" content="width=device-width, initial-scale=1.0" />
			<meta name="color-scheme" content="light dark" />

			<meta name="description" content="Learn how to set up Nginx as a reverse proxy on Ubuntu, RHEL and SUSE to forward HTTP traffic to an ASP.NET Core web app running on Kestrel." />
			<link rel="canonical" href="linux-nginx553c.html?view=aspnetcore-9.0" /> 

			<!-- Non-customizable open graph and sharing-related metadata -->
			<meta name="twitter:card" content="summary" />
			<meta name="twitter:site" content="@MicrosoftLearn" />
			<meta property="og:type" content="website" />
			<meta property="og:image:alt" content="Host ASP.NET Core on Linux with Nginx | Microsoft Learn" />
			<meta property="og:image" content="https://learn.microsoft.com/dotnet/media/dotnet-logo.png" />
			<!-- Page specific open graph and sharing-related metadata -->
			<meta property="og:title" content="Host ASP.NET Core on Linux with Nginx" />
			<meta property="og:url" content="linux-nginx553c.html?view=aspnetcore-9.0" />
			<meta property="og:description" content="Learn how to set up Nginx as a reverse proxy on Ubuntu, RHEL and SUSE to forward HTTP traffic to an ASP.NET Core web app running on Kestrel." />
			<meta name="platform_id" content="b6e25b01-256b-fd9a-838c-ad7de2de561a" /> <meta name="scope" content="ASP.NET Core" />
			<meta name="locale" content="en-us" />
			 <meta name="adobe-target" content="true" />
			<meta name="uhfHeaderId" content="MSDocsHeader-AspNet" />

			<meta name="page_type" content="conceptual" />

			<!--page specific meta tags-->
			

			<!-- custom meta tags -->
			
		<meta name="breadcrumb_path" content="/aspnet/core/breadcrumb/toc.json" />
	
		<meta name="feedback_system" content="OpenSource" />
	
		<meta name="feedback_product_url" content="https://github.com/dotnet/aspnetcore/blob/main/CONTRIBUTING.md" />
	
		<meta name="ms.service" content="aspnet-core" />
	
		<meta name="ms.topic" content="conceptual" />
	
		<meta name="ms.subservice" content="hosting-deployment" />
	
		<meta name="author" content="tdykstra" />
	
		<meta name="monikerRange" content="&gt;= aspnetcore-3.1" />
	
		<meta name="ms.author" content="tdykstra" />
	
		<meta name="ms.custom" content="mvc, engagement-fy23, linux-related-content, sfi-ropc-nochange" />
	
		<meta name="ms.date" content="2023-05-08T00:00:00Z" />
	
		<meta name="uid" content="host-and-deploy/linux-nginx" />
	
		<meta name="document_id" content="dcdd2c35-bf2b-2673-d150-303a8aaa54d2" />
	
		<meta name="document_version_independent_id" content="815fe034-c9fc-aee3-a8b5-f2e860b30302" />
	
		<meta name="updated_at" content="2025-08-01T13:31:00Z" />
	
		<meta name="original_content_git_url" content="https://github.com/dotnet/AspNetCore.Docs/blob/live/aspnetcore/host-and-deploy/linux-nginx.md" />
	
		<meta name="gitcommit" content="https://github.com/dotnet/AspNetCore.Docs/blob/6a51096c09da531a44f5de89218041792966a565/aspnetcore/host-and-deploy/linux-nginx.md" />
	
		<meta name="git_commit_id" content="6a51096c09da531a44f5de89218041792966a565" />
	
		<meta name="monikers" content="aspnetcore-3.1" />
	
		<meta name="monikers" content="aspnetcore-5.0" />
	
		<meta name="monikers" content="aspnetcore-6.0" />
	
		<meta name="monikers" content="aspnetcore-7.0" />
	
		<meta name="monikers" content="aspnetcore-8.0" />
	
		<meta name="monikers" content="aspnetcore-9.0" />
	
		<meta name="monikers" content="aspnetcore-10.0" />
	
		<meta name="default_moniker" content="aspnetcore-9.0" />
	
		<meta name="site_name" content="Docs" />
	
		<meta name="depot_name" content="MSDN.aspnet-core-conceptual" />
	
		<meta name="schema" content="Conceptual" />
	
		<meta name="toc_rel" content="../toc.json" />
	
		<meta name="pdf_url_template" content="https://learn.microsoft.com/pdfstore/en-us/MSDN.aspnet-core-conceptual/{branchName}{pdfName}" />
	
		<meta name="feedback_help_link_type" content="" />
	
		<meta name="feedback_help_link_url" content="" />
	
		<meta name="word_count" content="9797" />
	
		<meta name="config_moniker_range" content="&gt;= aspnetcore-1.0" />
	
		<meta name="asset_id" content="host-and-deploy/linux-nginx" />
	
		<meta name="moniker_range_name" content="dd7b9de2e2e080a77b76aef7078b3e55" />
	
		<meta name="item_type" content="Content" />
	
		<meta name="source_path" content="aspnetcore/host-and-deploy/linux-nginx.md" />
	
		<meta name="previous_tlsh_hash" content="29047E43B50CD514FFC34F26986F6601A6F4C58AEBB036C812252A91E94F3FB7179D3997D713B38C333706831396678F12E5FB3E926C2226295454BEC19E218297DA3B72D8" />
	
		<meta name="github_feedback_content_git_url" content="https://github.com/dotnet/AspNetCore.Docs/blob/main/aspnetcore/host-and-deploy/linux-nginx.md" />
	 
		<meta name="cmProducts" content="https://authoring-docs-microsoft.poolparty.biz/devrel/d452572f-6212-498f-9050-ca4a9e50a425" data-source="generated" />
	
		<meta name="cmProducts" content="https://authoring-docs-microsoft.poolparty.biz/devrel/7696cda6-0510-47f6-8302-71bb5d2e28cf" data-source="generated" />
	
		<meta name="spProducts" content="https://authoring-docs-microsoft.poolparty.biz/devrel/a12e40b7-59a2-4437-96e2-166ce622b864" data-source="generated" />
	
		<meta name="spProducts" content="https://authoring-docs-microsoft.poolparty.biz/devrel/69c76c32-967e-4c65-b89a-74cc527db725" data-source="generated" />
	

			<!-- assets and js globals -->
			
			<link rel="stylesheet" href="https://learn.microsoft.com/static/assets/0.4.03137.7032-e8b681c0/styles/site-ltr.css" />
			<link rel="preconnect" href="http://mscom.demdex.net/" crossorigin />
						<link rel="dns-prefetch" href="http://target.microsoft.com/" />
						<link rel="dns-prefetch" href="http://microsoftmscompoc.tt.omtrdc.net/" />
						<link
							rel="preload"
							as="script"
							href="https://learn.microsoft.com/static/third-party/adobe-target/at-js/2.9.0/at.js"
							integrity="sha384-1/viVM50hgc33O2gOgkWz3EjiD/Fy/ld1dKYXJRUyjNYVEjSUGcSN+iPiQF7e4cu"
							crossorigin="anonymous"
							id="adobe-target-script"
							type="application/javascript"
						/>
			<script src="https://wcpstatic.microsoft.com/mscc/lib/v2/wcp-consent.js"></script>
			<script src="https://js.monitor.azure.com/scripts/c/ms.jsll-4.min.js"></script>
			<script src="https://learn.microsoft.com/_themes/docs.theme/master/en-us/_themes/global/deprecation.js"></script>

			<!-- msdocs global object -->
			<script id="msdocs-script">
		var msDocs = {
  "environment": {
    "accessLevel": "online",
    "azurePortalHostname": "portal.azure.com",
    "reviewFeatures": false,
    "supportLevel": "production",
    "systemContent": true,
    "siteName": "learn",
    "legacyHosting": false
  },
  "data": {
    "contentLocale": "en-us",
    "contentDir": "ltr",
    "userLocale": "en-us",
    "userDir": "ltr",
    "pageTemplate": "Conceptual",
    "brand": "",
    "context": {},
    "standardFeedback": false,
    "showFeedbackReport": false,
    "feedbackHelpLinkType": "",
    "feedbackHelpLinkUrl": "",
    "feedbackSystem": "OpenSource",
    "feedbackGitHubRepo": "dotnet/AspNetCore.Docs",
    "feedbackProductUrl": "https://github.com/dotnet/aspnetcore/blob/main/CONTRIBUTING.md",
    "extendBreadcrumb": false,
    "isEditDisplayable": true,
    "isPrivateUnauthorized": false,
    "hideViewSource": false,
    "isPermissioned": false,
    "hasRecommendations": true,
    "contributors": [
      {
        "name": "tdykstra",
        "url": "https://github.com/tdykstra"
      },
      {
        "name": "Dickson-Mwendia",
        "url": "https://github.com/Dickson-Mwendia"
      },
      {
        "name": "wadepickett",
        "url": "https://github.com/wadepickett"
      },
      {
        "name": "Copilot",
        "url": "https://github.com/Copilot"
      },
      {
        "name": "guardrex",
        "url": "https://github.com/guardrex"
      },
      {
        "name": "kant2002",
        "url": "https://github.com/kant2002"
      },
      {
        "name": "dbradish-microsoft",
        "url": "https://github.com/dbradish-microsoft"
      },
      {
        "name": "Rick-Anderson",
        "url": "https://github.com/Rick-Anderson"
      },
      {
        "name": "BrennanConroy",
        "url": "https://github.com/BrennanConroy"
      },
      {
        "name": "asbjornu",
        "url": "https://github.com/asbjornu"
      },
      {
        "name": "rguptar",
        "url": "https://github.com/rguptar"
      },
      {
        "name": "serpent5",
        "url": "https://github.com/serpent5"
      },
      {
        "name": "FatTigerWang",
        "url": "https://github.com/FatTigerWang"
      },
      {
        "name": "halter73",
        "url": "https://github.com/halter73"
      },
      {
        "name": "scottaddie",
        "url": "https://github.com/scottaddie"
      },
      {
        "name": "v-thepet",
        "url": "https://github.com/v-thepet"
      },
      {
        "name": "dustout",
        "url": "https://github.com/dustout"
      },
      {
        "name": "StillLearnin",
        "url": "https://github.com/StillLearnin"
      },
      {
        "name": "nopara73",
        "url": "https://github.com/nopara73"
      },
      {
        "name": "joacar",
        "url": "https://github.com/joacar"
      },
      {
        "name": "ddprince17",
        "url": "https://github.com/ddprince17"
      }
    ],
    "openSourceFeedbackIssueUrl": "https://github.com/dotnet/aspnetcore.docs/issues/new?template=customer-feedback.yml",
    "openSourceFeedbackIssueTitle": "",
    "openSourceFeedbackIssueLabels": "Source - Docs.ms,:watch: Not Triaged"
  },
  "functions": {}
};;
	</script>

			<!-- base scripts, msdocs global should be before this -->
			<script src="https://learn.microsoft.com/static/assets/0.4.03137.7032-e8b681c0/scripts/en-us/index-docs.js"></script>
			

			<!-- json-ld -->
			
		</head>
	
			<body
				id="body"
				data-bi-name="body"
				class="layout-body "
				lang="en-us"
				dir="ltr"
			>
				<header class="layout-body-header">
		<div class="header-holder has-default-focus">
			
		<a
			href="#main"
			
			style="z-index: 1070"
			class="outline-color-text visually-hidden-until-focused position-fixed inner-focus focus-visible top-0 left-0 right-0 padding-xs text-align-center background-color-body"
			
		>
			Skip to main content
		</a>
	
		<a
			href="#"
			data-skip-to-ask-learn
			style="z-index: 1070"
			class="outline-color-text visually-hidden-until-focused position-fixed inner-focus focus-visible top-0 left-0 right-0 padding-xs text-align-center background-color-body"
			hidden
		>
			Skip to Ask Learn chat experience
		</a>
	

			<div hidden id="cookie-consent-holder" data-test-id="cookie-consent-container"></div>
			<!-- Unsupported browser warning -->
			<div
				id="unsupported-browser"
				style="background-color: white; color: black; padding: 16px; border-bottom: 1px solid grey;"
				hidden
			>
				<div style="max-width: 800px; margin: 0 auto;">
					<p style="font-size: 24px">This browser is no longer supported.</p>
					<p style="font-size: 16px; margin-top: 16px;">
						Upgrade to Microsoft Edge to take advantage of the latest features, security updates, and technical support.
					</p>
					<div style="margin-top: 12px;">
						<a
							href="https://go.microsoft.com/fwlink/p/?LinkID=2092881"
							style="background-color: #0078d4; border: 1px solid #0078d4; color: white; padding: 6px 12px; border-radius: 2px; display: inline-block;"
						>
							Download Microsoft Edge
						</a>
						<a
							href="https://learn.microsoft.com/en-us/lifecycle/faq/internet-explorer-microsoft-edge"
							style="background-color: white; padding: 6px 12px; border: 1px solid #505050; color: #171717; border-radius: 2px; display: inline-block;"
						>
							More info about Internet Explorer and Microsoft Edge
						</a>
					</div>
				</div>
			</div>
			<!-- site header -->
			<header
				id="ms--site-header"
				data-test-id="site-header-wrapper"
				role="banner"
				itemscope="itemscope"
				itemtype="http://schema.org/Organization"
			>
				<div
					id="ms--mobile-nav"
					class="site-header display-none-tablet padding-inline-none gap-none"
					data-bi-name="mobile-header"
					data-test-id="mobile-header"
				></div>
				<div
					id="ms--primary-nav"
					class="site-header display-none display-flex-tablet"
					data-bi-name="L1-header"
					data-test-id="primary-header"
				></div>
				<div
					id="ms--secondary-nav"
					class="site-header display-none display-flex-tablet"
					data-bi-name="L2-header"
					data-test-id="secondary-header"
				></div>
			</header>
			
		<!-- banner -->
		<div data-banner>
			<div id="disclaimer-holder"></div>
			
		</div>
		<!-- banner end -->
	
		</div>
	</header>
				 <section
					id="layout-body-menu"
					class="layout-body-menu display-flex"
					data-bi-name="menu"
			  >
					<div
		id="left-container"
		class="left-container display-none display-block-tablet padding-inline-sm padding-bottom-sm width-full"
	>
		<nav
			id="affixed-left-container"
			class="margin-top-sm-tablet position-sticky display-flex flex-direction-column"
			aria-label="Primary"
		></nav>
	</div>
			  </section>

				<main
					id="main"
					role="main"
					class="layout-body-main "
					data-bi-name="content"
					lang="en-us"
					dir="ltr"
				>
					
			<div
		id="ms--content-header"
		class="content-header default-focus border-bottom-none"
		data-bi-name="content-header"
	>
		<div class="content-header-controls margin-xxs margin-inline-sm-tablet">
			<button
				type="button"
				class="contents-button button button-sm margin-right-xxs"
				data-bi-name="contents-expand"
				aria-haspopup="true"
				data-contents-button
			>
				<span class="icon" aria-hidden="true"><span class="docon docon-menu"></span></span>
				<span class="contents-expand-title"> Table of contents </span>
			</button>
			<button
				type="button"
				class="ap-collapse-behavior ap-expanded button button-sm"
				data-bi-name="ap-collapse"
				aria-controls="action-panel"
			>
				<span class="icon" aria-hidden="true"><span class="docon docon-exit-mode"></span></span>
				<span>Exit editor mode</span>
			</button>
		</div>
	</div>
			<div data-main-column class="padding-sm padding-top-none padding-top-sm-tablet">
				<div>
					
		<div id="article-header" class="background-color-body margin-bottom-xs display-none-print">
			<div class="display-flex align-items-center justify-content-space-between">
				
		<details
			id="article-header-breadcrumbs-overflow-popover"
			class="popover"
			data-for="article-header-breadcrumbs"
		>
			<summary
				class="button button-clear button-primary button-sm inner-focus"
				aria-label="All breadcrumbs"
			>
				<span class="icon">
					<span class="docon docon-more"></span>
				</span>
			</summary>
			<div id="article-header-breadcrumbs-overflow" class="popover-content padding-none"></div>
		</details>

		<bread-crumbs
			id="article-header-breadcrumbs"
			data-test-id="article-header-breadcrumbs"
			class="overflow-hidden flex-grow-1 margin-right-sm margin-right-md-tablet margin-right-lg-desktop margin-left-negative-xxs padding-left-xxs"
		></bread-crumbs>
	 
		<div
			id="article-header-page-actions"
			class="opacity-none margin-left-auto display-flex flex-wrap-no-wrap align-items-stretch"
		>
			
		<button
			class="button button-sm border-none inner-focus display-none-tablet flex-shrink-0 "
			data-bi-name="ask-learn-assistant-entry"
			data-test-id="ask-learn-assistant-modal-entry-mobile"
			data-ask-learn-modal-entry
			type="button"
			style="min-width: max-content;"
			aria-expanded="false"
			aria-label="Ask Learn"
			hidden
		>
			<span class="icon font-size-lg" aria-hidden="true">
				<span class="docon docon-chat-sparkle-fill gradient-ask-learn-logo"></span>
			</span>
		</button>
		<button
			class="button button-sm display-none display-inline-flex-tablet display-none-desktop flex-shrink-0 margin-right-xxs border-color-ask-learn "
			data-bi-name="ask-learn-assistant-entry"
			data-test-id="ask-learn-assistant-modal-entry-tablet"
			data-ask-learn-modal-entry
			type="button"
			style="min-width: max-content;"
			aria-expanded="false"
			hidden
		>
			<span class="icon font-size-lg" aria-hidden="true">
				<span class="docon docon-chat-sparkle-fill gradient-ask-learn-logo"></span>
			</span>
			<span>Ask Learn</span>
		</button>
		<button
			class="button button-sm display-none flex-shrink-0 display-inline-flex-desktop margin-right-xxs	border-color-ask-learn "
			data-bi-name="ask-learn-assistant-entry"
			data-test-id="ask-learn-assistant-flyout-entry"
			data-ask-learn-flyout-entry
			data-flyout-button="toggle"
			type="button"
			style="min-width: max-content;"
			aria-expanded="false"
			aria-controls="ask-learn-flyout"
			hidden
		>
			<span class="icon font-size-lg" aria-hidden="true">
				<span class="docon docon-chat-sparkle-fill gradient-ask-learn-logo"></span>
			</span>
			<span>Ask Learn</span>
		</button>
	 
		<button
			type="button"
			id="ms--focus-mode-button"
			data-focus-mode
			data-bi-name="focus-mode-entry"
			class="button button-sm flex-shrink-0 margin-right-xxs display-none display-inline-flex-desktop"
		>
			<span class="icon font-size-lg" aria-hidden="true">
				<span class="docon docon-glasses"></span>
			</span>
			<span>Focus mode</span>
		</button>
	 

			<details class="popover popover-right" id="article-header-page-actions-overflow">
				<summary
					class="justify-content-flex-start button button-clear button-sm button-primary inner-focus"
					aria-label="More actions"
					title="More actions"
				>
					<span class="icon" aria-hidden="true">
						<span class="docon docon-more-vertical"></span>
					</span>
				</summary>
				<div class="popover-content">
					
		<button
			data-page-action-item="overflow-mobile"
			type="button"
			class="button-block button-sm has-inner-focus button button-clear display-none-tablet justify-content-flex-start text-align-left"
			data-bi-name="contents-expand"
			data-contents-button
			data-popover-close
		>
			<span class="icon">
				<span class="docon docon-editor-list-bullet" aria-hidden="true"></span>
			</span>
			<span class="contents-expand-title">Table of contents</span>
		</button>
	 
		<a
			id="lang-link-overflow"
			class="button-sm has-inner-focus button button-clear button-block justify-content-flex-start text-align-left"
			data-bi-name="language-toggle"
			data-page-action-item="overflow-all"
			data-check-hidden="true"
			data-read-in-link
			href="#"
			hidden
		>
			<span class="icon" aria-hidden="true" data-read-in-link-icon>
				<span class="docon docon-locale-globe"></span>
			</span>
			<span data-read-in-link-text>Read in English</span>
		</a>
	 
		<button
			type="button"
			class="collection button button-clear button-sm button-block justify-content-flex-start text-align-left inner-focus"
			data-list-type="collection"
			data-bi-name="collection"
			data-page-action-item="overflow-all"
			data-check-hidden="true"
			data-popover-close
		>
			<span class="icon" aria-hidden="true">
				<span class="docon docon-circle-addition"></span>
			</span>
			<span class="collection-status">Add</span>
		</button>
	
					
		<button
			type="button"
			class="collection button button-block button-clear button-sm justify-content-flex-start text-align-left inner-focus"
			data-list-type="plan"
			data-bi-name="plan"
			data-page-action-item="overflow-all"
			data-check-hidden="true"
			data-popover-close
			hidden
		>
			<span class="icon" aria-hidden="true">
				<span class="docon docon-circle-addition"></span>
			</span>
			<span class="plan-status">Add to plan</span>
		</button>
	  
		<a
			data-contenteditbtn
			class="button button-clear button-block button-sm inner-focus justify-content-flex-start text-align-left text-decoration-none"
			data-bi-name="edit"
			
			href="https://github.com/dotnet/AspNetCore.Docs/blob/main/aspnetcore/host-and-deploy/linux-nginx.md"
			data-original_content_git_url="https://github.com/dotnet/AspNetCore.Docs/blob/live/aspnetcore/host-and-deploy/linux-nginx.md"
			data-original_content_git_url_template="{repo}/blob/{branch}/aspnetcore/host-and-deploy/linux-nginx.md"
			data-pr_repo=""
			data-pr_branch=""
		>
			<span class="icon" aria-hidden="true">
				<span class="docon docon-edit-outline"></span>
			</span>
			<span>Edit</span>
		</a>
	
					
		<hr class="margin-block-xxs" />
		<h4 class="font-size-sm padding-left-xxs">Share via</h4>
		
					<a
						class="button button-clear button-sm inner-focus button-block justify-content-flex-start text-align-left text-decoration-none share-facebook"
						data-bi-name="facebook"
						data-page-action-item="overflow-all"
						href="#"
					>
						<span class="icon color-primary" aria-hidden="true">
							<span class="docon docon-facebook-share"></span>
						</span>
						<span>Facebook</span>
					</a>

					<a
						href="#"
						class="button button-clear button-sm inner-focus button-block justify-content-flex-start text-align-left text-decoration-none share-twitter"
						data-bi-name="twitter"
						data-page-action-item="overflow-all"
					>
						<span class="icon color-text" aria-hidden="true">
							<span class="docon docon-xlogo-share"></span>
						</span>
						<span>x.com</span>
					</a>

					<a
						href="#"
						class="button button-clear button-sm inner-focus button-block justify-content-flex-start text-align-left text-decoration-none share-linkedin"
						data-bi-name="linkedin"
						data-page-action-item="overflow-all"
					>
						<span class="icon color-primary" aria-hidden="true">
							<span class="docon docon-linked-in-logo"></span>
						</span>
						<span>LinkedIn</span>
					</a>
					<a
						href="#"
						class="button button-clear button-sm inner-focus button-block justify-content-flex-start text-align-left text-decoration-none share-email"
						data-bi-name="email"
						data-page-action-item="overflow-all"
					>
						<span class="icon color-primary" aria-hidden="true">
							<span class="docon docon-mail-message"></span>
						</span>
						<span>Email</span>
					</a>
			  
	 
		<hr class="margin-block-xxs" />
		<button
			class="button button-block button-clear button-sm justify-content-flex-start text-align-left inner-focus"
			type="button"
			data-bi-name="print"
			data-page-action-item="overflow-all"
			data-popover-close
			data-print-page
			data-check-hidden="true"
		>
			<span class="icon color-primary" aria-hidden="true">
				<span class="docon docon-print"></span>
			</span>
			<span>Print</span>
		</button>
	
				</div>
			</details>
		</div>
	
			</div>
		</div>
	
					<!-- azure disclaimer -->
					
					<!-- privateUnauthorizedTemplate is hidden by default -->
					
		<div unauthorized-private-section data-bi-name="permission-content-unauthorized-private" hidden>
			<hr class="hr margin-top-xs margin-bottom-sm" />
			<div class="notification notification-info">
				<div class="notification-content">
					<p class="margin-top-none notification-title">
						<span class="icon">
							<span class="docon docon-exclamation-circle-solid" aria-hidden="true"></span>
						</span>
						<span>Note</span>
					</p>
					<p class="margin-top-none authentication-determined not-authenticated">
						Access to this page requires authorization. You can try <a class="docs-sign-in" href="#" data-bi-name="permission-content-sign-in">signing in</a> or <a  class="docs-change-directory" data-bi-name="permisson-content-change-directory">changing directories</a>.
					</p>
					<p class="margin-top-none authentication-determined authenticated">
						Access to this page requires authorization. You can try <a class="docs-change-directory" data-bi-name="permisson-content-change-directory">changing directories</a>.
					</p>
				</div>
			</div>
		</div>
	
					<div class="content"><h1 id="host-aspnet-core-on-linux-with-nginx">Host ASP.NET Core on Linux with Nginx</h1></div>
					
		<div
			id="article-metadata"
			class="page-metadata-container display-flex gap-xxs justify-content-space-between align-items-center flex-wrap-wrap"
		>
			
		<div class="margin-block-xxs">
			<ul class="metadata page-metadata" data-bi-name="page info" lang="en-us" dir="ltr">
				  <li class="visibility-hidden-visual-diff">
			<local-time
				format="twoDigitNumeric"
				datetime="2024-03-14T13:44:00.000Z"
				data-article-date-source="calculated"
				class="is-invisible"
			>
				2024-03-14
			</local-time>
		</li>  
			</ul>
		</div>
	 
				<div
					id="user-feedback"
					class="margin-block-xxs display-none display-none-print"
					hidden
					data-hide-on-archived
				>
					
		<button
			id="user-feedback-button"
			data-test-id="conceptual-feedback-button"
			class="button button-sm button-clear button-primary display-none"
			type="button"
			data-bi-name="user-feedback-button"
			data-user-feedback-button
			hidden
		>
			<span class="icon" aria-hidden="true">
				<span class="docon docon-like"></span>
			</span>
			<span>Feedback</span>
		</button>
	
				</div>
		  
		</div>
	 
		<nav
			id="center-doc-outline"
			class="doc-outline is-hidden-desktop display-none-print margin-bottom-sm"
			data-bi-name="intopic toc"
			aria-label="In this article"
		>
			<h2 id="ms--in-this-article" class="title is-6 margin-block-xs">
				In this article
			</h2>
		</nav>
	
					<div class="content"><p>By <a href="https://twitter.com/sshirhatti" data-linktype="external">Sourabh Shirhatti</a></p>
<div data-moniker="aspnetcore-3.1 aspnetcore-5.0 aspnetcore-6.0 aspnetcore-7.0 aspnetcore-8.0">
<div class="NOTE">
<p>Note</p>
<p>This isn't the latest version of this article. For the current release, see the <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/linux-nginx?view=aspnetcore-9.0&amp;preserve-view=true" data-linktype="relative-path">.NET 9 version of this article</a>.</p>
</div>
</div>
<div data-moniker="aspnetcore-3.1 aspnetcore-5.0 aspnetcore-7.0">
<div class="WARNING">
<p>Warning</p>
<p>This version of ASP.NET Core is no longer supported. For more information, see the <a href="https://dotnet.microsoft.com/platform/support/policy/dotnet-core" data-linktype="external">.NET and .NET Core Support Policy</a>. For the current release, see the <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/linux-nginx?view=aspnetcore-9.0&amp;preserve-view=true" data-linktype="relative-path">.NET 9 version of this article</a>.</p>
</div>
</div>
<div data-moniker="aspnetcore-10.0">
<div class="IMPORTANT">
<p>Important</p>
<p>This information relates to a pre-release product that may be substantially modified before it's commercially released. Microsoft makes no warranties, express or implied, with respect to the information provided here.</p>
<p>For the current release, see the <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/linux-nginx?view=aspnetcore-9.0&amp;preserve-view=true" data-linktype="relative-path">.NET 9 version of this article</a>.</p>
</div>
</div>
<!--
Include either this file or 'not-latest-version-without-not-supported-content.md' at the top 
of articles.

'not-latest-version.md' (this file): Includes not-supported content.
'not-latest-version-without-not-supported-content.md': Doesn't include not-supported content.

Use this file in articles that target >=7.0. For articles that target >=8.0 prior to 9.0
reaching EOL, 'not-latest-version-without-not-supported-content.md' must be used to avoid
a zone/file moniker range mismatch error.

When a new version is released, it might be necessary to temporarily comment out the current 
version moniker range section until the new moniker is created.

Markdown to include this file:

[!INCLUDE[](~/includes/not-latest-version.md)]
-->
<div data-moniker="aspnetcore-10.0 aspnetcore-6.0 aspnetcore-7.0 aspnetcore-8.0 aspnetcore-9.0">
<p>This guide explains setting up a production-ready ASP.NET Core environment for Ubuntu, Red Hat Enterprise (RHEL), and SUSE Linux Enterprise Server.</p>
<p>For information on other Linux distributions supported by ASP.NET Core, see <a href="https://learn.microsoft.com/en-us/dotnet/core/linux-prerequisites" data-linktype="absolute-path">Prerequisites for .NET on Linux</a>.</p>
<p>This guide:</p>
<ul>
<li>Places an existing ASP.NET Core app behind a reverse proxy server.</li>
<li>Sets up the reverse proxy server to forward requests to the Kestrel web server.</li>
<li>Ensures the web app runs on startup as a daemon.</li>
<li>Configures a process management tool to help restart the web app.</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<div class="tabGroup" id="tabgroup_1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_1_linux-ubuntu" role="tab" aria-controls="tabpanel_1_linux-ubuntu" data-tab="linux-ubuntu" tabindex="0" aria-selected="true" data-linktype="self-bookmark">Ubuntu</a>
</li>
<li role="presentation">
<a href="#tabpanel_1_linux-rhel" role="tab" aria-controls="tabpanel_1_linux-rhel" data-tab="linux-rhel" tabindex="-1" data-linktype="self-bookmark">Red Hat Enterprise Linux</a>
</li>
<li role="presentation">
<a href="#tabpanel_1_linux-sles" role="tab" aria-controls="tabpanel_1_linux-sles" data-tab="linux-sles" tabindex="-1" data-linktype="self-bookmark">SUSE Linux Enterprise Server</a>
</li>
</ul>
<section id="tabpanel_1_linux-ubuntu" role="tabpanel" data-tab="linux-ubuntu">

<ul>
<li>Access to Ubuntu 20.04 with a standard user account with sudo privilege.</li>
<li>The latest stable <a href="https://learn.microsoft.com/en-us/dotnet/core/install/linux" data-linktype="absolute-path">.NET runtime installed</a> on the server.</li>
<li>An existing ASP.NET Core app.</li>
</ul>
</section>
<section id="tabpanel_1_linux-rhel" role="tabpanel" data-tab="linux-rhel" aria-hidden="true" hidden="hidden">

<ul>
<li>Access to Red Hat Enterprise (RHEL) 8.0 or later with a standard user account with sudo privilege.</li>
<li>The latest stable <a href="https://learn.microsoft.com/en-us/dotnet/core/install/linux" data-linktype="absolute-path">.NET runtime installed</a> on the server.</li>
<li>An existing ASP.NET Core app.</li>
</ul>
</section>
<section id="tabpanel_1_linux-sles" role="tabpanel" data-tab="linux-sles" aria-hidden="true" hidden="hidden">

<ul>
<li>Access to SLES 12 or 15 with a standard user account with sudo privilege.</li>
<li>The latest stable <a href="https://learn.microsoft.com/en-us/dotnet/core/install/linux" data-linktype="absolute-path">.NET runtime installed</a> on the server.</li>
<li>An existing ASP.NET Core app.</li>
</ul>
</section>
</div>

<p>At any point in the future after upgrading the shared framework, restart the ASP.NET Core apps hosted by the server.</p>
<h2 id="publish-and-copy-over-the-app">Publish and copy over the app</h2>
<p>Configure the app for a <a href="https://learn.microsoft.com/en-us/dotnet/core/deploying/#framework-dependent-deployments-fdd" data-linktype="absolute-path">framework-dependent deployment</a>.</p>
<p>If the app is run locally in the <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-9.0#configure-services-and-middleware-by-environment" data-linktype="relative-path">Development environment</a> and isn't configured by the server to make secure HTTPS connections, adopt either of the following approaches:</p>
<ul>
<li><p>Configure the app to handle secure local connections. For more information, see the <a href="#https-configuration" data-linktype="self-bookmark">HTTPS configuration</a> section.</p>
</li>
<li><p>Configure the app to run at the insecure endpoint:</p>
<ul>
<li><p>Deactivate HTTPS Redirection Middleware in the Development environment (<code>Program.cs</code>):</p>
<pre><code class="lang-csharp">if (!app.Environment.IsDevelopment())
{
    app.UseHttpsRedirection();
}
</code></pre>
<p>For more information, see <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-9.0#configure-services-and-middleware-by-environment" data-linktype="relative-path">Use multiple environments in ASP.NET Core</a>.</p>
</li>
<li><p>Remove <code>https://localhost:5001</code> (if present) from the <code>applicationUrl</code> property in the <code>Properties/launchSettings.json</code> file.</p>
</li>
</ul>
</li>
</ul>
<p>For more information on configuration by environment, see <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-9.0" data-linktype="relative-path">Use multiple environments in ASP.NET Core</a>.</p>
<p>Run <a href="https://learn.microsoft.com/en-us/dotnet/core/tools/dotnet-publish" data-linktype="absolute-path">dotnet publish</a> from the development environment to package an app into a directory (for example, <code>bin/Release/{TARGET FRAMEWORK MONIKER}/publish</code>, where the <code>{TARGET FRAMEWORK MONIKER}</code> placeholder is the <a href="https://learn.microsoft.com/en-us/dotnet/standard/frameworks" data-linktype="absolute-path">Target Framework Moniker (TFM)</a>) that can run on the server:</p>
<pre><code class="lang-dotnetcli">dotnet publish --configuration Release
</code></pre>
<p>The app can also be published as a <a href="https://learn.microsoft.com/en-us/dotnet/core/deploying/#self-contained-deployments-scd" data-linktype="absolute-path">self-contained deployment</a> if you prefer not to maintain the .NET runtime on the server.</p>
<p>Copy the ASP.NET Core app to the server using a tool that integrates into the organization's workflow (for example, <code>SCP</code>, <code>SFTP</code>). It's common to locate web apps under the <code>var</code> directory (for example, <code>var/www/helloapp</code>).</p>
<div class="NOTE">
<p>Note</p>
<p>Under a production deployment scenario, a continuous integration workflow does the work of publishing the app and copying the assets to the server.</p>
</div>
<p>Test the app:</p>
<ol>
<li>From the command line, run the app: <code>dotnet &lt;app_assembly&gt;.dll</code>.</li>
<li>In a browser, navigate to <code>http://&lt;serveraddress&gt;:&lt;port&gt;</code> to verify the app works on Linux locally.</li>
</ol>
<h2 id="configure-a-reverse-proxy-server">Configure a reverse proxy server</h2>
<p>A reverse proxy is a common setup for serving dynamic web apps. A reverse proxy terminates the HTTP request and forwards it to the ASP.NET Core app.</p>
<h3 id="use-a-reverse-proxy-server">Use a reverse proxy server</h3>
<p>Kestrel is great for serving dynamic content from ASP.NET Core. However, the web serving capabilities aren't as feature rich as servers such as IIS, Apache, or Nginx. A reverse proxy server can offload work such as serving static content, caching requests, compressing requests, and HTTPS termination from the HTTP server. A reverse proxy server may reside on a dedicated machine or may be deployed alongside an HTTP server.</p>
<p>For the purposes of this guide, a single instance of Nginx is used. It runs on the same server, alongside the HTTP server. Based on requirements, a different setup may be chosen.</p>
<p>Because requests are forwarded by reverse proxy, use the <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/proxy-load-balancer?view=aspnetcore-9.0" data-linktype="relative-path">Forwarded Headers Middleware</a> from the <a href="https://www.nuget.org/packages/Microsoft.AspNetCore.HttpOverrides" data-linktype="external"><code>Microsoft.AspNetCore.HttpOverrides</code></a> package, which is automatically included in ASP.NET Core apps via the <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/metapackage-app?view=aspnetcore-9.0" data-linktype="relative-path">shared framework's <code>Microsoft.AspNetCore.App</code> metapackage</a>. The middleware updates the <code>Request.Scheme</code>, using the <code>X-Forwarded-Proto</code> header, so that redirect URIs and other security policies work correctly.</p>
<p>Forwarded Headers Middleware should run before other middleware. This ordering ensures that the middleware relying on forwarded headers information can consume the header values for processing. To run Forwarded Headers Middleware after diagnostics and error handling middleware, see <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/proxy-load-balancer?view=aspnetcore-9.0#fhmo" data-linktype="relative-path">Forwarded Headers Middleware order</a>.</p>
<p>Invoke the <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.forwardedheadersextensions.useforwardedheaders" class="no-loc" data-linktype="absolute-path">UseForwardedHeaders</a> method before calling other middleware. Configure the middleware to forward the <code>X-Forwarded-For</code> and <code>X-Forwarded-Proto</code> headers:</p>
<pre><code class="lang-csharp">using Microsoft.AspNetCore.HttpOverrides;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddAuthentication();

var app = builder.Build();

app.UseForwardedHeaders(new ForwardedHeadersOptions
{
    ForwardedHeaders = ForwardedHeaders.XForwardedFor | ForwardedHeaders.XForwardedProto
});

app.UseAuthentication();

app.MapGet("/", () =&gt; "Hello ForwardedHeadersOptions!");

app.Run();
</code></pre>
<p>If no <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.forwardedheadersoptions" class="no-loc" data-linktype="absolute-path">ForwardedHeadersOptions</a> are specified to the middleware, the default headers to forward are <code>None</code>.</p>
<p>Proxies running on loopback addresses (<code>127.0.0.0/8</code>, <code>[::1]</code>), including the standard localhost address (<code>127.0.0.1</code>), are trusted by default. If other trusted proxies or networks within the organization handle requests between the internet and the web server, add them to the list of <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.forwardedheadersoptions.knownproxies" class="no-loc" data-linktype="absolute-path">KnownProxies</a> or <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.forwardedheadersoptions.knownnetworks" class="no-loc" data-linktype="absolute-path">KnownNetworks</a> with <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.forwardedheadersoptions" class="no-loc" data-linktype="absolute-path">ForwardedHeadersOptions</a>. The following example adds a trusted proxy server at IP address <code>10.0.0.100</code> to the Forwarded Headers Middleware <code>KnownProxies</code>:</p>
<pre><code class="lang-csharp">using Microsoft.AspNetCore.HttpOverrides;
using System.Net;

var builder = WebApplication.CreateBuilder(args);

// Configure forwarded headers
builder.Services.Configure&lt;ForwardedHeadersOptions&gt;(options =&gt;
{
    options.KnownProxies.Add(IPAddress.Parse("10.0.0.100"));
});

builder.Services.AddAuthentication();

var app = builder.Build();

app.UseForwardedHeaders(new ForwardedHeadersOptions
{
    ForwardedHeaders = ForwardedHeaders.XForwardedFor | ForwardedHeaders.XForwardedProto
});

app.UseAuthentication();

app.MapGet("/", () =&gt; "10.0.0.100");

app.Run();
</code></pre>
<p>For more information, see <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/proxy-load-balancer?view=aspnetcore-9.0" data-linktype="relative-path">Configure ASP.NET Core to work with proxy servers and load balancers</a>.</p>
<h3 id="install-nginx">Install Nginx</h3>
<div class="tabGroup" id="tabgroup_2">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_2_linux-ubuntu" role="tab" aria-controls="tabpanel_2_linux-ubuntu" data-tab="linux-ubuntu" tabindex="0" aria-selected="true" data-linktype="self-bookmark">Ubuntu</a>
</li>
<li role="presentation">
<a href="#tabpanel_2_linux-rhel" role="tab" aria-controls="tabpanel_2_linux-rhel" data-tab="linux-rhel" tabindex="-1" data-linktype="self-bookmark">Red Hat Enterprise Linux</a>
</li>
<li role="presentation">
<a href="#tabpanel_2_linux-sles" role="tab" aria-controls="tabpanel_2_linux-sles" data-tab="linux-sles" tabindex="-1" data-linktype="self-bookmark">SUSE Linux Enterprise Server</a>
</li>
</ul>
<section id="tabpanel_2_linux-ubuntu" role="tabpanel" data-tab="linux-ubuntu">

<p>Use <code>apt-get</code> to install Nginx. The installer creates a <a href="https://systemd.io/" data-linktype="external"><code>systemd</code></a> init script that runs Nginx as daemon on system startup. Follow the installation instructions for Ubuntu at <a href="https://www.nginx.com/resources/wiki/start/topics/tutorials/install/#official-debian-ubuntu-packages" data-linktype="external">Nginx: Official Debian/Ubuntu packages</a>.</p>
</section>
<section id="tabpanel_2_linux-rhel" role="tabpanel" data-tab="linux-rhel" aria-hidden="true" hidden="hidden">

<p>Use <code>yum-utils</code> to select and install an Nginx module stream. Follow the installation instructions for RHEL at <a href="https://nginx.org/en/linux_packages.html#RHEL" data-linktype="external">Nginx: Linux packages - RHEL</a>.</p>
</section>
<section id="tabpanel_2_linux-sles" role="tabpanel" data-tab="linux-sles" aria-hidden="true" hidden="hidden">

<p>Use <code>yum-utils</code> to select and install an Nginx module stream. Follow the installation instructions for SLES at <a href="https://nginx.org/en/linux_packages.html#SLES" data-linktype="external">Nginx: Linux packages - SLES</a>.</p>
</section>
</div>

<div class="NOTE">
<p>Note</p>
<p>If optional Nginx modules are required, building Nginx from source might be required.</p>
</div>
<p>Since Nginx was installed for the first time, explicitly start it by running:</p>
<pre><code class="lang-bash">sudo service nginx start
</code></pre>
<p>Verify a browser displays the default landing page for Nginx. The landing page is reachable at <code>http://&lt;server_IP_address&gt;/index.nginx-debian.html</code>.</p>
<h3 id="configure-nginx">Configure Nginx</h3>
<div class="tabGroup" id="tabgroup_3">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_3_linux-ubuntu" role="tab" aria-controls="tabpanel_3_linux-ubuntu" data-tab="linux-ubuntu" tabindex="0" aria-selected="true" data-linktype="self-bookmark">Ubuntu</a>
</li>
<li role="presentation">
<a href="#tabpanel_3_linux-rhel" role="tab" aria-controls="tabpanel_3_linux-rhel" data-tab="linux-rhel" tabindex="-1" data-linktype="self-bookmark">Red Hat Enterprise Linux</a>
</li>
<li role="presentation">
<a href="#tabpanel_3_linux-sles" role="tab" aria-controls="tabpanel_3_linux-sles" data-tab="linux-sles" tabindex="-1" data-linktype="self-bookmark">SUSE Linux Enterprise Server</a>
</li>
</ul>
<section id="tabpanel_3_linux-ubuntu" role="tabpanel" data-tab="linux-ubuntu">

<p>To configure Nginx as a reverse proxy to forward HTTP requests to the ASP.NET Core app, modify <code>/etc/nginx/sites-available/default</code> and  recreate the symlink. After creating the <code>/etc/nginx/sites-available/default</code> file,  use the following command to create the symlink:</p>
<pre><code class="lang-bash">sudo ln -s /etc/nginx/sites-available/default /etc/nginx/sites-enabled/default
</code></pre>
<p>Open <code>/etc/nginx/sites-available/default</code> in a text editor, and replace the contents with the following snippet:</p>
</section>
<section id="tabpanel_3_linux-rhel" role="tabpanel" data-tab="linux-rhel" aria-hidden="true" hidden="hidden">

<p>To configure Nginx as a reverse proxy to forward HTTP requests to an ASP.NET Core app, modify <code>/etc/nginx.conf</code>. Update the <code>http{}</code> code block with the following snippet:</p>
</section>
<section id="tabpanel_3_linux-sles" role="tabpanel" data-tab="linux-sles" aria-hidden="true" hidden="hidden">

<p>To configure Nginx as a reverse proxy to forward HTTP requests to an ASP.NET Core app, modify <code>/etc/nginx.conf</code>. Update the <code>http{}</code> code block with the following snippet:</p>
</section>
</div>

<pre><code class="lang-text">map $http_connection $connection_upgrade {
  "~*Upgrade" $http_connection;
  default keep-alive;
}

server {
  listen        80;
  server_name   example.com *.example.com;
  location / {
      proxy_pass         http://127.0.0.1:5000/;
      proxy_http_version 1.1;
      proxy_set_header   Upgrade $http_upgrade;
      proxy_set_header   Connection $connection_upgrade;
      proxy_set_header   Host $host;
      proxy_cache_bypass $http_upgrade;
      proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header   X-Forwarded-Proto $scheme;
  }
}
</code></pre>
<p>If the app is a SignalR or Blazor Server app, see <a href="https://learn.microsoft.com/en-us/aspnet/core/signalr/scale?view=aspnetcore-9.0#linux-with-nginx" data-linktype="relative-path">ASP.NET Core SignalR production hosting and scaling</a> and <a href="https://learn.microsoft.com/en-us/aspnet/core/blazor/host-and-deploy/server/?view=aspnetcore-9.0#linux-with-nginx" data-linktype="relative-path">Host and deploy ASP.NET Core server-side Blazor apps</a> respectively for more information.</p>
<p>When no <code>server_name</code> matches, Nginx uses the default server. If no default server is defined, the first server in the configuration file is the default server. As a best practice, add a specific default server that returns a status code of 444 in your configuration file. A default server configuration example is:</p>
<pre><code class="lang-text">server {
    listen   80 default_server;
    # listen [::]:80 default_server deferred;
    return   444;
}
</code></pre>
<p>With the preceding configuration file and default server, Nginx accepts public traffic on port 80 with host header <code>example.com</code> or <code>*.example.com</code>. Requests not matching these hosts won't get forwarded to Kestrel. Nginx forwards the matching requests to Kestrel at <code>http://127.0.0.1:5000/</code>. For more information, see <a href="https://nginx.org/docs/http/request_processing.html" data-linktype="external">How nginx processes a request</a>. To change Kestrel's IP/port, see <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/servers/kestrel/endpoints?view=aspnetcore-9.0" data-linktype="relative-path">Kestrel: Endpoint configuration</a>.</p>
<div class="WARNING">
<p>Warning</p>
<p>Failure to specify a proper <a href="https://nginx.org/docs/http/server_names.html" data-linktype="external">server_name directive</a> exposes your app to security vulnerabilities. Subdomain wildcard binding (for example, <code>*.example.com</code>) doesn't pose this security risk if you control the entire parent domain (as opposed to <code>*.com</code>, which is vulnerable). For more information, see <a href="https://www.rfc-editor.org/rfc/rfc9110#field.host" data-linktype="external">RFC 9110: HTTP Semantics (Section 7.2: Host and :authority)</a>.</p>
</div>
<p>Once the Nginx configuration is established, run <code>sudo nginx -t</code> to verify the syntax of the configuration files. If the configuration file test is successful, force Nginx to pick up the changes by running <code>sudo nginx -s reload</code>.</p>
<p>To directly run the app on the server:</p>
<ol>
<li>Navigate to the app's directory.</li>
<li>Run the app: <code>dotnet &lt;app_assembly.dll&gt;</code>, where <code>app_assembly.dll</code> is the assembly file name of the app.</li>
</ol>
<div class="tabGroup" id="tabgroup_4">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_4_linux-ubuntu" role="tab" aria-controls="tabpanel_4_linux-ubuntu" data-tab="linux-ubuntu" tabindex="0" aria-selected="true" data-linktype="self-bookmark">Ubuntu</a>
</li>
<li role="presentation">
<a href="#tabpanel_4_linux-rhel" role="tab" aria-controls="tabpanel_4_linux-rhel" data-tab="linux-rhel" tabindex="-1" data-linktype="self-bookmark">Red Hat Enterprise Linux</a>
</li>
<li role="presentation">
<a href="#tabpanel_4_linux-sles" role="tab" aria-controls="tabpanel_4_linux-sles" data-tab="linux-sles" tabindex="-1" data-linktype="self-bookmark">SUSE Linux Enterprise Server</a>
</li>
</ul>
<section id="tabpanel_4_linux-ubuntu" role="tabpanel" data-tab="linux-ubuntu">

<p>If the app runs on the server but fails to respond over the internet, check the server's firewall and confirm port 80 is open. If using an Azure Ubuntu VM, add a Network Security Group (NSG) rule that enables inbound port 80 traffic. There's no need to enable an outbound port 80 rule, as the outbound traffic is automatically granted when the inbound rule is enabled.</p>
</section>
<section id="tabpanel_4_linux-rhel" role="tabpanel" data-tab="linux-rhel" aria-hidden="true" hidden="hidden">

<p>If the app runs on the server but fails to respond over the internet, check the server's firewall and confirm port 80 is open.</p>
</section>
<section id="tabpanel_4_linux-sles" role="tabpanel" data-tab="linux-sles" aria-hidden="true" hidden="hidden">

<p>If the app runs on the server but fails to respond over the internet, check the server's firewall and confirm port 80 is open.</p>
</section>
</div>

<p>When done testing the app, shut down the app with <kbd>Ctrl</kbd>+<kbd>C</kbd> in the command shell.</p>
<h3 id="increase-keepalive_requests">Increase keepalive_requests</h3>
<p><a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#keepalive_requests" data-linktype="external"><code>keepalive_requests</code></a> can be increased for <a href="https://www.nginx.com/blog/10-tips-for-10x-application-performance/#web-server-tuning" data-linktype="external">higher performance</a>, For more information, see <a href="https://github.com/dotnet/AspNetCore.Docs/issues/22141#issuecomment-1442435506" data-linktype="external">this GitHub issue</a>.</p>
<h2 id="monitor-the-app">Monitor the app</h2>
<p>The server is set up to forward requests made to <code>http://&lt;serveraddress&gt;:80</code> on to the ASP.NET Core app running on Kestrel at <code>http://127.0.0.1:5000</code>. However, Nginx isn't set up to manage the Kestrel process. <a href="https://systemd.io/" data-linktype="external"><code>systemd</code></a> can be used to create a service file to start and monitor the underlying web app. <code>systemd</code> is an init system that provides many powerful features for starting, stopping, and managing processes.</p>
<h3 id="create-the-service-file">Create the service file</h3>
<p>Create the service definition file:</p>
<pre><code class="lang-bash">sudo nano /etc/systemd/system/kestrel-helloapp.service
</code></pre>
<p>The following example is an <code>.ini</code> service file for the app:</p>
<pre><code class="lang-text">[Unit]
Description=Example .NET Web API App running on Linux

[Service]
WorkingDirectory=/var/www/helloapp
ExecStart=/usr/bin/dotnet /var/www/helloapp/helloapp.dll
Restart=always
# Restart service after 10 seconds if the dotnet service crashes:
RestartSec=10
KillSignal=SIGINT
SyslogIdentifier=dotnet-example
User=www-data
Environment=ASPNETCORE_ENVIRONMENT=Production
Environment=DOTNET_NOLOGO=true

[Install]
WantedBy=multi-user.target
</code></pre>
<p>In the preceding example, the user that manages the service is specified by the <code>User</code> option. The user (<code>www-data</code>) must exist and have proper ownership of the app's files.</p>
<p>Use <code>TimeoutStopSec</code> to configure the duration of time to wait for the app to shut down after it receives the initial interrupt signal. If the app doesn't shut down in this period, SIGKILL is issued to terminate the app. Provide the value as unitless seconds (for example, <code>150</code>), a time span value (for example, <code>2min 30s</code>), or <code>infinity</code> to disable the timeout. <code>TimeoutStopSec</code> defaults to the value of <code>DefaultTimeoutStopSec</code> in the manager configuration file (<code>systemd-system.conf</code>, <code>system.conf.d</code>, <code>systemd-user.conf</code>, <code>user.conf.d</code>). The default timeout for most distributions is 90 seconds.</p>
<pre><code class="lang-text"># The default value is 90 seconds for most distributions.
TimeoutStopSec=90
</code></pre>
<p>Linux has a case-sensitive file system. Setting <code>ASPNETCORE_ENVIRONMENT</code> to <code>Production</code> results in searching for the configuration file <code>appsettings.Production.json</code>, not <code>appsettings.production.json</code>.</p>
<p>Some values (for example, SQL connection strings) must be escaped for the configuration providers to read the environment variables. Use the following command to generate a properly escaped value for use in the configuration file:</p>
<pre><code class="lang-console">systemd-escape "&lt;value-to-escape&gt;"
</code></pre>
<p>Colon (<code>:</code>) separators aren't supported in environment variable names. Use a double underscore (<code>__</code>) in place of a colon. The <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/configuration/?view=aspnetcore-9.0#environment-variables" data-linktype="relative-path">Environment Variables configuration provider</a> converts double-underscores into colons when environment variables are read into configuration. In the following example, the connection string key <code>ConnectionStrings:DefaultConnection</code> is set into the service definition file as <code>ConnectionStrings__DefaultConnection</code>:</p>
<pre><code class="lang-console">Environment=ConnectionStrings__DefaultConnection={Connection String}
</code></pre>
<p>Save the file and enable the service.</p>
<pre><code class="lang-bash">sudo systemctl enable kestrel-helloapp.service
</code></pre>
<p>Start the service and verify that it's running.</p>
<pre><code class="lang-bash">sudo systemctl start kestrel-helloapp.service
sudo systemctl status kestrel-helloapp.service

◝ kestrel-helloapp.service - Example .NET Web API App running on Linux
    Loaded: loaded (/etc/systemd/system/kestrel-helloapp.service; enabled)
    Active: active (running) since Thu 2016-10-18 04:09:35 NZDT; 35s ago
Main PID: 9021 (dotnet)
    CGroup: /system.slice/kestrel-helloapp.service
            └─9021 /usr/local/bin/dotnet /var/www/helloapp/helloapp.dll
</code></pre>
<p>With the reverse proxy configured and Kestrel managed through <code>systemd</code>, the web app is fully configured and can be accessed from a browser on the local machine at <code>http://localhost</code>. It's also accessible from a remote machine, barring any firewall that might be blocking. Inspecting the response headers, the <code>Server</code> header shows the ASP.NET Core app being served by Kestrel.</p>
<pre><code class="lang-text">HTTP/1.1 200 OK
Date: Tue, 11 Oct 2016 16:22:23 GMT
Server: Kestrel
Keep-Alive: timeout=5, max=98
Connection: Keep-Alive
Transfer-Encoding: chunked
</code></pre>
<h3 id="view-logs">View logs</h3>
<p>Since the web app using Kestrel is managed using <a href="https://systemd.io/" data-linktype="external"><code>systemd</code></a>, all events and processes are logged to a centralized journal. However, this journal includes all entries for all services and processes managed by <code>systemd</code>. To view the <code>kestrel-helloapp.service</code>-specific items, use the following command:</p>
<pre><code class="lang-bash">sudo journalctl -fu kestrel-helloapp.service
</code></pre>
<p>For further filtering, time options such as <code>--since today</code>, <code>--until 1 hour ago</code>, or a combination of these can reduce the number of entries returned.</p>
<pre><code class="lang-bash">sudo journalctl -fu kestrel-helloapp.service --since "2016-10-18" --until "2016-10-18 04:00"
</code></pre>
<h2 id="data-protection">Data protection</h2>
<p>The <a href="../security/data-protection/introduction553c.html?view=aspnetcore-9.0" data-linktype="relative-path">ASP.NET Core Data Protection stack</a> is used by several ASP.NET Core <a href="../fundamentals/middleware/index553c.html?view=aspnetcore-9.0" data-linktype="relative-path">middlewares</a>, including authentication middleware (for example, cookie middleware) and cross-site request forgery (CSRF) protections. Even if Data Protection APIs aren't called by user code, data protection should be configured to create a persistent cryptographic <a href="https://learn.microsoft.com/en-us/aspnet/core/security/data-protection/implementation/key-management?view=aspnetcore-9.0" data-linktype="relative-path">key store</a>. If data protection isn't configured, the keys are held in memory and discarded when the app restarts.</p>
<p>If the key ring is stored in memory when the app restarts:</p>
<ul>
<li>All cookie-based authentication tokens are invalidated.</li>
<li>Users are required to sign in again on their next request.</li>
<li>Any data protected with the key ring can no longer be decrypted. This may include <a href="https://learn.microsoft.com/en-us/aspnet/core/security/anti-request-forgery?view=aspnetcore-9.0#aspnet-core-antiforgery-configuration" data-linktype="relative-path">CSRF tokens</a> and <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/app-state?view=aspnetcore-9.0#tempdata" data-linktype="relative-path">ASP.NET Core MVC TempData cookies</a>.</li>
</ul>
<p>To configure data protection to persist and encrypt the key ring, see:</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/security/data-protection/implementation/key-storage-providers?view=aspnetcore-9.0" data-linktype="relative-path">Key storage providers in ASP.NET Core</a></li>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/security/data-protection/implementation/key-encryption-at-rest?view=aspnetcore-9.0" data-linktype="relative-path">Key encryption at rest in Windows and Azure using ASP.NET Core</a></li>
</ul>
<h2 id="long-request-header-fields">Long request header fields</h2>
<p>Proxy server default settings typically limit request header fields to 4 K or 8 K depending on the platform. An app may require fields longer than the default (for example, apps that use <a href="https://azure.microsoft.com/services/active-directory/" data-linktype="external">Microsoft Entra ID</a>). If longer fields are required, the proxy server's default settings require adjustment. The values to apply depend on the scenario. For more information, see your server's documentation.</p>
<ul>
<li><a href="https://nginx.org/docs/http/ngx_http_proxy_module.html#proxy_buffer_size" data-linktype="external">proxy_buffer_size</a></li>
<li><a href="https://nginx.org/docs/http/ngx_http_proxy_module.html#proxy_buffers" data-linktype="external">proxy_buffers</a></li>
<li><a href="https://nginx.org/docs/http/ngx_http_proxy_module.html#proxy_busy_buffers_size" data-linktype="external">proxy_busy_buffers_size</a></li>
<li><a href="https://nginx.org/docs/http/ngx_http_core_module.html#large_client_header_buffers" data-linktype="external">large_client_header_buffers</a></li>
</ul>
<div class="WARNING">
<p>Warning</p>
<p>Don't increase the default values of proxy buffers unless necessary. Increasing these values increases the risk of buffer overrun (overflow) and Denial of Service (DoS) attacks by malicious users.</p>
</div>
<h2 id="secure-the-app">Secure the app</h2>
<h3 id="enable-apparmor">Enable AppArmor</h3>
<p>Linux Security Modules (LSM) is a framework that's part of the Linux kernel since Linux 2.6. LSM supports different implementations of security modules. <a href="https://wiki.ubuntu.com/AppArmor" data-linktype="external">AppArmor</a> is an LSM that implements a Mandatory Access Control system, which allows confining the program to a limited set of resources. Ensure AppArmor is enabled and properly configured.</p>
<h3 id="configure-the-firewall">Configure the firewall</h3>
<p>Close off all external ports that aren't in use. Uncomplicated firewall (ufw) provides a front end for <code>iptables</code> by providing a CLI for configuring the firewall.</p>
<div class="tabGroup" id="tabgroup_5">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_5_linux-ubuntu" role="tab" aria-controls="tabpanel_5_linux-ubuntu" data-tab="linux-ubuntu" tabindex="0" aria-selected="true" data-linktype="self-bookmark">Ubuntu</a>
</li>
<li role="presentation">
<a href="#tabpanel_5_linux-rhel" role="tab" aria-controls="tabpanel_5_linux-rhel" data-tab="linux-rhel" tabindex="-1" data-linktype="self-bookmark">Red Hat Enterprise Linux</a>
</li>
<li role="presentation">
<a href="#tabpanel_5_linux-sles" role="tab" aria-controls="tabpanel_5_linux-sles" data-tab="linux-sles" tabindex="-1" data-linktype="self-bookmark">SUSE Linux Enterprise Server</a>
</li>
</ul>
<section id="tabpanel_5_linux-ubuntu" role="tabpanel" data-tab="linux-ubuntu">

<div class="WARNING">
<p>Warning</p>
<p>A firewall prevents access to the whole system if not configured correctly. Failure to specify the correct SSH port effectively locks you out of the system if you are using SSH to connect to it. The default port is 22. For more information, see the <a href="https://help.ubuntu.com/community/UFW" data-linktype="external">introduction to ufw</a> and the <a href="https://manpages.ubuntu.com/manpages/lunar/en/man8/ufw.8.html" data-linktype="external">manual</a>.</p>
</div>
<p>Install <code>ufw</code> and configure it to allow traffic on any ports needed.</p>
<pre><code class="lang-bash">sudo apt-get install ufw

sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

sudo ufw enable
</code></pre>
</section>
<section id="tabpanel_5_linux-rhel" role="tabpanel" data-tab="linux-rhel" aria-hidden="true" hidden="hidden">

<div class="WARNING">
<p>Warning</p>
<p>A firewall prevents access to the whole system if not configured correctly. Failure to specify the correct SSH port effectively locks you out of the system if you are using SSH to connect to it. The default port is 22. For more information, see the <a href="https://help.ubuntu.com/community/UFW" data-linktype="external">introduction to ufw</a>.</p>
</div>
<p>Install <code>ufw</code> and configure it to allow traffic on any ports needed.</p>
<pre><code class="lang-bash">sudo yum -y install ufw

sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

sudo ufw enable
</code></pre>
</section>
<section id="tabpanel_5_linux-sles" role="tabpanel" data-tab="linux-sles" aria-hidden="true" hidden="hidden">

<div class="WARNING">
<p>Warning</p>
<p>A firewall prevents access to the whole system if not configured correctly. Failure to specify the correct SSH port effectively locks you out of the system if you are using SSH to connect to it. The default port is 22. For more information, see the <a href="https://help.ubuntu.com/community/UFW" data-linktype="external">introduction to ufw</a>.</p>
</div>
<p>Install <code>ufw</code> and configure it to allow traffic on any ports needed.</p>
<pre><code class="lang-bash">sudo yum -y install ufw

sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

sudo ufw enable
</code></pre>
</section>
</div>
<h3 id="secure-nginx">Secure Nginx</h3>
<h4 id="change-the-nginx-response-name">Change the Nginx response name</h4>
<p>Edit <code>src/http/ngx_http_header_filter_module.c</code>:</p>
<pre><code class="lang-c">static char ngx_http_server_string[] = "Server: Web Server" CRLF;
static char ngx_http_server_full_string[] = "Server: Web Server" CRLF;
</code></pre>
<h4 id="configure-options">Configure options</h4>
<p>Configure the server with additional required modules. Consider using a web app firewall, such as <a href="https://www.modsecurity.org/" data-linktype="external">ModSecurity</a>, to harden the app.</p>
<h4 id="https-configuration">HTTPS configuration</h4>
<p><strong>Configure the app for secure (HTTPS) local connections</strong></p>
<p>The <a href="https://learn.microsoft.com/en-us/dotnet/core/tools/dotnet-run" data-linktype="absolute-path">dotnet run</a> command uses the app's <code>Properties/launchSettings.json</code> file, which configures the app to listen on the URLs provided by the <code>applicationUrl</code> property. For example, <code>https://localhost:5001;http://localhost:5000</code>.</p>
<p>Configure the app to use a certificate in development for the <code>dotnet run</code> command or development environment (<kbd>F5</kbd> or <kbd>Ctrl</kbd>+<kbd>F5</kbd> in Visual Studio Code) using one of the following approaches:</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/servers/kestrel/endpoints?view=aspnetcore-9.0#configuration" data-linktype="relative-path">Replace the default certificate from configuration</a> (<em>Recommended</em>)</li>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/servers/kestrel/endpoints?view=aspnetcore-9.0#configurehttpsdefaultsactionhttpsconnectionadapteroptions" data-linktype="relative-path">KestrelServerOptions.ConfigureHttpsDefaults</a></li>
</ul>
<p><strong>Configure the reverse proxy for secure (HTTPS) client connections</strong></p>
<div class="WARNING">
<p>Warning</p>
<p>The security configuration in this section is a general configuration to be used as a starting point for further customization. We're unable to provide support for third-party tooling, servers, and operating systems. <em>Use the configuration in this section at your own risk.</em> For more information, access the following resources:</p>
<ul>
<li><a href="http://nginx.org/docs/http/configuring_https_servers.html" data-linktype="external">Configuring HTTPS servers</a> (Nginx documentation)</li>
<li><a href="https://ssl-config.mozilla.org/#server=nginx" data-linktype="external">mozilla.org SSL Configuration Generator</a></li>
</ul>
</div>
<ul>
<li><p>Configure the server to listen to HTTPS traffic on port 443 by specifying a valid certificate issued by a trusted Certificate Authority (CA).</p>
</li>
<li><p>Harden the security by employing some of the practices depicted in the following <em>/etc/nginx/nginx.conf</em> file.</p>
</li>
<li><p>The following example doesn't configure the server to redirect insecure requests. We recommend using HTTPS Redirection Middleware. For more information, see <a href="../security/enforcing-ssl553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Enforce HTTPS in ASP.NET Core</a>.</p>
<div class="NOTE">
<p>Note</p>
<p>For development environments where the server configuration handles secure redirection instead of HTTPS Redirection Middleware, we recommend using temporary redirects (302) rather than permanent redirects (301). Link caching can cause unstable behavior in development environments.</p>
</div>
</li>
<li><p>Adding a <code>Strict-Transport-Security</code> (HSTS) header ensures all subsequent requests made by the client are over HTTPS. For guidance on setting the <code>Strict-Transport-Security</code> header, see <a href="../security/enforcing-ssl553c.html?view=aspnetcore-9.0#http-strict-transport-security-protocol-hsts" data-linktype="relative-path">Enforce HTTPS in ASP.NET Core</a>.</p>
</li>
<li><p>If HTTPS will be disabled in the future, use one of the following approaches:</p>
<ul>
<li>Don't add the HSTS header.</li>
<li>Choose a short <code>max-age</code> value.</li>
</ul>
</li>
</ul>
<p>Add the <em>/etc/nginx/proxy.conf</em> configuration file:</p>
<pre><code class="lang-nginx">proxy_redirect          off;
proxy_set_header        Host $host;
proxy_set_header        X-Real-IP $remote_addr;
proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header        X-Forwarded-Proto $scheme;
client_max_body_size    10m;
client_body_buffer_size 128k;
proxy_connect_timeout   90;
proxy_send_timeout      90;
proxy_read_timeout      90;
proxy_buffers           32 4k;
</code></pre><div class="tabGroup" id="tabgroup_6">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_6_linux-ubuntu" role="tab" aria-controls="tabpanel_6_linux-ubuntu" data-tab="linux-ubuntu" tabindex="0" aria-selected="true" data-linktype="self-bookmark">Ubuntu</a>
</li>
<li role="presentation">
<a href="#tabpanel_6_linux-rhel" role="tab" aria-controls="tabpanel_6_linux-rhel" data-tab="linux-rhel" tabindex="-1" data-linktype="self-bookmark">Red Hat Enterprise Linux</a>
</li>
<li role="presentation">
<a href="#tabpanel_6_linux-sles" role="tab" aria-controls="tabpanel_6_linux-sles" data-tab="linux-sles" tabindex="-1" data-linktype="self-bookmark">SUSE Linux Enterprise Server</a>
</li>
</ul>
<section id="tabpanel_6_linux-ubuntu" role="tabpanel" data-tab="linux-ubuntu">

<p><strong>Replace</strong> the contents of the <em>/etc/nginx/nginx.conf</em> configuration file with the following file. The example contains both <code>http</code> and <code>server</code> sections in one configuration file.</p>
</section>
<section id="tabpanel_6_linux-rhel" role="tabpanel" data-tab="linux-rhel" aria-hidden="true" hidden="hidden">

<p>Modify <code>/etc/nginx/nginx.conf</code>. Open it in a text editor, and replace the <code>http{}</code> and <code>server{}</code> code blocks with contents with the following snippet:</p>
</section>
<section id="tabpanel_6_linux-sles" role="tabpanel" data-tab="linux-sles" aria-hidden="true" hidden="hidden">

<p>Modify <code>/etc/nginx/nginx.conf</code>. Open it in a text editor, and replace the <code>http{}</code> and <code>server{}</code> code blocks with contents with the following snippet:</p>
</section>
</div>
<pre><code class="lang-nginx">http {
    include        /etc/nginx/proxy.conf;
    limit_req_zone $binary_remote_addr zone=one:10m rate=5r/s;
    server_tokens  off;

    sendfile on;
    # Adjust keepalive_timeout to the lowest possible value that makes sense 
    # for your use case.
    keepalive_timeout   29;
    client_body_timeout 10; client_header_timeout 10; send_timeout 10;

    upstream helloapp{
        server 127.0.0.1:5000;
    }

    server {
        listen                    443 ssl http2;
        listen                    [::]:443 ssl http2;
        server_name               example.com *.example.com;
        ssl_certificate           /etc/ssl/certs/testCert.crt;
        ssl_certificate_key       /etc/ssl/certs/testCert.key;
        ssl_session_timeout       1d;
        ssl_protocols             TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers off;
        ssl_ciphers               ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_session_cache         shared:SSL:10m;
        ssl_session_tickets       off;
        ssl_stapling              off;

        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;

        #Redirects all traffic
        location / {
            proxy_pass http://helloapp;
            limit_req  zone=one burst=10 nodelay;
        }
    }
}
</code></pre>
<div class="NOTE">
<p>Note</p>
<p>Blazor WebAssembly apps require a larger <code>burst</code> parameter value to accommodate the larger number of requests made by an app. For more information, see <a href="https://learn.microsoft.com/en-us/aspnet/core/blazor/host-and-deploy/webassembly/nginx?view=aspnetcore-9.0" data-linktype="relative-path">Host and deploy ASP.NET Core Blazor WebAssembly with Nginx</a>.</p>
</div>
<div class="NOTE">
<p>Note</p>
<p>The preceding example disables Online Certificate Status Protocol (OCSP) Stapling. If enabled, confirm that the certificate supports the feature. For more information and guidance on enabling OCSP, see the following properties in the <a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html" data-linktype="external">Module ngx_http_ssl_module (Nginx documentation)</a> article:</p>
<ul>
<li><code>ssl_stapling</code></li>
<li><code>ssl_stapling_file</code></li>
<li><code>ssl_stapling_responder</code></li>
<li><code>ssl_stapling_verify</code></li>
</ul>
</div>
<h4 id="secure-nginx-from-clickjacking">Secure Nginx from clickjacking</h4>
<p><a href="https://blog.qualys.com/securitylabs/2015/10/20/clickjacking-a-common-implementation-mistake-that-can-put-your-websites-in-danger" data-linktype="external">Clickjacking</a>, also known as a <em>UI redress attack</em>, is a malicious attack where a website visitor is tricked into clicking a link or button on a different page than they're currently visiting. Use <code>X-FRAME-OPTIONS</code> to secure the site.</p>
<p>To mitigate clickjacking attacks:</p>
<ol>
<li><p>Edit the <em>nginx.conf</em> file:</p>
<pre><code class="lang-bash">sudo nano /etc/nginx/nginx.conf
</code></pre>
<p>Within the <code>http{}</code> code block, add the line: <code>add_header X-Frame-Options "SAMEORIGIN";</code></p>
</li>
<li><p>Save the file.</p>
</li>
<li><p>Restart Nginx.</p>
</li>
</ol>
<h4 id="mime-type-sniffing">MIME-type sniffing</h4>
<p>This header prevents most browsers from MIME-sniffing a response away from the declared content type, as the header instructs the browser not to override the response content type. With the <code>nosniff</code> option, if the server says the content is <code>text/html</code>, the browser renders it as <code>text/html</code>.</p>
<ol>
<li><p>Edit the <em>nginx.conf</em> file:</p>
<pre><code class="lang-bash">sudo nano /etc/nginx/nginx.conf
</code></pre>
<p>Within the <code>http{}</code> code block, add the line: <code>add_header X-Content-Type-Options "nosniff";</code></p>
</li>
<li><p>Save the file.</p>
</li>
<li><p>Restart Nginx.</p>
</li>
</ol>
<h2 id="additional-nginx-suggestions">Additional Nginx suggestions</h2>
<p>After upgrading the shared framework on the server, restart the ASP.NET Core apps hosted by the server.</p>
<h2 id="additional-resources">Additional resources</h2>
<ul>
<li><a href="https://learn.microsoft.com/en-us/dotnet/core/linux-prerequisites" data-linktype="absolute-path">Prerequisites for .NET on Linux</a></li>
<li><a href="https://www.nginx.com/resources/wiki/start/topics/tutorials/install/#official-debian-ubuntu-packages" data-linktype="external">Nginx: Binary Releases: Official Debian/Ubuntu packages</a></li>
<li><a href="../test/troubleshoot553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Troubleshoot and debug ASP.NET Core projects</a></li>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/proxy-load-balancer?view=aspnetcore-9.0" data-linktype="relative-path">Configure ASP.NET Core to work with proxy servers and load balancers</a></li>
<li><a href="https://www.nginx.com/resources/wiki/start/topics/examples/forwarded/" data-linktype="external">NGINX: Using the Forwarded header</a></li>
</ul>
</div>
<div data-moniker="aspnetcore-5.0">
<p>This guide explains setting up a production-ready ASP.NET Core environment on an Ubuntu 16.04 server. These instructions likely work with newer versions of Ubuntu, but the instructions haven't been tested with newer versions.</p>
<p>For information on other Linux distributions supported by ASP.NET Core, see <a href="https://learn.microsoft.com/en-us/dotnet/core/linux-prerequisites" data-linktype="absolute-path">Prerequisites for .NET Core on Linux</a>.</p>
<div class="NOTE">
<p>Note</p>
<p>For Ubuntu 14.04, <code>supervisord</code> is recommended as a solution for monitoring the Kestrel process. <code>systemd</code> isn't available on Ubuntu 14.04. For Ubuntu 14.04 instructions, see the <a href="https://github.com/dotnet/AspNetCore.Docs/blob/e9c1419175c4dd7e152df3746ba1df5935aaafd5/aspnetcore/publishing/linuxproduction.md" data-linktype="external">previous version of this topic</a>.</p>
</div>
<p>This guide:</p>
<ul>
<li>Places an existing ASP.NET Core app behind a reverse proxy server.</li>
<li>Sets up the reverse proxy server to forward requests to the Kestrel web server.</li>
<li>Ensures the web app runs on startup as a daemon.</li>
<li>Configures a process management tool to help restart the web app.</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Access to an Ubuntu 16.04 server with a standard user account with sudo privilege.</li>
<li>The latest non-preview <a href="https://learn.microsoft.com/en-us/dotnet/core/install/linux" data-linktype="absolute-path">.NET runtime installed</a> on the server.</li>
<li>An existing ASP.NET Core app.</li>
</ul>
<p>At any point in the future after upgrading the shared framework, restart the ASP.NET Core apps hosted by the server.</p>
<h2 id="publish-and-copy-over-the-app">Publish and copy over the app</h2>
<p>Configure the app for a <a href="https://learn.microsoft.com/en-us/dotnet/core/deploying/#framework-dependent-deployments-fdd" data-linktype="absolute-path">framework-dependent deployment</a>.</p>
<p>If the app is run locally in the <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-9.0#configure-services-and-middleware-by-environment" data-linktype="relative-path">Development environment</a> and isn't configured by the server to make secure HTTPS connections, adopt either of the following approaches:</p>
<ul>
<li><p>Configure the app to handle secure local connections. For more information, see the <a href="#https-configuration" data-linktype="self-bookmark">HTTPS configuration</a> section.</p>
</li>
<li><p>Configure the app to run at the insecure endpoint:</p>
<ul>
<li><p>Deactivate HTTPS Redirection Middleware in the Development environment (<code>Program.cs</code>):</p>
<pre><code class="lang-csharp">if (!app.Environment.IsDevelopment())
{
    app.UseHttpsRedirection();
}
</code></pre>
<p>For more information, see <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-9.0#configure-services-and-middleware-by-environment" data-linktype="relative-path">Use multiple environments in ASP.NET Core</a>.</p>
</li>
<li><p>Remove <code>https://localhost:5001</code> (if present) from the <code>applicationUrl</code> property in the <code>Properties/launchSettings.json</code> file.</p>
</li>
</ul>
</li>
</ul>
<p>For more information on configuration by environment, see <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-9.0" data-linktype="relative-path">Use multiple environments in ASP.NET Core</a>.</p>
<p>Run <a href="https://learn.microsoft.com/en-us/dotnet/core/tools/dotnet-publish" data-linktype="absolute-path">dotnet publish</a> from the development environment to package an app into a directory (for example, <code>bin/Release/{TARGET FRAMEWORK MONIKER}/publish</code>, where the placeholder <code>{TARGET FRAMEWORK MONIKER}</code> is the Target Framework Moniker/TFM) that can run on the server:</p>
<pre><code class="lang-dotnetcli">dotnet publish --configuration Release
</code></pre>
<p>The app can also be published as a <a href="https://learn.microsoft.com/en-us/dotnet/core/deploying/#self-contained-deployments-scd" data-linktype="absolute-path">self-contained deployment</a> if you prefer not to maintain the .NET Core runtime on the server.</p>
<p>Copy the ASP.NET Core app to the server using a tool that integrates into the organization's workflow (for example, <code>SCP</code>, <code>SFTP</code>). It's common to locate web apps under the <code>var</code> directory (for example, <code>var/www/helloapp</code>).</p>
<div class="NOTE">
<p>Note</p>
<p>Under a production deployment scenario, a continuous integration workflow does the work of publishing the app and copying the assets to the server.</p>
</div>
<p>Test the app:</p>
<ol>
<li>From the command line, run the app: <code>dotnet &lt;app_assembly&gt;.dll</code>.</li>
<li>In a browser, navigate to <code>http://&lt;serveraddress&gt;:&lt;port&gt;</code> to verify the app works on Linux locally.</li>
</ol>
<h2 id="configure-a-reverse-proxy-server">Configure a reverse proxy server</h2>
<p>A reverse proxy is a common setup for serving dynamic web apps. A reverse proxy terminates the HTTP request and forwards it to the ASP.NET Core app.</p>
<h3 id="use-a-reverse-proxy-server">Use a reverse proxy server</h3>
<p>Kestrel is great for serving dynamic content from ASP.NET Core. However, the web serving capabilities aren't as feature rich as servers such as IIS, Apache, or Nginx. A reverse proxy server can offload work such as serving static content, caching requests, compressing requests, and HTTPS termination from the HTTP server. A reverse proxy server may reside on a dedicated machine or may be deployed alongside an HTTP server.</p>
<p>For the purposes of this guide, a single instance of Nginx is used. It runs on the same server, alongside the HTTP server. Based on requirements, a different setup may be chosen.</p>
<p>Because requests are forwarded by reverse proxy, use the <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/proxy-load-balancer?view=aspnetcore-9.0" data-linktype="relative-path">Forwarded Headers Middleware</a> from the <a href="https://www.nuget.org/packages/Microsoft.AspNetCore.HttpOverrides" data-linktype="external"><code>Microsoft.AspNetCore.HttpOverrides</code></a> package. The middleware updates the <code>Request.Scheme</code>, using the <code>X-Forwarded-Proto</code> header, so that redirect URIs and other security policies work correctly.</p>
<p>Forwarded Headers Middleware should run before other middleware. This ordering ensures that the middleware relying on forwarded headers information can consume the header values for processing. To run Forwarded Headers Middleware after diagnostics and error handling middleware, see <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/proxy-load-balancer?view=aspnetcore-9.0#fhmo" data-linktype="relative-path">Forwarded Headers Middleware order</a>.</p>
<p>Invoke the <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.forwardedheadersextensions.useforwardedheaders" class="no-loc" data-linktype="absolute-path">UseForwardedHeaders</a> method at the top of <code>Program.cs</code> before calling other middleware. Configure the middleware to forward the <code>X-Forwarded-For</code> and <code>X-Forwarded-Proto</code> headers:</p>
<pre><code class="lang-csharp">// requires using Microsoft.AspNetCore.HttpOverrides;
app.UseForwardedHeaders(new ForwardedHeadersOptions
{
    ForwardedHeaders = ForwardedHeaders.XForwardedFor | ForwardedHeaders.XForwardedProto
});

app.UseAuthentication();
</code></pre>
<p>If no <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.forwardedheadersoptions" class="no-loc" data-linktype="absolute-path">ForwardedHeadersOptions</a> are specified to the middleware, the default headers to forward are <code>None</code>.</p>
<p>Proxies running on loopback addresses (<code>127.0.0.0/8</code>, <code>[::1]</code>), including the standard localhost address (<code>127.0.0.1</code>), are trusted by default. If other trusted proxies or networks within the organization handle requests between the Internet and the web server, add them to the list of <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.forwardedheadersoptions.knownproxies" class="no-loc" data-linktype="absolute-path">KnownProxies</a> or <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.forwardedheadersoptions.knownnetworks" class="no-loc" data-linktype="absolute-path">KnownNetworks</a> with <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.forwardedheadersoptions" class="no-loc" data-linktype="absolute-path">ForwardedHeadersOptions</a>. The following example adds a trusted proxy server at IP address 10.0.0.100 to the Forwarded Headers Middleware <code>KnownProxies</code> in <code>Program.cs</code>:</p>
<pre><code class="lang-csharp">using System.Net;

var builder = WebApplication.CreateBuilder(args);

builder.Services.Configure&lt;ForwardedHeadersOptions&gt;(options =&gt;
{
    options.KnownProxies.Add(IPAddress.Parse("10.0.0.100"));
});
</code></pre>
<p>For more information, see <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/proxy-load-balancer?view=aspnetcore-9.0" data-linktype="relative-path">Configure ASP.NET Core to work with proxy servers and load balancers</a>.</p>
<h3 id="install-nginx">Install Nginx</h3>
<p>Use <code>apt-get</code> to install Nginx. The installer creates a <code>systemd</code> init script that runs Nginx as daemon on system startup. Follow the installation instructions for Ubuntu at <a href="https://www.nginx.com/resources/wiki/start/topics/tutorials/install/#official-debian-ubuntu-packages" data-linktype="external">Nginx: Official Debian/Ubuntu packages</a>.</p>
<div class="NOTE">
<p>Note</p>
<p>If optional Nginx modules are required, building Nginx from source might be required.</p>
</div>
<p>Since Nginx was installed for the first time, explicitly start it by running:</p>
<pre><code class="lang-bash">sudo service nginx start
</code></pre>
<p>Verify a browser displays the default landing page for Nginx. The landing page is reachable at <code>http://&lt;server_IP_address&gt;/index.nginx-debian.html</code>.</p>
<h3 id="configure-nginx">Configure Nginx</h3>
<p>To configure Nginx as a reverse proxy to forward HTTP requests to your ASP.NET Core app, modify <code>/etc/nginx/sites-available/default</code>. Open it in a text editor, and replace the contents with the following snippet:</p>
<pre><code class="lang-nginx">server {
    listen        80;
    server_name   example.com *.example.com;
    location / {
        proxy_pass         http://127.0.0.1:5000;
        proxy_http_version 1.1;
        proxy_set_header   Upgrade $http_upgrade;
        proxy_set_header   Connection keep-alive;
        proxy_set_header   Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto $scheme;
    }
}
</code></pre>
<p>If the app is a SignalR or Blazor Server app, see <a href="https://learn.microsoft.com/en-us/aspnet/core/signalr/scale?view=aspnetcore-9.0#linux-with-nginx" data-linktype="relative-path">ASP.NET Core SignalR production hosting and scaling</a> and <a href="https://learn.microsoft.com/en-us/aspnet/core/blazor/host-and-deploy/server/?view=aspnetcore-9.0#linux-with-nginx" data-linktype="relative-path">Host and deploy ASP.NET Core server-side Blazor apps</a> respectively for more information.</p>
<p>When no <code>server_name</code> matches, Nginx uses the default server. If no default server is defined, the first server in the configuration file is the default server. As a best practice, add a specific default server that returns a status code of 444 in your configuration file. A default server configuration example is:</p>
<pre><code class="lang-nginx">server {
    listen   80 default_server;
    # listen [::]:80 default_server deferred;
    return   444;
}
</code></pre>
<p>With the preceding configuration file and default server, Nginx accepts public traffic on port 80 with host header <code>example.com</code> or <code>*.example.com</code>. Requests not matching these hosts won't get forwarded to Kestrel. Nginx forwards the matching requests to Kestrel at <code>http://127.0.0.1:5000</code>. For more information, see <a href="https://nginx.org/docs/http/request_processing.html" data-linktype="external">How nginx processes a request</a>. To change Kestrel's IP/port, see <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/servers/kestrel/endpoints?view=aspnetcore-9.0" data-linktype="relative-path">Kestrel: Endpoint configuration</a>.</p>
<div class="WARNING">
<p>Warning</p>
<p>Failure to specify a proper <a href="https://nginx.org/docs/http/server_names.html" data-linktype="external">server_name directive</a> exposes your app to security vulnerabilities. Subdomain wildcard binding (for example, <code>*.example.com</code>) doesn't pose this security risk if you control the entire parent domain (as opposed to <code>*.com</code>, which is vulnerable). For more information, see <a href="https://www.rfc-editor.org/rfc/rfc9110#field.host" data-linktype="external">RFC 9110: HTTP Semantics (Section 7.2: Host and :authority)</a>.</p>
</div>
<p>Once the Nginx configuration is established, run <code>sudo nginx -t</code> to verify the syntax of the configuration files. If the configuration file test is successful, force Nginx to pick up the changes by running <code>sudo nginx -s reload</code>.</p>
<p>To directly run the app on the server:</p>
<ol>
<li>Navigate to the app's directory.</li>
<li>Run the app: <code>dotnet &lt;app_assembly.dll&gt;</code>, where <code>app_assembly.dll</code> is the assembly file name of the app.</li>
</ol>
<p>If the app runs on the server but fails to respond over the Internet, check the server's firewall and confirm port 80 is open. If using an Azure Ubuntu VM, add a Network Security Group (NSG) rule that enables inbound port 80 traffic. There's no need to enable an outbound port 80 rule, as the outbound traffic is automatically granted when the inbound rule is enabled.</p>
<p>When done testing the app, shut down the app with <kbd>Ctrl</kbd>+<kbd>C</kbd> in the command shell.</p>
<h2 id="monitor-the-app">Monitor the app</h2>
<p>The server is set up to forward requests made to <code>http://&lt;serveraddress&gt;:80</code> on to the ASP.NET Core app running on Kestrel at <code>http://127.0.0.1:5000</code>. However, Nginx isn't set up to manage the Kestrel process. <code>systemd</code> can be used to create a service file to start and monitor the underlying web app. <code>systemd</code> is an init system that provides many powerful features for starting, stopping, and managing processes.</p>
<h3 id="create-the-service-file">Create the service file</h3>
<p>Create the service definition file:</p>
<pre><code class="lang-bash">sudo nano /etc/systemd/system/kestrel-helloapp.service
</code></pre>
<p>The following example is a service file for the app:</p>
<pre><code class="lang-ini">[Unit]
Description=Example .NET Web API App running on Ubuntu

[Service]
WorkingDirectory=/var/www/helloapp
ExecStart=/usr/bin/dotnet /var/www/helloapp/helloapp.dll
Restart=always
# Restart service after 10 seconds if the dotnet service crashes:
RestartSec=10
KillSignal=SIGINT
SyslogIdentifier=dotnet-example
User=www-data
Environment=ASPNETCORE_ENVIRONMENT=Production
Environment=DOTNET_NOLOGO=true

[Install]
WantedBy=multi-user.target
</code></pre>
<p>In the preceding example, the user that manages the service is specified by the <code>User</code> option. The user (<code>www-data</code>) must exist and have proper ownership of the app's files.</p>
<p>Use <code>TimeoutStopSec</code> to configure the duration of time to wait for the app to shut down after it receives the initial interrupt signal. If the app doesn't shut down in this period, SIGKILL is issued to terminate the app. Provide the value as unitless seconds (for example, <code>150</code>), a time span value (for example, <code>2min 30s</code>), or <code>infinity</code> to disable the timeout. <code>TimeoutStopSec</code> defaults to the value of <code>DefaultTimeoutStopSec</code> in the manager configuration file (<code>systemd-system.conf</code>, <code>system.conf.d</code>, <code>systemd-user.conf</code>, <code>user.conf.d</code>). The default timeout for most distributions is 90 seconds.</p>
<pre><code># The default value is 90 seconds for most distributions.
TimeoutStopSec=90
</code></pre>
<p>Linux has a case-sensitive file system. Setting <code>ASPNETCORE_ENVIRONMENT</code> to <code>Production</code> results in searching for the configuration file <code>appsettings.Production.json</code>, not <code>appsettings.production.json</code>.</p>
<p>Some values (for example, SQL connection strings) must be escaped for the configuration providers to read the environment variables. Use the following command to generate a properly escaped value for use in the configuration file:</p>
<pre><code class="lang-console">systemd-escape "&lt;value-to-escape&gt;"
</code></pre>
<p>Colon (<code>:</code>) separators aren't supported in environment variable names. Use a double underscore (<code>__</code>) in place of a colon. The <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/configuration/?view=aspnetcore-9.0#environment-variables" data-linktype="relative-path">Environment Variables configuration provider</a> converts double-underscores into colons when environment variables are read into configuration. In the following example, the connection string key <code>ConnectionStrings:DefaultConnection</code> is set into the service definition file as <code>ConnectionStrings__DefaultConnection</code>:</p>
<pre><code>Environment=ConnectionStrings__DefaultConnection={Connection String}
</code></pre>
<p>Save the file and enable the service.</p>
<pre><code class="lang-bash">sudo systemctl enable kestrel-helloapp.service
</code></pre>
<p>Start the service and verify that it's running.</p>
<pre><code>sudo systemctl start kestrel-helloapp.service
sudo systemctl status kestrel-helloapp.service

◝ kestrel-helloapp.service - Example .NET Web API App running on Ubuntu
    Loaded: loaded (/etc/systemd/system/kestrel-helloapp.service; enabled)
    Active: active (running) since Thu 2016-10-18 04:09:35 NZDT; 35s ago
Main PID: 9021 (dotnet)
    CGroup: /system.slice/kestrel-helloapp.service
            └─9021 /usr/local/bin/dotnet /var/www/helloapp/helloapp.dll
</code></pre>
<p>With the reverse proxy configured and Kestrel managed through <code>systemd</code>, the web app is fully configured and can be accessed from a browser on the local machine at <code>http://localhost</code>. It's also accessible from a remote machine, barring any firewall that might be blocking. Inspecting the response headers, the <code>Server</code> header shows the ASP.NET Core app being served by Kestrel.</p>
<pre><code class="lang-text">HTTP/1.1 200 OK
Date: Tue, 11 Oct 2016 16:22:23 GMT
Server: Kestrel
Keep-Alive: timeout=5, max=98
Connection: Keep-Alive
Transfer-Encoding: chunked
</code></pre>
<h3 id="view-logs">View logs</h3>
<p>Since the web app using Kestrel is managed using <code>systemd</code>, all events and processes are logged to a centralized journal. However, this journal includes all entries for all services and processes managed by <code>systemd</code>. To view the <code>kestrel-helloapp.service</code>-specific items, use the following command:</p>
<pre><code class="lang-bash">sudo journalctl -fu kestrel-helloapp.service
</code></pre>
<p>For further filtering, time options such as <code>--since today</code>, <code>--until 1 hour ago</code>, or a combination of these can reduce the number of entries returned.</p>
<pre><code class="lang-bash">sudo journalctl -fu kestrel-helloapp.service --since "2016-10-18" --until "2016-10-18 04:00"
</code></pre>
<h2 id="data-protection">Data protection</h2>
<p>The <a href="../security/data-protection/introduction553c.html?view=aspnetcore-9.0" data-linktype="relative-path">ASP.NET Core Data Protection stack</a> is used by several ASP.NET Core <a href="../fundamentals/middleware/index553c.html?view=aspnetcore-9.0" data-linktype="relative-path">middlewares</a>, including authentication middleware (for example, cookie middleware) and cross-site request forgery (CSRF) protections. Even if Data Protection APIs aren't called by user code, data protection should be configured to create a persistent cryptographic <a href="https://learn.microsoft.com/en-us/aspnet/core/security/data-protection/implementation/key-management?view=aspnetcore-9.0" data-linktype="relative-path">key store</a>. If data protection isn't configured, the keys are held in memory and discarded when the app restarts.</p>
<p>If the key ring is stored in memory when the app restarts:</p>
<ul>
<li>All cookie-based authentication tokens are invalidated.</li>
<li>Users are required to sign in again on their next request.</li>
<li>Any data protected with the key ring can no longer be decrypted. This may include <a href="https://learn.microsoft.com/en-us/aspnet/core/security/anti-request-forgery?view=aspnetcore-9.0#aspnet-core-antiforgery-configuration" data-linktype="relative-path">CSRF tokens</a> and <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/app-state?view=aspnetcore-9.0#tempdata" data-linktype="relative-path">ASP.NET Core MVC TempData cookies</a>.</li>
</ul>
<p>To configure data protection to persist and encrypt the key ring, see:</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/security/data-protection/implementation/key-storage-providers?view=aspnetcore-9.0" data-linktype="relative-path">Key storage providers in ASP.NET Core</a></li>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/security/data-protection/implementation/key-encryption-at-rest?view=aspnetcore-9.0" data-linktype="relative-path">Key encryption at rest in Windows and Azure using ASP.NET Core</a></li>
</ul>
<h2 id="long-request-header-fields">Long request header fields</h2>
<p>Proxy server default settings typically limit request header fields to 4 K or 8 K depending on the platform. An app may require fields longer than the default (for example, apps that use <a href="https://azure.microsoft.com/services/active-directory/" data-linktype="external">Azure Active Directory</a>). If longer fields are required, the proxy server's default settings require adjustment. The values to apply depend on the scenario. For more information, see your server's documentation.</p>
<ul>
<li><a href="https://nginx.org/docs/http/ngx_http_proxy_module.html#proxy_buffer_size" data-linktype="external">proxy_buffer_size</a></li>
<li><a href="https://nginx.org/docs/http/ngx_http_proxy_module.html#proxy_buffers" data-linktype="external">proxy_buffers</a></li>
<li><a href="https://nginx.org/docs/http/ngx_http_proxy_module.html#proxy_busy_buffers_size" data-linktype="external">proxy_busy_buffers_size</a></li>
<li><a href="https://nginx.org/docs/http/ngx_http_core_module.html#large_client_header_buffers" data-linktype="external">large_client_header_buffers</a></li>
</ul>
<div class="WARNING">
<p>Warning</p>
<p>Don't increase the default values of proxy buffers unless necessary. Increasing these values increases the risk of buffer overrun (overflow) and Denial of Service (DoS) attacks by malicious users.</p>
</div>
<h2 id="secure-the-app">Secure the app</h2>
<h3 id="enable-apparmor">Enable AppArmor</h3>
<p>Linux Security Modules (LSM) is a framework that's part of the Linux kernel since Linux 2.6. LSM supports different implementations of security modules. <a href="https://wiki.ubuntu.com/AppArmor" data-linktype="external">AppArmor</a> is an LSM that implements a Mandatory Access Control system, which allows confining the program to a limited set of resources. Ensure AppArmor is enabled and properly configured.</p>
<h3 id="configure-the-firewall">Configure the firewall</h3>
<p>Close off all external ports that aren't in use. Uncomplicated firewall (ufw) provides a front end for <code>iptables</code> by providing a CLI for configuring the firewall.</p>
<div class="WARNING">
<p>Warning</p>
<p>A firewall will prevent access to the whole system if not configured correctly. Failure to specify the correct SSH port will effectively lock you out of the system if you are using SSH to connect to it. The default port is 22. For more information, see the <a href="https://help.ubuntu.com/community/UFW" data-linktype="external">introduction to ufw</a> and the <a href="https://manpages.ubuntu.com/manpages/lunar/en/man8/ufw.8.html" data-linktype="external">manual</a>.</p>
</div>
<p>Install <code>ufw</code> and configure it to allow traffic on any ports needed.</p>
<pre><code class="lang-bash">sudo apt-get install ufw

sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

sudo ufw enable
</code></pre>
<h3 id="secure-nginx">Secure Nginx</h3>
<h4 id="change-the-nginx-response-name">Change the Nginx response name</h4>
<p>Edit <code>src/http/ngx_http_header_filter_module.c</code>:</p>
<pre><code>static char ngx_http_server_string[] = "Server: Web Server" CRLF;
static char ngx_http_server_full_string[] = "Server: Web Server" CRLF;
</code></pre>
<h4 id="configure-options">Configure options</h4>
<p>Configure the server with additional required modules. Consider using a web app firewall, such as <a href="https://www.modsecurity.org/" data-linktype="external">ModSecurity</a>, to harden the app.</p>
<h4 id="https-configuration">HTTPS configuration</h4>
<p><strong>Configure the app for secure (HTTPS) local connections</strong></p>
<p>The <a href="https://learn.microsoft.com/en-us/dotnet/core/tools/dotnet-run" data-linktype="absolute-path">dotnet run</a> command uses the app's <code>Properties/launchSettings.json</code> file, which configures the app to listen on the URLs provided by the <code>applicationUrl</code> property. For example, <code>https://localhost:5001;http://localhost:5000</code>.</p>
<p>Configure the app to use a certificate in development for the <code>dotnet run</code> command or development environment (<kbd>F5</kbd> or <kbd>Ctrl</kbd>+<kbd>F5</kbd> in Visual Studio Code) using one of the following approaches:</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/servers/kestrel/endpoints?view=aspnetcore-9.0#configuration" data-linktype="relative-path">Replace the default certificate from configuration</a> (<em>Recommended</em>)</li>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/servers/kestrel/endpoints?view=aspnetcore-9.0#configurehttpsdefaultsactionhttpsconnectionadapteroptions" data-linktype="relative-path">KestrelServerOptions.ConfigureHttpsDefaults</a></li>
</ul>
<p><strong>Configure the reverse proxy for secure (HTTPS) client connections</strong></p>
<div class="WARNING">
<p>Warning</p>
<p>The security configuration in this section is a general configuration to be used as a starting point for further customization. We're unable to provide support for third-party tooling, servers, and operating systems. <em>Use the configuration in this section at your own risk.</em> For more information, access the following resources:</p>
<ul>
<li><a href="http://nginx.org/docs/http/configuring_https_servers.html" data-linktype="external">Configuring HTTPS servers</a> (Nginx documentation)</li>
<li><a href="https://ssl-config.mozilla.org/#server=nginx" data-linktype="external">mozilla.org SSL Configuration Generator</a></li>
</ul>
</div>
<ul>
<li><p>Configure the server to listen to HTTPS traffic on port 443 by specifying a valid certificate issued by a trusted Certificate Authority (CA).</p>
</li>
<li><p>Harden the security by employing some of the practices depicted in the following <em>/etc/nginx/nginx.conf</em> file.</p>
</li>
<li><p>The following example doesn't configure the server to redirect insecure requests. We recommend using HTTPS Redirection Middleware. For more information, see <a href="../security/enforcing-ssl553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Enforce HTTPS in ASP.NET Core</a>.</p>
<div class="NOTE">
<p>Note</p>
<p>For development environments where the server configuration handles secure redirection instead of HTTPS Redirection Middleware, we recommend using temporary redirects (302) rather than permanent redirects (301). Link caching can cause unstable behavior in development environments.</p>
</div>
</li>
<li><p>Adding a <code>Strict-Transport-Security</code> (HSTS) header ensures all subsequent requests made by the client are over HTTPS. For guidance on setting the <code>Strict-Transport-Security</code> header, see <a href="../security/enforcing-ssl553c.html?view=aspnetcore-9.0#http-strict-transport-security-protocol-hsts" data-linktype="relative-path">Enforce HTTPS in ASP.NET Core</a>.</p>
</li>
<li><p>If HTTPS will be disabled in the future, use one of the following approaches:</p>
<ul>
<li>Don't add the HSTS header.</li>
<li>Choose a short <code>max-age</code> value.</li>
</ul>
</li>
</ul>
<p>Add the <em>/etc/nginx/proxy.conf</em> configuration file:</p>
<pre><code class="lang-nginx">proxy_redirect          off;
proxy_set_header        Host $host;
proxy_set_header        X-Real-IP $remote_addr;
proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header        X-Forwarded-Proto $scheme;
client_max_body_size    10m;
client_body_buffer_size 128k;
proxy_connect_timeout   90;
proxy_send_timeout      90;
proxy_read_timeout      90;
proxy_buffers           32 4k;
</code></pre>
<p><strong>Replace</strong> the contents of the <em>/etc/nginx/nginx.conf</em> configuration file with the following file. The example contains both <code>http</code> and <code>server</code> sections in one configuration file.</p>
<pre><code class="lang-nginx">http {
    include        /etc/nginx/proxy.conf;
    limit_req_zone $binary_remote_addr zone=one:10m rate=5r/s;
    server_tokens  off;

    sendfile on;
    # Adjust keepalive_timeout to the lowest possible value that makes sense 
    # for your use case.
    keepalive_timeout   29;
    client_body_timeout 10; client_header_timeout 10; send_timeout 10;

    upstream helloapp{
        server 127.0.0.1:5000;
    }

    server {
        listen                    443 ssl http2;
        listen                    [::]:443 ssl http2;
        server_name               example.com *.example.com;
        ssl_certificate           /etc/ssl/certs/testCert.crt;
        ssl_certificate_key       /etc/ssl/certs/testCert.key;
        ssl_session_timeout       1d;
        ssl_protocols             TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers off;
        ssl_ciphers               ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_session_cache         shared:SSL:10m;
        ssl_session_tickets       off;
        ssl_stapling              off;

        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;

        #Redirects all traffic
        location / {
            proxy_pass http://helloapp;
            limit_req  zone=one burst=10 nodelay;
        }
    }
}
</code></pre>
<div class="NOTE">
<p>Note</p>
<p>Blazor WebAssembly apps require a larger <code>burst</code> parameter value to accommodate the larger number of requests made by an app. For more information, see <a href="https://learn.microsoft.com/en-us/aspnet/core/blazor/host-and-deploy/webassembly/nginx?view=aspnetcore-9.0" data-linktype="relative-path">Host and deploy ASP.NET Core Blazor WebAssembly with Nginx</a>.</p>
</div>
<div class="NOTE">
<p>Note</p>
<p>The preceding example disables Online Certificate Status Protocol (OCSP) Stapling. If enabled, confirm that the certificate supports the feature. For more information and guidance on enabling OCSP, see the following properties in the <a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html" data-linktype="external">Module ngx_http_ssl_module (Nginx documentation)</a> article:</p>
<ul>
<li><code>ssl_stapling</code></li>
<li><code>ssl_stapling_file</code></li>
<li><code>ssl_stapling_responder</code></li>
<li><code>ssl_stapling_verify</code></li>
</ul>
</div>
<h4 id="secure-nginx-from-clickjacking">Secure Nginx from clickjacking</h4>
<p><a href="https://blog.qualys.com/securitylabs/2015/10/20/clickjacking-a-common-implementation-mistake-that-can-put-your-websites-in-danger" data-linktype="external">Clickjacking</a>, also known as a <em>UI redress attack</em>, is a malicious attack where a website visitor is tricked into clicking a link or button on a different page than they're currently visiting. Use <code>X-FRAME-OPTIONS</code> to secure the site.</p>
<p>To mitigate clickjacking attacks:</p>
<ol>
<li><p>Edit the <em>nginx.conf</em> file:</p>
<pre><code class="lang-bash">sudo nano /etc/nginx/nginx.conf
</code></pre>
<p>Add the line: <code>add_header X-Frame-Options "SAMEORIGIN";</code></p>
</li>
<li><p>Save the file.</p>
</li>
<li><p>Restart Nginx.</p>
</li>
</ol>
<h4 id="mime-type-sniffing">MIME-type sniffing</h4>
<p>This header prevents most browsers from MIME-sniffing a response away from the declared content type, as the header instructs the browser not to override the response content type. With the <code>nosniff</code> option, if the server says the content is <code>text/html</code>, the browser renders it as <code>text/html</code>.</p>
<ol>
<li><p>Edit the <em>nginx.conf</em> file:</p>
<pre><code class="lang-bash">sudo nano /etc/nginx/nginx.conf
</code></pre>
<p>Add the line: <code>add_header X-Content-Type-Options "nosniff";</code></p>
</li>
<li><p>Save the file.</p>
</li>
<li><p>Restart Nginx.</p>
</li>
</ol>
<h2 id="additional-nginx-suggestions">Additional Nginx suggestions</h2>
<p>After upgrading the shared framework on the server, restart the ASP.NET Core apps hosted by the server.</p>
<h2 id="additional-resources">Additional resources</h2>
<ul>
<li><a href="https://learn.microsoft.com/en-us/dotnet/core/linux-prerequisites" data-linktype="absolute-path">Prerequisites for .NET Core on Linux</a></li>
<li><a href="https://www.nginx.com/resources/wiki/start/topics/tutorials/install/#official-debian-ubuntu-packages" data-linktype="external">Nginx: Binary Releases: Official Debian/Ubuntu packages</a></li>
<li><a href="../test/troubleshoot553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Troubleshoot and debug ASP.NET Core projects</a></li>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/proxy-load-balancer?view=aspnetcore-9.0" data-linktype="relative-path">Configure ASP.NET Core to work with proxy servers and load balancers</a></li>
<li><a href="https://www.nginx.com/resources/wiki/start/topics/examples/forwarded/" data-linktype="external">NGINX: Using the Forwarded header</a></li>
</ul>
</div>
<div data-moniker="aspnetcore-3.1">
<p>This guide explains setting up a production-ready ASP.NET Core environment on an Ubuntu 16.04 server. These instructions likely work with newer versions of Ubuntu, but the instructions haven't been tested with newer versions.</p>
<p>For information on other Linux distributions supported by ASP.NET Core, see <a href="https://learn.microsoft.com/en-us/dotnet/core/linux-prerequisites" data-linktype="absolute-path">Prerequisites for .NET Core on Linux</a>.</p>
<div class="NOTE">
<p>Note</p>
<p>For Ubuntu 14.04, <code>supervisord</code> is recommended as a solution for monitoring the Kestrel process. <code>systemd</code> isn't available on Ubuntu 14.04. For Ubuntu 14.04 instructions, see the <a href="https://github.com/dotnet/AspNetCore.Docs/blob/e9c1419175c4dd7e152df3746ba1df5935aaafd5/aspnetcore/publishing/linuxproduction.md" data-linktype="external">previous version of this topic</a>.</p>
</div>
<p>This guide:</p>
<ul>
<li>Places an existing ASP.NET Core app behind a reverse proxy server.</li>
<li>Sets up the reverse proxy server to forward requests to the Kestrel web server.</li>
<li>Ensures the web app runs on startup as a daemon.</li>
<li>Configures a process management tool to help restart the web app.</li>
</ul>
<h2 id="prerequisites-1">Prerequisites</h2>
<ul>
<li>Access to an Ubuntu 16.04 server with a standard user account with sudo privilege.</li>
<li>The latest non-preview <a href="https://learn.microsoft.com/en-us/dotnet/core/install/linux" data-linktype="absolute-path">.NET runtime installed</a> on the server.</li>
<li>An existing ASP.NET Core app.</li>
</ul>
<p>At any point in the future after upgrading the shared framework, restart the ASP.NET Core apps hosted by the server.</p>
<h2 id="publish-and-copy-over-the-app-1">Publish and copy over the app</h2>
<p>Configure the app for a <a href="https://learn.microsoft.com/en-us/dotnet/core/deploying/#framework-dependent-deployments-fdd" data-linktype="absolute-path">framework-dependent deployment</a>.</p>
<p>If the app is run locally in the <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-9.0#configure-services-and-middleware-by-environment" data-linktype="relative-path">Development environment</a> and isn't configured by the server to make secure HTTPS connections, adopt either of the following approaches:</p>
<ul>
<li><p>Configure the app to handle secure local connections. For more information, see the <a href="#https-configuration" data-linktype="self-bookmark">HTTPS configuration</a> section.</p>
</li>
<li><p>Configure the app to run at the insecure endpoint:</p>
<ul>
<li><p>Deactivate HTTPS Redirection Middleware in the Development environment (<code>Program.cs</code>):</p>
<pre><code class="lang-csharp">if (!app.Environment.IsDevelopment())
{
    app.UseHttpsRedirection();
}
</code></pre>
<p>For more information, see <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-9.0#configure-services-and-middleware-by-environment" data-linktype="relative-path">Use multiple environments in ASP.NET Core</a>.</p>
</li>
<li><p>Remove <code>https://localhost:5001</code> (if present) from the <code>applicationUrl</code> property in the <code>Properties/launchSettings.json</code> file.</p>
</li>
</ul>
</li>
</ul>
<p>For more information on configuration by environment, see <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-9.0" data-linktype="relative-path">Use multiple environments in ASP.NET Core</a>.</p>
<p>Run <a href="https://learn.microsoft.com/en-us/dotnet/core/tools/dotnet-publish" data-linktype="absolute-path">dotnet publish</a> from the development environment to package an app into a directory (for example, <code>bin/Release/{TARGET FRAMEWORK MONIKER}/publish</code>, where the placeholder <code>{TARGET FRAMEWORK MONIKER}</code> is the Target Framework Moniker/TFM) that can run on the server:</p>
<pre><code class="lang-dotnetcli">dotnet publish --configuration Release
</code></pre>
<p>The app can also be published as a <a href="https://learn.microsoft.com/en-us/dotnet/core/deploying/#self-contained-deployments-scd" data-linktype="absolute-path">self-contained deployment</a> if you prefer not to maintain the .NET Core runtime on the server.</p>
<p>Copy the ASP.NET Core app to the server using a tool that integrates into the organization's workflow (for example, <code>SCP</code>, <code>SFTP</code>). It's common to locate web apps under the <code>var</code> directory (for example, <code>var/www/helloapp</code>).</p>
<div class="NOTE">
<p>Note</p>
<p>Under a production deployment scenario, a continuous integration workflow does the work of publishing the app and copying the assets to the server.</p>
</div>
<p>Test the app:</p>
<ol>
<li>From the command line, run the app: <code>dotnet &lt;app_assembly&gt;.dll</code>.</li>
<li>In a browser, navigate to <code>http://&lt;serveraddress&gt;:&lt;port&gt;</code> to verify the app works on Linux locally.</li>
</ol>
<h2 id="configure-a-reverse-proxy-server-1">Configure a reverse proxy server</h2>
<p>A reverse proxy is a common setup for serving dynamic web apps. A reverse proxy terminates the HTTP request and forwards it to the ASP.NET Core app.</p>
<h3 id="use-a-reverse-proxy-server-1">Use a reverse proxy server</h3>
<p>Kestrel is great for serving dynamic content from ASP.NET Core. However, the web serving capabilities aren't as feature rich as servers such as IIS, Apache, or Nginx. A reverse proxy server can offload work such as serving static content, caching requests, compressing requests, and HTTPS termination from the HTTP server. A reverse proxy server may reside on a dedicated machine or may be deployed alongside an HTTP server.</p>
<p>For the purposes of this guide, a single instance of Nginx is used. It runs on the same server, alongside the HTTP server. Based on requirements, a different setup may be chosen.</p>
<p>Because requests are forwarded by reverse proxy, use the <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/proxy-load-balancer?view=aspnetcore-9.0" data-linktype="relative-path">Forwarded Headers Middleware</a> from the <a href="https://www.nuget.org/packages/Microsoft.AspNetCore.HttpOverrides" data-linktype="external"><code>Microsoft.AspNetCore.HttpOverrides</code></a> package. The middleware updates the <code>Request.Scheme</code>, using the <code>X-Forwarded-Proto</code> header, so that redirect URIs and other security policies work correctly.</p>
<p>Forwarded Headers Middleware should run before other middleware. This ordering ensures that the middleware relying on forwarded headers information can consume the header values for processing. To run Forwarded Headers Middleware after diagnostics and error handling middleware, see <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/proxy-load-balancer?view=aspnetcore-9.0#fhmo" data-linktype="relative-path">Forwarded Headers Middleware order</a>.</p>
<p>Invoke the <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.forwardedheadersextensions.useforwardedheaders" class="no-loc" data-linktype="absolute-path">UseForwardedHeaders</a> method at the top of <code>Startup.Configure</code> before calling other middleware. Configure the middleware to forward the <code>X-Forwarded-For</code> and <code>X-Forwarded-Proto</code> headers:</p>
<pre><code class="lang-csharp">using Microsoft.AspNetCore.HttpOverrides;

...

app.UseForwardedHeaders(new ForwardedHeadersOptions
{
    ForwardedHeaders = ForwardedHeaders.XForwardedFor | ForwardedHeaders.XForwardedProto
});

app.UseAuthentication();
</code></pre>
<p>If no <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.forwardedheadersoptions" class="no-loc" data-linktype="absolute-path">ForwardedHeadersOptions</a> are specified to the middleware, the default headers to forward are <code>None</code>.</p>
<p>Proxies running on loopback addresses (<code>127.0.0.0/8</code>, <code>[::1]</code>), including the standard localhost address (<code>127.0.0.1</code>), are trusted by default. If other trusted proxies or networks within the organization handle requests between the Internet and the web server, add them to the list of <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.forwardedheadersoptions.knownproxies" class="no-loc" data-linktype="absolute-path">KnownProxies</a> or <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.forwardedheadersoptions.knownnetworks" class="no-loc" data-linktype="absolute-path">KnownNetworks</a> with <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.forwardedheadersoptions" class="no-loc" data-linktype="absolute-path">ForwardedHeadersOptions</a>. The following example adds a trusted proxy server at IP address 10.0.0.100 to the Forwarded Headers Middleware <code>KnownProxies</code> in <code>Startup.ConfigureServices</code>:</p>
<pre><code class="lang-csharp">using System.Net;

...

services.Configure&lt;ForwardedHeadersOptions&gt;(options =&gt;
{
    options.KnownProxies.Add(IPAddress.Parse("10.0.0.100"));
});
</code></pre>
<p>For more information, see <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/proxy-load-balancer?view=aspnetcore-9.0" data-linktype="relative-path">Configure ASP.NET Core to work with proxy servers and load balancers</a>.</p>
<h3 id="install-nginx-1">Install Nginx</h3>
<p>Use <code>apt-get</code> to install Nginx. The installer creates a <code>systemd</code> init script that runs Nginx as daemon on system startup. Follow the installation instructions for Ubuntu at <a href="https://www.nginx.com/resources/wiki/start/topics/tutorials/install/#official-debian-ubuntu-packages" data-linktype="external">Nginx: Official Debian/Ubuntu packages</a>.</p>
<div class="NOTE">
<p>Note</p>
<p>If optional Nginx modules are required, building Nginx from source might be required.</p>
</div>
<p>Since Nginx was installed for the first time, explicitly start it by running:</p>
<pre><code class="lang-bash">sudo service nginx start
</code></pre>
<p>Verify a browser displays the default landing page for Nginx. The landing page is reachable at <code>http://&lt;server_IP_address&gt;/index.nginx-debian.html</code>.</p>
<h3 id="configure-nginx-1">Configure Nginx</h3>
<p>To configure Nginx as a reverse proxy to forward HTTP requests to your ASP.NET Core app, modify <code>/etc/nginx/sites-available/default</code>. Open it in a text editor, and replace the contents with the following snippet:</p>
<pre><code class="lang-nginx">server {
    listen        80;
    server_name   example.com *.example.com;
    location / {
        proxy_pass         http://127.0.0.1:5000;
        proxy_http_version 1.1;
        proxy_set_header   Upgrade $http_upgrade;
        proxy_set_header   Connection keep-alive;
        proxy_set_header   Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto $scheme;
    }
}
</code></pre>
<p>If the app is a SignalR or Blazor Server app, see <a href="https://learn.microsoft.com/en-us/aspnet/core/signalr/scale?view=aspnetcore-9.0#linux-with-nginx" data-linktype="relative-path">ASP.NET Core SignalR production hosting and scaling</a> and <a href="https://learn.microsoft.com/en-us/aspnet/core/blazor/host-and-deploy/server/?view=aspnetcore-9.0#linux-with-nginx" data-linktype="relative-path">Host and deploy ASP.NET Core server-side Blazor apps</a> respectively for more information.</p>
<p>When no <code>server_name</code> matches, Nginx uses the default server. If no default server is defined, the first server in the configuration file is the default server. As a best practice, add a specific default server that returns a status code of 444 in your configuration file. A default server configuration example is:</p>
<pre><code class="lang-nginx">server {
    listen   80 default_server;
    # listen [::]:80 default_server deferred;
    return   444;
}
</code></pre>
<p>With the preceding configuration file and default server, Nginx accepts public traffic on port 80 with host header <code>example.com</code> or <code>*.example.com</code>. Requests not matching these hosts won't get forwarded to Kestrel. Nginx forwards the matching requests to Kestrel at <code>http://127.0.0.1:5000</code>. For more information, see <a href="https://nginx.org/docs/http/request_processing.html" data-linktype="external">How nginx processes a request</a>. To change Kestrel's IP/port, see <a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0#endpoint-configuration" data-linktype="relative-path">Kestrel: Endpoint configuration</a>.</p>
<div class="WARNING">
<p>Warning</p>
<p>Failure to specify a proper <a href="https://nginx.org/docs/http/server_names.html" data-linktype="external">server_name directive</a> exposes your app to security vulnerabilities. Subdomain wildcard binding (for example, <code>*.example.com</code>) doesn't pose this security risk if you control the entire parent domain (as opposed to <code>*.com</code>, which is vulnerable). For more information, see <a href="https://www.rfc-editor.org/rfc/rfc9110#field.host" data-linktype="external">RFC 9110: HTTP Semantics (Section 7.2: Host and :authority)</a>.</p>
</div>
<p>Once the Nginx configuration is established, run <code>sudo nginx -t</code> to verify the syntax of the configuration files. If the configuration file test is successful, force Nginx to pick up the changes by running <code>sudo nginx -s reload</code>.</p>
<p>To directly run the app on the server:</p>
<ol>
<li>Navigate to the app's directory.</li>
<li>Run the app: <code>dotnet &lt;app_assembly.dll&gt;</code>, where <code>app_assembly.dll</code> is the assembly file name of the app.</li>
</ol>
<p>If the app runs on the server but fails to respond over the Internet, check the server's firewall and confirm port 80 is open. If using an Azure Ubuntu VM, add a Network Security Group (NSG) rule that enables inbound port 80 traffic. There's no need to enable an outbound port 80 rule, as the outbound traffic is automatically granted when the inbound rule is enabled.</p>
<p>When done testing the app, shut down the app with <kbd>Ctrl</kbd>+<kbd>C</kbd> in the command shell.</p>
<h2 id="monitor-the-app-1">Monitor the app</h2>
<p>The server is set up to forward requests made to <code>http://&lt;serveraddress&gt;:80</code> on to the ASP.NET Core app running on Kestrel at <code>http://127.0.0.1:5000</code>. However, Nginx isn't set up to manage the Kestrel process. <code>systemd</code> can be used to create a service file to start and monitor the underlying web app. <code>systemd</code> is an init system that provides many powerful features for starting, stopping, and managing processes.</p>
<h3 id="create-the-service-file-1">Create the service file</h3>
<p>Create the service definition file:</p>
<pre><code class="lang-bash">sudo nano /etc/systemd/system/kestrel-helloapp.service
</code></pre>
<p>The following example is a service file for the app:</p>
<pre><code class="lang-ini">[Unit]
Description=Example .NET Web API App running on Ubuntu

[Service]
WorkingDirectory=/var/www/helloapp
ExecStart=/usr/bin/dotnet /var/www/helloapp/helloapp.dll
Restart=always
# Restart service after 10 seconds if the dotnet service crashes:
RestartSec=10
KillSignal=SIGINT
SyslogIdentifier=dotnet-example
User=www-data
Environment=ASPNETCORE_ENVIRONMENT=Production
Environment=DOTNET_PRINT_TELEMETRY_MESSAGE=false

[Install]
WantedBy=multi-user.target
</code></pre>
<p>In the preceding example, the user that manages the service is specified by the <code>User</code> option. The user (<code>www-data</code>) must exist and have proper ownership of the app's files.</p>
<p>Use <code>TimeoutStopSec</code> to configure the duration of time to wait for the app to shut down after it receives the initial interrupt signal. If the app doesn't shut down in this period, SIGKILL is issued to terminate the app. Provide the value as unitless seconds (for example, <code>150</code>), a time span value (for example, <code>2min 30s</code>), or <code>infinity</code> to disable the timeout. <code>TimeoutStopSec</code> defaults to the value of <code>DefaultTimeoutStopSec</code> in the manager configuration file (<code>systemd-system.conf</code>, <code>system.conf.d</code>, <code>systemd-user.conf</code>, <code>user.conf.d</code>). The default timeout for most distributions is 90 seconds.</p>
<pre><code># The default value is 90 seconds for most distributions.
TimeoutStopSec=90
</code></pre>
<p>Linux has a case-sensitive file system. Setting <code>ASPNETCORE_ENVIRONMENT</code> to <code>Production</code> results in searching for the configuration file <code>appsettings.Production.json</code>, not <code>appsettings.production.json</code>.</p>
<p>Some values (for example, SQL connection strings) must be escaped for the configuration providers to read the environment variables. Use the following command to generate a properly escaped value for use in the configuration file:</p>
<pre><code class="lang-console">systemd-escape "&lt;value-to-escape&gt;"
</code></pre>
<p>Colon (<code>:</code>) separators aren't supported in environment variable names. Use a double underscore (<code>__</code>) in place of a colon. The <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/configuration/?view=aspnetcore-9.0#environment-variables" data-linktype="relative-path">Environment Variables configuration provider</a> converts double-underscores into colons when environment variables are read into configuration. In the following example, the connection string key <code>ConnectionStrings:DefaultConnection</code> is set into the service definition file as <code>ConnectionStrings__DefaultConnection</code>:</p>
<pre><code>Environment=ConnectionStrings__DefaultConnection={Connection String}
</code></pre>
<p>Save the file and enable the service.</p>
<pre><code class="lang-bash">sudo systemctl enable kestrel-helloapp.service
</code></pre>
<p>Start the service and verify that it's running.</p>
<pre><code>sudo systemctl start kestrel-helloapp.service
sudo systemctl status kestrel-helloapp.service

◝ kestrel-helloapp.service - Example .NET Web API App running on Ubuntu
    Loaded: loaded (/etc/systemd/system/kestrel-helloapp.service; enabled)
    Active: active (running) since Thu 2016-10-18 04:09:35 NZDT; 35s ago
Main PID: 9021 (dotnet)
    CGroup: /system.slice/kestrel-helloapp.service
            └─9021 /usr/local/bin/dotnet /var/www/helloapp/helloapp.dll
</code></pre>
<p>With the reverse proxy configured and Kestrel managed through <code>systemd</code>, the web app is fully configured and can be accessed from a browser on the local machine at <code>http://localhost</code>. It's also accessible from a remote machine, barring any firewall that might be blocking. Inspecting the response headers, the <code>Server</code> header shows the ASP.NET Core app being served by Kestrel.</p>
<pre><code class="lang-text">HTTP/1.1 200 OK
Date: Tue, 11 Oct 2016 16:22:23 GMT
Server: Kestrel
Keep-Alive: timeout=5, max=98
Connection: Keep-Alive
Transfer-Encoding: chunked
</code></pre>
<h3 id="view-logs-1">View logs</h3>
<p>Since the web app using Kestrel is managed using <code>systemd</code>, all events and processes are logged to a centralized journal. However, this journal includes all entries for all services and processes managed by <code>systemd</code>. To view the <code>kestrel-helloapp.service</code>-specific items, use the following command:</p>
<pre><code class="lang-bash">sudo journalctl -fu kestrel-helloapp.service
</code></pre>
<p>For further filtering, time options such as <code>--since today</code>, <code>--until 1 hour ago</code>, or a combination of these can reduce the number of entries returned.</p>
<pre><code class="lang-bash">sudo journalctl -fu kestrel-helloapp.service --since "2016-10-18" --until "2016-10-18 04:00"
</code></pre>
<h2 id="data-protection-1">Data protection</h2>
<p>The <a href="../security/data-protection/introduction553c.html?view=aspnetcore-9.0" data-linktype="relative-path">ASP.NET Core Data Protection stack</a> is used by several ASP.NET Core <a href="../fundamentals/middleware/index553c.html?view=aspnetcore-9.0" data-linktype="relative-path">middlewares</a>, including authentication middleware (for example, cookie middleware) and cross-site request forgery (CSRF) protections. Even if Data Protection APIs aren't called by user code, data protection should be configured to create a persistent cryptographic <a href="https://learn.microsoft.com/en-us/aspnet/core/security/data-protection/implementation/key-management?view=aspnetcore-9.0" data-linktype="relative-path">key store</a>. If data protection isn't configured, the keys are held in memory and discarded when the app restarts.</p>
<p>If the key ring is stored in memory when the app restarts:</p>
<ul>
<li>All cookie-based authentication tokens are invalidated.</li>
<li>Users are required to sign in again on their next request.</li>
<li>Any data protected with the key ring can no longer be decrypted. This may include <a href="https://learn.microsoft.com/en-us/aspnet/core/security/anti-request-forgery?view=aspnetcore-9.0#aspnet-core-antiforgery-configuration" data-linktype="relative-path">CSRF tokens</a> and <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/app-state?view=aspnetcore-9.0#tempdata" data-linktype="relative-path">ASP.NET Core MVC TempData cookies</a>.</li>
</ul>
<p>To configure data protection to persist and encrypt the key ring, see:</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/security/data-protection/implementation/key-storage-providers?view=aspnetcore-9.0" data-linktype="relative-path">Key storage providers in ASP.NET Core</a></li>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/security/data-protection/implementation/key-encryption-at-rest?view=aspnetcore-9.0" data-linktype="relative-path">Key encryption at rest in Windows and Azure using ASP.NET Core</a></li>
</ul>
<h2 id="long-request-header-fields-1">Long request header fields</h2>
<p>Proxy server default settings typically limit request header fields to 4 K or 8 K depending on the platform. An app may require fields longer than the default (for example, apps that use <a href="https://azure.microsoft.com/services/active-directory/" data-linktype="external">Azure Active Directory</a>). If longer fields are required, the proxy server's default settings require adjustment. The values to apply depend on the scenario. For more information, see your server's documentation.</p>
<ul>
<li><a href="https://nginx.org/docs/http/ngx_http_proxy_module.html#proxy_buffer_size" data-linktype="external">proxy_buffer_size</a></li>
<li><a href="https://nginx.org/docs/http/ngx_http_proxy_module.html#proxy_buffers" data-linktype="external">proxy_buffers</a></li>
<li><a href="https://nginx.org/docs/http/ngx_http_proxy_module.html#proxy_busy_buffers_size" data-linktype="external">proxy_busy_buffers_size</a></li>
<li><a href="https://nginx.org/docs/http/ngx_http_core_module.html#large_client_header_buffers" data-linktype="external">large_client_header_buffers</a></li>
</ul>
<div class="WARNING">
<p>Warning</p>
<p>Don't increase the default values of proxy buffers unless necessary. Increasing these values increases the risk of buffer overrun (overflow) and Denial of Service (DoS) attacks by malicious users.</p>
</div>
<h2 id="secure-the-app-1">Secure the app</h2>
<h3 id="enable-apparmor-1">Enable AppArmor</h3>
<p>Linux Security Modules (LSM) is a framework that's part of the Linux kernel since Linux 2.6. LSM supports different implementations of security modules. <a href="https://wiki.ubuntu.com/AppArmor" data-linktype="external">AppArmor</a> is an LSM that implements a Mandatory Access Control system, which allows confining the program to a limited set of resources. Ensure AppArmor is enabled and properly configured.</p>
<h3 id="configure-the-firewall-1">Configure the firewall</h3>
<p>Close off all external ports that aren't in use. Uncomplicated firewall (ufw) provides a front end for <code>iptables</code> by providing a CLI for configuring the firewall.</p>
<div class="WARNING">
<p>Warning</p>
<p>A firewall will prevent access to the whole system if not configured correctly. Failure to specify the correct SSH port will effectively lock you out of the system if you are using SSH to connect to it. The default port is 22. For more information, see the <a href="https://help.ubuntu.com/community/UFW" data-linktype="external">introduction to ufw</a> and the <a href="https://manpages.ubuntu.com/manpages/lunar/en/man8/ufw.8.html" data-linktype="external">manual</a>.</p>
</div>
<p>Install <code>ufw</code> and configure it to allow traffic on any ports needed.</p>
<pre><code class="lang-bash">sudo apt-get install ufw

sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

sudo ufw enable
</code></pre>
<h3 id="secure-nginx-1">Secure Nginx</h3>
<h4 id="change-the-nginx-response-name-1">Change the Nginx response name</h4>
<p>Edit <code>src/http/ngx_http_header_filter_module.c</code>:</p>
<pre><code>static char ngx_http_server_string[] = "Server: Web Server" CRLF;
static char ngx_http_server_full_string[] = "Server: Web Server" CRLF;
</code></pre>
<h4 id="configure-options-1">Configure options</h4>
<p>Configure the server with additional required modules. Consider using a web app firewall, such as <a href="https://www.modsecurity.org/" data-linktype="external">ModSecurity</a>, to harden the app.</p>
<h4 id="https-configuration-1">HTTPS configuration</h4>
<p><strong>Configure the app for secure (HTTPS) local connections</strong></p>
<p>The <a href="https://learn.microsoft.com/en-us/dotnet/core/tools/dotnet-run" data-linktype="absolute-path">dotnet run</a> command uses the app's <code>Properties/launchSettings.json</code> file, which configures the app to listen on the URLs provided by the <code>applicationUrl</code> property. For example, <code>https://localhost:5001;http://localhost:5000</code>.</p>
<p>Configure the app to use a certificate in development for the <code>dotnet run</code> command or development environment (<kbd>F5</kbd> or <kbd>Ctrl</kbd>+<kbd>F5</kbd> in Visual Studio Code) using one of the following approaches:</p>
<ul>
<li><a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0#configuration" data-linktype="relative-path">Replace the default certificate from configuration</a> (<em>Recommended</em>)</li>
<li><a href="../fundamentals/servers/kestrel553c.html?view=aspnetcore-9.0#configurehttpsdefaultsactionhttpsconnectionadapteroptions" data-linktype="relative-path">KestrelServerOptions.ConfigureHttpsDefaults</a></li>
</ul>
<p><strong>Configure the reverse proxy for secure (HTTPS) client connections</strong></p>
<div class="WARNING">
<p>Warning</p>
<p>The security configuration in this section is a general configuration to be used as a starting point for further customization. We're unable to provide support for third-party tooling, servers, and operating systems. <em>Use the configuration in this section at your own risk.</em> For more information, access the following resources:</p>
<ul>
<li><a href="http://nginx.org/docs/http/configuring_https_servers.html" data-linktype="external">Configuring HTTPS servers</a> (Nginx documentation)</li>
<li><a href="https://ssl-config.mozilla.org/#server=nginx" data-linktype="external">mozilla.org SSL Configuration Generator</a></li>
</ul>
</div>
<ul>
<li><p>Configure the server to listen to HTTPS traffic on port 443 by specifying a valid certificate issued by a trusted Certificate Authority (CA).</p>
</li>
<li><p>Harden the security by employing some of the practices depicted in the following <em>/etc/nginx/nginx.conf</em> file.</p>
</li>
<li><p>The following example doesn't configure the server to redirect insecure requests. We recommend using HTTPS Redirection Middleware. For more information, see <a href="../security/enforcing-ssl553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Enforce HTTPS in ASP.NET Core</a>.</p>
<div class="NOTE">
<p>Note</p>
<p>For development environments where the server configuration handles secure redirection instead of HTTPS Redirection Middleware, we recommend using temporary redirects (302) rather than permanent redirects (301). Link caching can cause unstable behavior in development environments.</p>
</div>
</li>
<li><p>Adding a <code>Strict-Transport-Security</code> (HSTS) header ensures all subsequent requests made by the client are over HTTPS. For guidance on setting the <code>Strict-Transport-Security</code> header, see <a href="../security/enforcing-ssl553c.html?view=aspnetcore-9.0#http-strict-transport-security-protocol-hsts" data-linktype="relative-path">Enforce HTTPS in ASP.NET Core</a>.</p>
</li>
<li><p>If HTTPS will be disabled in the future, use one of the following approaches:</p>
<ul>
<li>Don't add the HSTS header.</li>
<li>Choose a short <code>max-age</code> value.</li>
</ul>
</li>
</ul>
<p>Add the <em>/etc/nginx/proxy.conf</em> configuration file:</p>
<pre><code class="lang-nginx">proxy_redirect          off;
proxy_set_header        Host $host;
proxy_set_header        X-Real-IP $remote_addr;
proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header        X-Forwarded-Proto $scheme;
client_max_body_size    10m;
client_body_buffer_size 128k;
proxy_connect_timeout   90;
proxy_send_timeout      90;
proxy_read_timeout      90;
proxy_buffers           32 4k;
</code></pre>
<p><strong>Replace</strong> the contents of the <em>/etc/nginx/nginx.conf</em> configuration file with the following file. The example contains both <code>http</code> and <code>server</code> sections in one configuration file.</p>
<pre><code class="lang-nginx">http {
    include        /etc/nginx/proxy.conf;
    limit_req_zone $binary_remote_addr zone=one:10m rate=5r/s;
    server_tokens  off;

    sendfile on;
    # Adjust keepalive_timeout to the lowest possible value that makes sense 
    # for your use case.
    keepalive_timeout   29;
    client_body_timeout 10; client_header_timeout 10; send_timeout 10;

    upstream helloapp{
        server 127.0.0.1:5000;
    }

    server {
        listen                    443 ssl http2;
        listen                    [::]:443 ssl http2;
        server_name               example.com *.example.com;
        ssl_certificate           /etc/ssl/certs/testCert.crt;
        ssl_certificate_key       /etc/ssl/certs/testCert.key;
        ssl_session_timeout       1d;
        ssl_protocols             TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers off;
        ssl_ciphers               ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_session_cache         shared:SSL:10m;
        ssl_session_tickets       off;
        ssl_stapling              off;

        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;

        #Redirects all traffic
        location / {
            proxy_pass http://helloapp;
            limit_req  zone=one burst=10 nodelay;
        }
    }
}
</code></pre>
<div class="NOTE">
<p>Note</p>
<p>Blazor WebAssembly apps require a larger <code>burst</code> parameter value to accommodate the larger number of requests made by an app. For more information, see <a href="https://learn.microsoft.com/en-us/aspnet/core/blazor/host-and-deploy/webassembly/nginx?view=aspnetcore-9.0" data-linktype="relative-path">Host and deploy ASP.NET Core Blazor WebAssembly with Nginx</a>.</p>
</div>
<div class="NOTE">
<p>Note</p>
<p>The preceding example disables Online Certificate Status Protocol (OCSP) Stapling. If enabled, confirm that the certificate supports the feature. For more information and guidance on enabling OCSP, see the following properties in the <a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html" data-linktype="external">Module ngx_http_ssl_module (Nginx documentation)</a> article:</p>
<ul>
<li><code>ssl_stapling</code></li>
<li><code>ssl_stapling_file</code></li>
<li><code>ssl_stapling_responder</code></li>
<li><code>ssl_stapling_verify</code></li>
</ul>
</div>
<h4 id="secure-nginx-from-clickjacking-1">Secure Nginx from clickjacking</h4>
<p><a href="https://blog.qualys.com/securitylabs/2015/10/20/clickjacking-a-common-implementation-mistake-that-can-put-your-websites-in-danger" data-linktype="external">Clickjacking</a>, also known as a <em>UI redress attack</em>, is a malicious attack where a website visitor is tricked into clicking a link or button on a different page than they're currently visiting. Use <code>X-FRAME-OPTIONS</code> to secure the site.</p>
<p>To mitigate clickjacking attacks:</p>
<ol>
<li><p>Edit the <em>nginx.conf</em> file:</p>
<pre><code class="lang-bash">sudo nano /etc/nginx/nginx.conf
</code></pre>
<p>Add the line: <code>add_header X-Frame-Options "SAMEORIGIN";</code></p>
</li>
<li><p>Save the file.</p>
</li>
<li><p>Restart Nginx.</p>
</li>
</ol>
<h4 id="mime-type-sniffing-1">MIME-type sniffing</h4>
<p>This header prevents most browsers from MIME-sniffing a response away from the declared content type, as the header instructs the browser not to override the response content type. With the <code>nosniff</code> option, if the server says the content is <code>text/html</code>, the browser renders it as <code>text/html</code>.</p>
<ol>
<li><p>Edit the <em>nginx.conf</em> file:</p>
<pre><code class="lang-bash">sudo nano /etc/nginx/nginx.conf
</code></pre>
<p>Add the line: <code>add_header X-Content-Type-Options "nosniff";</code></p>
</li>
<li><p>Save the file.</p>
</li>
<li><p>Restart Nginx.</p>
</li>
</ol>
<h2 id="additional-nginx-suggestions-1">Additional Nginx suggestions</h2>
<p>After upgrading the shared framework on the server, restart the ASP.NET Core apps hosted by the server.</p>
<h2 id="additional-resources-1">Additional resources</h2>
<ul>
<li><a href="https://learn.microsoft.com/en-us/dotnet/core/linux-prerequisites" data-linktype="absolute-path">Prerequisites for .NET Core on Linux</a></li>
<li><a href="https://www.nginx.com/resources/wiki/start/topics/tutorials/install/#official-debian-ubuntu-packages" data-linktype="external">Nginx: Binary Releases: Official Debian/Ubuntu packages</a></li>
<li><a href="../test/troubleshoot553c.html?view=aspnetcore-9.0" data-linktype="relative-path">Troubleshoot and debug ASP.NET Core projects</a></li>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/proxy-load-balancer?view=aspnetcore-9.0" data-linktype="relative-path">Configure ASP.NET Core to work with proxy servers and load balancers</a></li>
<li><a href="https://www.nginx.com/resources/wiki/start/topics/examples/forwarded/" data-linktype="external">NGINX: Using the Forwarded header</a></li>
</ul>
</div>
</div>
					
		<div
			id="ms--inline-notifications"
			class="margin-block-xs"
			data-bi-name="inline-notification"
		></div>
	 
		<div
			id="assertive-live-region"
			role="alert"
			aria-live="assertive"
			class="visually-hidden"
			aria-relevant="additions"
			aria-atomic="true"
		></div>
		<div
			id="polite-live-region"
			role="status"
			aria-live="polite"
			class="visually-hidden"
			aria-relevant="additions"
			aria-atomic="true"
		></div>
	
					
			
		<!-- feedback section -->
		<section
			class="feedback-section position-relative margin-top-lg border border-radius padding-xxs display-none-print"
			data-bi-name="open-source-feedback-section"
			data-open-source-feedback-section
			hidden
		>
			<div class="display-flex flex-direction-column flex-direction-row-tablet">
				<div
					class="width-450-tablet padding-inline-xs padding-inline-xs-tablet padding-top-xs padding-bottom-sm padding-top-xs-tablet background-color-body-medium"
				>
					<div class="display-flex flex-direction-column">
						<div class="padding-bottom-xxs">
							<span class="icon margin-right-xxs" aria-hidden="true">
								<span class="docon docon-brand-github"></span>
							</span>
							<span class="font-weight-semibold">
								Collaborate with us on GitHub
							</span>
						</div>
						<span class="line-height-normal">
							The source for this content can be found on GitHub, where you can also create and review issues and pull requests. For more information, see <a href="https://learn.microsoft.com/contribute/content/dotnet/dotnet-contribute">our contributor guide</a>.
						</span>
					</div>
				</div>
				<div
					class="display-flex gap-xs width-full-tablet flex-direction-column padding-xs justify-content-space-evenly"
				>
					<div class="media">
						
					<div class="media-left">
						<div class="image image-36x36" hidden data-open-source-image-container>
							<img
								class="theme-display is-light"
								src="https://learn.microsoft.com/media/logos/logo_net.svg"
								aria-hidden="true"
								data-open-source-image-light
							/>
							<img
								class="theme-display is-dark is-high-contrast"
								src="https://learn.microsoft.com/media/logos/logo_net.svg"
								aria-hidden="true"
								data-open-source-image-dark
							/>
						</div>
					</div>
			  

						<div class="media-content">
							<p
								class="font-size-xl font-weight-semibold margin-bottom-xxs"
								data-open-source-product-title
							>
								ASP.NET Core
							</p>
							<div class="display-flex gap-xs flex-direction-column">
								<p class="line-height-normal" data-open-source-product-description></p>
								<div class="display-flex gap-xs flex-direction-column">
									<a href="#" data-github-link>
										<span class="icon margin-right-xxs" aria-hidden="true">
											<span class="docon docon-bug"></span>
										</span>
										<span>Open a documentation issue</span>
									</a>
									<a
										href="https://github.com/dotnet/aspnetcore/blob/main/CONTRIBUTING.md"
										class="display-block margin-top-auto font-size-md"
										data-feedback-product-url
									>
										<span class="icon margin-right-xxs" aria-hidden="true">
											<span class="docon docon-feedback"></span>
										</span>
										<span>Provide product feedback</span>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
		<!-- end feedback section -->
	
			
		<!-- feedback section -->
		<section
			id="site-user-feedback-footer"
			class="font-size-sm margin-top-md display-none-print display-none-desktop"
			data-test-id="site-user-feedback-footer"
			data-bi-name="site-feedback-section"
		>
			<hr class="hr" />
			<h2 id="ms--feedback" class="title is-3">Feedback</h2>
			<div class="display-flex flex-wrap-wrap align-items-center">
				<p class="font-weight-semibold margin-xxs margin-left-none">
					Was this page helpful?
				</p>
				<div class="buttons">
					<button
						class="thumb-rating-button like button button-primary button-sm"
						data-test-id="footer-rating-yes"
						data-binary-rating-response="rating-yes"
						type="button"
						title="This article is helpful"
						data-bi-name="button-rating-yes"
						aria-pressed="false"
					>
						<span class="icon" aria-hidden="true">
							<span class="docon docon-like"></span>
						</span>
						<span>Yes</span>
					</button>
					<button
						class="thumb-rating-button dislike button button-primary button-sm"
						data-test-id="footer-rating-no"
						data-binary-rating-response="rating-no"
						type="button"
						title="This article is not helpful"
						data-bi-name="button-rating-no"
						aria-pressed="false"
					>
						<span class="icon" aria-hidden="true">
							<span class="docon docon-dislike"></span>
						</span>
						<span>No</span>
					</button>
				</div>
			</div>
		</section>
		<!-- end feedback section -->
	
		
				</div>
				
		<div id="ms--additional-resources-mobile" class="display-none-print">
			<hr class="hr" hidden />
			<h2 id="ms--additional-resources-mobile-heading" class="title is-3" hidden>
				Additional resources
			</h2>
			
		<section
			id="right-rail-recommendations-mobile"
			class=""
			data-bi-name="recommendations"
			hidden
		></section>
	 
		<section
			id="right-rail-training-mobile"
			class=""
			data-bi-name="learning-resource-card"
			hidden
		></section>
	 
		<section
			id="right-rail-events-mobile"
			class=""
			data-bi-name="events-card"
			hidden
		></section>
	 
		<section
			id="right-rail-qna-mobile"
			class="margin-top-xxs"
			data-bi-name="qna-link-card"
			hidden
		></section>
	
		</div>
	
			</div>
			
		<div
			id="action-panel"
			role="region"
			aria-label="Action Panel"
			class="action-panel"
			tabindex="-1"
		></div>
	
		
				</main>
				<aside
					id="layout-body-aside"
					class="layout-body-aside "
					data-bi-name="aside"
			  >
					
		<div
			id="ms--additional-resources"
			class="right-container padding-sm display-none display-block-desktop height-full"
			data-bi-name="pageactions"
			role="complementary"
			aria-label="Additional resources"
		>
			<div id="affixed-right-container" data-bi-name="right-column">
				
		<nav
			id="side-doc-outline"
			class="doc-outline border-bottom padding-bottom-xs margin-bottom-xs"
			data-bi-name="intopic toc"
			aria-label="In this article"
		>
			<h3>In this article</h3>
		</nav>
	
				<!-- Feedback -->
				
		<section
			id="ms--site-user-feedback-right-rail"
			class="font-size-sm display-none-print"
			data-test-id="site-user-feedback-right-rail"
			data-bi-name="site-feedback-right-rail"
		>
			<p class="font-weight-semibold margin-bottom-xs">Was this page helpful?</p>
			<div class="buttons">
				<button
					class="thumb-rating-button like button button-primary button-sm"
					data-test-id="right-rail-rating-yes"
					data-binary-rating-response="rating-yes"
					type="button"
					title="This article is helpful"
					data-bi-name="button-rating-yes"
					aria-pressed="false"
				>
					<span class="icon" aria-hidden="true">
						<span class="docon docon-like"></span>
					</span>
					<span>Yes</span>
				</button>
				<button
					class="thumb-rating-button dislike button button-primary button-sm"
					data-test-id="right-rail-rating-no"
					data-binary-rating-response="rating-no"
					type="button"
					title="This article is not helpful"
					data-bi-name="button-rating-no"
					aria-pressed="false"
				>
					<span class="icon" aria-hidden="true">
						<span class="docon docon-dislike"></span>
					</span>
					<span>No</span>
				</button>
			</div>
		</section>
	
			</div>
		</div>
	
			  </aside> <section
					id="layout-body-flyout"
					class="layout-body-flyout "
					data-bi-name="flyout"
			  >
					 <div
	class="height-full border-left background-color-body-medium"
	id="ask-learn-flyout"
></div>
			  </section> <div class="layout-body-footer " data-bi-name="layout-footer">
		<footer
			id="footer"
			data-test-id="footer"
			data-bi-name="footer"
			class="footer-layout has-padding has-default-focus border-top  uhf-container"
			role="contentinfo"
		>
			<div class="display-flex gap-xs flex-wrap-wrap is-full-height padding-right-lg-desktop">
				
		<a
			data-mscc-ic="false"
			href="#"
			data-bi-name="select-locale"
			class="locale-selector-link flex-shrink-0 button button-sm button-clear external-link-indicator"
			id=""
			title=""
			><span class="icon" aria-hidden="true"
				><span class="docon docon-world"></span></span
			><span class="local-selector-link-text">en-us</span></a
		>
	
				<div class="ccpa-privacy-link" data-ccpa-privacy-link hidden>
		
		<a
			data-mscc-ic="false"
			href="https://aka.ms/yourcaliforniaprivacychoices"
			data-bi-name="your-privacy-choices"
			class="button button-sm button-clear flex-shrink-0 external-link-indicator"
			id=""
			title=""
			>
		<svg
			xmlns="http://www.w3.org/2000/svg"
			viewBox="0 0 30 14"
			xml:space="preserve"
			height="16"
			width="43"
			aria-hidden="true"
			focusable="false"
		>
			<path
				d="M7.4 12.8h6.8l3.1-11.6H7.4C4.2 1.2 1.6 3.8 1.6 7s2.6 5.8 5.8 5.8z"
				style="fill-rule:evenodd;clip-rule:evenodd;fill:#fff"
			></path>
			<path
				d="M22.6 0H7.4c-3.9 0-7 3.1-7 7s3.1 7 7 7h15.2c3.9 0 7-3.1 7-7s-3.2-7-7-7zm-21 7c0-3.2 2.6-5.8 5.8-5.8h9.9l-3.1 11.6H7.4c-3.2 0-5.8-2.6-5.8-5.8z"
				style="fill-rule:evenodd;clip-rule:evenodd;fill:#06f"
			></path>
			<path
				d="M24.6 4c.2.2.2.6 0 .8L22.5 7l2.2 2.2c.2.2.2.6 0 .8-.2.2-.6.2-.8 0l-2.2-2.2-2.2 2.2c-.2.2-.6.2-.8 0-.2-.2-.2-.6 0-.8L20.8 7l-2.2-2.2c-.2-.2-.2-.6 0-.8.2-.2.6-.2.8 0l2.2 2.2L23.8 4c.2-.2.6-.2.8 0z"
				style="fill:#fff"
			></path>
			<path
				d="M12.7 4.1c.2.2.3.6.1.8L8.6 9.8c-.1.1-.2.2-.3.2-.2.1-.5.1-.7-.1L5.4 7.7c-.2-.2-.2-.6 0-.8.2-.2.6-.2.8 0L8 8.6l3.8-4.5c.2-.2.6-.2.9 0z"
				style="fill:#06f"
			></path>
		</svg>
	
			<span>Your Privacy Choices</span></a
		>
	
	</div>
				<div class="flex-shrink-0">
		<div class="dropdown has-caret-up">
			<button
				data-test-id="theme-selector-button"
				class="dropdown-trigger button button-clear button-sm has-inner-focus theme-dropdown-trigger"
				aria-controls="{{ themeMenuId }}"
				aria-expanded="false"
				title="Theme"
				data-bi-name="theme"
			>
				<span class="icon">
					<span class="docon docon-sun" aria-hidden="true"></span>
				</span>
				<span>Theme</span>
				<span class="icon expanded-indicator" aria-hidden="true">
					<span class="docon docon-chevron-down-light"></span>
				</span>
			</button>
			<div class="dropdown-menu" id="{{ themeMenuId }}" role="menu">
				<ul class="theme-selector padding-xxs" data-test-id="theme-dropdown-menu">
					<li class="theme display-block">
						<button
							class="button button-clear button-sm theme-control button-block justify-content-flex-start text-align-left"
							data-theme-to="light"
						>
							<span class="theme-light margin-right-xxs">
								<span
									class="theme-selector-icon border display-inline-block has-body-background"
									aria-hidden="true"
								>
									<svg class="svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 14">
										<rect width="22" height="14" class="has-fill-body-background" />
										<rect x="5" y="5" width="12" height="4" class="has-fill-secondary" />
										<rect x="5" y="2" width="2" height="1" class="has-fill-secondary" />
										<rect x="8" y="2" width="2" height="1" class="has-fill-secondary" />
										<rect x="11" y="2" width="3" height="1" class="has-fill-secondary" />
										<rect x="1" y="1" width="2" height="2" class="has-fill-secondary" />
										<rect x="5" y="10" width="7" height="2" rx="0.3" class="has-fill-primary" />
										<rect x="19" y="1" width="2" height="2" rx="1" class="has-fill-secondary" />
									</svg>
								</span>
							</span>
							<span role="menuitem"> Light </span>
						</button>
					</li>
					<li class="theme display-block">
						<button
							class="button button-clear button-sm theme-control button-block justify-content-flex-start text-align-left"
							data-theme-to="dark"
						>
							<span class="theme-dark margin-right-xxs">
								<span
									class="border theme-selector-icon display-inline-block has-body-background"
									aria-hidden="true"
								>
									<svg class="svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 14">
										<rect width="22" height="14" class="has-fill-body-background" />
										<rect x="5" y="5" width="12" height="4" class="has-fill-secondary" />
										<rect x="5" y="2" width="2" height="1" class="has-fill-secondary" />
										<rect x="8" y="2" width="2" height="1" class="has-fill-secondary" />
										<rect x="11" y="2" width="3" height="1" class="has-fill-secondary" />
										<rect x="1" y="1" width="2" height="2" class="has-fill-secondary" />
										<rect x="5" y="10" width="7" height="2" rx="0.3" class="has-fill-primary" />
										<rect x="19" y="1" width="2" height="2" rx="1" class="has-fill-secondary" />
									</svg>
								</span>
							</span>
							<span role="menuitem"> Dark </span>
						</button>
					</li>
					<li class="theme display-block">
						<button
							class="button button-clear button-sm theme-control button-block justify-content-flex-start text-align-left"
							data-theme-to="high-contrast"
						>
							<span class="theme-high-contrast margin-right-xxs">
								<span
									class="border theme-selector-icon display-inline-block has-body-background"
									aria-hidden="true"
								>
									<svg class="svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 14">
										<rect width="22" height="14" class="has-fill-body-background" />
										<rect x="5" y="5" width="12" height="4" class="has-fill-secondary" />
										<rect x="5" y="2" width="2" height="1" class="has-fill-secondary" />
										<rect x="8" y="2" width="2" height="1" class="has-fill-secondary" />
										<rect x="11" y="2" width="3" height="1" class="has-fill-secondary" />
										<rect x="1" y="1" width="2" height="2" class="has-fill-secondary" />
										<rect x="5" y="10" width="7" height="2" rx="0.3" class="has-fill-primary" />
										<rect x="19" y="1" width="2" height="2" rx="1" class="has-fill-secondary" />
									</svg>
								</span>
							</span>
							<span role="menuitem"> High contrast </span>
						</button>
					</li>
				</ul>
			</div>
		</div>
	</div>
			</div>
			<ul class="links" data-bi-name="footerlinks">
				<li class="manage-cookies-holder" hidden=""></li>
				<li>
		
		<a
			data-mscc-ic="false"
			href="https://learn.microsoft.com/en-us/principles-for-ai-generated-content"
			data-bi-name="aiDisclaimer"
			class=" external-link-indicator"
			id=""
			title=""
			>AI Disclaimer</a
		>
	
	</li><li>
		
		<a
			data-mscc-ic="false"
			href="https://learn.microsoft.com/en-us/previous-versions/"
			data-bi-name="archivelink"
			class=" external-link-indicator"
			id=""
			title=""
			>Previous Versions</a
		>
	
	</li> <li>
		
		<a
			data-mscc-ic="false"
			href="https://techcommunity.microsoft.com/t5/microsoft-learn-blog/bg-p/MicrosoftLearnBlog"
			data-bi-name="bloglink"
			class=" external-link-indicator"
			id=""
			title=""
			>Blog</a
		>
	
	</li> <li>
		
		<a
			data-mscc-ic="false"
			href="https://learn.microsoft.com/en-us/contribute"
			data-bi-name="contributorGuide"
			class=" external-link-indicator"
			id=""
			title=""
			>Contribute</a
		>
	
	</li><li>
		
		<a
			data-mscc-ic="false"
			href="https://go.microsoft.com/fwlink/?LinkId=521839"
			data-bi-name="privacy"
			class=" external-link-indicator"
			id=""
			title=""
			>Privacy</a
		>
	
	</li><li>
		
		<a
			data-mscc-ic="false"
			href="https://learn.microsoft.com/en-us/legal/termsofuse"
			data-bi-name="termsofuse"
			class=" external-link-indicator"
			id=""
			title=""
			>Terms of Use</a
		>
	
	</li><li>
		
		<a
			data-mscc-ic="false"
			href="https://www.microsoft.com/legal/intellectualproperty/Trademarks/"
			data-bi-name="trademarks"
			class=" external-link-indicator"
			id=""
			title=""
			>Trademarks</a
		>
	
	</li>
				<li>&copy; Microsoft 2025</li>
			</ul>
		</footer>
	</footer>
			</body>
		
<!-- Mirrored from learn.microsoft.com/en-us/aspnet/core/host-and-deploy/linux-nginx?view=aspnetcore-9.0 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 06 Aug 2025 14:53:03 GMT -->
</html>