<!DOCTYPE html>
<html lang="en">
  
<!-- Mirrored from perldoc.perl.org/5.6.1/perlfaq5 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 06 Aug 2025 16:20:46 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>perlfaq5 - Files and Formats ($Revision: 1.38 $, $Date: 1999/05/23 16:08:30 $) - Perldoc Browser</title>
    <link rel="search" href="../opensearch.xml" type="application/opensearchdescription+xml" title="Perldoc Browser">
    <link rel="canonical" href="../perlfaq5.html">
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/stackoverflow-light.min.css" rel="stylesheet">
    <link href="../css/perldoc.css" rel="stylesheet">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KVNWBNT5FB"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-KVNWBNT5FB');
      gtag('config', 'UA-50555-3');
    </script>
  </head>
  <body>
    <nav class="navbar navbar-expand-md bg-dark" data-bs-theme="dark"><div class="container-fluid">
  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <a class="navbar-brand" href="../index.html"><img src="../images/perl_camel_30.png" width="30" height="30" class="d-inline-block align-text-top" alt="Perl Camel Logo"> Perldoc Browser</a>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav me-auto">
      <li class="nav-item dropdown text-nowrap">
        <a class="nav-link dropdown-toggle" href="#" id="dropdownlink-stable" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">5.6.1</a>
        <div class="dropdown-menu" aria-labelledby="dropdownlink-stable">
          <a class="dropdown-item" href="../perlfaq5.html">Latest</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.42.0/perlfaq5">5.42.0</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.40.3/perlfaq5">5.40.3</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.40.2/perlfaq5">5.40.2</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.40.1/perlfaq5">5.40.1</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.40.0/perlfaq5">5.40.0</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.38.5/perlfaq5">5.38.5</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.38.4/perlfaq5">5.38.4</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.38.3/perlfaq5">5.38.3</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.38.2/perlfaq5">5.38.2</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.38.1/perlfaq5">5.38.1</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.38.0/perlfaq5">5.38.0</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.36.3/perlfaq5">5.36.3</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.36.2/perlfaq5">5.36.2</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.36.1/perlfaq5">5.36.1</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.36.0/perlfaq5">5.36.0</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.34.3/perlfaq5">5.34.3</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.34.2/perlfaq5">5.34.2</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.34.1/perlfaq5">5.34.1</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.34.0/perlfaq5">5.34.0</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.32.1/perlfaq5">5.32.1</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.32.0/perlfaq5">5.32.0</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.30.3/perlfaq5">5.30.3</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.30.2/perlfaq5">5.30.2</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.30.1/perlfaq5">5.30.1</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.30.0/perlfaq5">5.30.0</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.28.3/perlfaq5">5.28.3</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.28.2/perlfaq5">5.28.2</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.28.1/perlfaq5">5.28.1</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.28.0/perlfaq5">5.28.0</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.26.3/perlfaq5">5.26.3</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.26.2/perlfaq5">5.26.2</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.26.1/perlfaq5">5.26.1</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.26.0/perlfaq5">5.26.0</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.24.4/perlfaq5">5.24.4</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.24.3/perlfaq5">5.24.3</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.24.2/perlfaq5">5.24.2</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.24.1/perlfaq5">5.24.1</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.24.0/perlfaq5">5.24.0</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.22.4/perlfaq5">5.22.4</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.22.3/perlfaq5">5.22.3</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.22.2/perlfaq5">5.22.2</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.22.1/perlfaq5">5.22.1</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.22.0/perlfaq5">5.22.0</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.20.3/perlfaq5">5.20.3</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.20.2/perlfaq5">5.20.2</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.20.1/perlfaq5">5.20.1</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.20.0/perlfaq5">5.20.0</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.18.4/perlfaq5">5.18.4</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.18.3/perlfaq5">5.18.3</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.18.2/perlfaq5">5.18.2</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.18.1/perlfaq5">5.18.1</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.18.0/perlfaq5">5.18.0</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.16.3/perlfaq5">5.16.3</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.16.2/perlfaq5">5.16.2</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.16.1/perlfaq5">5.16.1</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.16.0/perlfaq5">5.16.0</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.14.4/perlfaq5">5.14.4</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.14.3/perlfaq5">5.14.3</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.14.2/perlfaq5">5.14.2</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.14.1/perlfaq5">5.14.1</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.14.0/perlfaq5">5.14.0</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.12.5/perlfaq5">5.12.5</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.12.4/perlfaq5">5.12.4</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.12.3/perlfaq5">5.12.3</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.12.2/perlfaq5">5.12.2</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.12.1/perlfaq5">5.12.1</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.12.0/perlfaq5">5.12.0</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.10.1/perlfaq5">5.10.1</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.10.0/perlfaq5">5.10.0</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.8.9/perlfaq5">5.8.9</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.8.8/perlfaq5">5.8.8</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.8.7/perlfaq5">5.8.7</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.8.6/perlfaq5">5.8.6</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.8.5/perlfaq5">5.8.5</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.8.4/perlfaq5">5.8.4</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.8.3/perlfaq5">5.8.3</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.8.2/perlfaq5">5.8.2</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.8.1/perlfaq5">5.8.1</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.8.0/perlfaq5">5.8.0</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="../5.6.2/perlfaq5.html">5.6.2</a>
          <a class="dropdown-item active" href="perlfaq5.html">5.6.1</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.6.0/perlfaq5">5.6.0</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.005_04/perlfaq5">5.005_04</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.005_03/perlfaq5">5.005_03</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.005_02/perlfaq5">5.005_02</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.005_01/perlfaq5">5.005_01</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.005/perlfaq5">5.005</a>
        </div>
      </li>
      <li class="nav-item dropdown text-nowrap">
        <a class="nav-link dropdown-toggle" href="#" id="dropdownlink-dev" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Dev</a>
        <div class="dropdown-menu" aria-labelledby="dropdownlink-dev">
          <a class="dropdown-item" href="https://perldoc.perl.org/blead/perlfaq5">blead</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.43.1/perlfaq5">5.43.1</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.42.0-RC3/perlfaq5">5.42.0-RC3</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.42.0-RC2/perlfaq5">5.42.0-RC2</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.42.0-RC1/perlfaq5">5.42.0-RC1</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.41.13/perlfaq5">5.41.13</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.41.12/perlfaq5">5.41.12</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.41.11/perlfaq5">5.41.11</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.41.10/perlfaq5">5.41.10</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.41.9/perlfaq5">5.41.9</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.41.8/perlfaq5">5.41.8</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.41.7/perlfaq5">5.41.7</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.41.6/perlfaq5">5.41.6</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.41.5/perlfaq5">5.41.5</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.41.4/perlfaq5">5.41.4</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.41.3/perlfaq5">5.41.3</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.41.2/perlfaq5">5.41.2</a>
          <a class="dropdown-item" href="https://perldoc.perl.org/5.41.1/perlfaq5">5.41.1</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.40.3-RC1/perlfaq5">5.40.3-RC1</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="https://perldoc.perl.org/5.38.5-RC1/perlfaq5">5.38.5-RC1</a>
        </div>
      </li>
      <li class="nav-item dropdown text-nowrap">
        <a class="nav-link dropdown-toggle" href="#" id="dropdownlink-nav" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Documentation</a>
        <div class="dropdown-menu" aria-labelledby="dropdownlink-nav">
          <a class="dropdown-item" href="perl.html">Perl</a>
          <a class="dropdown-item" href="perlintro.html">Intro</a>
          <a class="dropdown-item" href="perl.html#Tutorials">Tutorials</a>
          <a class="dropdown-item" href="perlfaq.html">FAQs</a>
          <a class="dropdown-item" href="perl.html#Reference-Manual">Reference</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="perlop.html">Operators</a>
          <a class="dropdown-item" href="functions.html">Functions</a>
          <a class="dropdown-item" href="variables.html">Variables</a>
          <a class="dropdown-item" href="modules.html">Modules</a>
          <a class="dropdown-item" href="perlutil.html">Utilities</a>
          <hr class="dropdown-divider">
          <a class="dropdown-item" href="perldelta.html">Release Notes</a>
          <a class="dropdown-item" href="perlcommunity.html">Community</a>
          <a class="dropdown-item" href="perlhist.html">History</a>
        </div>
      </li>
    </ul>
    <ul class="navbar-nav">
      <button id="content-expand-button" type="button" class="btn btn-dark d-none d-lg-inline-block me-4">Expand</button>
      <script src="../js/perldoc-expand-page.js"></script>
    </ul>
    <form class="form-inline" method="get" action="https://perldoc.perl.org/5.6.1/search">
      <input id="search-input" class="form-control me-3" type="search" name="q" placeholder="[S]earch" aria-label="Search" value="">
    </form>
    <script src="../js/perldoc-focus-search.js"></script>
  </div>
</div></nav>

    <div id="wrapperlicious" class="container-fluid">
      <div id="perldocdiv">
        <div id="links">
          <a href="perlfaq5.html">perlfaq5</a>
          <div id="more">
            (<a href="https://perldoc.perl.org/5.6.1/perlfaq5.txt">source</a>,
            <a href="https://metacpan.org/pod/perlfaq5">CPAN</a>)
          </div>
        </div>
        <div class="leading-notice">
          You are viewing the version of this documentation from Perl 5.6.1.
            <a href="../perlfaq5.html">View the latest version</a>
        </div>
        <h1><a id="toc">CONTENTS</a></h1>
                  <ul>
              <li>
                <a class="text-decoration-none" href="#NAME">NAME</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#DESCRIPTION">DESCRIPTION</a>
                            <ul>
              <li>
                <a class="text-decoration-none" href="#How-do-I-flush/unbuffer-an-output-filehandle?-Why-must-I-do-this?">How do I flush/unbuffer an output filehandle? Why must I do this?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-do-I-change-one-line-in-a-file/delete-a-line-in-a-file/insert-a-line-in-the-middle-of-a-file/append-to-the-beginning-of-a-file?">How do I change one line in a file/delete a line in a file/insert a line in the middle of a file/append to the beginning of a file?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-do-I-count-the-number-of-lines-in-a-file?">How do I count the number of lines in a file?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-do-I-make-a-temporary-file-name?">How do I make a temporary file name?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-can-I-manipulate-fixed-record-length-files?">How can I manipulate fixed-record-length files?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-can-I-make-a-filehandle-local-to-a-subroutine?-How-do-I-pass-filehandles-between-subroutines?-How-do-I-make-an-array-of-filehandles?">How can I make a filehandle local to a subroutine? How do I pass filehandles between subroutines? How do I make an array of filehandles?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-can-I-use-a-filehandle-indirectly?">How can I use a filehandle indirectly?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-can-I-set-up-a-footer-format-to-be-used-with-write()?">How can I set up a footer format to be used with write()?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-can-I-write()-into-a-string?">How can I write() into a string?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-can-I-output-my-numbers-with-commas-added?">How can I output my numbers with commas added?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-can-I-translate-tildes-(~)-in-a-filename?">How can I translate tildes (~) in a filename?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-come-when-I-open-a-file-read-write-it-wipes-it-out?">How come when I open a file read-write it wipes it out?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#Why-do-I-sometimes-get-an-%22Argument-list-too-long%22-when-I-use-%3C*%3E?">Why do I sometimes get an &quot;Argument list too long&quot; when I use &lt;*&gt;?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#Is-there-a-leak/bug-in-glob()?">Is there a leak/bug in glob()?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-can-I-open-a-file-with-a-leading-%22%3E%22-or-trailing-blanks?">How can I open a file with a leading &quot;&gt;&quot; or trailing blanks?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-can-I-reliably-rename-a-file?">How can I reliably rename a file?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-can-I-lock-a-file?">How can I lock a file?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#Why-can&#39;t-I-just-open(FH,-%22%3Efile.lock%22)?">Why can&#39;t I just open(FH, &quot;&gt;file.lock&quot;)?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#I-still-don&#39;t-get-locking.-I-just-want-to-increment-the-number-in-the-file.-How-can-I-do-this?">I still don&#39;t get locking. I just want to increment the number in the file. How can I do this?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-do-I-randomly-update-a-binary-file?">How do I randomly update a binary file?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-do-I-get-a-file&#39;s-timestamp-in-perl?">How do I get a file&#39;s timestamp in perl?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-do-I-set-a-file&#39;s-timestamp-in-perl?">How do I set a file&#39;s timestamp in perl?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-do-I-print-to-more-than-one-file-at-once?">How do I print to more than one file at once?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-can-I-read-in-an-entire-file-all-at-once?">How can I read in an entire file all at once?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-can-I-read-in-a-file-by-paragraphs?">How can I read in a file by paragraphs?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-can-I-read-a-single-character-from-a-file?-From-the-keyboard?">How can I read a single character from a file? From the keyboard?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-can-I-tell-whether-there&#39;s-a-character-waiting-on-a-filehandle?">How can I tell whether there&#39;s a character waiting on a filehandle?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-do-I-do-a-tail-f-in-perl?">How do I do a tail -f in perl?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-do-I-dup()-a-filehandle-in-Perl?">How do I dup() a filehandle in Perl?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-do-I-close-a-file-descriptor-by-number?">How do I close a file descriptor by number?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#Why-can&#39;t-I-use-%22C:%5Ctemp%5Cfoo%22-in-DOS-paths?-What-doesn&#39;t-%60C:%5Ctemp%5Cfoo.exe%60-work?">Why can&#39;t I use &quot;C:\temp\foo&quot; in DOS paths? What doesn&#39;t `C:\temp\foo.exe` work?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#Why-doesn&#39;t-glob(%22*.*%22)-get-all-the-files?">Why doesn&#39;t glob(&quot;*.*&quot;) get all the files?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#Why-does-Perl-let-me-delete-read-only-files?-Why-does-i-clobber-protected-files?-Isn&#39;t-this-a-bug-in-Perl?">Why does Perl let me delete read-only files? Why does -i clobber protected files? Isn&#39;t this a bug in Perl?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#How-do-I-select-a-random-line-from-a-file?">How do I select a random line from a file?</a>
              </li>
              <li>
                <a class="text-decoration-none" href="#Why-do-I-get-weird-spaces-when-I-print-an-array-of-lines?">Why do I get weird spaces when I print an array of lines?</a>
              </li>
          </ul>

              </li>
              <li>
                <a class="text-decoration-none" href="#AUTHOR-AND-COPYRIGHT">AUTHOR AND COPYRIGHT</a>
              </li>
          </ul>

      <h1 id="NAME"><a class="permalink" href="#NAME">#</a>NAME</h1>

<p>perlfaq5 - Files and Formats ($Revision: 1.38 $, $Date: 1999/05/23 16:08:30 $)</p>

<h1 id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">#</a>DESCRIPTION</h1>

<p>This section deals with I/O and the &quot;f&quot; issues: filehandles, flushing, formats, and footers.</p>

<h2 id="How-do-I-flush/unbuffer-an-output-filehandle?-Why-must-I-do-this?"><a class="permalink" href="#How-do-I-flush/unbuffer-an-output-filehandle?-Why-must-I-do-this?">#</a><a id="How"></a><a id="How-do-I-flush-unbuffer-an-output-filehandle-Why-must-I-do-this"></a>How do I flush/unbuffer an output filehandle? Why must I do this?</h2>

<p>The C standard I/O library (stdio) normally buffers characters sent to devices. This is done for efficiency reasons so that there isn&#39;t a system call for each byte. Any time you use print() or write() in Perl, you go though this buffering. syswrite() circumvents stdio and buffering.</p>

<p>In most stdio implementations, the type of output buffering and the size of the buffer varies according to the type of device. Disk files are block buffered, often with a buffer size of more than 2k. Pipes and sockets are often buffered with a buffer size between 1/2 and 2k. Serial devices (e.g. modems, terminals) are normally line-buffered, and stdio sends the entire line when it gets the newline.</p>

<p>Perl does not support truly unbuffered output (except insofar as you can <code>syswrite(OUT, $char, 1)</code>). What it does instead support is &quot;command buffering&quot;, in which a physical write is performed after every output command. This isn&#39;t as hard on your system as unbuffering, but does get the output where you want it when you want it.</p>

<p>If you expect characters to get to your device when you print them there, you&#39;ll want to autoflush its handle. Use select() and the <code>$|</code> variable to control autoflushing (see <a>perlvar/$</a> and <a href="perlfunc.html#select">&quot;select&quot; in perlfunc</a>):</p>

<pre><code>$old_fh = select(OUTPUT_HANDLE);
$| = 1;
select($old_fh);</code></pre>

<p>Or using the traditional idiom:</p>

<pre><code>select((select(OUTPUT_HANDLE), $| = 1)[0]);</code></pre>

<p>Or if don&#39;t mind slowly loading several thousand lines of module code just because you&#39;re afraid of the <code>$|</code> variable:</p>

<pre><code>use FileHandle;
open(DEV, &quot;+&lt;/dev/tty&quot;); 	  # ceci n&#39;est pas une pipe
DEV-&gt;autoflush(1);</code></pre>

<p>or the newer IO::* modules:</p>

<pre><code>use IO::Handle;
open(DEV, &quot;&gt;/dev/printer&quot;);   # but is this?
DEV-&gt;autoflush(1);</code></pre>

<p>or even this:</p>

<pre><code>    use IO::Socket;		  # this one is kinda a pipe?
    $sock = IO::Socket::INET-&gt;new(PeerAddr =&gt; &#39;www.perl.com&#39;,
				  PeerPort =&gt; &#39;http(80)&#39;,
				  Proto    =&gt; &#39;tcp&#39;);
    die &quot;$!&quot; unless $sock;

    $sock-&gt;autoflush();
    print $sock &quot;GET / HTTP/1.0&quot; . &quot;\015\012&quot; x 2;
    $document = join(&#39;&#39;, &lt;$sock&gt;);
    print &quot;DOC IS: $document\n&quot;;</code></pre>

<p>Note the bizarrely hardcoded carriage return and newline in their octal equivalents. This is the ONLY way (currently) to assure a proper flush on all platforms, including Macintosh. That&#39;s the way things work in network programming: you really should specify the exact bit pattern on the network line terminator. In practice, <code>&quot;\n\n&quot;</code> often works, but this is not portable.</p>

<p>See <a href="perlfaq9.html">perlfaq9</a> for other examples of fetching URLs over the web.</p>

<h2 id="How-do-I-change-one-line-in-a-file/delete-a-line-in-a-file/insert-a-line-in-the-middle-of-a-file/append-to-the-beginning-of-a-file?"><a class="permalink" href="#How-do-I-change-one-line-in-a-file/delete-a-line-in-a-file/insert-a-line-in-the-middle-of-a-file/append-to-the-beginning-of-a-file?">#</a><a id="How1"></a><a id="How-do-I-change-one-line-in-a-file-delete-a-line-in-a-file-insert-a-line-in-the-middle-of-a-file-append-to-the-beginning-of-a-file"></a>How do I change one line in a file/delete a line in a file/insert a line in the middle of a file/append to the beginning of a file?</h2>

<p>Those are operations of a text editor. Perl is not a text editor. Perl is a programming language. You have to decompose the problem into low-level calls to read, write, open, close, and seek.</p>

<p>Although humans have an easy time thinking of a text file as being a sequence of lines that operates much like a stack of playing cards--or punch cards--computers usually see the text file as a sequence of bytes. In general, there&#39;s no direct way for Perl to seek to a particular line of a file, insert text into a file, or remove text from a file.</p>

<p>(There are exceptions in special circumstances. You can add or remove data at the very end of the file. A sequence of bytes can be replaced with another sequence of the same length. The <code>$DB_RECNO</code> array bindings as documented in <a href="https://perldoc.perl.org/5.6.1/DB_File">DB_File</a> also provide a direct way of modifying a file. Files where all lines are the same length are also easy to alter.)</p>

<p>The general solution is to create a temporary copy of the text file with the changes you want, then copy that over the original. This assumes no locking.</p>

<pre><code>    $old = $file;
    $new = &quot;$file.tmp.$$&quot;;
    $bak = &quot;$file.orig&quot;;

    open(OLD, &quot;&lt; $old&quot;) 	or die &quot;can&#39;t open $old: $!&quot;;
    open(NEW, &quot;&gt; $new&quot;) 	or die &quot;can&#39;t open $new: $!&quot;;

    # Correct typos, preserving case
    while (&lt;OLD&gt;) {
	s/\b(p)earl\b/${1}erl/i;
	(print NEW $_)		or die &quot;can&#39;t write to $new: $!&quot;;
    }

    close(OLD)			or die &quot;can&#39;t close $old: $!&quot;;
    close(NEW) 			or die &quot;can&#39;t close $new: $!&quot;;

    rename($old, $bak)		or die &quot;can&#39;t rename $old to $bak: $!&quot;;
    rename($new, $old)		or die &quot;can&#39;t rename $new to $old: $!&quot;;</code></pre>

<p>Perl can do this sort of thing for you automatically with the <code>-i</code> command-line switch or the closely-related <code>$^I</code> variable (see <a href="perlrun.html">perlrun</a> for more details). Note that <code>-i</code> may require a suffix on some non-Unix systems; see the platform-specific documentation that came with your port.</p>

<pre><code>    # Renumber a series of tests from the command line
    perl -pi -e &#39;s/(^\s+test\s+)\d+/ $1 . ++$count /e&#39; t/op/taint.t

    # form a script
    local($^I, @ARGV) = (&#39;.orig&#39;, glob(&quot;*.c&quot;));
    while (&lt;&gt;) {
	if ($. == 1) {
	    print &quot;This line should appear at the top of each file\n&quot;;
	}
	s/\b(p)earl\b/${1}erl/i;        # Correct typos, preserving case
	print;
	close ARGV if eof;              # Reset $.
    }</code></pre>

<p>If you need to seek to an arbitrary line of a file that changes infrequently, you could build up an index of byte positions of where the line ends are in the file. If the file is large, an index of every tenth or hundredth line end would allow you to seek and read fairly efficiently. If the file is sorted, try the look.pl library (part of the standard perl distribution).</p>

<p>In the unique case of deleting lines at the end of a file, you can use tell() and truncate(). The following code snippet deletes the last line of a file without making a copy or reading the whole file into memory:</p>

<pre><code>	open (FH, &quot;+&lt; $file&quot;);
        while ( &lt;FH&gt; ) { $addr = tell(FH) unless eof(FH) }
        truncate(FH, $addr);</code></pre>

<p>Error checking is left as an exercise for the reader.</p>

<h2 id="How-do-I-count-the-number-of-lines-in-a-file?"><a class="permalink" href="#How-do-I-count-the-number-of-lines-in-a-file?">#</a><a id="How2"></a><a id="How-do-I-count-the-number-of-lines-in-a-file"></a>How do I count the number of lines in a file?</h2>

<p>One fairly efficient way is to count newlines in the file. The following program uses a feature of tr///, as documented in <a href="perlop.html">perlop</a>. If your text file doesn&#39;t end with a newline, then it&#39;s not really a proper text file, so this may report one fewer line than you expect.</p>

<pre><code>    $lines = 0;
    open(FILE, $filename) or die &quot;Can&#39;t open `$filename&#39;: $!&quot;;
    while (sysread FILE, $buffer, 4096) {
	$lines += ($buffer =~ tr/\n//);
    }
    close FILE;</code></pre>

<p>This assumes no funny games with newline translations.</p>

<h2 id="How-do-I-make-a-temporary-file-name?"><a class="permalink" href="#How-do-I-make-a-temporary-file-name?">#</a><a id="How3"></a><a id="How-do-I-make-a-temporary-file-name"></a>How do I make a temporary file name?</h2>

<p>Use the <code>new_tmpfile</code> class method from the IO::File module to get a filehandle opened for reading and writing. Use it if you don&#39;t need to know the file&#39;s name:</p>

<pre><code>    use IO::File;
    $fh = IO::File-&gt;new_tmpfile()
	or die &quot;Unable to make new temporary file: $!&quot;;</code></pre>

<p>If you do need to know the file&#39;s name, you can use the <code>tmpnam</code> function from the POSIX module to get a filename that you then open yourself:</p>

<pre><code>use Fcntl;
use POSIX qw(tmpnam);

# try new temporary filenames until we get one that didn&#39;t already
# exist;  the check should be unnecessary, but you can&#39;t be too careful
do { $name = tmpnam() }
    until sysopen(FH, $name, O_RDWR|O_CREAT|O_EXCL);

# install atexit-style handler so that when we exit or die,
# we automatically delete this temporary file
END { unlink($name) or die &quot;Couldn&#39;t unlink $name : $!&quot; }

# now go on to use the file ...</code></pre>

<p>If you&#39;re committed to creating a temporary file by hand, use the process ID and/or the current time-value. If you need to have many temporary files in one process, use a counter:</p>

<pre><code>    BEGIN {
	use Fcntl;
	my $temp_dir = -d &#39;/tmp&#39; ? &#39;/tmp&#39; : $ENV{TMP} || $ENV{TEMP};
	my $base_name = sprintf(&quot;%s/%d-%d-0000&quot;, $temp_dir, $$, time());
	sub temp_file {
	    local *FH;
	    my $count = 0;
	    until (defined(fileno(FH)) || $count++ &gt; 100) {
		$base_name =~ s/-(\d+)$/&quot;-&quot; . (1 + $1)/e;
		sysopen(FH, $base_name, O_WRONLY|O_EXCL|O_CREAT);
	    }
	    if (defined(fileno(FH))
		return (*FH, $base_name);
	    } else {
		return ();
	    }
	}
    }</code></pre>

<h2 id="How-can-I-manipulate-fixed-record-length-files?"><a class="permalink" href="#How-can-I-manipulate-fixed-record-length-files?">#</a><a id="How4"></a><a id="How-can-I-manipulate-fixed-record-length-files"></a>How can I manipulate fixed-record-length files?</h2>

<p>The most efficient way is using pack() and unpack(). This is faster than using substr() when taking many, many strings. It is slower for just a few.</p>

<p>Here is a sample chunk of code to break up and put back together again some fixed-format input lines, in this case from the output of a normal, Berkeley-style ps:</p>

<pre><code>    # sample input line:
    #   15158 p5  T      0:00 perl /home/tchrist/scripts/now-what
    $PS_T = &#39;A6 A4 A7 A5 A*&#39;;
    open(PS, &quot;ps|&quot;);
    print scalar &lt;PS&gt;; 
    while (&lt;PS&gt;) {
	($pid, $tt, $stat, $time, $command) = unpack($PS_T, $_);
	for $var (qw!pid tt stat time command!) {
	    print &quot;$var: &lt;$$var&gt;\n&quot;;
	}
	print &#39;line=&#39;, pack($PS_T, $pid, $tt, $stat, $time, $command),
		&quot;\n&quot;;
    }</code></pre>

<p>We&#39;ve used <code>$$var</code> in a way that forbidden by <code>use strict &#39;refs&#39;</code>. That is, we&#39;ve promoted a string to a scalar variable reference using symbolic references. This is ok in small programs, but doesn&#39;t scale well. It also only works on global variables, not lexicals.</p>

<h2 id="How-can-I-make-a-filehandle-local-to-a-subroutine?-How-do-I-pass-filehandles-between-subroutines?-How-do-I-make-an-array-of-filehandles?"><a class="permalink" href="#How-can-I-make-a-filehandle-local-to-a-subroutine?-How-do-I-pass-filehandles-between-subroutines?-How-do-I-make-an-array-of-filehandles?">#</a><a id="How5"></a><a id="How-can-I-make-a-filehandle-local-to-a-subroutine-How-do-I-pass-filehandles-between-subroutines-How-do-I-make-an-array-of-filehandles"></a>How can I make a filehandle local to a subroutine? How do I pass filehandles between subroutines? How do I make an array of filehandles?</h2>

<p>The fastest, simplest, and most direct way is to localize the typeglob of the filehandle in question:</p>

<pre><code>local *TmpHandle;</code></pre>

<p>Typeglobs are fast (especially compared with the alternatives) and reasonably easy to use, but they also have one subtle drawback. If you had, for example, a function named TmpHandle(), or a variable named %TmpHandle, you just hid it from yourself.</p>

<pre><code>    sub findme {
        local *HostFile;
	open(HostFile, &quot;&lt;/etc/hosts&quot;) or die &quot;no /etc/hosts: $!&quot;;
	local $_;		# &lt;- VERY IMPORTANT
        while (&lt;HostFile&gt;) {
	    print if /\b127\.(0\.0\.)?1\b/;
	}
	# *HostFile automatically closes/disappears here
    }</code></pre>

<p>Here&#39;s how to use typeglobs in a loop to open and store a bunch of filehandles. We&#39;ll use as values of the hash an ordered pair to make it easy to sort the hash in insertion order.</p>

<pre><code>    @names = qw(motd termcap passwd hosts);
    my $i = 0;
    foreach $filename (@names) {
	local *FH;
	open(FH, &quot;/etc/$filename&quot;) || die &quot;$filename: $!&quot;;
        $file{$filename} = [ $i++, *FH ];
    }

    # Using the filehandles in the array
    foreach $name (sort { $file{$a}[0] &lt;=&gt; $file{$b}[0] } keys %file) {
        my $fh = $file{$name}[1];
        my $line = &lt;$fh&gt;;
        print &quot;$name $. $line&quot;;
    }</code></pre>

<p>For passing filehandles to functions, the easiest way is to preface them with a star, as in func(*STDIN). See <a href="perlfaq7.html#Passing-Filehandles">&quot;Passing Filehandles&quot; in perlfaq7</a> for details.</p>

<p>If you want to create many anonymous handles, you should check out the Symbol, FileHandle, or IO::Handle (etc.) modules. Here&#39;s the equivalent code with Symbol::gensym, which is reasonably light-weight:</p>

<pre><code>    foreach $filename (@names) {
	use Symbol;
	my $fh = gensym();
	open($fh, &quot;/etc/$filename&quot;) || die &quot;open /etc/$filename: $!&quot;;
        $file{$filename} = [ $i++, $fh ];
    }</code></pre>

<p>Here&#39;s using the semi-object-oriented FileHandle module, which certainly isn&#39;t light-weight:</p>

<pre><code>use FileHandle;

foreach $filename (@names) {
    my $fh = FileHandle-&gt;new(&quot;/etc/$filename&quot;) or die &quot;$filename: $!&quot;;
    $file{$filename} = [ $i++, $fh ];
}</code></pre>

<p>Please understand that whether the filehandle happens to be a (probably localized) typeglob or an anonymous handle from one of the modules in no way affects the bizarre rules for managing indirect handles. See the next question.</p>

<h2 id="How-can-I-use-a-filehandle-indirectly?"><a class="permalink" href="#How-can-I-use-a-filehandle-indirectly?">#</a><a id="How6"></a><a id="How-can-I-use-a-filehandle-indirectly"></a>How can I use a filehandle indirectly?</h2>

<p>An indirect filehandle is using something other than a symbol in a place that a filehandle is expected. Here are ways to get indirect filehandles:</p>

<pre><code>$fh =   SOME_FH;       # bareword is strict-subs hostile
$fh =  &quot;SOME_FH&quot;;      # strict-refs hostile; same package only
$fh =  *SOME_FH;       # typeglob
$fh = \*SOME_FH;       # ref to typeglob (bless-able)
$fh =  *SOME_FH{IO};   # blessed IO::Handle from *SOME_FH typeglob</code></pre>

<p>Or, you can use the <code>new</code> method from the FileHandle or IO modules to create an anonymous filehandle, store that in a scalar variable, and use it as though it were a normal filehandle.</p>

<pre><code>use FileHandle;
$fh = FileHandle-&gt;new();

use IO::Handle;                     # 5.004 or higher
$fh = IO::Handle-&gt;new();</code></pre>

<p>Then use any of those as you would a normal filehandle. Anywhere that Perl is expecting a filehandle, an indirect filehandle may be used instead. An indirect filehandle is just a scalar variable that contains a filehandle. Functions like <code>print</code>, <code>open</code>, <code>seek</code>, or the <code>&lt;FH&gt;</code> diamond operator will accept either a read filehandle or a scalar variable containing one:</p>

<pre><code>($ifh, $ofh, $efh) = (*STDIN, *STDOUT, *STDERR);
print $ofh &quot;Type it: &quot;;
$got = &lt;$ifh&gt;
print $efh &quot;What was that: $got&quot;;</code></pre>

<p>If you&#39;re passing a filehandle to a function, you can write the function in two ways:</p>

<pre><code>sub accept_fh {
    my $fh = shift;
    print $fh &quot;Sending to indirect filehandle\n&quot;;
}</code></pre>

<p>Or it can localize a typeglob and use the filehandle directly:</p>

<pre><code>sub accept_fh {
    local *FH = shift;
    print  FH &quot;Sending to localized filehandle\n&quot;;
}</code></pre>

<p>Both styles work with either objects or typeglobs of real filehandles. (They might also work with strings under some circumstances, but this is risky.)</p>

<pre><code>accept_fh(*STDOUT);
accept_fh($handle);</code></pre>

<p>In the examples above, we assigned the filehandle to a scalar variable before using it. That is because only simple scalar variables, not expressions or subscripts of hashes or arrays, can be used with built-ins like <code>print</code>, <code>printf</code>, or the diamond operator. Using something other than a simple scalar varaible as a filehandle is illegal and won&#39;t even compile:</p>

<pre><code>@fd = (*STDIN, *STDOUT, *STDERR);
print $fd[1] &quot;Type it: &quot;;                           # WRONG
$got = &lt;$fd[0]&gt;                                     # WRONG
print $fd[2] &quot;What was that: $got&quot;;                 # WRONG</code></pre>

<p>With <code>print</code> and <code>printf</code>, you get around this by using a block and an expression where you would place the filehandle:</p>

<pre><code>print  { $fd[1] } &quot;funny stuff\n&quot;;
printf { $fd[1] } &quot;Pity the poor %x.\n&quot;, 3_735_928_559;
# Pity the poor deadbeef.</code></pre>

<p>That block is a proper block like any other, so you can put more complicated code there. This sends the message out to one of two places:</p>

<pre><code>$ok = -x &quot;/bin/cat&quot;;                
print { $ok ? $fd[1] : $fd[2] } &quot;cat stat $ok\n&quot;;
print { $fd[ 1+ ($ok || 0) ]  } &quot;cat stat $ok\n&quot;;           </code></pre>

<p>This approach of treating <code>print</code> and <code>printf</code> like object methods calls doesn&#39;t work for the diamond operator. That&#39;s because it&#39;s a real operator, not just a function with a comma-less argument. Assuming you&#39;ve been storing typeglobs in your structure as we did above, you can use the built-in function named <code>readline</code> to reads a record just as <code>&lt;&gt;</code> does. Given the initialization shown above for @fd, this would work, but only because readline() require a typeglob. It doesn&#39;t work with objects or strings, which might be a bug we haven&#39;t fixed yet.</p>

<pre><code>$got = readline($fd[0]);</code></pre>

<p>Let it be noted that the flakiness of indirect filehandles is not related to whether they&#39;re strings, typeglobs, objects, or anything else. It&#39;s the syntax of the fundamental operators. Playing the object game doesn&#39;t help you at all here.</p>

<h2 id="How-can-I-set-up-a-footer-format-to-be-used-with-write()?"><a class="permalink" href="#How-can-I-set-up-a-footer-format-to-be-used-with-write()?">#</a><a id="How7"></a><a id="How-can-I-set-up-a-footer-format-to-be-used-with-write"></a>How can I set up a footer format to be used with write()?</h2>

<p>There&#39;s no builtin way to do this, but <a href="perlform.html">perlform</a> has a couple of techniques to make it possible for the intrepid hacker.</p>

<h2 id="How-can-I-write()-into-a-string?"><a class="permalink" href="#How-can-I-write()-into-a-string?">#</a><a id="How8"></a><a id="How-can-I-write-into-a-string"></a>How can I write() into a string?</h2>

<p>See <a href="perlform.html#Accessing-Formatting-Internals">&quot;Accessing Formatting Internals&quot; in perlform</a> for an swrite() function.</p>

<h2 id="How-can-I-output-my-numbers-with-commas-added?"><a class="permalink" href="#How-can-I-output-my-numbers-with-commas-added?">#</a><a id="How9"></a><a id="How-can-I-output-my-numbers-with-commas-added"></a>How can I output my numbers with commas added?</h2>

<p>This one will do it for you:</p>

<pre><code>    sub commify {
	local $_  = shift;
	1 while s/^([-+]?\d+)(\d{3})/$1,$2/;
	return $_;
    }

    $n = 23659019423.2331;
    print &quot;GOT: &quot;, commify($n), &quot;\n&quot;;

    GOT: 23,659,019,423.2331</code></pre>

<p>You can&#39;t just:</p>

<pre><code>s/^([-+]?\d+)(\d{3})/$1,$2/g;</code></pre>

<p>because you have to put the comma in and then recalculate your position.</p>

<p>Alternatively, this code commifies all numbers in a line regardless of whether they have decimal portions, are preceded by + or -, or whatever:</p>

<pre><code># from Andrew Johnson &lt;ajohnson@gpu.srv.ualberta.ca&gt;
sub commify {
   my $input = shift;
    $input = reverse $input;
    $input =~ s&lt;(\d\d\d)(?=\d)(?!\d*\.)&gt;&lt;$1,&gt;g;
    return scalar reverse $input;
}</code></pre>

<h2 id="How-can-I-translate-tildes-(~)-in-a-filename?"><a class="permalink" href="#How-can-I-translate-tildes-(~)-in-a-filename?">#</a><a id="How10"></a><a id="How-can-I-translate-tildes-in-a-filename"></a>How can I translate tildes (~) in a filename?</h2>

<p>Use the &lt;&gt; (glob()) operator, documented in <a href="perlfunc.html">perlfunc</a>. Older versions of Perl require that you have a shell installed that groks tildes. Recent perl versions have this feature built in. The Glob::KGlob module (available from CPAN) gives more portable glob functionality.</p>

<p>Within Perl, you may use this directly:</p>

<pre><code>$filename =~ s{
  ^ ~             # find a leading tilde
  (               # save this in $1
      [^/]        # a non-slash character
            *     # repeated 0 or more times (0 means me)
  )
}{
  $1
      ? (getpwnam($1))[7]
      : ( $ENV{HOME} || $ENV{LOGDIR} )
}ex;</code></pre>

<h2 id="How-come-when-I-open-a-file-read-write-it-wipes-it-out?"><a class="permalink" href="#How-come-when-I-open-a-file-read-write-it-wipes-it-out?">#</a><a id="How11"></a><a id="How-come-when-I-open-a-file-read-write-it-wipes-it-out"></a>How come when I open a file read-write it wipes it out?</h2>

<p>Because you&#39;re using something like this, which truncates the file and <i>then</i> gives you read-write access:</p>

<pre><code>open(FH, &quot;+&gt; /path/name&quot;);		# WRONG (almost always)</code></pre>

<p>Whoops. You should instead use this, which will fail if the file doesn&#39;t exist.</p>

<pre><code>open(FH, &quot;+&lt; /path/name&quot;);  	# open for update</code></pre>

<p>Using &quot;&gt;&quot; always clobbers or creates. Using &quot;&lt;&quot; never does either. The &quot;+&quot; doesn&#39;t change this.</p>

<p>Here are examples of many kinds of file opens. Those using sysopen() all assume</p>

<pre><code>use Fcntl;</code></pre>

<p>To open file for reading:</p>

<pre><code>open(FH, &quot;&lt; $path&quot;)                                 || die $!;
sysopen(FH, $path, O_RDONLY)                        || die $!;</code></pre>

<p>To open file for writing, create new file if needed or else truncate old file:</p>

<pre><code>open(FH, &quot;&gt; $path&quot;) || die $!;
sysopen(FH, $path, O_WRONLY|O_TRUNC|O_CREAT)        || die $!;
sysopen(FH, $path, O_WRONLY|O_TRUNC|O_CREAT, 0666)  || die $!;</code></pre>

<p>To open file for writing, create new file, file must not exist:</p>

<pre><code>sysopen(FH, $path, O_WRONLY|O_EXCL|O_CREAT)         || die $!;
sysopen(FH, $path, O_WRONLY|O_EXCL|O_CREAT, 0666)   || die $!;</code></pre>

<p>To open file for appending, create if necessary:</p>

<pre><code>open(FH, &quot;&gt;&gt; $path&quot;) || die $!;
sysopen(FH, $path, O_WRONLY|O_APPEND|O_CREAT)       || die $!;
sysopen(FH, $path, O_WRONLY|O_APPEND|O_CREAT, 0666) || die $!;</code></pre>

<p>To open file for appending, file must exist:</p>

<pre><code>sysopen(FH, $path, O_WRONLY|O_APPEND)               || die $!;</code></pre>

<p>To open file for update, file must exist:</p>

<pre><code>open(FH, &quot;+&lt; $path&quot;)                                || die $!;
sysopen(FH, $path, O_RDWR)                          || die $!;</code></pre>

<p>To open file for update, create file if necessary:</p>

<pre><code>sysopen(FH, $path, O_RDWR|O_CREAT)                  || die $!;
sysopen(FH, $path, O_RDWR|O_CREAT, 0666)            || die $!;</code></pre>

<p>To open file for update, file must not exist:</p>

<pre><code>sysopen(FH, $path, O_RDWR|O_EXCL|O_CREAT)           || die $!;
sysopen(FH, $path, O_RDWR|O_EXCL|O_CREAT, 0666)     || die $!;</code></pre>

<p>To open a file without blocking, creating if necessary:</p>

<pre><code class="plaintext">    sysopen(FH, &quot;/tmp/somefile&quot;, O_WRONLY|O_NDELAY|O_CREAT)
	    or die &quot;can&#39;t open /tmp/somefile: $!&quot;:</code></pre>

<p>Be warned that neither creation nor deletion of files is guaranteed to be an atomic operation over NFS. That is, two processes might both successfully create or unlink the same file! Therefore O_EXCL isn&#39;t as exclusive as you might wish.</p>

<p>See also the new <a href="perlopentut.html">perlopentut</a> if you have it (new for 5.6).</p>

<h2 id="Why-do-I-sometimes-get-an-&quot;Argument-list-too-long&quot;-when-I-use-&lt;*&gt;?"><a class="permalink" href="#Why-do-I-sometimes-get-an-%22Argument-list-too-long%22-when-I-use-%3C*%3E?">#</a><a id="Why"></a><a id="Why-do-I-sometimes-get-an-Argument-list-too-long-when-I-use"></a>Why do I sometimes get an &quot;Argument list too long&quot; when I use &lt;*&gt;?</h2>

<p>The <code>&lt;&gt;</code> operator performs a globbing operation (see above). In Perl versions earlier than v5.6.0, the internal glob() operator forks csh(1) to do the actual glob expansion, but csh can&#39;t handle more than 127 items and so gives the error message <code>Argument list too long</code>. People who installed tcsh as csh won&#39;t have this problem, but their users may be surprised by it.</p>

<p>To get around this, either upgrade to Perl v5.6.0 or later, do the glob yourself with readdir() and patterns, or use a module like Glob::KGlob, one that doesn&#39;t use the shell to do globbing.</p>

<h2 id="Is-there-a-leak/bug-in-glob()?"><a class="permalink" href="#Is-there-a-leak/bug-in-glob()?">#</a><a id="Is"></a><a id="Is-there-a-leak-bug-in-glob"></a>Is there a leak/bug in glob()?</h2>

<p>Due to the current implementation on some operating systems, when you use the glob() function or its angle-bracket alias in a scalar context, you may cause a memory leak and/or unpredictable behavior. It&#39;s best therefore to use glob() only in list context.</p>

<h2 id="How-can-I-open-a-file-with-a-leading-&quot;&gt;&quot;-or-trailing-blanks?"><a class="permalink" href="#How-can-I-open-a-file-with-a-leading-%22%3E%22-or-trailing-blanks?">#</a><a id="How12"></a><a id="How-can-I-open-a-file-with-a-leading-or-trailing-blanks"></a>How can I open a file with a leading &quot;&gt;&quot; or trailing blanks?</h2>

<p>Normally perl ignores trailing blanks in filenames, and interprets certain leading characters (or a trailing &quot;|&quot;) to mean something special. To avoid this, you might want to use a routine like the one below. It turns incomplete pathnames into explicit relative ones, and tacks a trailing null byte on the name to make perl leave it alone:</p>

<pre><code>    sub safe_filename {
	local $_  = shift;
        s#^([^./])#./$1#;
        $_ .= &quot;\0&quot;;
	return $_;
    }

    $badpath = &quot;&lt;&lt;&lt;something really wicked   &quot;;
    $fn = safe_filename($badpath&quot;);
    open(FH, &quot;&gt; $fn&quot;) or &quot;couldn&#39;t open $badpath: $!&quot;;</code></pre>

<p>This assumes that you are using POSIX (portable operating systems interface) paths. If you are on a closed, non-portable, proprietary system, you may have to adjust the <code>&quot;./&quot;</code> above.</p>

<p>It would be a lot clearer to use sysopen(), though:</p>

<pre><code>    use Fcntl;
    $badpath = &quot;&lt;&lt;&lt;something really wicked   &quot;;
    sysopen (FH, $badpath, O_WRONLY | O_CREAT | O_TRUNC)
	or die &quot;can&#39;t open $badpath: $!&quot;;</code></pre>

<p>For more information, see also the new <a href="perlopentut.html">perlopentut</a> if you have it (new for 5.6).</p>

<h2 id="How-can-I-reliably-rename-a-file?"><a class="permalink" href="#How-can-I-reliably-rename-a-file?">#</a><a id="How13"></a><a id="How-can-I-reliably-rename-a-file"></a>How can I reliably rename a file?</h2>

<p>Well, usually you just use Perl&#39;s rename() function. That may not work everywhere, though, particularly when renaming files across file systems. Some sub-Unix systems have broken ports that corrupt the semantics of rename()--for example, WinNT does this right, but Win95 and Win98 are broken. (The last two parts are not surprising, but the first is. :-)</p>

<p>If your operating system supports a proper mv(1) program or its moral equivalent, this works:</p>

<pre><code>rename($old, $new) or system(&quot;mv&quot;, $old, $new);</code></pre>

<p>It may be more compelling to use the File::Copy module instead. You just copy to the new file to the new name (checking return values), then delete the old one. This isn&#39;t really the same semantically as a real rename(), though, which preserves metainformation like permissions, timestamps, inode info, etc.</p>

<p>Newer versions of File::Copy exports a move() function.</p>

<h2 id="How-can-I-lock-a-file?"><a class="permalink" href="#How-can-I-lock-a-file?">#</a><a id="How14"></a><a id="How-can-I-lock-a-file"></a>How can I lock a file?</h2>

<p>Perl&#39;s builtin flock() function (see <a href="perlfunc.html">perlfunc</a> for details) will call flock(2) if that exists, fcntl(2) if it doesn&#39;t (on perl version 5.004 and later), and lockf(3) if neither of the two previous system calls exists. On some systems, it may even use a different form of native locking. Here are some gotchas with Perl&#39;s flock():</p>

<ol>

<li><p>Produces a fatal error if none of the three system calls (or their close equivalent) exists.</p>

</li>
<li><p>lockf(3) does not provide shared locking, and requires that the filehandle be open for writing (or appending, or read/writing).</p>

</li>
<li><p>Some versions of flock() can&#39;t lock files over a network (e.g. on NFS file systems), so you&#39;d need to force the use of fcntl(2) when you build Perl. But even this is dubious at best. See the flock entry of <a href="perlfunc.html">perlfunc</a> and the <i>INSTALL</i> file in the source distribution for information on building Perl to do this.</p>

<p>Two potentially non-obvious but traditional flock semantics are that it waits indefinitely until the lock is granted, and that its locks are <i>merely advisory</i>. Such discretionary locks are more flexible, but offer fewer guarantees. This means that files locked with flock() may be modified by programs that do not also use flock(). Cars that stop for red lights get on well with each other, but not with cars that don&#39;t stop for red lights. See the perlport manpage, your port&#39;s specific documentation, or your system-specific local manpages for details. It&#39;s best to assume traditional behavior if you&#39;re writing portable programs. (If you&#39;re not, you should as always feel perfectly free to write for your own system&#39;s idiosyncrasies (sometimes called &quot;features&quot;). Slavish adherence to portability concerns shouldn&#39;t get in the way of your getting your job done.)</p>

<p>For more information on file locking, see also <a href="perlopentut.html#File-Locking">&quot;File Locking&quot; in perlopentut</a> if you have it (new for 5.6).</p>

</li>
</ol>

<h2 id="Why-can&#39;t-I-just-open(FH,-&quot;&gt;file.lock&quot;)?"><a class="permalink" href="#Why-can&#39;t-I-just-open(FH,-%22%3Efile.lock%22)?">#</a><a id="Why1"></a><a id="Why-cant-I-just-open-FH-file.lock"></a>Why can&#39;t I just open(FH, &quot;&gt;file.lock&quot;)?</h2>

<p>A common bit of code <b>NOT TO USE</b> is this:</p>

<pre><code>sleep(3) while -e &quot;file.lock&quot;;	# PLEASE DO NOT USE
open(LCK, &quot;&gt; file.lock&quot;);		# THIS BROKEN CODE</code></pre>

<p>This is a classic race condition: you take two steps to do something which must be done in one. That&#39;s why computer hardware provides an atomic test-and-set instruction. In theory, this &quot;ought&quot; to work:</p>

<pre><code class="plaintext">    sysopen(FH, &quot;file.lock&quot;, O_WRONLY|O_EXCL|O_CREAT)
		or die &quot;can&#39;t open  file.lock: $!&quot;:</code></pre>

<p>except that lamentably, file creation (and deletion) is not atomic over NFS, so this won&#39;t work (at least, not every time) over the net. Various schemes involving link() have been suggested, but these tend to involve busy-wait, which is also subdesirable.</p>

<h2 id="I-still-don&#39;t-get-locking.-I-just-want-to-increment-the-number-in-the-file.-How-can-I-do-this?"><a class="permalink" href="#I-still-don&#39;t-get-locking.-I-just-want-to-increment-the-number-in-the-file.-How-can-I-do-this?">#</a><a id="I"></a><a id="I-still-dont-get-locking.-I-just-want-to-increment-the-number-in-the-file.-How-can-I-do-this"></a>I still don&#39;t get locking. I just want to increment the number in the file. How can I do this?</h2>

<p>Didn&#39;t anyone ever tell you web-page hit counters were useless? They don&#39;t count number of hits, they&#39;re a waste of time, and they serve only to stroke the writer&#39;s vanity. It&#39;s better to pick a random number; they&#39;re more realistic.</p>

<p>Anyway, this is what you can do if you can&#39;t help yourself.</p>

<pre><code>use Fcntl qw(:DEFAULT :flock);
sysopen(FH, &quot;numfile&quot;, O_RDWR|O_CREAT) 	 or die &quot;can&#39;t open numfile: $!&quot;;
flock(FH, LOCK_EX) 				 or die &quot;can&#39;t flock numfile: $!&quot;;
$num = &lt;FH&gt; || 0;
seek(FH, 0, 0) 				 or die &quot;can&#39;t rewind numfile: $!&quot;;
truncate(FH, 0) 				 or die &quot;can&#39;t truncate numfile: $!&quot;;
(print FH $num+1, &quot;\n&quot;)			 or die &quot;can&#39;t write numfile: $!&quot;;
close FH 					 or die &quot;can&#39;t close numfile: $!&quot;;</code></pre>

<p>Here&#39;s a much better web-page hit counter:</p>

<pre><code>$hits = int( (time() - 850_000_000) / rand(1_000) );</code></pre>

<p>If the count doesn&#39;t impress your friends, then the code might. :-)</p>

<h2 id="How-do-I-randomly-update-a-binary-file?"><a class="permalink" href="#How-do-I-randomly-update-a-binary-file?">#</a><a id="How15"></a><a id="How-do-I-randomly-update-a-binary-file"></a>How do I randomly update a binary file?</h2>

<p>If you&#39;re just trying to patch a binary, in many cases something as simple as this works:</p>

<pre><code class="plaintext">perl -i -pe &#39;s{window manager}{window mangler}g&#39; /usr/bin/emacs</code></pre>

<p>However, if you have fixed sized records, then you might do something more like this:</p>

<pre><code>$RECSIZE = 220; # size of record, in bytes
$recno   = 37;  # which record to update
open(FH, &quot;+&lt;somewhere&quot;) || die &quot;can&#39;t update somewhere: $!&quot;;
seek(FH, $recno * $RECSIZE, 0);
read(FH, $record, $RECSIZE) == $RECSIZE || die &quot;can&#39;t read record $recno: $!&quot;;
# munge the record
seek(FH, -$RECSIZE, 1);
print FH $record;
close FH;</code></pre>

<p>Locking and error checking are left as an exercise for the reader. Don&#39;t forget them or you&#39;ll be quite sorry.</p>

<h2 id="How-do-I-get-a-file&#39;s-timestamp-in-perl?"><a class="permalink" href="#How-do-I-get-a-file&#39;s-timestamp-in-perl?">#</a><a id="How16"></a><a id="How-do-I-get-a-files-timestamp-in-perl"></a>How do I get a file&#39;s timestamp in perl?</h2>

<p>If you want to retrieve the time at which the file was last read, written, or had its meta-data (owner, etc) changed, you use the <b>-M</b>, <b>-A</b>, or <b>-C</b> filetest operations as documented in <a href="perlfunc.html">perlfunc</a>. These retrieve the age of the file (measured against the start-time of your program) in days as a floating point number. To retrieve the &quot;raw&quot; time in seconds since the epoch, you would call the stat function, then use localtime(), gmtime(), or POSIX::strftime() to convert this into human-readable form.</p>

<p>Here&#39;s an example:</p>

<pre><code>    $write_secs = (stat($file))[9];
    printf &quot;file %s updated at %s\n&quot;, $file,
	scalar localtime($write_secs);</code></pre>

<p>If you prefer something more legible, use the File::stat module (part of the standard distribution in version 5.004 and later):</p>

<pre><code># error checking left as an exercise for reader.
use File::stat;
use Time::localtime;
$date_string = ctime(stat($file)-&gt;mtime);
print &quot;file $file updated at $date_string\n&quot;;</code></pre>

<p>The POSIX::strftime() approach has the benefit of being, in theory, independent of the current locale. See <a href="perllocale.html">perllocale</a> for details.</p>

<h2 id="How-do-I-set-a-file&#39;s-timestamp-in-perl?"><a class="permalink" href="#How-do-I-set-a-file&#39;s-timestamp-in-perl?">#</a><a id="How17"></a><a id="How-do-I-set-a-files-timestamp-in-perl"></a>How do I set a file&#39;s timestamp in perl?</h2>

<p>You use the utime() function documented in <a href="perlfunc.html#utime">&quot;utime&quot; in perlfunc</a>. By way of example, here&#39;s a little program that copies the read and write times from its first argument to all the rest of them.</p>

<pre><code>    if (@ARGV &lt; 2) {
	die &quot;usage: cptimes timestamp_file other_files ...\n&quot;;
    }
    $timestamp = shift;
    ($atime, $mtime) = (stat($timestamp))[8,9];
    utime $atime, $mtime, @ARGV;</code></pre>

<p>Error checking is, as usual, left as an exercise for the reader.</p>

<p>Note that utime() currently doesn&#39;t work correctly with Win95/NT ports. A bug has been reported. Check it carefully before using utime() on those platforms.</p>

<h2 id="How-do-I-print-to-more-than-one-file-at-once?"><a class="permalink" href="#How-do-I-print-to-more-than-one-file-at-once?">#</a><a id="How18"></a><a id="How-do-I-print-to-more-than-one-file-at-once"></a>How do I print to more than one file at once?</h2>

<p>If you only have to do this once, you can do this:</p>

<pre><code>for $fh (FH1, FH2, FH3) { print $fh &quot;whatever\n&quot; }</code></pre>

<p>To connect up to one filehandle to several output filehandles, it&#39;s easiest to use the tee(1) program if you have it, and let it take care of the multiplexing:</p>

<pre><code>open (FH, &quot;| tee file1 file2 file3&quot;);</code></pre>

<p>Or even:</p>

<pre><code># make STDOUT go to three files, plus original STDOUT
open (STDOUT, &quot;| tee file1 file2 file3&quot;) or die &quot;Teeing off: $!\n&quot;;
print &quot;whatever\n&quot;                       or die &quot;Writing: $!\n&quot;;
close(STDOUT)                            or die &quot;Closing: $!\n&quot;;</code></pre>

<p>Otherwise you&#39;ll have to write your own multiplexing print function--or your own tee program--or use Tom Christiansen&#39;s, at http://www.perl.com/CPAN/authors/id/TOMC/scripts/tct.gz , which is written in Perl and offers much greater functionality than the stock version.</p>

<h2 id="How-can-I-read-in-an-entire-file-all-at-once?"><a class="permalink" href="#How-can-I-read-in-an-entire-file-all-at-once?">#</a><a id="How19"></a><a id="How-can-I-read-in-an-entire-file-all-at-once"></a>How can I read in an entire file all at once?</h2>

<p>The customary Perl approach for processing all the lines in a file is to do so one line at a time:</p>

<pre><code>    open (INPUT, $file) 	|| die &quot;can&#39;t open $file: $!&quot;;
    while (&lt;INPUT&gt;) {
	chomp;
	# do something with $_
    } 
    close(INPUT)	    	|| die &quot;can&#39;t close $file: $!&quot;;</code></pre>

<p>This is tremendously more efficient than reading the entire file into memory as an array of lines and then processing it one element at a time, which is often--if not almost always--the wrong approach. Whenever you see someone do this:</p>

<pre><code>@lines = &lt;INPUT&gt;;</code></pre>

<p>you should think long and hard about why you need everything loaded at once. It&#39;s just not a scalable solution. You might also find it more fun to use the standard DB_File module&#39;s $DB_RECNO bindings, which allow you to tie an array to a file so that accessing an element the array actually accesses the corresponding line in the file.</p>

<p>On very rare occasion, you may have an algorithm that demands that the entire file be in memory at once as one scalar. The simplest solution to that is</p>

<pre><code>$var = `cat $file`;</code></pre>

<p>Being in scalar context, you get the whole thing. In list context, you&#39;d get a list of all the lines:</p>

<pre><code>@lines = `cat $file`;</code></pre>

<p>This tiny but expedient solution is neat, clean, and portable to all systems on which decent tools have been installed. For those who prefer not to use the toolbox, you can of course read the file manually, although this makes for more complicated code.</p>

<pre><code>    {
	local(*INPUT, $/);
	open (INPUT, $file) 	|| die &quot;can&#39;t open $file: $!&quot;;
	$var = &lt;INPUT&gt;;
    }</code></pre>

<p>That temporarily undefs your record separator, and will automatically close the file at block exit. If the file is already open, just use this:</p>

<pre><code>$var = do { local $/; &lt;INPUT&gt; };</code></pre>

<h2 id="How-can-I-read-in-a-file-by-paragraphs?"><a class="permalink" href="#How-can-I-read-in-a-file-by-paragraphs?">#</a><a id="How20"></a><a id="How-can-I-read-in-a-file-by-paragraphs"></a>How can I read in a file by paragraphs?</h2>

<p>Use the <code>$/</code> variable (see <a href="perlvar.html">perlvar</a> for details). You can either set it to <code>&quot;&quot;</code> to eliminate empty paragraphs (<code>&quot;abc\n\n\n\ndef&quot;</code>, for instance, gets treated as two paragraphs and not three), or <code>&quot;\n\n&quot;</code> to accept empty paragraphs.</p>

<p>Note that a blank line must have no blanks in it. Thus <code>&quot;fred\n \nstuff\n\n&quot;</code> is one paragraph, but <code>&quot;fred\n\nstuff\n\n&quot;</code> is two.</p>

<h2 id="How-can-I-read-a-single-character-from-a-file?-From-the-keyboard?"><a class="permalink" href="#How-can-I-read-a-single-character-from-a-file?-From-the-keyboard?">#</a><a id="How21"></a><a id="How-can-I-read-a-single-character-from-a-file-From-the-keyboard"></a>How can I read a single character from a file? From the keyboard?</h2>

<p>You can use the builtin <code>getc()</code> function for most filehandles, but it won&#39;t (easily) work on a terminal device. For STDIN, either use the Term::ReadKey module from CPAN or use the sample code in <a href="perlfunc.html#getc">&quot;getc&quot; in perlfunc</a>.</p>

<p>If your system supports the portable operating system programming interface (POSIX), you can use the following code, which you&#39;ll note turns off echo processing as well.</p>

<pre><code>    #!/usr/bin/perl -w
    use strict;
    $| = 1;
    for (1..4) {
	my $got;
	print &quot;gimme: &quot;;
	$got = getone();
	print &quot;--&gt; $got\n&quot;;
    }
    exit;

    BEGIN {
	use POSIX qw(:termios_h);

	my ($term, $oterm, $echo, $noecho, $fd_stdin);

	$fd_stdin = fileno(STDIN);

	$term     = POSIX::Termios-&gt;new();
	$term-&gt;getattr($fd_stdin);
	$oterm     = $term-&gt;getlflag();

	$echo     = ECHO | ECHOK | ICANON;
	$noecho   = $oterm &amp; ~$echo;

	sub cbreak {
	    $term-&gt;setlflag($noecho);
	    $term-&gt;setcc(VTIME, 1);
	    $term-&gt;setattr($fd_stdin, TCSANOW);
	}

	sub cooked {
	    $term-&gt;setlflag($oterm);
	    $term-&gt;setcc(VTIME, 0);
	    $term-&gt;setattr($fd_stdin, TCSANOW);
	}

	sub getone {
	    my $key = &#39;&#39;;
	    cbreak();
	    sysread(STDIN, $key, 1);
	    cooked();
	    return $key;
	}

    }

    END { cooked() }</code></pre>

<p>The Term::ReadKey module from CPAN may be easier to use. Recent versions include also support for non-portable systems as well.</p>

<pre><code>use Term::ReadKey;
open(TTY, &quot;&lt;/dev/tty&quot;);
print &quot;Gimme a char: &quot;;
ReadMode &quot;raw&quot;;
$key = ReadKey 0, *TTY;
ReadMode &quot;normal&quot;;
printf &quot;\nYou said %s, char number %03d\n&quot;,
    $key, ord $key;</code></pre>

<p>For legacy DOS systems, Dan Carson &lt;dbc@tc.fluke.COM&gt; reports the following:</p>

<p>To put the PC in &quot;raw&quot; mode, use ioctl with some magic numbers gleaned from msdos.c (Perl source file) and Ralf Brown&#39;s interrupt list (comes across the net every so often):</p>

<pre><code>$old_ioctl = ioctl(STDIN,0,0);     # Gets device info
$old_ioctl &amp;= 0xff;
ioctl(STDIN,1,$old_ioctl | 32);    # Writes it back, setting bit 5</code></pre>

<p>Then to read a single character:</p>

<pre><code>sysread(STDIN,$c,1);               # Read a single character</code></pre>

<p>And to put the PC back to &quot;cooked&quot; mode:</p>

<pre><code>ioctl(STDIN,1,$old_ioctl);         # Sets it back to cooked mode.</code></pre>

<p>So now you have $c. If <code>ord($c) == 0</code>, you have a two byte code, which means you hit a special key. Read another byte with <code>sysread(STDIN,$c,1)</code>, and that value tells you what combination it was according to this table:</p>

<pre><code class="plaintext"># PC 2-byte keycodes = ^@ + the following:

# HEX     KEYS
# ---     ----
# 0F      SHF TAB
# 10-19   ALT QWERTYUIOP
# 1E-26   ALT ASDFGHJKL
# 2C-32   ALT ZXCVBNM
# 3B-44   F1-F10
# 47-49   HOME,UP,PgUp
# 4B      LEFT
# 4D      RIGHT
# 4F-53   END,DOWN,PgDn,Ins,Del
# 54-5D   SHF F1-F10
# 5E-67   CTR F1-F10
# 68-71   ALT F1-F10
# 73-77   CTR LEFT,RIGHT,END,PgDn,HOME
# 78-83   ALT 1234567890-=
# 84      CTR PgUp</code></pre>

<p>This is all trial and error I did a long time ago; I hope I&#39;m reading the file that worked...</p>

<h2 id="How-can-I-tell-whether-there&#39;s-a-character-waiting-on-a-filehandle?"><a class="permalink" href="#How-can-I-tell-whether-there&#39;s-a-character-waiting-on-a-filehandle?">#</a><a id="How22"></a><a id="How-can-I-tell-whether-theres-a-character-waiting-on-a-filehandle"></a>How can I tell whether there&#39;s a character waiting on a filehandle?</h2>

<p>The very first thing you should do is look into getting the Term::ReadKey extension from CPAN. As we mentioned earlier, it now even has limited support for non-portable (read: not open systems, closed, proprietary, not POSIX, not Unix, etc) systems.</p>

<p>You should also check out the Frequently Asked Questions list in comp.unix.* for things like this: the answer is essentially the same. It&#39;s very system dependent. Here&#39;s one solution that works on BSD systems:</p>

<pre><code>    sub key_ready {
	my($rin, $nfd);
	vec($rin, fileno(STDIN), 1) = 1;
	return $nfd = select($rin,undef,undef,0);
    }</code></pre>

<p>If you want to find out how many characters are waiting, there&#39;s also the FIONREAD ioctl call to be looked at. The <i>h2ph</i> tool that comes with Perl tries to convert C include files to Perl code, which can be <code>require</code>d. FIONREAD ends up defined as a function in the <i>sys/ioctl.ph</i> file:</p>

<pre><code>require &#39;sys/ioctl.ph&#39;;

$size = pack(&quot;L&quot;, 0);
ioctl(FH, FIONREAD(), $size)    or die &quot;Couldn&#39;t call ioctl: $!\n&quot;;
$size = unpack(&quot;L&quot;, $size);</code></pre>

<p>If <i>h2ph</i> wasn&#39;t installed or doesn&#39;t work for you, you can <i>grep</i> the include files by hand:</p>

<pre><code class="plaintext">% grep FIONREAD /usr/include/*/*
/usr/include/asm/ioctls.h:#define FIONREAD      0x541B</code></pre>

<p>Or write a small C program using the editor of champions:</p>

<pre><code>% cat &gt; fionread.c
#include &lt;sys/ioctl.h&gt;
main() {
    printf(&quot;%#08x\n&quot;, FIONREAD);
}
^D
% cc -o fionread fionread.c
% ./fionread
0x4004667f</code></pre>

<p>And then hard-code it, leaving porting as an exercise to your successor.</p>

<pre><code>$FIONREAD = 0x4004667f;         # XXX: opsys dependent

$size = pack(&quot;L&quot;, 0);
ioctl(FH, $FIONREAD, $size)     or die &quot;Couldn&#39;t call ioctl: $!\n&quot;;
$size = unpack(&quot;L&quot;, $size);</code></pre>

<p>FIONREAD requires a filehandle connected to a stream, meaning that sockets, pipes, and tty devices work, but <i>not</i> files.</p>

<h2 id="How-do-I-do-a-tail-f-in-perl?"><a class="permalink" href="#How-do-I-do-a-tail-f-in-perl?">#</a><a id="How23"></a><a id="How-do-I-do-a-tail--f-in-perl"></a>How do I do a <code>tail -f</code> in perl?</h2>

<p>First try</p>

<pre><code>seek(GWFILE, 0, 1);</code></pre>

<p>The statement <code>seek(GWFILE, 0, 1)</code> doesn&#39;t change the current position, but it does clear the end-of-file condition on the handle, so that the next &lt;GWFILE&gt; makes Perl try again to read something.</p>

<p>If that doesn&#39;t work (it relies on features of your stdio implementation), then you need something more like this:</p>

<pre><code>for (;;) {
  for ($curpos = tell(GWFILE); &lt;GWFILE&gt;; $curpos = tell(GWFILE)) {
    # search for some stuff and put it into files
  }
  # sleep for a while
  seek(GWFILE, $curpos, 0);  # seek to where we had been
}</code></pre>

<p>If this still doesn&#39;t work, look into the POSIX module. POSIX defines the clearerr() method, which can remove the end of file condition on a filehandle. The method: read until end of file, clearerr(), read some more. Lather, rinse, repeat.</p>

<p>There&#39;s also a File::Tail module from CPAN.</p>

<h2 id="How-do-I-dup()-a-filehandle-in-Perl?"><a class="permalink" href="#How-do-I-dup()-a-filehandle-in-Perl?">#</a><a id="How24"></a><a id="How-do-I-dup-a-filehandle-in-Perl"></a>How do I dup() a filehandle in Perl?</h2>

<p>If you check <a href="perlfunc.html#open">&quot;open&quot; in perlfunc</a>, you&#39;ll see that several of the ways to call open() should do the trick. For example:</p>

<pre><code>open(LOG, &quot;&gt;&gt;/tmp/logfile&quot;);
open(STDERR, &quot;&gt;&amp;LOG&quot;);</code></pre>

<p>Or even with a literal numeric descriptor:</p>

<pre><code>$fd = $ENV{MHCONTEXTFD};
open(MHCONTEXT, &quot;&lt;&amp;=$fd&quot;);	# like fdopen(3S)</code></pre>

<p>Note that &quot;&lt;&amp;STDIN&quot; makes a copy, but &quot;&lt;&amp;=STDIN&quot; make an alias. That means if you close an aliased handle, all aliases become inaccessible. This is not true with a copied one.</p>

<p>Error checking, as always, has been left as an exercise for the reader.</p>

<h2 id="How-do-I-close-a-file-descriptor-by-number?"><a class="permalink" href="#How-do-I-close-a-file-descriptor-by-number?">#</a><a id="How25"></a><a id="How-do-I-close-a-file-descriptor-by-number"></a>How do I close a file descriptor by number?</h2>

<p>This should rarely be necessary, as the Perl close() function is to be used for things that Perl opened itself, even if it was a dup of a numeric descriptor as with MHCONTEXT above. But if you really have to, you may be able to do this:</p>

<pre><code>require &#39;sys/syscall.ph&#39;;
$rc = syscall(&amp;SYS_close, $fd + 0);  # must force numeric
die &quot;can&#39;t sysclose $fd: $!&quot; unless $rc == -1;</code></pre>

<p>Or, just use the fdopen(3S) feature of open():</p>

<pre><code>    { 
	local *F; 
	open F, &quot;&lt;&amp;=$fd&quot; or die &quot;Cannot reopen fd=$fd: $!&quot;;
	close F;
    }</code></pre>

<h2 id="Why-can&#39;t-I-use-&quot;C:\temp\foo&quot;-in-DOS-paths?-What-doesn&#39;t-`C:\temp\foo.exe`-work?"><a class="permalink" href="#Why-can&#39;t-I-use-%22C:%5Ctemp%5Cfoo%22-in-DOS-paths?-What-doesn&#39;t-%60C:%5Ctemp%5Cfoo.exe%60-work?">#</a><a id="Why2"></a><a id="Why-cant-I-use-C:-temp-foo-in-DOS-paths-What-doesnt-C:-temp-foo.exe-work"></a>Why can&#39;t I use &quot;C:\temp\foo&quot; in DOS paths? What doesn&#39;t `C:\temp\foo.exe` work?</h2>

<p>Whoops! You just put a tab and a formfeed into that filename! Remember that within double quoted strings (&quot;like\this&quot;), the backslash is an escape character. The full list of these is in <a href="perlop.html#Quote-and-Quote-like-Operators">&quot;Quote and Quote-like Operators&quot; in perlop</a>. Unsurprisingly, you don&#39;t have a file called &quot;c:(tab)emp(formfeed)oo&quot; or &quot;c:(tab)emp(formfeed)oo.exe&quot; on your legacy DOS filesystem.</p>

<p>Either single-quote your strings, or (preferably) use forward slashes. Since all DOS and Windows versions since something like MS-DOS 2.0 or so have treated <code>/</code> and <code>\</code> the same in a path, you might as well use the one that doesn&#39;t clash with Perl--or the POSIX shell, ANSI C and C++, awk, Tcl, Java, or Python, just to mention a few. POSIX paths are more portable, too.</p>

<h2 id="Why-doesn&#39;t-glob(&quot;*.*&quot;)-get-all-the-files?"><a class="permalink" href="#Why-doesn&#39;t-glob(%22*.*%22)-get-all-the-files?">#</a><a id="Why3"></a><a id="Why-doesnt-glob-.-get-all-the-files"></a>Why doesn&#39;t glob(&quot;*.*&quot;) get all the files?</h2>

<p>Because even on non-Unix ports, Perl&#39;s glob function follows standard Unix globbing semantics. You&#39;ll need <code>glob(&quot;*&quot;)</code> to get all (non-hidden) files. This makes glob() portable even to legacy systems. Your port may include proprietary globbing functions as well. Check its documentation for details.</p>

<h2 id="Why-does-Perl-let-me-delete-read-only-files?-Why-does-i-clobber-protected-files?-Isn&#39;t-this-a-bug-in-Perl?"><a class="permalink" href="#Why-does-Perl-let-me-delete-read-only-files?-Why-does-i-clobber-protected-files?-Isn&#39;t-this-a-bug-in-Perl?">#</a><a id="Why4"></a><a id="Why-does-Perl-let-me-delete-read-only-files-Why-does--i-clobber-protected-files-Isnt-this-a-bug-in-Perl"></a>Why does Perl let me delete read-only files? Why does <code>-i</code> clobber protected files? Isn&#39;t this a bug in Perl?</h2>

<p>This is elaborately and painstakingly described in the &quot;Far More Than You Ever Wanted To Know&quot; in http://www.perl.com/CPAN/doc/FMTEYEWTK/file-dir-perms .</p>

<p>The executive summary: learn how your filesystem works. The permissions on a file say what can happen to the data in that file. The permissions on a directory say what can happen to the list of files in that directory. If you delete a file, you&#39;re removing its name from the directory (so the operation depends on the permissions of the directory, not of the file). If you try to write to the file, the permissions of the file govern whether you&#39;re allowed to.</p>

<h2 id="How-do-I-select-a-random-line-from-a-file?"><a class="permalink" href="#How-do-I-select-a-random-line-from-a-file?">#</a><a id="How26"></a><a id="How-do-I-select-a-random-line-from-a-file"></a>How do I select a random line from a file?</h2>

<p>Here&#39;s an algorithm from the Camel Book:</p>

<pre><code>srand;
rand($.) &lt; 1 &amp;&amp; ($line = $_) while &lt;&gt;;</code></pre>

<p>This has a significant advantage in space over reading the whole file in. A simple proof by induction is available upon request if you doubt the algorithm&#39;s correctness.</p>

<h2 id="Why-do-I-get-weird-spaces-when-I-print-an-array-of-lines?"><a class="permalink" href="#Why-do-I-get-weird-spaces-when-I-print-an-array-of-lines?">#</a><a id="Why5"></a><a id="Why-do-I-get-weird-spaces-when-I-print-an-array-of-lines"></a>Why do I get weird spaces when I print an array of lines?</h2>

<p>Saying</p>

<pre><code>print &quot;@lines\n&quot;;</code></pre>

<p>joins together the elements of <code>@lines</code> with a space between them. If <code>@lines</code> were <code>(&quot;little&quot;, &quot;fluffy&quot;, &quot;clouds&quot;)</code> then the above statement would print</p>

<pre><code class="plaintext">little fluffy clouds</code></pre>

<p>but if each element of <code>@lines</code> was a line of text, ending a newline character <code>(&quot;little\n&quot;, &quot;fluffy\n&quot;, &quot;clouds\n&quot;)</code> then it would print:</p>

<pre><code class="plaintext">little
 fluffy
 clouds</code></pre>

<p>If your array contains lines, just print them:</p>

<pre><code>print @lines;</code></pre>

<h1 id="AUTHOR-AND-COPYRIGHT"><a class="permalink" href="#AUTHOR-AND-COPYRIGHT">#</a><a id="AUTHOR"></a>AUTHOR AND COPYRIGHT</h1>

<p>Copyright (c) 1997-1999 Tom Christiansen and Nathan Torkington. All rights reserved.</p>

<p>When included as an integrated part of the Standard Distribution of Perl or of its documentation (printed or otherwise), this works is covered under Perl&#39;s Artistic License. For separate distributions of all or part of this FAQ outside of that, see <a href="perlfaq.html">perlfaq</a>.</p>

<p>Irrespective of its distribution, all code examples here are in the public domain. You are permitted and encouraged to use this code and any derivatives thereof in your own programs for fun or for profit as you see fit. A simple comment in the code giving credit to the FAQ would be courteous but is not required.</p>

<div class="pod-errors"><p>1 POD Error</p><div class="pod-errors-detail"><p>The following errors were encountered while parsing the POD:</p><dl><dt><a class="permalink" href="#">#</a>Around line 31:</dt><dd><p>alternative text &#39;perlvar/$&#39; contains non-escaped | or /</p></dd></dl></div></div>


      </div>
      <div id="footer">
        <p>Perldoc Browser is maintained by Dan Book (<a href="https://metacpan.org/author/DBOOK">DBOOK</a>). Please contact him via the <a href="https://github.com/Grinnz/perldoc-browser/issues">GitHub issue tracker</a> or <a href="mailto:dbook@cpan.org">email</a> regarding any issues with the site itself, search, or rendering of documentation.</p>

<p>The Perl documentation is maintained by the Perl 5 Porters in the development of Perl. Please contact them via the <a href="https://github.com/Perl/perl5/issues">Perl issue tracker</a>, the <a href="https://lists.perl.org/list/perl5-porters.html">mailing list</a>, or <a href="https://kiwiirc.com/client/irc.perl.org/p5p">IRC</a> to report any issues with the contents or format of the documentation.</p>


      </div>
    </div>
    <script src="../js/bootstrap.bundle.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    <script>hljs.highlightAll();</script>
  </body>

<!-- Mirrored from perldoc.perl.org/5.6.1/perlfaq5 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 06 Aug 2025 16:20:46 GMT -->
</html>
